<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Content personalization on MVC sites - Kentico 11 Documentation</title>

    
    <link rel="stylesheet" href="assets/css/expand-macro.css">

            <meta name="scroll-content-language-key" content="">
    
    <meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=2.0, user-scalable=yes">

<script type="text/javascript" src="assets/js/jquery.min.js"></script>
<script type="text/javascript" src="assets/js/jquery.scrollTo.min.js"></script>


<script type="text/javascript" src="assets/js/translate.js"></script>

<script type="text/javascript" src="assets/js/theme.main.js"></script>

    <script type="text/javascript" src="assets/js/iframeResizer.min.js"></script>

<link rel="stylesheet" href="assets/css/content-style.css">
    <link rel="stylesheet" href="assets/css/search.css">

<link rel="stylesheet" href="assets/css/theme.main.css">
<link rel="stylesheet" href="assets/css/theme.colors.css">

            <!-- ES5 support for older browsers, needed by lunr -->
        <script src="js/augment.js"></script> 
        <script id="worker" type="javascript/worker">

        startIndex = function() {
            idx = lunr.Index.load(lunrIndex);
            idx.pipeline.remove(lunr.stopWordFilter);
            postMessage({type: "setup-complete"});
        }

        onmessage = function (event) {
            var message = event.data;

            if ((message.type === 'setup') && message.baseUrl) {
                var url = message.baseUrl;
                importScripts(url + 'js/lunr.js');
                importScripts(url + 'js/lunr-extras.js');
                importScripts(url + 'js/lunr-index.js');
                importScripts(url + 'js/lunr-data.js');
                startIndex();
            }

            if (idx && (message.type === 'search-request') && message.query) {
                var searchWord = message.query;
                var results = idx.search(searchWord).map(function (result) {
                    return lunrData.filter(function (d) {
                        return d.id === parseInt(result.ref, 10)
                    })[0]
                });
                postMessage({type: 'search-results', results: results, query: searchWord, queryId: message.queryId});
            }
        }

    </script>
    </head>

<body pageid="68879260">

<div id="ht-loader">
    <noscript>
        <p style="width: 100%; text-align:center; position: absolute; margin-top: 200px;">This content cannot be displayed without JavaScript.<br>Please enable JavaScript and reload the page.</p>
    </noscript>
</div>

<div>
   	<header id="ht-headerbar">
    <div class="ht-headerbar-left">
        <a href="" id="ht-menu-toggle" class="sp-aui-icon-small sp-aui-iconfont-appswitcher"></a>
    </div>
    <div class="ht-headerbar-right">
            <div class="sp-aui-icon-small ht-search-index-loader ht-header-icon"></div>

        <div id="ht-search">
            <div class="ht-search-input" style="display: none;">
              	<a href="#" class="sp-aui-icon-small sp-aui-iconfont-remove ht-search-clear"></a>

                <form action="#" method="GET" id="search">
                    <input class="search-input" type="text" placeholder="Search" tabindex="-1" autocomplete="off" name="q" value="">
                    <input type="hidden" name="max" value="15" />
                    <input type="submit" style="display:none" tabindex="-4"/>
                </form>

                <a href="#" id="ht-search-button" class="ht-header-icon ht-header-icon-svg">
                                        <svg width="40px" height="40px" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                        <g>
                            <path d="M29.572,28.802 L28.801,29.571 C28.515,29.857 28.187,30 27.816,30 C27.445,30 27.116,29.857 26.831,29.571 L21.392,24.134 C20.193,24.762 18.908,25.076 17.538,25.076 C15.396,25.076 13.605,24.348 12.163,22.892 C10.721,21.436 10,19.651 10,17.538 C10,15.397 10.721,13.605 12.163,12.163 C13.605,10.721 15.396,10 17.538,10 C19.651,10 21.434,10.721 22.89,12.163 C24.347,13.605 25.075,15.397 25.075,17.538 C25.075,18.937 24.761,20.222 24.132,21.393 L29.572,26.832 C29.857,27.118 30,27.446 30,27.817 C30,28.188 29.857,28.517 29.572,28.802 L29.572,28.802 Z M13.662,21.414 C14.732,22.485 16.024,23.02 17.538,23.02 C19.051,23.02 20.343,22.485 21.413,21.414 C22.484,20.344 23.019,19.052 23.019,17.538 C23.019,16.025 22.484,14.733 21.413,13.662 C20.343,12.592 19.051,12.056 17.538,12.056 C16.024,12.056 14.732,12.592 13.662,13.662 C12.591,14.733 12.056,16.025 12.056,17.538 C12.056,19.052 12.591,20.344 13.662,21.414 L13.662,21.414 Z"></path>
                        </g>
                    </svg>
              	</a>

                <div class="ht-search-dropdown ht-dropdown">
                    <ul></ul>
                </div>
            </div>
        </div>
    </div>
    </header>   	<aside id="ht-sidebar">
    <div class="ht-sidebar-content">
        <div class="ht-sidebar-content-scroll-container">
            <header class="ht-sidebar-header">
                <h1 class="ht-logo">
                    <span class="ht-logo-label">K11</span>
                    <img class="space-logo" src="global.logo" />
                </h1>
                <a href="Kentico-11-Documentation-Home.html" class="ht-space-link">
                    <h2>Kentico 11 Documentation</h2>
                </a>
            </header>
                            <iframe id="ht-nav" src="toc.html?pageId=68880507"></iframe>
                <script>
                    $('iframe#ht-nav').iFrameResize(
                            { 'log': true, 'autoResize': true, 'heightCalculationMethod': 'lowestElement', 'checkOrigin': false });
                </script>
                    </div>
    </div>

</aside></div>

<div id="ht-wrap-container">

            
    <div id="ht-sidebar-dragbar">
    <div class="ht-sidebar-drag-handle">
        <span class="drag-handle-1"></span>
        <span class="drag-handle-2"></span>
        <span class="drag-handle-3"></span>
    </div>
</div>
    <article id="ht-content" class="ht-content">
        <header class="ht-content-header">
            <div id="ht-breadcrumb">
    <ul>
        <li><a href="Kentico-11-Documentation-Home.html">Kentico 11 Documentation</a></li>
                                                                                                             <li><a href="" onclick="$('.shortcut').each(function(){$(this).removeClass('shortcut')}); $(this).parent().addClass('shortcut'); return false;">...</a> </li>
                                        <li class="shortcut"><a href="Developing-websites.html">Developing websites</a></li>
                                                                                                         <li class="shortcut"><a href="Developing-sites-using-ASP.NET-MVC.html">Developing sites using ASP.NET MVC</a></li>
                                                                                     <li><a href="Implementing-on-line-marketing-features-on-MVC-sites.html">Implementing on-line marketing features on MVC sites</a></li>
                                                            </ul>
</div>            <h1 id="src-68880507"> <span>Content personalization on MVC sites</span></h1>
        </header>

        <div id="main-content" class="wiki-content sp-grid-section" data-index-for-search="true">
<p   
>Content personalization is an on-line marketing technique that creates pages with different content depending on the circumstances in which they are viewed. For example, you can build pages that offer special content for different types of visitors or dynamically change for each user according to the actions they performed on the website.</p>
<p   
>When   <a   href="Developing-sites-using-ASP.NET-MVC">developing MVC websites</a>, you cannot create personalization variants of web parts, widgets or zones. Instead, you need to write personalization conditions within the code of your MVC site&#39;s controllers, views or other code. The conditions leverage the visitor segmentation tools that marketers define within the Kentico application &ndash;   <a   href="Segmenting-contacts-into-contact-groups">Contact groups</a> or   <a   href="Personas">Personas</a>.</p>
    <div  class="confbox admonition admonition-note">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p   
><strong class=" ">Prerequisite</strong></p>
<p   
>Before defining content personalization conditions, you first need to set up   <a   href="Tracking-contacts-on-MVC-sites">Tracking of contacts</a> on your MVC website.</p>
        </div>
    </div>
    <div  class="confbox admonition admonition-info">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p   
><strong class=" ">Note</strong>: The <strong class=" ">Settings -&gt; On-line marketing -&gt; Enable content personalization</strong> setting does not have any effect on content personalization conditions written in an MVC website&#39;s code.</p>
        </div>
    </div>
    <div  class="confbox panel">
            <div class="title panel-header">On this page</div>
            <div class="panel-content">
<p   
></p>
<ul class="toc-indentation "><li class=" "><p   
>  <a   href="#src-68880507_ContentpersonalizationonMVCsites-Personalizingcontentbasedoncontactgroups">Personalizing content based on contact groups</a></p>
</li><li class=" "><p   
>  <a   href="#src-68880507_ContentpersonalizationonMVCsites-Personalizingcontentforpersonas">Personalizing content for personas</a></p>
</li><li class=" "><p   
>  <a   href="#src-68880507_ContentpersonalizationonMVCsites-Usingoutputcachingforpersonalizedpages">Using output caching for personalized pages</a></p>
</li></ul><p   
></p>
        </div>
    </div>
    <div  class="confbox panel">
            <div class="title panel-header">Related pages</div>
            <div class="panel-content">
<ul class=" "><li class=" "><p   
>  <a   href="Developing-sites-using-ASP.NET-MVC">Developing sites using ASP.NET MVC</a></p>
</li><li class=" "><p   
>  <a   href="Tracking-contacts-on-MVC-sites">Tracking contacts on MVC sites</a></p>
</li><li class=" "><p   
>  <a   href="Content-personalization">Content personalization</a></p>
</li><li class=" "><p   
>  <a   href="Segmenting-contacts-into-contact-groups">Segmenting contacts into contact groups</a></p>
</li></ul>        </div>
    </div>
    <h3 id="src-68880507_ContentpersonalizationonMVCsites-Personalizingcontentbasedoncontactgroups" class="heading "><span>Personalizing content based on contact groups</span></h3>
<p   
>We recommend using   <a   href="Segmenting-contacts-into-contact-groups">Contact groups</a> to personalize your MVC site&#39;s content:</p>
<ol class=" "><li class=" "><p   
>Define contact groups to segment your website&#39;s visitors (in the <strong class=" ">Contact groups</strong> application within Kentico).</p>
</li><li class=" "><p   
>Use the   <a   href="Tracking-contacts-on-MVC-sites">contact tracking</a> API to get the current contact in your MVC site&#39;s code.</p>
</li><li class=" "><p   
>Create conditions to display different content for contacts who belong to different contact groups.</p>
</li><li class=" "><p   
>Call one of the following extension methods for the current contact object within the conditions:<br/><br/></p>
<ul class=" "><li class=" "><p   
><strong class=" ">IsInContactGroup</strong> &ndash; evaluates whether the contact belongs to one specific contact group.</p>
</li><li class=" "><p   
><strong class=" ">IsInAnyContactGroup</strong> &ndash; evaluates whether the contact belongs to <i class=" ">at least one</i> of the specified contact groups.</p>
</li><li class=" "><p   
><strong class=" ">IsInAllContactGroups</strong> &ndash; evaluates whether the contact belongs to <i class=" ">all</i> of the specified contact groups.</p>
    <div  class="confbox admonition admonition-info">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p   
>All of the methods return a boolean value that you can use in your content conditions.</p>
<p   
>The methods accept one or more string parameters, which must match the <strong class=" ">code names</strong> of contact groups. To find the code names, edit contact groups in the <i class=" ">Contact groups</i> application in Kentico.</p>
        </div>
    </div>
</li></ul></li></ol><p   
>The system segments your website&#39;s visitors into contact groups, for example according to   <a   href="Logging-activities-on-MVC-sites">performed activities</a>. Your MVC site then displays personalized content depending on the contact groups to which the current visitor (contact) belongs.<img  class="wysiwyg-unknown-macro"  src="images/plugins/servlet/confluence/placeholder/unknown-macro.png" alt="images/plugins/servlet/confluence/placeholder/unknown-macro.png"   />
</p>
    <div  class="confbox admonition admonition-tip">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p   
><strong class=" ">Tip</strong>: To view the full code of a functional example directly in Visual Studio, download the <a  class="external-link" href="https://github.com/Kentico/Mvc">Kentico MVC solution</a> from GitHub and inspect the <strong class=" ">LearningKit</strong> project. You can also run the Learning Kit website after connecting the project to a Kentico database.</p>
        </div>
    </div>
<p   
></p>
    <h3 id="src-68880507_ContentpersonalizationonMVCsites-Personalizingcontentforpersonas" class="heading "><span>Personalizing content for personas</span></h3>
<p   
>If you use   <a   href="Personas">Personas</a> to segment your site&#39;s visitors, you can create conditions and serve different content for different personas.</p>
<p   
>To check whether a contact is assigned to a persona:</p>
<ol class=" "><li class=" "><p   
>Get the contact&#39;s persona by calling the <strong class=" ">GetPersona()</strong> extension method for the contact object (requires a reference to the <strong class=" ">CMS.Personas</strong> namespace).</p>
</li><li class=" "><p   
>Create a condition that checks the code name of the persona (or any other persona property).</p>
</li></ol>    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="keyword">using</code><code class="plain"> System;</code></div>
<div class="line"><code class="keyword">using</code><code class="plain"> CMS.ContactManagement;</code></div>
<div class="line"><code class="keyword">using</code><code class="plain"> CMS.Personas;</code></div>
<div class="line"><code class="keyword">using</code><code class="plain"> Kentico.ContactManagement;</code></div>
</div>
    </div>
<p   
><img  class="wysiwyg-unknown-macro"  src="images/plugins/servlet/confluence/placeholder/unknown-macro.png" alt="images/plugins/servlet/confluence/placeholder/unknown-macro.png"   />
    </p>
    <div  class="confbox admonition admonition-tip">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p   
>We recommend using a   <a   href="Initializing-Kentico-services-with-dependency-injection">dependency injection container</a> to initialize service instances. When configuring the lifetime scope for <i class=" ">ContactTrackingService</i>, create a shared instance (singleton) for all requests.</p>
        </div>
    </div>
    <h3 id="src-68880507_ContentpersonalizationonMVCsites-Usingoutputcachingforpersonalizedpages" class="heading "><span>Using output caching for personalized pages</span></h3>
<p   
>When using <a  class="external-link" href="https://docs.microsoft.com/en-us/aspnet/mvc/overview/older-versions-1/controllers-and-routing/improving-performance-with-output-caching-cs">ASP.NET output caching</a> to improve the performance of your MVC website, you need to take additional steps to ensure that personalized pages display the correct content. Because personalized pages serve different content based on conditions, you need to adjust your application to cache separate output versions according to the personalization criteria.</p>
<p   
>The following steps describe how to cache multiple versions of personalized output using custom strings:</p>
<ol class=" "><li class=" "><p   
>Edit your MVC site&#39;s controller classes that serve personalized content.</p>
</li><li class=" "><p   
>Set the <strong class=" ">VaryByCustom</strong> property for the <a  class="external-link" href="https://docs.microsoft.com/en-us/dotnet/api/system.web.mvc.outputcacheattribute"><strong class=" ">OutputCache</strong></a> attributes of the appropriate action methods to a custom string.<img  class="wysiwyg-unknown-macro"  src="images/plugins/servlet/confluence/placeholder/unknown-macro.png" alt="images/plugins/servlet/confluence/placeholder/unknown-macro.png"   />
</p>
</li><li class=" "><p   
>Edit your project&#39;s <strong class=" ">Global.asax</strong> file and override the <a  class="external-link" href="https://docs.microsoft.com/en-us/dotnet/api/system.web.httpapplication.getvarybycustomstring">GetVaryByCustomString</a> method.</p>
<ul class=" "><li class=" "><p   
>The method accepts the string that you set in the <i class=" ">VaryByCustom</i> property of <i class=" ">OutputCache</i> attributes as the <i class=" ">arg</i> string parameter.</p>
</li><li class=" "><p   
>For each custom string, you need to define the caching requirements &ndash; return a string value containing all variables that you wish to use to vary the output cache.</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="keyword">using</code><code class="plain"> System;</code></div>
<div class="line"><code class="keyword">using</code><code class="plain"> System.Linq;</code></div>
<div class="line"><code class="keyword">using</code><code class="plain"> System.Web;</code></div>
<div class="line"> </div>
<div class="line"><code class="keyword">using</code><code class="plain"> CMS.ContactManagement;</code></div>
<div class="line"><code class="keyword">using</code><code class="plain"> Kentico.ContactManagement;</code></div>
</div>
    </div>
<p   
><img  class="wysiwyg-unknown-macro"  src="images/plugins/servlet/confluence/placeholder/unknown-macro.png" alt="images/plugins/servlet/confluence/placeholder/unknown-macro.png"   />
    </p>
    <div  class="confbox admonition admonition-note">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p   
><strong class=" ">Important</strong></p>
<p   
>The &quot;contactdata&quot; example above defines a broad set of cache variables that ensure separate caching for most types of personalization conditions. This may be unnecessary for your website. For optimal caching, you need to prepare output cache variables tailored according to the personalization conditions that you use on the site or individual pages.</p>
<p   
>For example, pages that only check personas in their personalization condition only require the persona identifier in the cache variables &ndash; cached content can be shared for contacts belonging to different contact groups. On the other hand, strongly personalized pages with dynamic content may require separate cache versions for every contact.</p>
<p   
>You always need to balance website performance, memory usage on the server, and the risk of displaying incorrect cached content.</p>
        </div>
    </div>
</li></ul></li></ol><p   
>The application now caches separate versions of action output based on your custom variables. This ensures that visitors do not receive incorrect cached content when viewing personalized pages.</p>
    <div  class="confbox admonition admonition-info">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p   
><strong class=" ">Using client-side only output caching</strong></p>
<p   
>An alternative approach that you can consider is to set the <strong class=" ">Location</strong> property of your <strong class=" ">OutputCache</strong> attributes to <i class=" "><strong class=" ">System.Web.UI.OutputCacheLocation.Client</strong></i>. This disables output caching on the server.</p>
<p   
>With only client-side caching, each client device caches its own personalized content and you do not need to define custom cache variables. This scenario is easier to set up for heavily personalized pages, but the performance gains are usually lower than with optimally configured output caching for both the server and client sides.</p>
        </div>
    </div>
        </div>

    </article>


               
            
    <footer id="ht-footer">
    <a href="#" id="ht-jump-top" class="sp-aui-icon-small sp-aui-iconfont-arrows-up"></a>
</footer></div>

<div>
    <div id="ht-mq-detect"></div>
</div>

    <script src="js/lunr.js"></script>
    <script src="js/lunr-extras.js"></script>
    <script src="assets/js/scroll-search.js"></script>

    <script src="assets/js/expand-macro.js"></script>
</body>
</html>
