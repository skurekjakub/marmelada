<!DOCTYPE html><html><head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Enabling web farms on Azure Web Apps - Kentico 11 Documentation</title>

    
    <link rel="stylesheet" href="assets/css/expand-macro.css">

            <meta name="scroll-content-language-key" content="">
    
    <meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=2.0, user-scalable=yes">

<script type="text/javascript" src="assets/js/jquery.min.js"></script>
<script type="text/javascript" src="assets/js/jquery.scrollTo.min.js"></script>


<script type="text/javascript" src="assets/js/translate.js"></script>

<script type="text/javascript" src="assets/js/theme.main.js"></script>

    <script type="text/javascript" src="assets/js/iframeResizer.min.js"></script>

<link rel="stylesheet" href="assets/css/content-style.css">
    <link rel="stylesheet" href="assets/css/search.css">

<link rel="stylesheet" href="assets/css/theme.main.css">
<link rel="stylesheet" href="assets/css/theme.colors.css">

            <!-- ES5 support for older browsers, needed by lunr -->
        <script src="js/augment.js"></script> 
        <script id="worker" type="javascript/worker">

        startIndex = function() {
            idx = lunr.Index.load(lunrIndex);
            idx.pipeline.remove(lunr.stopWordFilter);
            postMessage({type: "setup-complete"});
        }

        onmessage = function (event) {
            var message = event.data;

            if ((message.type === 'setup') && message.baseUrl) {
                var url = message.baseUrl;
                importScripts(url + 'js/lunr.js');
                importScripts(url + 'js/lunr-extras.js');
                importScripts(url + 'js/lunr-index.js');
                importScripts(url + 'js/lunr-data.js');
                startIndex();
            }

            if (idx && (message.type === 'search-request') && message.query) {
                var searchWord = message.query;
                var results = idx.search(searchWord).map(function (result) {
                    return lunrData.filter(function (d) {
                        return d.id === parseInt(result.ref, 10)
                    })[0]
                });
                postMessage({type: 'search-results', results: results, query: searchWord, queryId: message.queryId});
            }
        }

    </script>
    </head>

<body pageid="68879260">

<div id="ht-loader">
    <noscript>
        <p style="width: 100%; text-align:center; position: absolute; margin-top: 200px;">This content cannot be displayed without JavaScript.<br>Please enable JavaScript and reload the page.</p>
    </noscript>
</div>

<div>
   	<header id="ht-headerbar">
    <div class="ht-headerbar-left">
        <a href="" id="ht-menu-toggle" class="sp-aui-icon-small sp-aui-iconfont-appswitcher"></a>
    </div>
    <div class="ht-headerbar-right">
            <div class="sp-aui-icon-small ht-search-index-loader ht-header-icon"></div>

        <div id="ht-search">
            <div class="ht-search-input" style="display: none;">
              	<a href="#" class="sp-aui-icon-small sp-aui-iconfont-remove ht-search-clear"></a>

                <form action="#" method="GET" id="search">
                    <input class="search-input" type="text" placeholder="Search" tabindex="-1" autocomplete="off" name="q" value="">
                    <input type="hidden" name="max" value="15">
                    <input type="submit" style="display:none" tabindex="-4">
                </form>

                <a href="#" id="ht-search-button" class="ht-header-icon ht-header-icon-svg">
                                        <svg width="40px" height="40px" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                        <g>
                            <path d="M29.572,28.802 L28.801,29.571 C28.515,29.857 28.187,30 27.816,30 C27.445,30 27.116,29.857 26.831,29.571 L21.392,24.134 C20.193,24.762 18.908,25.076 17.538,25.076 C15.396,25.076 13.605,24.348 12.163,22.892 C10.721,21.436 10,19.651 10,17.538 C10,15.397 10.721,13.605 12.163,12.163 C13.605,10.721 15.396,10 17.538,10 C19.651,10 21.434,10.721 22.89,12.163 C24.347,13.605 25.075,15.397 25.075,17.538 C25.075,18.937 24.761,20.222 24.132,21.393 L29.572,26.832 C29.857,27.118 30,27.446 30,27.817 C30,28.188 29.857,28.517 29.572,28.802 L29.572,28.802 Z M13.662,21.414 C14.732,22.485 16.024,23.02 17.538,23.02 C19.051,23.02 20.343,22.485 21.413,21.414 C22.484,20.344 23.019,19.052 23.019,17.538 C23.019,16.025 22.484,14.733 21.413,13.662 C20.343,12.592 19.051,12.056 17.538,12.056 C16.024,12.056 14.732,12.592 13.662,13.662 C12.591,14.733 12.056,16.025 12.056,17.538 C12.056,19.052 12.591,20.344 13.662,21.414 L13.662,21.414 Z"></path>
                        </g>
                    </svg>
              	</a>

                <div class="ht-search-dropdown ht-dropdown">
                    <ul></ul>
                </div>
            </div>
        </div>
    </div>
    </header>   	<aside id="ht-sidebar">
    <div class="ht-sidebar-content">
        <div class="ht-sidebar-content-scroll-container">
            <header class="ht-sidebar-header">
                <h1 class="ht-logo">
                    <span class="ht-logo-label">K11</span>
                    <img class="space-logo" src="global.logo">
                </h1>
                <a href="Kentico-11-Documentation-Home.html" class="ht-space-link">
                    <h2>Kentico 11 Documentation</h2>
                </a>
            </header>
                            <iframe id="ht-nav" src="toc.html?pageId=68881692"></iframe>
                <script>
                    $('iframe#ht-nav').iFrameResize(
                            { 'log': true, 'autoResize': true, 'heightCalculationMethod': 'lowestElement', 'checkOrigin': false });
                </script>
                    </div>
    </div>

</aside></div>

<div id="ht-wrap-container">

            
    <div id="ht-sidebar-dragbar">
    <div class="ht-sidebar-drag-handle">
        <span class="drag-handle-1"></span>
        <span class="drag-handle-2"></span>
        <span class="drag-handle-3"></span>
    </div>
</div>
    <article id="ht-content" class="ht-content">
        <header class="ht-content-header">
            <div id="ht-breadcrumb">
    <ul>
        <li><a href="Kentico-11-Documentation-Home.html">Kentico 11 Documentation</a></li>
                                                                                                             <li><a href="" onclick="$('.shortcut').each(function(){$(this).removeClass('shortcut')}); $(this).parent().addClass('shortcut'); return false;">...</a> </li>
                                        <li class="shortcut"><a href="Running-Kentico-on-Microsoft-Azure.html">Running Kentico on Microsoft Azure</a></li>
                                                                                     <li><a href="Running-Kentico-in-Azure-Web-Apps.html">Running Kentico in Azure Web Apps</a></li>
                                                            </ul>
</div>            <h1 id="src-68881692"> <span>Enabling web farms on Azure Web Apps</span></h1>
        </header>

        <div id="main-content" class="wiki-content sp-grid-section" data-index-for-search="true">
<div class="section-left"></div><p>Microsoft Azure Web Apps allow you to scale the computing power (<i class=" ">scale up</i>) and the number of instances your application is replicated on (<i class=" ">scale out</i>), enabling you to increase the performance and throughput as necessary. Learn more about web app scaling in Microsoft Azure on <a class="external-link" href="https://docs.microsoft.com/en-us/azure/azure-monitor/platform/autoscale-get-started">Get started with Autoscale in Azure</a>.</p>
    <div class="confbox admonition admonition-note">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p>We only support this functionality for <a class="external-link" href="https://docs.microsoft.com/en-us/azure/app-service/azure-web-sites-web-hosting-plans-in-depth-overview">web hosting plans</a> with a <strong class=" ">Basic</strong> or higher <a class="external-link" href="https://azure.microsoft.com/en-us/pricing/details/app-service/">pricing tier</a>.</p>
        </div>
    </div>
<p>Continue depending on your site's development model:</p>
<ul class=" "><li class=" "><p><a href="#src-68881692_enablingwebfarmsonazurewebapps-portalengine">Portal Engine</a></p>
</li><li class=" "><p><a href="#src-68881692_enablingwebfarmsonazurewebapps-mvc">MVC</a></p>
</li></ul>    <div class="section section-1" id="src-68881692_EnablingwebfarmsonAzureWebApps-PortalEngine">
        <h1 class="heading "><span>Portal Engine</span></h1>
<p>For the <i class=" ">scale out</i> functionality to work with Kentico <a href="developing-websites-using-the-portal-engine">Portal Engine</a> sites, you need to enable automatic <a href="setting-up-web-farms">Web farms</a>.</p>
<p>To enable and configure Web farms in your Kentico application:</p>
<ol class=" "><li class=" "><p>Open the Kentico administration interface of your web app.</p>
</li><li class=" "><p>Open the <strong class=" ">Settings</strong> application and select the <strong class=" ">Versioning &amp; Synchronization -&gt; Web farm</strong> category.</p>
</li><li class=" "><p>Set the <strong class=" ">Web farm mode </strong>to <strong class=" ">Automatic</strong>.<br></p>
<ul class=" "><li class=" "><p>This setting allows the system to generate and delete web farm servers dynamically according to the allocated computing instances.</p>
</li><li class=" "><p>See <a href="setting-up-web-farms">Setting up web farms</a> for more information.</p>
</li></ul></li><li class=" "><p>Add the <i class=" ">CMSSharedFileSystem </i>key to the <i class=" ">web.config</i> file of your application. The key disables the generation of web farm tasks related to synchronization of physical files (media library items, smart search indexes, etc.). This is required since scaled App Services share physical storage. By default when synchronizing file system changes, the system creates a web farm task for every known web farm instance. For example, this occurs every time an image is uploaded or modified – an instance needs to relay information about the change to every other instance. In shared file system environments, such as the one provided when scaling Azure App Services, this can lead to deadlocks (when multiple instances attempt to concurrently access the same physical file while processing a web farm task).</p>
    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">&lt;add key=</code><code class="string">"CMSSharedFileSystem"</code><code class="plain"> value=</code><code class="string">"true"</code><code class="plain">/&gt;</code></div>
</div>
    </div>
</li><li class=" "><p><a href="storing-cache-and-session-state-data-in-azure-environment">Configure storing of session state data</a>.</p>
</li></ol><p>You can now increase or decrease the number of computing instances for your web app (in the Windows Azure Management Portal on the <strong class=" ">Scale out (App service plan)</strong> tab of your App service). The system generates web farm servers and synchronization tasks automatically.</p>
    </div>
    <div class="section section-1" id="src-68881692_EnablingwebfarmsonAzureWebApps-MVC">
        <h1 class="heading "><span>MVC</span></h1>
<p>For the <i class=" ">scale-out</i> functionality to work with Kentico <a href="starting-with-mvc-development">MVC environments</a>, you need to:</p>
<ol class=" "><li class=" "><p><a href="#src-68881692_enablingwebfarmsonazurewebapps-enablingautomaticwebfarms">Enable the automatic web farms feature</a> (enabled by default on new installations)</p>
</li><li class=" "><p><a href="#src-68881692_enablingwebfarmsonazurewebapps-settingupsharedstorageforphysicalfiles">Set up shared storage for physical files</a></p>
</li><li class=" "><p><a href="#src-68881692_enablingwebfarmsonazurewebapps-scalingoutdeployedwebapps">Scale-out the deployed web apps using Azure</a></p>
</li></ol>    <div class="section section-2" id="src-68881692_EnablingwebfarmsonAzureWebApps-Enablingautomaticwebfarms">
        <h2 class="heading "><span>Enabling automatic web farms</span></h2>
<p>To run a Kentico MVC environment in Microsoft Azure, your projects need to use the <strong class=" ">Automatic</strong> <a href="setting-up-web-farms">web farm</a> functionality. It is not possible to manually set up static web farm servers since server names in Azure change every time the application is recycled or a new instance spins up. Newly installed projects have automatic web farm server detection enabled by default.</p>
<ol class=" "><li class=" "><p>Open the Kentico administration interface.</p>
</li><li class=" "><p>Open the <strong class=" ">Settings</strong> application and select the <strong class=" ">Versioning &amp; Synchronization -&gt; Web farm</strong> category.</p>
</li><li class=" "><p>Set the <strong class=" ">Web farm mode </strong>to <strong class=" ">Automatic</strong>.</p>
</li></ol><p>The automatic web farm feature is enabled. The system now dynamically generates and removes web farm servers according to the number of detected active instances and generates synchronization tasks automatically.</p>
    </div>
    <div class="section section-2" id="src-68881692_EnablingwebfarmsonAzureWebApps-Settingupsharedstorageforphysicalfiles">
        <h2 class="heading "><span>Setting up shared storage for physical files</span></h2>
<p><a class="external-link" href="https://docs.microsoft.com/en-us/azure/app-service/manage-scale-up">Scaled out</a> app service instances share the file system of the original application, which can cause issues with the synchronization of files in Kentico web farm environments. By default when synchronizing file system changes, the system creates a web farm task for every known web farm instance. For example, this occurs every time an image is uploaded or modified – an instance needs to relay information about the change to every other instance. In shared file system environments, such as the one provided when scaling Azure App Services, this can lead to deadlocks (when multiple instances attempt to concurrently access the same physical file while processing a web farm task).</p>
<p>To avoid any potential synchronization issues, we strongly recommend you:</p>
<ol class=" "><li class=" "><p>Map the following folders from <strong class=" ">both</strong> projects to <a href="configuring-azure-storage">storage</a> shared by both web apps (to ensure files are accessible from both the administration and MVC sites):</p>
<ul class=" "><li class=" "><p>~/App_Data/CMSModules/SmartSearch – Contains smart search index files.</p>
</li><li class=" "><p>~/##SiteFolder## – named after the site's code name. Contains primarily media library files and documents.</p>
</li></ul><p>These folders contain all files Kentico synchronizes via web farms.</p>
</li><li class=" "><p>Add the <i class=" ">CMSSharedFileSystem </i>key to the <i class=" ">web.config</i> of <strong class=" ">both</strong> applications. The key disables the generation of web farm tasks related to synchronization of physical files (media library items, smart search indexes, etc.).<br></p>
    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">&lt;</code><code class="keyword">add</code><code class="plain"> </code><code class="color1">key</code><code class="plain">=</code><code class="string">"CMSSharedFileSystem"</code><code class="plain">&nbsp;</code><code class="color1">value</code><code class="plain">=</code><code class="string">"true"</code><code class="plain">/&gt;</code></div>
</div>
    </div>
</li></ol><p>With this configuration, the system does not need to create web farm synchronization tasks for physical files as they are available to both instances from dedicated shared storage. This neutralizes any potential issues with web farm synchronization.</p>
    </div>
    <div class="section section-2" id="src-68881692_EnablingwebfarmsonAzureWebApps-Scalingoutdeployedwebapps">
        <h2 class="heading "><span>Scaling out deployed web apps</span></h2>
<p>Kentico uses a dual-application environment where the front-end application serves content and receives the bulk of visitor traffic. The administration application manages and stores content and generally experiences lesser load. Therefore, when deciding how to scale-out your deployment environment, consider prioritizing the front-end application.</p>
<p>To <i class=" ">scale out</i> a Web App:</p>
<ol class=" "><li class=" "><p>Open the <a class="external-link" href="https://portal.azure.com">Azure portal</a> and navigate to your Web App.</p>
</li><li class=" "><p>Open the <strong class=" ">Scale out (App Service plan)</strong> tab.</p>
</li><li class=" "><p>Manually set the required instance count or create a custom autoscale configuration.</p>
</li><li class=" "><p>Repeat the process for the other application, if required.</p>
</li><li class=" "><p><a href="storing-cache-and-session-state-data-in-azure-environment">Configure how session data is stored</a>.</p>
</li></ol><p>You have configured instance scaling for your Web Apps. Learn more about Web App scaling in Microsoft Azure in <a class="external-link" href="https://docs.microsoft.com/en-us/azure/azure-monitor/platform/autoscale-get-started">Get started with Autoscale in Azure</a>.</p>
    </div>
    </div>
        </div>

    </article>


               
            
    <footer id="ht-footer">
    <a href="#" id="ht-jump-top" class="sp-aui-icon-small sp-aui-iconfont-arrows-up"></a>
</footer></div>

<div>
    <div id="ht-mq-detect"></div>
</div>

    <script src="js/lunr.js"></script>
    <script src="js/lunr-extras.js"></script>
    <script src="assets/js/scroll-search.js"></script>

    <script src="assets/js/expand-macro.js"></script>


</body></html>