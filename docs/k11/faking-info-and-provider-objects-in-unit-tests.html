<!DOCTYPE html><html><head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Faking Info and Provider objects in unit tests - Kentico 11 Documentation</title>

    
    <link rel="stylesheet" href="assets/css/expand-macro.css">

            <meta name="scroll-content-language-key" content="">
    
    <meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=2.0, user-scalable=yes">

<script type="text/javascript" src="assets/js/jquery.min.js"></script>
<script type="text/javascript" src="assets/js/jquery.scrollTo.min.js"></script>


<script type="text/javascript" src="assets/js/translate.js"></script>

<script type="text/javascript" src="assets/js/theme.main.js"></script>

    <script type="text/javascript" src="assets/js/iframeResizer.min.js"></script>

<link rel="stylesheet" href="assets/css/content-style.css">
    <link rel="stylesheet" href="assets/css/search.css">

<link rel="stylesheet" href="assets/css/theme.main.css">
<link rel="stylesheet" href="assets/css/theme.colors.css">

            <!-- ES5 support for older browsers, needed by lunr -->
        <script src="js/augment.js"></script> 
        <script id="worker" type="javascript/worker">

        startIndex = function() {
            idx = lunr.Index.load(lunrIndex);
            idx.pipeline.remove(lunr.stopWordFilter);
            postMessage({type: "setup-complete"});
        }

        onmessage = function (event) {
            var message = event.data;

            if ((message.type === 'setup') && message.baseUrl) {
                var url = message.baseUrl;
                importScripts(url + 'js/lunr.js');
                importScripts(url + 'js/lunr-extras.js');
                importScripts(url + 'js/lunr-index.js');
                importScripts(url + 'js/lunr-data.js');
                startIndex();
            }

            if (idx && (message.type === 'search-request') && message.query) {
                var searchWord = message.query;
                var results = idx.search(searchWord).map(function (result) {
                    return lunrData.filter(function (d) {
                        return d.id === parseInt(result.ref, 10)
                    })[0]
                });
                postMessage({type: 'search-results', results: results, query: searchWord, queryId: message.queryId});
            }
        }

    </script>
    </head>

<body pageid="68879260" elementpageid="68882280">

<div id="ht-loader">
    <noscript>
        <p style="width: 100%; text-align:center; position: absolute; margin-top: 200px;">This content cannot be displayed without JavaScript.<br>Please enable JavaScript and reload the page.</p>
    </noscript>
</div>

<div>
   	<header id="ht-headerbar">
    <div class="ht-headerbar-left">
        <a href="" id="ht-menu-toggle" class="sp-aui-icon-small sp-aui-iconfont-appswitcher"></a>
    </div>
    <div class="ht-headerbar-right">
            <div class="sp-aui-icon-small ht-search-index-loader ht-header-icon"></div>

        <div id="ht-search">
            <div class="ht-search-input" style="display: none;">
              	<a href="#" class="sp-aui-icon-small sp-aui-iconfont-remove ht-search-clear"></a>

                <form action="#" method="GET" id="search">
                    <input class="search-input" type="text" placeholder="Search" tabindex="-1" autocomplete="off" name="q" value="">
                    <input type="hidden" name="max" value="15">
                    <input type="submit" style="display:none" tabindex="-4">
                </form>

                <a href="#" id="ht-search-button" class="ht-header-icon ht-header-icon-svg">
                                        <svg width="40px" height="40px" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                        <g>
                            <path d="M29.572,28.802 L28.801,29.571 C28.515,29.857 28.187,30 27.816,30 C27.445,30 27.116,29.857 26.831,29.571 L21.392,24.134 C20.193,24.762 18.908,25.076 17.538,25.076 C15.396,25.076 13.605,24.348 12.163,22.892 C10.721,21.436 10,19.651 10,17.538 C10,15.397 10.721,13.605 12.163,12.163 C13.605,10.721 15.396,10 17.538,10 C19.651,10 21.434,10.721 22.89,12.163 C24.347,13.605 25.075,15.397 25.075,17.538 C25.075,18.937 24.761,20.222 24.132,21.393 L29.572,26.832 C29.857,27.118 30,27.446 30,27.817 C30,28.188 29.857,28.517 29.572,28.802 L29.572,28.802 Z M13.662,21.414 C14.732,22.485 16.024,23.02 17.538,23.02 C19.051,23.02 20.343,22.485 21.413,21.414 C22.484,20.344 23.019,19.052 23.019,17.538 C23.019,16.025 22.484,14.733 21.413,13.662 C20.343,12.592 19.051,12.056 17.538,12.056 C16.024,12.056 14.732,12.592 13.662,13.662 C12.591,14.733 12.056,16.025 12.056,17.538 C12.056,19.052 12.591,20.344 13.662,21.414 L13.662,21.414 Z"></path>
                        </g>
                    </svg>
              	</a>

                <div class="ht-search-dropdown ht-dropdown">
                    <ul></ul>
                </div>
            </div>
        </div>
    </div>
    </header>   	<aside id="ht-sidebar">
    <div class="ht-sidebar-content">
        <div class="ht-sidebar-content-scroll-container">
            <header class="ht-sidebar-header">
                <h1 class="ht-logo">
                    <span class="ht-logo-label">K11</span>
                    <img class="space-logo" src="global.logo">
                </h1>
                <a href="Kentico-11-Documentation-Home.html" class="ht-space-link">
                    <h2>Kentico 11 Documentation</h2>
                </a>
            </header>
                            <iframe id="ht-nav" src="toc.html?pageId=68882280"></iframe>
                <script>
                    $('iframe#ht-nav').iFrameResize(
                            { 'log': true, 'autoResize': true, 'heightCalculationMethod': 'lowestElement', 'checkOrigin': false });
                </script>
                    </div>
    </div>

</aside></div>

<div id="ht-wrap-container">

            
    <div id="ht-sidebar-dragbar">
    <div class="ht-sidebar-drag-handle">
        <span class="drag-handle-1"></span>
        <span class="drag-handle-2"></span>
        <span class="drag-handle-3"></span>
    </div>
</div>
    <article id="ht-content" class="ht-content">
        <header class="ht-content-header">
            <div id="ht-breadcrumb">
    <ul>
        <li><a href="Kentico-11-Documentation-Home.html">Kentico 11 Documentation</a></li>
                                                                                                             <li><a href="" onclick="$('.shortcut').each(function(){$(this).removeClass('shortcut')}); $(this).parent().addClass('shortcut'); return false;">...</a> </li>
                                        <li class="shortcut"><a href="Custom-development.html">Custom development</a></li>
                                                                                     <li><a href="Writing-automated-tests.html">Writing automated tests</a></li>
                                                            </ul>
</div>            <h1 id="src-68882280"> <span>Faking Info and Provider objects in unit tests</span></h1>
        </header>

        <div id="main-content" class="wiki-content sp-grid-section" data-index-for-search="true">
<div class="sp-grid-section"><div class="sp-grid-cell sp-grid-60"></div></div><p>When creating <a href="writing-automated-tests">automated tests</a>, we recommend using unit tests whenever possible. Unit tests are able to run without external resources, such as a database. They have the fastest execution speed (compared with other types of automated tests) and are the easiest to integrate into your development process.</p>
<p>A common problem with unit tests is that code needs to connect to a database, either directly or indirectly through external dependencies. Unit tests where this problem occurs throw the following exception upon execution:</p>
<p><strong class=" ">"System.InvalidOperationException: The ConnectionString property has not been initialized"</strong></p>
<p>In many cases, you can solve the problem by preparing faked data for your unit tests.</p>
    <div class="confbox admonition admonition-info">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p>If you cannot fake the data required for a test, you need to create an integration or isolated integration test instead. Integration tests can work with a database, but have significantly slower execution speed. See:</p>
<ul class=" "><li class=" "><p><a href="creating-integration-tests-with-a-connection-string">Creating integration tests with a connection string</a></p>
</li><li class=" "><p><a href="creating-isolated-integration-tests">Creating isolated integration tests</a></p>
</li></ul>        </div>
    </div>
    <div class="section section-1" id="src-68882280_FakingInfoandProviderobjectsinunittests-Fakingdata">
        <h1 class="heading "><span>Faking data</span></h1>
<p>The Kentico API uses <i class=" ">Info</i> and <i class=" ">Provider</i> classes to manage the data stored in database tables. See the <a href="database-table-api">Database table API</a> page for more information.</p>
<p>To create fake data for your unit tests, call the <strong class=" ">Fake</strong> method from the <strong class=" ">UnitTests</strong> base class (must be inherited by all unit test classes using the <i class=" ">CMS.Tests</i> library). The method prepares a faked instance of a specific Provider class with data. You can then use the given Provider's methods to <strong class=" ">get</strong>, <strong class=" ">create</strong> or <strong class=" ">update</strong> data in your unit tests.</p>
    <div class="confbox admonition admonition-note">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p><strong class=" ">Note</strong>: Faked providers do NOT allow you to use methods that <strong class=" ">delete data</strong>. If you need to test methods that delete data, use <a href="creating-isolated-integration-tests">isolated integration tests</a>.</p>
        </div>
    </div>
    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                    <div class="title">Example (NUnit)</div>
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-title="Example (NUnit)" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="keyword">using</code><code class="plain"> CMS.Membership;</code></div>
<div class="line"><code class="keyword">using</code><code class="plain"> CMS.Tests;</code></div>
<div class="line"><code class="keyword">using</code><code class="plain"> NUnit.Framework;</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">[TestFixture]</code></div>
<div class="line"><code class="keyword">public</code><code class="plain"> </code><code class="keyword">class</code><code class="plain"> MyUnitTests : UnitTests</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">	[SetUp]</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">public</code><code class="plain"> </code><code class="keyword">void</code><code class="plain"> MyUnitTestSetUp()</code></div>
<div class="line"><code class="plain">	{</code></div>
<div class="line"><code class="plain">		</code><code class="comments">// Prepares faked data for the UserInfoProvider</code></div>
<div class="line"><code class="plain">		Fake&lt;UserInfo, UserInfoProvider&gt;().WithData(</code></div>
<div class="line"><code class="plain">			</code><code class="keyword">new</code><code class="plain"> UserInfo</code></div>
<div class="line"><code class="plain">			{</code></div>
<div class="line"><code class="plain">				UserID = 123,</code></div>
<div class="line"><code class="plain">				UserName = </code><code class="string">"FakeUser"</code><code class="plain">,</code></div>
<div class="line"><code class="plain">				UserNickName = </code><code class="string">"FakeUser"</code></div>
<div class="line"><code class="plain">			});</code></div>
<div class="line"><code class="plain">	}</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">	[Test]</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">public</code><code class="plain"> </code><code class="keyword">void</code><code class="plain"> MyTest()</code></div>
<div class="line"><code class="plain">	{</code></div>
<div class="line"><code class="plain">		</code><code class="comments">// Calls a UserInfoProvider method to get user data</code></div>
<div class="line"><code class="plain">		</code><code class="keyword">var</code><code class="plain"> users = UserInfoProvider.GetUsers();</code></div>
<div class="line"><code class="plain">	}</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p>In the example, <i class=" ">UserInfoProvider</i> is faked with specific data.     <span style="color: #262524;">
Calling <i class=" ">UserInfoProvider</i> methods to get <i class=" ">UserInfo</i> objects within tests then returns the faked data instead of accessing the database. The code in the example behaves as if there were a single user named <i class=" ">FakeUser</i> in the database.    </span>
</p>
<p>You do <strong class=" ">not need to clean up the faked data before or after running tests</strong>. Tests inherited from the <strong class=" ">UnitTests </strong>base class automatically reset all faked data upon initialization and cleanup.</p>
    <div class="section section-2" id="src-68882280_FakingInfoandProviderobjectsinunittests-Fakingpagedata">
        <h2 class="heading "><span>Faking page data</span></h2>
<p>Use the following approach if you need to fake page data in unit tests:</p>
<ol class=" "><li class=" "><p><a href="generating-classes-for-kentico-objects">Generate</a> a strongly-typed class for the page type that you wish to test.</p>
</li><li class=" "><p>Add the generated class into your test project.</p>
</li><li class=" "><p>In your test's <i class=" ">SetUp</i> method, register and fake the given page type by calling the following methods:</p>
<ul class=" "><li class=" "><p><strong class=" ">DocumentGenerator.RegisterDocumentType&lt;TGeneratedItemClass&gt;</strong></p>
</li><li class=" "><p><strong class=" ">Fake().DocumentType&lt;TGeneratedItemClass&gt;</strong></p>
</li></ul></li><li class=" "><p>In your test methods, create pages of the registered type and perform any required assertions.</p>
</li></ol>    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                    <div class="title">Example (NUnit)</div>
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-title="Example (NUnit)" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="keyword">using</code><code class="plain"> CMS.DocumentEngine;</code></div>
<div class="line"><code class="keyword">using</code><code class="plain"> CMS.DataEngine;</code></div>
<div class="line"><code class="keyword">using</code><code class="plain"> CMS.Tests;</code></div>
<div class="line"><code class="keyword">using</code><code class="plain"> Tests.DocumentEngine;</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="keyword">using</code><code class="plain"> NUnit.Framework;</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="comments">// Namespace used by the 'CustomPageType' generated page type class</code></div>
<div class="line"><code class="keyword">using</code><code class="plain"> CMS.DocumentEngine.Types.Custom;</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">[TestFixture]</code></div>
<div class="line"><code class="keyword">public</code><code class="plain"> </code><code class="keyword">class</code><code class="plain"> MyUnitTests : UnitTests</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">	[SetUp]</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">public</code><code class="plain"> </code><code class="keyword">void</code><code class="plain"> MyUnitTestSetUp()</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        </code><code class="comments">// Registers the page type class</code></div>
<div class="line"><code class="plain">        </code><code class="comments">// The 'CustomPageType' class is generated for a page type from the Kentico Page types application</code></div>
<div class="line"><code class="plain">        DocumentGenerator.RegisterDocumentType&lt;CustomPageType&gt;(CustomPageType.CLASS_NAME);</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">        </code><code class="comments">// Fakes the page type to allow creation of fake page data</code></div>
<div class="line"><code class="plain">        Fake().DocumentType&lt;CustomPageType&gt;(CustomPageType.CLASS_NAME);</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">    [Test]</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">public</code><code class="plain"> </code><code class="keyword">void</code><code class="plain"> MyTest()</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        </code><code class="comments">// Creates a fake page for testing purposes</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">var</code><code class="plain"> page = TreeNode.New(CustomPageType.CLASS_NAME).With(p =&gt;</code></div>
<div class="line"><code class="plain">        {</code></div>
<div class="line"><code class="plain">            p.NodeAlias = </code><code class="string">"Test page"</code><code class="plain">;</code></div>
<div class="line"><code class="plain">            p.DocumentCulture = </code><code class="string">"en-US"</code><code class="plain">;</code></div>
<div class="line"><code class="plain">            p.SetValue(</code><code class="string">"CustomTextField"</code><code class="plain">, </code><code class="string">"Test_Value"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">        });</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">        </code><code class="comments">// Tests the value of a custom field within the page type</code></div>
<div class="line"><code class="plain">        Assert.AreEqual(</code><code class="string">"Test_Value"</code><code class="plain">, page.GetValue(</code><code class="string">"CustomTextField"</code><code class="plain">));</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
    </div>
    <div class="section section-2" id="src-68882280_FakingInfoandProviderobjectsinunittests-FakingInfometadata">
        <h2 class="heading "><span>Faking Info metadata</span></h2>
<p>Calling the constructor of an <i class=" ">Info</i> class requires access to metadata stored in the database. If your unit tests do not require faked Providers with data prepared in advance, but directly create new instances of Info classes, you can fake only the Info metadata.</p>
<p>To prepare faked metadata for an Info class, call the <strong class=" ">Fake</strong> method with a single generic type parameter matching the given Info class.</p>
    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                    <div class="title">Example (NUnit)</div>
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-title="Example (NUnit)" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="keyword">using</code><code class="plain"> CMS.Membership;</code></div>
<div class="line"><code class="keyword">using</code><code class="plain"> CMS.Tests;</code></div>
<div class="line"><code class="keyword">using</code><code class="plain"> NUnit.Framework;</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">[TestFixture]</code></div>
<div class="line"><code class="keyword">public</code><code class="plain"> </code><code class="keyword">class</code><code class="plain"> MyUnitTests : UnitTests</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">	[SetUp]</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">public</code><code class="plain"> </code><code class="keyword">void</code><code class="plain"> MyUnitTestSetUp()</code></div>
<div class="line"><code class="plain">	{</code></div>
<div class="line"><code class="plain">		</code><code class="comments">// Sets up faked metadata for UserInfo</code></div>
<div class="line"><code class="plain">		Fake&lt;UserInfo&gt;();</code></div>
<div class="line"><code class="plain">	}</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">	[Test]</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">public</code><code class="plain"> </code><code class="keyword">void</code><code class="plain"> MyTest()</code></div>
<div class="line"><code class="plain">	{</code></div>
<div class="line"><code class="plain">		</code><code class="comments">// Creates a new UserInfo instance</code></div>
<div class="line"><code class="plain">		UserInfo user = </code><code class="keyword">new</code><code class="plain"> UserInfo();</code></div>
<div class="line"><code class="plain">	}</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
    </div>
    </div>
        </div>

    </article>


               
            
    <footer id="ht-footer">
    <a href="#" id="ht-jump-top" class="sp-aui-icon-small sp-aui-iconfont-arrows-up"></a>
</footer></div>

<div>
    <div id="ht-mq-detect"></div>
</div>

    <script src="js/lunr.js"></script>
    <script src="js/lunr-extras.js"></script>
    <script src="assets/js/scroll-search.js"></script>

    <script src="assets/js/expand-macro.js"></script>


</body></html>