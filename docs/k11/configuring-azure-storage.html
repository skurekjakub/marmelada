<!DOCTYPE html><html><head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Configuring Azure storage - Kentico 11 Documentation</title>

    
    <link rel="stylesheet" href="assets/css/expand-macro.css">

            <meta name="scroll-content-language-key" content="">
    
    <meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=2.0, user-scalable=yes">

<script type="text/javascript" src="assets/js/jquery.min.js"></script>
<script type="text/javascript" src="assets/js/jquery.scrollTo.min.js"></script>


<script type="text/javascript" src="assets/js/translate.js"></script>

<script type="text/javascript" src="assets/js/theme.main.js"></script>

    <script type="text/javascript" src="assets/js/iframeResizer.min.js"></script>

<link rel="stylesheet" href="assets/css/content-style.css">
    <link rel="stylesheet" href="assets/css/search.css">

<link rel="stylesheet" href="assets/css/theme.main.css">
<link rel="stylesheet" href="assets/css/theme.colors.css">

            <!-- ES5 support for older browsers, needed by lunr -->
        <script src="js/augment.js"></script> 
        <script id="worker" type="javascript/worker">

        startIndex = function() {
            idx = lunr.Index.load(lunrIndex);
            idx.pipeline.remove(lunr.stopWordFilter);
            postMessage({type: "setup-complete"});
        }

        onmessage = function (event) {
            var message = event.data;

            if ((message.type === 'setup') && message.baseUrl) {
                var url = message.baseUrl;
                importScripts(url + 'js/lunr.js');
                importScripts(url + 'js/lunr-extras.js');
                importScripts(url + 'js/lunr-index.js');
                importScripts(url + 'js/lunr-data.js');
                startIndex();
            }

            if (idx && (message.type === 'search-request') && message.query) {
                var searchWord = message.query;
                var results = idx.search(searchWord).map(function (result) {
                    return lunrData.filter(function (d) {
                        return d.id === parseInt(result.ref, 10)
                    })[0]
                });
                postMessage({type: 'search-results', results: results, query: searchWord, queryId: message.queryId});
            }
        }

    </script>
    </head>

<body pageid="68879260" elementpageid="68882093">

<div id="ht-loader">
    <noscript>
        <p style="width: 100%; text-align:center; position: absolute; margin-top: 200px;">This content cannot be displayed without JavaScript.<br>Please enable JavaScript and reload the page.</p>
    </noscript>
</div>

<div>
   	<header id="ht-headerbar">
    <div class="ht-headerbar-left">
        <a href="" id="ht-menu-toggle" class="sp-aui-icon-small sp-aui-iconfont-appswitcher"></a>
    </div>
    <div class="ht-headerbar-right">
            <div class="sp-aui-icon-small ht-search-index-loader ht-header-icon"></div>

        <div id="ht-search">
            <div class="ht-search-input" style="display: none;">
              	<a href="#" class="sp-aui-icon-small sp-aui-iconfont-remove ht-search-clear"></a>

                <form action="#" method="GET" id="search">
                    <input class="search-input" type="text" placeholder="Search" tabindex="-1" autocomplete="off" name="q" value="">
                    <input type="hidden" name="max" value="15">
                    <input type="submit" style="display:none" tabindex="-4">
                </form>

                <a href="#" id="ht-search-button" class="ht-header-icon ht-header-icon-svg">
                                        <svg width="40px" height="40px" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                        <g>
                            <path d="M29.572,28.802 L28.801,29.571 C28.515,29.857 28.187,30 27.816,30 C27.445,30 27.116,29.857 26.831,29.571 L21.392,24.134 C20.193,24.762 18.908,25.076 17.538,25.076 C15.396,25.076 13.605,24.348 12.163,22.892 C10.721,21.436 10,19.651 10,17.538 C10,15.397 10.721,13.605 12.163,12.163 C13.605,10.721 15.396,10 17.538,10 C19.651,10 21.434,10.721 22.89,12.163 C24.347,13.605 25.075,15.397 25.075,17.538 C25.075,18.937 24.761,20.222 24.132,21.393 L29.572,26.832 C29.857,27.118 30,27.446 30,27.817 C30,28.188 29.857,28.517 29.572,28.802 L29.572,28.802 Z M13.662,21.414 C14.732,22.485 16.024,23.02 17.538,23.02 C19.051,23.02 20.343,22.485 21.413,21.414 C22.484,20.344 23.019,19.052 23.019,17.538 C23.019,16.025 22.484,14.733 21.413,13.662 C20.343,12.592 19.051,12.056 17.538,12.056 C16.024,12.056 14.732,12.592 13.662,13.662 C12.591,14.733 12.056,16.025 12.056,17.538 C12.056,19.052 12.591,20.344 13.662,21.414 L13.662,21.414 Z"></path>
                        </g>
                    </svg>
              	</a>

                <div class="ht-search-dropdown ht-dropdown">
                    <ul></ul>
                </div>
            </div>
        </div>
    </div>
    </header>   	<aside id="ht-sidebar">
    <div class="ht-sidebar-content">
        <div class="ht-sidebar-content-scroll-container">
            <header class="ht-sidebar-header">
                <h1 class="ht-logo">
                    <span class="ht-logo-label">K11</span>
                    <img class="space-logo" src="global.logo">
                </h1>
                <a href="Kentico-11-Documentation-Home.html" class="ht-space-link">
                    <h2>Kentico 11 Documentation</h2>
                </a>
            </header>
                            <iframe id="ht-nav" src="toc.html?pageId=68882093"></iframe>
                <script>
                    $('iframe#ht-nav').iFrameResize(
                            { 'log': true, 'autoResize': true, 'heightCalculationMethod': 'lowestElement', 'checkOrigin': false });
                </script>
                    </div>
    </div>

</aside></div>

<div id="ht-wrap-container">

            
    <div id="ht-sidebar-dragbar">
    <div class="ht-sidebar-drag-handle">
        <span class="drag-handle-1"></span>
        <span class="drag-handle-2"></span>
        <span class="drag-handle-3"></span>
    </div>
</div>
    <article id="ht-content" class="ht-content">
        <header class="ht-content-header">
            <div id="ht-breadcrumb">
    <ul>
        <li><a href="Kentico-11-Documentation-Home.html">Kentico 11 Documentation</a></li>
                                                                                                             <li><a href="" onclick="$('.shortcut').each(function(){$(this).removeClass('shortcut')}); $(this).parent().addClass('shortcut'); return false;">...</a> </li>
                                        <li class="shortcut"><a href="Custom-development.html">Custom development</a></li>
                                                                                                         <li class="shortcut"><a href="Working-with-physical-files-using-the-API.html">Working with physical files using the API</a></li>
                                                                                     <li><a href="Configuring-file-system-providers.html">Configuring file system providers</a></li>
                                                            </ul>
</div>            <h1 id="src-68882093"> <span>Configuring Azure storage</span></h1>
        </header>

        <div id="main-content" class="wiki-content sp-grid-section" data-index-for-search="true">
<div class="sp-grid-section"><div class="sp-grid-cell sp-grid-60"><div class="sp-grid-section"></div></div><div class="sp-grid-cell sp-grid-60"><p>In some situations, it may be beneficial to store files of an on‑premise website on a <strong class=" ">Microsoft Azure Blob Storage</strong> account rather than on a local disk.</p><ul class=" "><li class=" "><p>For example, if your server has a limited storage capacity and you need to save large amounts of file data. Using Microsoft Azure may be more convenient than upgrading your server, especially if the increased requirements are only temporary.</p>
</li><li class=" "><p>The same applies when running Kentico in <strong class=" "><a href="running-kentico-in-azure-web-apps">Azure Web Apps</a></strong>, where use of blob storage is optional (unlike with Cloud Services).</p>
</li></ul><p>There are two approaches for connecting an Azure storage to your project:</p><ul class=" "><li class=" "><p><a href="#src-68882093_configuringazurestorage-configuringkenticotostoreonlymediafilesonazurestorage">Store only media files on Azure storage</a> <strong class=" ">(recommended)</strong></p>
<ul class=" "><li class=" "><p>We recommend that you map only media library folders to the Azure storage. This allows you to store large media files on a shared storage and optionally use an Azure CDN for this data, while avoiding issues related to local smart search indexes and Web analytics functionality.</p>
</li></ul></li><li class=" "><p><a href="#src-68882093_configuringazurestorage-configuringkenticotomapitsfilesystemtoazurestorage">Map the whole file system to Azure storage</a></p>
<ul class=" "><li class=" "><p>We do not recommend mapping the whole file system to the Azure storage because of possible problems with local smart search indexes and Web analytics functionality. These features use data that is not suitable for shared file systems.</p>
</li></ul></li></ul><div class="confbox admonition admonition-info">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p><strong class=" ">Mapping media files or the file system or storage accounts enforcing HTTPS connections</strong></p>
<p>Storage accounts can be configured to communicate exclusively over HTTPS via the <a class="external-link" href="https://docs.microsoft.com/en-us/azure/storage/common/storage-require-secure-transfer">Security transfer required</a> setting available in the <a class="external-link" href="https://portal.azure.com">Azure portal</a>. In such cases, additional configuration of the environment is required. See <a href="#src-68882093_configuringazurestorage-mappingfilestostorageaccountsenforcinghttpsconnections">Mapping files to storage accounts enforcing HTTPS connections</a> for details.</p>
        </div>
    </div><div class="sp-grid-section"></div><div class="sp-grid-section"></div></div><div class="sp-grid-cell sp-grid-40 sp-grid-sidebar"><div class="confbox panel">
            <div class="title panel-header">On this page</div>
            <div class="panel-content">
<p></p>
<ul class="toc-indentation "><li class=" "><p><a href="#src-68882093_configuringazurestorage-configuringkenticotostoreonlymediafilesonazurestorage">Configuring Kentico to store only media files on Azure storage</a></p>
</li><li class=" "><p><a href="#src-68882093_configuringazurestorage-configuringkenticotomapitsfilesystemtoazurestorage">Configuring Kentico to map its file system to Azure storage</a></p>
</li><li class=" "><p><a href="#src-68882093_configuringazurestorage-mappingfilestostorageaccountsenforcinghttpsconnections">Mapping files to storage accounts enforcing HTTPS connections</a></p>
</li><li class=" "><p><a href="#src-68882093_configuringazurestorage-medialibrarynotes">Media library notes</a></p>
<ul class="toc-indentation "><li class=" "><p><a href="#src-68882093_configuringazurestorage-storingtoomanyfilesinonemedialibraryfolder">Storing too many files in one media library folder</a></p>
</li><li class=" "><p><a href="#src-68882093_configuringazurestorage-usingpermanentlinkswhencmsazurepubliccontainerkeyissettotrue">Using permanent links when CMSAzurePublicContainer key is set to true</a></p>
</li></ul></li><li class=" "><p><a href="#src-68882093_configuringazurestorage-optionalweb.configsettingsforazurestorage">Optional web.config settings for Azure storage</a></p>
</li></ul><p></p>
        </div>
    </div><div class="confbox panel">
            <div class="title panel-header">Related pages</div>
            <div class="panel-content">
<ul class=" "><li class=" "><p><a href="settings---performance">Settings - Performance</a></p>
</li><li class=" "><p><a href="configuring-azure-cdn">Configuring Azure CDN</a></p>
</li></ul>        </div>
    </div></div><div class="sp-grid-cell sp-grid-40 sp-grid-sidebar"><div class="confbox panel">
            <div class="title panel-header">On this page</div>
            <div class="panel-content">
<p></p>
<ul class="toc-indentation "><li class=" "><p><a href="#src-68882093_configuringazurestorage-configuringkenticotostoreonlymediafilesonazurestorage">Configuring Kentico to store only media files on Azure storage</a></p>
</li><li class=" "><p><a href="#src-68882093_configuringazurestorage-configuringkenticotomapitsfilesystemtoazurestorage">Configuring Kentico to map its file system to Azure storage</a></p>
</li><li class=" "><p><a href="#src-68882093_configuringazurestorage-mappingfilestostorageaccountsenforcinghttpsconnections">Mapping files to storage accounts enforcing HTTPS connections</a></p>
</li><li class=" "><p><a href="#src-68882093_configuringazurestorage-medialibrarynotes">Media library notes</a></p>
<ul class="toc-indentation "><li class=" "><p><a href="#src-68882093_configuringazurestorage-storingtoomanyfilesinonemedialibraryfolder">Storing too many files in one media library folder</a></p>
</li><li class=" "><p><a href="#src-68882093_configuringazurestorage-usingpermanentlinkswhencmsazurepubliccontainerkeyissettotrue">Using permanent links when CMSAzurePublicContainer key is set to true</a></p>
</li></ul></li><li class=" "><p><a href="#src-68882093_configuringazurestorage-optionalweb.configsettingsforazurestorage">Optional web.config settings for Azure storage</a></p>
</li></ul><p></p>
        </div>
    </div><div class="confbox panel">
            <div class="title panel-header">Related pages</div>
            <div class="panel-content">
<ul class=" "><li class=" "><p><a href="settings---performance">Settings - Performance</a></p>
</li><li class=" "><p><a href="configuring-azure-cdn">Configuring Azure CDN</a></p>
</li></ul>        </div>
    </div></div></div><div class="sp-grid-section"></div>

    
    
    
    <div class="confbox admonition admonition-note">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p><strong class=" ">File name case<br></strong></p>
<p>Unlike standard Windows file systems, the Microsoft Azure Blob storage is case-sensitive. To ensure consistent behavior, Kentico automatically converts all file and folder names to lower case when processing files on Azure storage.</p>
        </div>
    </div>
    <h3 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Configuring Kentico to store only media files on Azure storage</span></h3>
<p>To map <a href="media-library-files">media library</a> folders to Azure storage, use the API and the built-in Azure storage provider:</p>
<ol class=" "><li class=" "><p>Add the following keys to the <i class=" ">appSettings</i> section of your project's <strong class=" ">web.config</strong> file. Specify the storage account name and primary access key:</p>
    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">&lt;add key=</code><code class="string">"CMSAzureAccountName"</code><code class="plain"> value=</code><code class="string">"StorageAccountName"</code><code class="plain"> /&gt;</code></div>
<div class="line"><code class="plain">&lt;add key=</code><code class="string">"CMSAzureSharedKey"</code><code class="plain"> value=</code><code class="string">"PrimaryAccessKey"</code><code class="plain"> /&gt;</code></div>
</div>
    </div>
    <div class="confbox admonition admonition-info">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p>To locate the values of these keys on Microsoft Azure:</p>
<ol class=" "><li class=" "><p>Open the <a class="external-link" href="https://portal.azure.com">Azure Management Portal</a> in a browser and sign in.</p>
</li><li class=" "><p>Open <strong class=" ">Storage accounts</strong>.</p>
</li><li class=" "><p>Select your storage.</p>
</li><li class=" "><p>Switch to the<strong class=" "> Access keys</strong> tab.</p>
<ul class=" "><li class=" "><p>Use the <strong class=" ">Storage account name</strong> and one of the provided access key values.</p>
</li></ul></li></ol>        </div>
    </div>
    <div class="confbox admonition admonition-note">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p><strong class=" ">Important</strong></p>
<p>Do NOT set the <strong class=" ">CMSExternalStorageName</strong> key in your web.config (remove the key if it is present). Setting the key's value to <i class=" ">azure</i> maps the project's entire file system to the Azure storage, which is not recommended. See the <a href="#src-68882093_configuringazurestorage-configuringkenticotomapitsfilesystemtoazurestorage">Configuring Kentico to map its file system to Azure storage</a> section for more information about this scenario.</p>
        </div>
    </div>
</li><li class=" "><p>Open the Kentico web project in Visual Studio (using the <strong class=" ">WebSite.sln</strong> or <strong class=" ">WebApp.sln</strong> file).</p>
</li><li class=" "><p>Create a <a href="initializing-modules-to-run-custom-code">custom module class</a>.</p>
<ul class=" "><li class=" "><p>Either add the class into a custom project within the Kentico solution (recommended) or directly into the Kentico web project (into the <strong class=" ">CMSApp</strong> project for <i class=" ">web application</i> installations, into the <strong class=" ">App_Code</strong> folder for <i class=" ">web site</i> installations).</p>
</li></ul>    <div class="confbox admonition admonition-info">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p>For basic execution of initialization code, you only need to register a "code-only" module through the API. You do NOT need to create a new module within the <strong class=" ">Modules</strong> application in the Kentico administration interface.</p>
        </div>
    </div>
</li><li class=" "><p>Override the module's <strong class=" ">OnInit</strong> method and perform the following:</p>
<ul class=" "><li class=" "><p>Create a new instance of the Azure storage provider.</p>
</li><li class=" "><p>(Optional) Specify the target container using the <strong class=" ">CustomRootPath</strong> property of the provider.</p>
</li><li class=" "><p>(Optional) You can specify whether you want the container to be publicly accessible using the <strong class=" ">PublicExternalFolderObject</strong> property of the provider. <i class=" ">True</i> means the container is publicly accessible.</p>
</li><li class=" "><p>Map a directory to the provider. This is the directory that you want to store in the container.</p>
</li></ul>    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="keyword">using</code><code class="plain"> CMS;</code></div>
<div class="line"><code class="keyword">using</code><code class="plain"> CMS.Base;</code></div>
<div class="line"><code class="keyword">using</code><code class="plain"> CMS.DataEngine;</code></div>
<div class="line"><code class="keyword">using</code><code class="plain"> CMS.IO;</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="comments">// Registers the custom module into the system</code></div>
<div class="line"><code class="plain">[assembly: RegisterModule(</code><code class="keyword">typeof</code><code class="plain">(CustomInitializationModule))]</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="keyword">public</code><code class="plain"> </code><code class="keyword">class</code><code class="plain"> CustomInitializationModule : Module</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">	</code><code class="comments">// Module class constructor, the system registers the module under the name "CustomInit"</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">public</code><code class="plain"> CustomInitializationModule()</code></div>
<div class="line"><code class="plain">		: </code><code class="keyword">base</code><code class="plain">(</code><code class="string">"CustomInit"</code><code class="plain">)</code></div>
<div class="line"><code class="plain">	{</code></div>
<div class="line"><code class="plain">	}</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">	</code><code class="comments">// Contains initialization code that is executed when the application starts</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">protected</code><code class="plain"> </code><code class="keyword">override</code><code class="plain"> </code><code class="keyword">void</code><code class="plain"> OnInit()</code></div>
<div class="line"><code class="plain">	{</code></div>
<div class="line"><code class="plain">		</code><code class="keyword">base</code><code class="plain">.OnInit();</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">		</code><code class="comments">// Creates a new StorageProvider instance for Azure</code></div>
<div class="line"><code class="plain">		</code><code class="keyword">var</code><code class="plain"> mediaProvider = StorageProvider.CreateAzureStorageProvider();</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">		</code><code class="comments">// Specifies the target container</code></div>
<div class="line"><code class="plain">		mediaProvider.CustomRootPath = </code><code class="string">"mymediacontainer"</code><code class="plain">;</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">		</code><code class="comments">// Makes the container publicly accessible</code></div>
<div class="line"><code class="plain">		mediaProvider.PublicExternalFolderObject = </code><code class="keyword">true</code><code class="plain">;</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">		</code><code class="comments">// Maps a directory to the provider</code></div>
<div class="line"><code class="plain">		StorageHelper.MapStoragePath(</code><code class="string">"~/MySite/Media/"</code><code class="plain">, mediaProvider);</code></div>
<div class="line"><code class="plain">	}</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
</li><li class=" "><p><strong class=" ">Save</strong> the file. If your project is installed in the web application format, rebuild the solution.</p>
</li></ol><p>The system now stores files from the <i class=" ">~/MySite/Media/</i> folder in the <i class=" ">mymediacontainer</i> on the Azure storage. See the <a href="#src-68882093_configuringazurestorage-medialibrarynotes">Media library notes</a> section on this page for additional information about media libraries when using Azure storage.</p>
    <div class="confbox admonition admonition-tip">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p><strong class=" ">Mapping media folders on instances with multiple sites</strong></p>
<p>By default, each site has its own separate media folder in the project's file system: <i class=" ">~/&lt;site code name&gt;/media</i></p>
<p>To map all media folders to Azure storage on Kentico instances with multiple sites, we recommend using a shared root folder for media libraries:</p>
<ol class=" "><li class=" "><p>Open the <strong class=" ">Settings </strong>application in Kentico.</p>
</li><li class=" "><p>Navigate to the <strong class=" ">Content -&gt; Media</strong> settings category.</p>
</li><li class=" "><p>Set the <strong class=" ">Media libraries folder</strong> to a custom folder (globally), for example: ~/SharedMedia</p>
</li><li class=" "><p>Enable the <strong class=" ">Use site-specific subfolders for custom media libraries folder</strong> setting to ensure that individual library folders are separated by site.</p>
</li><li class=" "><p>Click <strong class=" ">Save</strong>.</p>
</li><li class=" "><p>Move any existing media library files to the new location.</p>
</li></ol><p>You can then map the shared media folder to your Azure storage (using the API described above).</p>
<p>If you wish to use the default media folder locations, you need to map each site's media folder in the code – for each site, create and configure a separate <i class=" ">StorageProvider</i> instance and call the <i class=" ">StorageHelper.MapStoragePath</i> method for the corresponding media folder.</p>
        </div>
    </div>
    <div class="confbox admonition admonition-info">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p><strong class=" ">Using Azure storage for multiple projects</strong></p>
<p>We do not recommend using a single shared storage for multiple projects (for example production and testing instances), because the projects would overwrite each others' files.</p>
<p>However, you can use the <strong class=" ">mediaProvider.CustomRootPath</strong> property (as described on this page) to map each project to a different container. This way, each project has its own section of the Azure storage and overwriting of files does not occur.</p>
        </div>
    </div>
    <h3 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Configuring Kentico to map its file system to Azure storage</span></h3>
    <div class="confbox admonition admonition-note">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p><strong class=" ">Warning</strong>: Mapping the Kentico project's entire file system to Azure storage is only recommended when running on <a href="running-kentico-in-azure-cloud-services">Azure Cloud Services</a>. In other environments, this type of setup may introduce issues with <a href="using-locally-stored-search-indexes">locally stored search indexes</a> and <a href="web-analytics">Web analytics</a> functionality and we recommend that you only <a href="#src-68882093_configuringazurestorage-configuringkenticotostoreonlymediafilesonazurestorage">map media library folders</a>.</p>
<p>If you do wish to map the entire file system, you can set up additional mappings back to the local file system for the search index and web analytics folders – see <a href="mapping-the-web-analytics-storage-folder-to-the-server-file-system">Mapping the Web analytics storage folder to the server file system</a> for details. Also see <a href="troubleshooting-local-search-indexes-on-azure">Troubleshooting local search indexes on Azure</a> for more information.</p>
        </div>
    </div>
<ol class=" "><li class=" "><p>Add the following key into the <i class=" ">appSettings</i> section of your project's <strong class=" ">web.config</strong> file.</p>
    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">&lt;add key=</code><code class="string">"CMSExternalStorageName"</code><code class="plain"> value=</code><code class="string">"azure"</code><code class="plain"> /&gt;</code></div>
</div>
    </div>
<p>This key maps the entire file system of your application to the Azure storage.<br><br></p>
</li><li class=" "><p>Add the following keys to specify the storage account name and primary access key:</p>
    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">&lt;add key=</code><code class="string">"CMSAzureAccountName"</code><code class="plain"> value=</code><code class="string">"StorageAccountName"</code><code class="plain"> /&gt;</code></div>
<div class="line"><code class="plain">&lt;add key=</code><code class="string">"CMSAzureSharedKey"</code><code class="plain"> value=</code><code class="string">"PrimaryAccessKey"</code><code class="plain"> /&gt;</code></div>
</div>
    </div>
<p>To locate the values of these keys on Microsoft Azure:</p>
<ol class=" "><li class=" "><p>Open the <a class="external-link" href="https://portal.azure.com">Azure Management Portal</a> in a browser and sign in.</p>
</li><li class=" "><p>Open <strong class=" ">Storage accounts</strong>.</p>
</li><li class=" "><p>Select your storage.</p>
</li><li class=" "><p>Click<strong class=" "> Manage access keys</strong> on the bottom panel.</p>
<ul class=" "><li class=" "><p>Use the <strong class=" ">Storage account name</strong> and one of the provided access key values.</p>
</li></ul></li></ol></li></ol>    <div class="confbox admonition admonition-info">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p><strong class=" ">Additional website settings</strong></p>
<p>When configuring this type of storage, keep in mind that the website itself must be configured to store files in the file system rather than in the database only. In <strong class=" ">Settings -&gt; System -&gt; Files</strong> enable the <strong class=" ">Store files in file system</strong> option.</p>
<p>It is also recommended to enable <strong class=" ">Redirect files to disk</strong> in <strong class=" ">Settings -&gt; System -&gt; Performance</strong>. This means that files will be requested from the Azure Storage account rather than from the database (if possible).</p>
        </div>
    </div>
<p>Also see the <a href="#src-68882093_configuringazurestorage-medialibrarynotes">Media library notes</a> on this page for additional information about specifics of media libraries when using Azure storage.</p>
    <h3 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Mapping files to storage accounts enforcing HTTPS connections</span></h3>
<p>Some external storage accounts may enforce HTTPS communication via the <a class="external-link" href="https://docs.microsoft.com/en-us/azure/storage/common/storage-require-secure-transfer">Security transfer required</a> setting configurable in the <a class="external-link" href="https://portal.azure.com">Azure portal</a>. When mapping the file system or media library files to such accounts, you must include the <a href="#src-68882093_configuringazurestorage-optionalweb.configsettingsforazurestorage">CMSAzureBlobEndPoint </a>configuration key in the application's <strong class=" ">web.config</strong> file. The key's value needs to contain the full endpoint URL of the external storage account and explicitly use the <i class=" ">https</i> protocol:</p>
    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">&lt;appSettings&gt;</code></div>
<div class="line"><code class="plain">	...</code></div>
<div class="line"><code class="plain">	&lt;add key=</code><code class="string">"CMSAzureBlobEndPoint"</code><code class="plain"> value=</code><code class="string">"https://&lt;StorageAccountName&gt;.blob.core.windows.net"</code><code class="plain"> /&gt;</code></div>
<div class="line"><code class="plain">&lt;/appSettings&gt;</code></div>
</div>
    </div>
    <h3 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Media library notes</span></h3>
<p>Using the Azure Blob storage as an external storage for your project has some specific effects on media libraries.</p>
    <h4 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Storing too many files in one media library folder</span></h4>
<p>Note that storing a large number of media files in a single folder can significantly affect the performance of user interface when editing files in the Media library application. The performance of the website, however, is not affected. See <a href="configuring-media-libraries#src-68879365_configuringmedialibraries-medialibrarylimitationswhenstoringfilesinanexternalstorage">Media library limitations when storing files in an external storage</a> for details.</p>
    <h4 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Using permanent links when CMSAzurePublicContainer key is set to true</span></h4>
<p>If all following conditions are true:</p>
<ul class=" "><li class=" "><p>you use the Azure Blob storage as an external storage</p>
</li><li class=" "><p>and you set the CMSAzurePublicContainer key to <i class=" ">true</i></p>
</li><li class=" "><p>and you want to use <a href="content-staging">content staging</a></p>
</li></ul><p>then<strong class=" "> use Permanent links</strong> when linking to media files in media libraries.</p>
<p>The reason is that when using the CMSAzurePublicContainer key, direct file links contain the name of the storage in the URL. These links are not updated when staging files to another server, which is typically connected to a different storage. As a result, staged links incorrectly target files from the source server's storage, or may become broken if the files are not exactly mirrored on the staging servers. Permanent links do not contain the name of the storage, and automatically target the correct storage for each server.</p>
    <h3 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Optional web.config settings for Azure storage</span></h3>
    <div class="tablewrap">
        <table class="wrapped confluenceTable">
                    <colgroup>
                                    <col>
                                    <col>
                                    <col>
                            </colgroup>
        <thead class=" ">    <tr>
            <td class="confluenceTh" rowspan="1" colspan="1">
    <p>Key</p>
            </td>
                <td class="confluenceTh" rowspan="1" colspan="1">
    <p>Description</p>
            </td>
                <td class="confluenceTh" rowspan="1" colspan="1">
    <p>Sample value</p>
            </td>
        </tr>
</thead><tfoot class=" "></tfoot><tbody class=" ">    <tr>
            <td class="confluenceTd" rowspan="1" colspan="1">
    <p>CMSAzureTempPath</p>
            </td>
                <td class="confluenceTd" rowspan="1" colspan="1">
    <p>The system uses the specified folder to store temporary files on a local disk, for example when transferring large files to or from the storage account.</p>
            </td>
                <td class="confluenceTd" rowspan="1" colspan="1">
        <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">&lt;add key=</code><code class="string">"CMSAzureTempPath"</code><code class="plain"> value=</code><code class="string">"C:\AzureTemp"</code><code class="plain"> /&gt;</code></div>
</div>
    </div>
            </td>
        </tr>
    <tr>
            <td class="confluenceTd" rowspan="1" colspan="1">
    <p>CMSAzureCachePath</p>
            </td>
                <td class="confluenceTd" rowspan="1" colspan="1">
    <p>Specifies a folder on a local disk where files requested from the storage account are cached. This helps minimize the amount of blob storage operations, which saves time and resources.</p>
            </td>
                <td class="confluenceTd" rowspan="1" colspan="1">
        <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">&nbsp;&lt;add key=</code><code class="string">"CMSAzureCachePath"</code><code class="plain"> value=</code><code class="string">"C:\AzureCache"</code><code class="plain"> /&gt;</code></div>
</div>
    </div>
            </td>
        </tr>
    <tr>
            <td class="confluenceTd" rowspan="1" colspan="1">
    <p>CMSAzureBlobEndPoint</p>
            </td>
                <td class="confluenceTd" rowspan="1" colspan="1">
    <p>Sets the endpoint used for the connection to the blob service of the specified storage account. If you wish to use the default endpoint, remove the setting completely from the appropriate files.</p>
            </td>
                <td class="confluenceTd" rowspan="1" colspan="1">
        <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">&nbsp;&lt;add key=</code><code class="string">"CMSAzureBlobEndPoint"</code><code class="plain"> value=</code><code class="string">"http://127.0.0.1:10000/devstoreaccount1"</code><code class="plain"> /&gt;</code></div>
</div>
    </div>
            </td>
        </tr>
    <tr>
            <td class="confluenceTd" rowspan="1" colspan="1">
    <p>CMSAzurePublicContainer</p>
            </td>
                <td class="confluenceTd" rowspan="1" colspan="1">
    <p>Indicates if the blob container used to store the application's file system is public. If true, it will be possible to access files directly through the URL of the appropriate blob service, for example:</p>
<p><strong class=" "><i class=" ">http://&lt;StorageAccountName&gt;.blob.core.windows.net/cmsroot/corporatesite/media/imagelibrary/logo.png</i></strong></p>
<p><strong class=" "><i class=" "><br></i></strong></p>
<p>When you set this key to true, please see the <a href="#src-68882093_configuringazurestorage-medialibrarynotes">Media library notes</a> section<i class=" ">.</i></p>
            </td>
                <td class="confluenceTd" rowspan="1" colspan="1">
        <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">&nbsp;&lt;add key=</code><code class="string">"CMSAzurePublicContainer"</code><code class="plain"> value=</code><code class="string">"true"</code><code class="plain"> /&gt;</code></div>
</div>
    </div>
            </td>
        </tr>
    <tr>
            <td class="confluenceTd" rowspan="1" colspan="1">
    <p>CMSAzureCDNEndpoint</p>
            </td>
                <td class="confluenceTd" rowspan="1" colspan="1">
    <p>URL of the HTTP endpoint of a <a href="configuring-azure-cdn">Azure Blob storage CDN</a>.</p>
<p><strong class=" ">Note:</strong> If you set the CMSAzureCDNEndpoint key, you also need to set the blob storage container to public - <strong class=" ">&lt;add key="CMSAzurePublicContainer" value="true" /&gt;</strong>.</p>
            </td>
                <td class="confluenceTd" rowspan="1" colspan="1">
        <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">&nbsp;&lt;add key=</code><code class="string">"CMSAzureCDNEndpoint"</code><code class="plain"> value=</code><code class="string">"kentico123.vo.msecnd.net"</code><code class="plain"> /&gt;</code></div>
</div>
    </div>
            </td>
        </tr>
    <tr>
            <td class="confluenceTd" rowspan="1" colspan="1">
    <p>    <span style="color: #333333;">
CMSDownloadBlobTimeout    </span>
</p>
            </td>
                <td class="confluenceTd" rowspan="1" colspan="1">
    <p>Specifies the timeout interval in minutes for importing files from Azure Blob storage into Kentico.</p>
<p>The default value is <i class=" ">1.5</i> minutes. Increase the interval if you encounter problems when importing large (about 2GB) files.</p>
            </td>
                <td class="confluenceTd" rowspan="1" colspan="1">
        <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">&lt;add key=</code><code class="string">"CMSDownloadBlobTimeout"</code><code class="plain"> value=</code><code class="string">"50"</code><code class="plain"> /&gt;</code></div>
</div>
    </div>
            </td>
        </tr>
</tbody>        </table>
            </div>
        </div>

    </article>


               
            
    <footer id="ht-footer">
    <a href="#" id="ht-jump-top" class="sp-aui-icon-small sp-aui-iconfont-arrows-up"></a>
</footer></div>

<div>
    <div id="ht-mq-detect"></div>
</div>

    <script src="js/lunr.js"></script>
    <script src="js/lunr-extras.js"></script>
    <script src="assets/js/scroll-search.js"></script>

    <script src="assets/js/expand-macro.js"></script>


</body></html>