<!DOCTYPE html><html><head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Using geolocation for contacts - Kentico 11 Documentation</title>

    
    <link rel="stylesheet" href="assets/css/expand-macro.css">

            <meta name="scroll-content-language-key" content="">
    
    <meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=2.0, user-scalable=yes">

<script type="text/javascript" src="assets/js/jquery.min.js"></script>
<script type="text/javascript" src="assets/js/jquery.scrollTo.min.js"></script>


<script type="text/javascript" src="assets/js/translate.js"></script>

<script type="text/javascript" src="assets/js/theme.main.js"></script>

    <script type="text/javascript" src="assets/js/iframeResizer.min.js"></script>

<link rel="stylesheet" href="assets/css/content-style.css">
    <link rel="stylesheet" href="assets/css/search.css">

<link rel="stylesheet" href="assets/css/theme.main.css">
<link rel="stylesheet" href="assets/css/theme.colors.css">

            <!-- ES5 support for older browsers, needed by lunr -->
        <script src="js/augment.js"></script> 
        <script id="worker" type="javascript/worker">

        startIndex = function() {
            idx = lunr.Index.load(lunrIndex);
            idx.pipeline.remove(lunr.stopWordFilter);
            postMessage({type: "setup-complete"});
        }

        onmessage = function (event) {
            var message = event.data;

            if ((message.type === 'setup') && message.baseUrl) {
                var url = message.baseUrl;
                importScripts(url + 'js/lunr.js');
                importScripts(url + 'js/lunr-extras.js');
                importScripts(url + 'js/lunr-index.js');
                importScripts(url + 'js/lunr-data.js');
                startIndex();
            }

            if (idx && (message.type === 'search-request') && message.query) {
                var searchWord = message.query;
                var results = idx.search(searchWord).map(function (result) {
                    return lunrData.filter(function (d) {
                        return d.id === parseInt(result.ref, 10)
                    })[0]
                });
                postMessage({type: 'search-results', results: results, query: searchWord, queryId: message.queryId});
            }
        }

    </script>
    </head>

<body pageid="68879260">

<div id="ht-loader">
    <noscript>
        <p style="width: 100%; text-align:center; position: absolute; margin-top: 200px;">This content cannot be displayed without JavaScript.<br>Please enable JavaScript and reload the page.</p>
    </noscript>
</div>

<div>
   	<header id="ht-headerbar">
    <div class="ht-headerbar-left">
        <a href="" id="ht-menu-toggle" class="sp-aui-icon-small sp-aui-iconfont-appswitcher"></a>
    </div>
    <div class="ht-headerbar-right">
            <div class="sp-aui-icon-small ht-search-index-loader ht-header-icon"></div>

        <div id="ht-search">
            <div class="ht-search-input" style="display: none;">
              	<a href="#" class="sp-aui-icon-small sp-aui-iconfont-remove ht-search-clear"></a>

                <form action="#" method="GET" id="search">
                    <input class="search-input" type="text" placeholder="Search" tabindex="-1" autocomplete="off" name="q" value="">
                    <input type="hidden" name="max" value="15">
                    <input type="submit" style="display:none" tabindex="-4">
                </form>

                <a href="#" id="ht-search-button" class="ht-header-icon ht-header-icon-svg">
                                        <svg width="40px" height="40px" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                        <g>
                            <path d="M29.572,28.802 L28.801,29.571 C28.515,29.857 28.187,30 27.816,30 C27.445,30 27.116,29.857 26.831,29.571 L21.392,24.134 C20.193,24.762 18.908,25.076 17.538,25.076 C15.396,25.076 13.605,24.348 12.163,22.892 C10.721,21.436 10,19.651 10,17.538 C10,15.397 10.721,13.605 12.163,12.163 C13.605,10.721 15.396,10 17.538,10 C19.651,10 21.434,10.721 22.89,12.163 C24.347,13.605 25.075,15.397 25.075,17.538 C25.075,18.937 24.761,20.222 24.132,21.393 L29.572,26.832 C29.857,27.118 30,27.446 30,27.817 C30,28.188 29.857,28.517 29.572,28.802 L29.572,28.802 Z M13.662,21.414 C14.732,22.485 16.024,23.02 17.538,23.02 C19.051,23.02 20.343,22.485 21.413,21.414 C22.484,20.344 23.019,19.052 23.019,17.538 C23.019,16.025 22.484,14.733 21.413,13.662 C20.343,12.592 19.051,12.056 17.538,12.056 C16.024,12.056 14.732,12.592 13.662,13.662 C12.591,14.733 12.056,16.025 12.056,17.538 C12.056,19.052 12.591,20.344 13.662,21.414 L13.662,21.414 Z"></path>
                        </g>
                    </svg>
              	</a>

                <div class="ht-search-dropdown ht-dropdown">
                    <ul></ul>
                </div>
            </div>
        </div>
    </div>
    </header>   	<aside id="ht-sidebar">
    <div class="ht-sidebar-content">
        <div class="ht-sidebar-content-scroll-container">
            <header class="ht-sidebar-header">
                <h1 class="ht-logo">
                    <span class="ht-logo-label">K11</span>
                    <img class="space-logo" src="global.logo">
                </h1>
                <a href="Kentico-11-Documentation-Home.html" class="ht-space-link">
                    <h2>Kentico 11 Documentation</h2>
                </a>
            </header>
                            <iframe id="ht-nav" src="toc.html?pageId=68882623"></iframe>
                <script>
                    $('iframe#ht-nav').iFrameResize(
                            { 'log': true, 'autoResize': true, 'heightCalculationMethod': 'lowestElement', 'checkOrigin': false });
                </script>
                    </div>
    </div>

</aside></div>

<div id="ht-wrap-container">

            
    <div id="ht-sidebar-dragbar">
    <div class="ht-sidebar-drag-handle">
        <span class="drag-handle-1"></span>
        <span class="drag-handle-2"></span>
        <span class="drag-handle-3"></span>
    </div>
</div>
    <article id="ht-content" class="ht-content">
        <header class="ht-content-header">
            <div id="ht-breadcrumb">
    <ul>
        <li><a href="Kentico-11-Documentation-Home.html">Kentico 11 Documentation</a></li>
                                                                                                             <li><a href="" onclick="$('.shortcut').each(function(){$(this).removeClass('shortcut')}); $(this).parent().addClass('shortcut'); return false;">...</a> </li>
                                        <li class="shortcut"><a href="On-line-marketing-features.html">On-line marketing features</a></li>
                                                                                                         <li class="shortcut"><a href="Configuring-and-customizing-your-on-line-marketing-features.html">Configuring and customizing your on-line marketing features</a></li>
                                                                                     <li><a href="Configuring-contacts.html">Configuring contacts</a></li>
                                                            </ul>
</div>            <h1 id="src-68882623"> <span>Using geolocation for contacts</span></h1>
        </header>

        <div id="main-content" class="wiki-content sp-grid-section" data-index-for-search="true">
<div class="section-left"><p>You can use geolocation to determine the origin (real world geographic location) of your website visitors based on their IP address. The system obtains the geographic data using MaxMind's GeoIP Databases.</p><p>The default database is <i class=" ">GeoLite City</i> (Legacy). You can extend the accuracy of the feature by downloading additional databases.</p><div class="confbox admonition admonition-note">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p><strong class=" ">Using GeoIP2 Databases</strong></p>
<p>The GeoLite and GeoIP Legacy Databases will be <a class="external-link" href="https://blog.maxmind.com/2018/01/02/discontinuation-of-the-geolite-legacy-databases/">discontinued</a>. We recommend transitioning to the newer GeoLite2 or GeoIP2 Databases â€“ see the <a href="#src-68882623_usinggeolocationforcontacts-managingyourmaxminddatabases">Managing your MaxMind databases</a> section.</p>
        </div>
    </div><div class="confbox admonition admonition-info">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p><strong class=" ">Note</strong></p>
<p>The system only determines the geographic location of <a href="working-with-contacts">contacts</a> during their first visit on a website. The information is not updated when the same contact accesses your websites again from a different location.</p>
        </div>
    </div></div>

    
    
    <div class="section-right"><div class="confbox panel">
            <div class="title panel-header">On this page</div>
            <div class="panel-content">
<p></p>
<ul class="toc-indentation "><li class=" "><p><a href="#src-68882623_usinggeolocationforcontacts-configuringgeolocation">Configuring geolocation</a></p>
</li><li class=" "><p><a href="#src-68882623_usinggeolocationforcontacts-managingyourmaxminddatabases">Managing your MaxMind databases</a></p>
<ul class="toc-indentation "><li class=" "><p><a href="#src-68882623_usinggeolocationforcontacts-addinggeoip2databases">Adding GeoIP2 databases</a></p>
</li><li class=" "><p><a href="#src-68882623_safe-id-vxnpbmdnzw9sb2nhdglvbmzvcmnvbnrhy3rzlufkzgluz0dlb0lqq2l0eshmzwdhy3kp">Adding GeoIP City (Legacy)</a></p>
</li><li class=" "><p><a href="#src-68882623_safe-id-vxnpbmdnzw9sb2nhdglvbmzvcmnvbnrhy3rzlufkzgluz0dlb0lqt3jnyw5pemf0aw9ukexlz2fjesk">Adding GeoIP Organization (Legacy)</a></p>
</li><li class=" "><p><a href="#src-68882623_usinggeolocationforcontacts-updatingexistingdatabases">Updating existing databases</a></p>
</li></ul></li></ul><p></p>
        </div>
    </div></div>
<p></p>
    <div class="confbox admonition admonition-info">
                    <p class="title">Kentico EMS required</p>
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p>Features described on this page require the <strong class=" ">Kentico EMS</strong> license.</p>
        </div>
    </div>
<p></p>
    <h3 id="src-68882623_Usinggeolocationforcontacts-Configuringgeolocation" class="heading "><span>Configuring geolocation</span></h3>
<p>To set up geolocation for your websites:</p>
<ol class=" "><li class=" "><p>Open the <strong class=" ">Settings </strong>application.</p>
</li><li class=" "><p>Navigate to the<strong class=" "> On-line marketing -&gt; Contact management -&gt; Geolocation</strong> category.</p>
</li><li class=" "><p>Select the <strong class=" ">Enable contact geolocation by IP</strong> checkbox.</p>
</li><li class=" "><p>(Optional) Enter a <strong class=" ">Suffix for mapped data</strong>.</p>
<ul class=" "><li class=" "><p>The system adds the suffix to the values of all text-based contact fields that are obtained using geolocation.</p>
</li></ul></li><li class=" "><p>Configure the mappings of geolocation data to Kentico contact fields.</p>
    <div class="confbox admonition admonition-info">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p><strong class=" ">Note</strong></p>
<p>By default, Kentico contacts do not have an equivalent of the following fields:</p>
<ul class=" "><li class=" "><p>Area code</p>
</li><li class=" "><p>Metro code</p>
</li><li class=" "><p>DMA code</p>
</li><li class=" "><p>Latitude</p>
</li><li class=" "><p>Longitude</p>
</li></ul><p>To learn how to create custom fields for holding the data, see <a href="adding-custom-fields-to-contacts">Adding custom fields to contacts</a>.</p>
        </div>
    </div>
    <div class="confbox admonition admonition-note">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p><strong class=" ">Field data type restrictions</strong></p>
<p>Mind the following type restrictions when assigning target fields for the geolocation data:</p>
    <div class="tablewrap">
        <table class="wrapped confluenceTable">
                    <colgroup>
                                    <col>
                                    <col>
                            </colgroup>
        <thead class=" ">    <tr>
            <td class="confluenceTh" rowspan="1" colspan="1">
    <p>Field</p>
            </td>
                <td class="confluenceTh" rowspan="1" colspan="1">
    <p>Only accepts</p>
            </td>
        </tr>
</thead><tfoot class=" "></tfoot><tbody class=" ">    <tr>
            <td class="confluenceTd" rowspan="1" colspan="1">
    <p><strong class=" ">Country</strong></p>
            </td>
                <td class="confluenceTd" rowspan="1" colspan="1">
    <p>Integer-based and text-based fields.</p>
<ul class=" "><li class=" "><p>When mapping to integer fields, the <i class=" ">Country ID</i> value is used</p>
</li><li class=" "><p>Text-based fields use the <i class=" ">Country display name</i> value</p>
</li></ul>            </td>
        </tr>
    <tr>
            <td class="confluenceTd" rowspan="1" colspan="1">
    <p><strong class=" ">State</strong></p>
            </td>
                <td class="confluenceTd" rowspan="1" colspan="1">
    <p>Integer-based and text-based fields.</p>
<ul class=" "><li class=" "><p>When mapping to integer fields, the <i class=" ">State ID</i> value is used</p>
</li><li class=" "><p>Text-based fields use the <i class=" ">State display name</i> value</p>
</li></ul>            </td>
        </tr>
    <tr>
            <td class="confluenceTd" rowspan="1" colspan="1">
    <p><strong class=" ">City</strong></p>
            </td>
                <td class="confluenceTd" rowspan="1" colspan="1">
    <p>Textâ€‘based fields.</p>
            </td>
        </tr>
    <tr>
            <td class="confluenceTd" rowspan="1" colspan="1">
    <p><strong class=" ">Postal code</strong></p>
            </td>
                <td class="confluenceTd" rowspan="1" colspan="1">
    <p>Integerâ€‘based and textâ€‘based fields.</p>
            </td>
        </tr>
    <tr>
            <td class="confluenceTd" rowspan="1" colspan="1">
    <p><strong class=" ">Area code</strong></p>
            </td>
                <td class="confluenceTd" rowspan="1" colspan="1">
    <p>Integerâ€‘based and textâ€‘based fields.</p>
<p>Note: The area code data is not available when using GeoIP2 Databases.</p>
            </td>
        </tr>
    <tr>
            <td class="confluenceTd" rowspan="1" colspan="1">
    <p><strong class=" ">Metro code</strong></p>
            </td>
                <td class="confluenceTd" rowspan="1" colspan="1">
    <p>Integerâ€‘based and textâ€‘based fields.</p>
            </td>
        </tr>
    <tr>
            <td class="confluenceTd" rowspan="1" colspan="1">
    <p><strong class=" ">DMA code</strong></p>
            </td>
                <td class="confluenceTd" rowspan="1" colspan="1">
    <p>Integerâ€‘based and textâ€‘based fields.</p>
<p>Note: The DMA code data is not available when using GeoIP2 Databases.</p>
            </td>
        </tr>
    <tr>
            <td class="confluenceTd" rowspan="1" colspan="1">
    <p><strong class=" ">Latitude</strong></p>
            </td>
                <td class="confluenceTd" rowspan="1" colspan="1">
    <p>Floating-point number and textâ€‘based fields.</p>
            </td>
        </tr>
    <tr>
            <td class="confluenceTd" rowspan="1" colspan="1">
    <p><strong class=" ">Longitude</strong></p>
            </td>
                <td class="confluenceTd" rowspan="1" colspan="1">
    <p>Floating-point number and textâ€‘based fields.</p>
            </td>
        </tr>
    <tr>
            <td class="confluenceTd" rowspan="1" colspan="1">
    <p><strong class=" ">Organization/ISP</strong></p>
            </td>
                <td class="confluenceTd" rowspan="1" colspan="1">
    <p>Text-based fields.</p>
<p>Note: Organization data is only available if you have the GeoIP Organization Database (Legacy) or <a href="#src-68882623_usinggeolocationforcontacts-addinggeoip2databases">GeoLite2 ASN Database</a> added to your project.</p>
            </td>
        </tr>
</tbody>        </table>
            </div>
        </div>
    </div>
</li><li class=" "><p>Click <strong class=" ">Save</strong>.</p>
</li></ol>    <h3 id="src-68882623_Usinggeolocationforcontacts-ManagingyourMaxMinddatabases" class="heading "><span>Managing your MaxMind databases</span></h3>
<p>You can improve the functionality of geolocation by using more detailed and accurate databases and by keeping your current databases up to date.</p>
    <h4 id="src-68882623_Usinggeolocationforcontacts-AddingGeoIP2databases" class="heading "><span>Adding GeoIP2 databases</span></h4>
<p>The initially used GeoLite or GeoIP Legacy databases will be <a class="external-link" href="https://blog.maxmind.com/2018/01/02/discontinuation-of-the-geolite-legacy-databases/">discontinued</a>. If you wish to integrate MaxMind's newer GeoIP2 Databases, use the following manual process:</p>
<ol class=" "><li class=" "><p>Apply <a class="external-link" href="https://devnet.kentico.com/download/hotfixes">hotfix 11.0.27</a> or newer to your Kentico instance.</p>
</li><li class=" "><p>Open your web project in Visual Studio. For sites created using the <a href="developing-sites-using-asp.net-mvc">MVC development model</a>, perform all of the following steps in the MVC project that provides the live site.</p>
</li><li class=" "><p>Right-click the project in the <strong class=" ">Solution Explorer</strong> and select <strong class=" ">Manage NuGet Packages</strong>.</p>
</li><li class=" "><p>Install the <strong class=" ">Kentico.Geolocation.Update-v11</strong> package.</p>
    <div class="confbox admonition admonition-note">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p><strong class=" ">Note</strong>: The package also installs several required dependencies, such as the <strong class=" ">MaxMind.GeoIP2</strong> package and version 11.0.2 of the <strong class=" ">Newtonsoft.Json</strong> package. You need to accept all license agreements and ensure that these packages work correctly with any customizations you may have in your project. If you have any custom projects within the solution that use the same packages, you need to consolidate the package versions.</p>
        </div>
    </div>
</li><li class=" "><p>Download the free <a class="external-link" href="https://dev.maxmind.com/geoip/geoip2/geolite2/">GeoLite2 City</a> database or purchase the <a class="external-link" href="https://www.maxmind.com/en/geoip2-city">GeoIP2 City</a> database (provides more accuracy and details).</p>
</li><li class=" "><p>Place the database file into your project's <i class=" ">~/App_Data/CMSModules/WebAnalytics/MaxMind/</i> folder.</p>
</li><li class=" "><p>Open your project's <i class=" ">web.config</i> file, and make sure the <strong class=" ">CMSGeoIPLocationFileName</strong> key (in the <i class=" ">appSettings</i> section) is set according to the name of your geolocation database file (<i class=" ">GeoLite2-City.mmdb</i> or <i class=" ">GeoIP2-City.mmdb</i>).</p>
    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                    <div class="title">Example</div>
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-title="Example" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">&lt;add key=</code><code class="string">"CMSGeoIPLocationFileName"</code><code class="plain"> value=</code><code class="string">"GeoIP2-City.mmdb"</code><code class="plain"> /&gt;</code></div>
</div>
    </div>
</li><li class=" "><p>(Optional) If you also wish to use the <i class=" ">GeoLite2 ASN </i>database to determine the organization name of visiting contacts, download the <a class="external-link" href="https://dev.maxmind.com/geoip/geoip2/geolite2/">GeoLite2 ASN</a> database file (<i class=" ">GeoLite2-ASN.mmdb</i>) and place it into your web project's <i class=" ">~/App_Data/CMSModules/WebAnalytics/MaxMind/</i> folder.</p>
</li></ol><p>The geolocation feature now uses the added GeoLite2 or GeoIP2 databases. You can no longer use the GeoIP Legacy databases.</p>
    <h4 id="src-68882623_safe-id-VXNpbmdnZW9sb2NhdGlvbmZvcmNvbnRhY3RzLUFkZGluZ0dlb0lQQ2l0eShMZWdhY3kp" class="heading "><span>Adding GeoIP City (Legacy)</span></h4>
<p>The <strong class=" ">GeoIP City Legacy</strong> database provides more accurate results than the default <i class=" ">GeoLite City Legacy</i> database.</p>
<ol class=" "><li class=" "><p>Obtain the GeoIP City Legacy database.</p>
</li><li class=" "><p>Place the database file into the <i class=" ">~/App_Data/CMSModules/WebAnalytics/MaxMind/</i> folder of your web project.</p>
</li><li class=" "><p>Configure the system to use the new geolocation database by adding the following key to the <i class=" ">appSettings</i> section of your <i class=" ">web.config</i> file. Specify the name of the database file as the key's value.</p>
    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">&lt;add key=</code><code class="string">"CMSGeoIPLocationFileName"</code><code class="plain"> value=</code><code class="string">"GeoIPCity.dat"</code><code class="plain"> /&gt;</code></div>
</div>
    </div>
</li></ol><p>Geolocation now uses the <i class=" ">GeoIPCity.dat</i> database instead of the default <i class=" ">GeoLiteCity.dat</i> database.</p>
    <h4 id="src-68882623_safe-id-VXNpbmdnZW9sb2NhdGlvbmZvcmNvbnRhY3RzLUFkZGluZ0dlb0lQT3JnYW5pemF0aW9uKExlZ2FjeSk" class="heading "><span>Adding GeoIP Organization (Legacy)</span></h4>
<p>The <strong class=" ">GeoIP Organization Legacy</strong> database allows the system to determine the organization name of visiting contacts.</p>
<p>Note that the database only contains data for large corporations and organizations, and does not have guaranteed accuracy. We recommend contacting MaxMind support for more information about the accuracy of the organization data.</p>
<ol class=" "><li class=" "><p>Obtain the GeoIP Organization Legacy database.</p>
</li><li class=" "><p>Place the database file into the <i class=" ">~/App_Data/CMSModules/WebAnalytics/MaxMind/</i> folder of your web project.</p>
    <div class="confbox admonition admonition-note">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p><strong class=" ">Note</strong>: The name of the database file must be <strong class=" "><i class=" ">GeoIPOrg.dat</i>.</strong></p>
        </div>
    </div>
</li></ol><p>Geolocation now supports organization detection.</p>
    <h4 id="src-68882623_Usinggeolocationforcontacts-Updatingexistingdatabases" class="heading "><span>Updating existing databases</span></h4>
<p>To ensure that the geolocation data is accurate, you need to regularly update your MaxMind databases.</p>
<p>To update your databases, download the newest version and upload the database file to your web project's <i class=" ">~/App_Data/CMSModules/WebAnalytics/MaxMind/</i> folder.</p>
        </div>

    </article>


               
            
    <footer id="ht-footer">
    <a href="#" id="ht-jump-top" class="sp-aui-icon-small sp-aui-iconfont-arrows-up"></a>
</footer></div>

<div>
    <div id="ht-mq-detect"></div>
</div>

    <script src="js/lunr.js"></script>
    <script src="js/lunr-extras.js"></script>
    <script src="assets/js/scroll-search.js"></script>

    <script src="assets/js/expand-macro.js"></script>


</body></html>