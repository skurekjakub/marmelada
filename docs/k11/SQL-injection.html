<!DOCTYPE html><html><head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>SQL injection - Kentico 11 Documentation</title>

    
    <link rel="stylesheet" href="assets/css/expand-macro.css">

            <meta name="scroll-content-language-key" content="">
    
    <meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=2.0, user-scalable=yes">

<script type="text/javascript" src="assets/js/jquery.min.js"></script>
<script type="text/javascript" src="assets/js/jquery.scrollTo.min.js"></script>


<script type="text/javascript" src="assets/js/translate.js"></script>

<script type="text/javascript" src="assets/js/theme.main.js"></script>

    <script type="text/javascript" src="assets/js/iframeResizer.min.js"></script>

<link rel="stylesheet" href="assets/css/content-style.css">
    <link rel="stylesheet" href="assets/css/search.css">

<link rel="stylesheet" href="assets/css/theme.main.css">
<link rel="stylesheet" href="assets/css/theme.colors.css">

            <!-- ES5 support for older browsers, needed by lunr -->
        <script src="js/augment.js"></script> 
        <script id="worker" type="javascript/worker">

        startIndex = function() {
            idx = lunr.Index.load(lunrIndex);
            idx.pipeline.remove(lunr.stopWordFilter);
            postMessage({type: "setup-complete"});
        }

        onmessage = function (event) {
            var message = event.data;

            if ((message.type === 'setup') && message.baseUrl) {
                var url = message.baseUrl;
                importScripts(url + 'js/lunr.js');
                importScripts(url + 'js/lunr-extras.js');
                importScripts(url + 'js/lunr-index.js');
                importScripts(url + 'js/lunr-data.js');
                startIndex();
            }

            if (idx && (message.type === 'search-request') && message.query) {
                var searchWord = message.query;
                var results = idx.search(searchWord).map(function (result) {
                    return lunrData.filter(function (d) {
                        return d.id === parseInt(result.ref, 10)
                    })[0]
                });
                postMessage({type: 'search-results', results: results, query: searchWord, queryId: message.queryId});
            }
        }

    </script>
    </head>

<body pageid="68879260" elementpageid="68881119">

<div id="ht-loader">
    <noscript>
        <p style="width: 100%; text-align:center; position: absolute; margin-top: 200px;">This content cannot be displayed without JavaScript.<br>Please enable JavaScript and reload the page.</p>
    </noscript>
</div>

<div>
   	<header id="ht-headerbar">
    <div class="ht-headerbar-left">
        <a href="" id="ht-menu-toggle" class="sp-aui-icon-small sp-aui-iconfont-appswitcher"></a>
    </div>
    <div class="ht-headerbar-right">
            <div class="sp-aui-icon-small ht-search-index-loader ht-header-icon"></div>

        <div id="ht-search">
            <div class="ht-search-input" style="display: none;">
              	<a href="#" class="sp-aui-icon-small sp-aui-iconfont-remove ht-search-clear"></a>

                <form action="#" method="GET" id="search">
                    <input class="search-input" type="text" placeholder="Search" tabindex="-1" autocomplete="off" name="q" value="">
                    <input type="hidden" name="max" value="15">
                    <input type="submit" style="display:none" tabindex="-4">
                </form>

                <a href="#" id="ht-search-button" class="ht-header-icon ht-header-icon-svg">
                                        <svg width="40px" height="40px" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                        <g>
                            <path d="M29.572,28.802 L28.801,29.571 C28.515,29.857 28.187,30 27.816,30 C27.445,30 27.116,29.857 26.831,29.571 L21.392,24.134 C20.193,24.762 18.908,25.076 17.538,25.076 C15.396,25.076 13.605,24.348 12.163,22.892 C10.721,21.436 10,19.651 10,17.538 C10,15.397 10.721,13.605 12.163,12.163 C13.605,10.721 15.396,10 17.538,10 C19.651,10 21.434,10.721 22.89,12.163 C24.347,13.605 25.075,15.397 25.075,17.538 C25.075,18.937 24.761,20.222 24.132,21.393 L29.572,26.832 C29.857,27.118 30,27.446 30,27.817 C30,28.188 29.857,28.517 29.572,28.802 L29.572,28.802 Z M13.662,21.414 C14.732,22.485 16.024,23.02 17.538,23.02 C19.051,23.02 20.343,22.485 21.413,21.414 C22.484,20.344 23.019,19.052 23.019,17.538 C23.019,16.025 22.484,14.733 21.413,13.662 C20.343,12.592 19.051,12.056 17.538,12.056 C16.024,12.056 14.732,12.592 13.662,13.662 C12.591,14.733 12.056,16.025 12.056,17.538 C12.056,19.052 12.591,20.344 13.662,21.414 L13.662,21.414 Z"></path>
                        </g>
                    </svg>
              	</a>

                <div class="ht-search-dropdown ht-dropdown">
                    <ul></ul>
                </div>
            </div>
        </div>
    </div>
    </header>   	<aside id="ht-sidebar">
    <div class="ht-sidebar-content">
        <div class="ht-sidebar-content-scroll-container">
            <header class="ht-sidebar-header">
                <h1 class="ht-logo">
                    <span class="ht-logo-label">K11</span>
                    <img class="space-logo" src="global.logo">
                </h1>
                <a href="Kentico-11-Documentation-Home.html" class="ht-space-link">
                    <h2>Kentico 11 Documentation</h2>
                </a>
            </header>
                            <iframe id="ht-nav" src="toc.html?pageId=68881119"></iframe>
                <script>
                    $('iframe#ht-nav').iFrameResize(
                            { 'log': true, 'autoResize': true, 'heightCalculationMethod': 'lowestElement', 'checkOrigin': false });
                </script>
                    </div>
    </div>

</aside></div>

<div id="ht-wrap-container">

            
    <div id="ht-sidebar-dragbar">
    <div class="ht-sidebar-drag-handle">
        <span class="drag-handle-1"></span>
        <span class="drag-handle-2"></span>
        <span class="drag-handle-3"></span>
    </div>
</div>
    <article id="ht-content" class="ht-content">
        <header class="ht-content-header">
            <div id="ht-breadcrumb">
    <ul>
        <li><a href="Kentico-11-Documentation-Home.html">Kentico 11 Documentation</a></li>
                                                                                                             <li><a href="" onclick="$('.shortcut').each(function(){$(this).removeClass('shortcut')}); $(this).parent().addClass('shortcut'); return false;">...</a> </li>
                                        <li class="shortcut"><a href="Securing-websites.html">Securing websites</a></li>
                                                                                     <li><a href="Developing-secure-websites.html">Developing secure websites</a></li>
                                                            </ul>
</div>            <h1 id="src-68881119"> <span>SQL injection</span></h1>
        </header>

        <div id="main-content" class="wiki-content sp-grid-section" data-index-for-search="true">
<div class="sp-grid-cell sp-grid-60"><p>SQL injection is a well known web application vulnerability. The attacker's aim is to execute his own SQL code on the victim's database through a web application. The attack is similar to XSS. The attacker sends a string to the web application via a form or URL parameter. If that string is used as a dynamic part of an SQL query (for example as part of a WHERE condition) and not protected properly, the attacker can modify the query before it is executed.</p><p>We can divide vulnerabilities into two kinds â€“ <i class=" ">classic</i> and <i class=" ">blind</i>:</p><ul class=" "><li class=" "><p>Classic SQL injection - the attacker can see the real error message from the SQL server.</p>
</li><li class=" "><p>Blind SQL injection - the attacker sees only a general error page. These injections are harder to exploit because the attackers do not know how exactly they can inject the code. The attackers usually use enumeration in this type of attack. Then, according to the time based errors or the displayed error message can they determine which of their queries have passed and which did not.</p>
</li></ul><h3 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Example of SQL injection</span></h3><p>A simple web page with a textbox and button which is used for searching users:</p><div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">&lt;asp:TextBox ID=</code><code class="string">"txtUserName"</code><code class="plain"> runat=</code><code class="string">"server"</code><code class="plain">&gt;&lt;/asp:TextBox&gt;</code></div>
<div class="line"><code class="plain">&lt;asp:Button ID=</code><code class="string">"btnSearch"</code><code class="plain"> runat=</code><code class="string">"server"</code><code class="plain"> Text=</code><code class="string">"Search"</code><code class="plain"> onclick=</code><code class="string">"btnSearch_Click"</code><code class="plain"> /&gt; </code></div>
</div>
    </div></div>

    

    
    <div class="sp-grid-cell sp-grid-40 sp-grid-sidebar"><div class="confbox panel">
            <div class="title panel-header">On this page</div>
            <div class="panel-content">
<p></p>
<ul class="toc-indentation "><li class=" "><p><a href="#src-68881119_sqlinjection-exampleofsqlinjection">Example of SQL injection</a></p>
</li><li class=" "><p><a href="#src-68881119_sqlinjection-whatcansqlinjectionattacksdo">What can SQL injection attacks do</a></p>
</li><li class=" "><p><a href="#src-68881119_sqlinjection-findingsqlinjectionvulnerabilities">Finding SQL injection vulnerabilities</a></p>
</li><li class=" "><p><a href="#src-68881119_sqlinjection-avoidingsqlinjectioninkentico">Avoiding SQL injection in Kentico</a></p>
<ul class="toc-indentation "><li class=" "><p><a href="#src-68881119_sqlinjection-dataquery">DataQuery</a></p>
</li><li class=" "><p><a href="#src-68881119_sqlinjection-queryobjects">Query objects</a></p>
</li><li class=" "><p><a href="#src-68881119_sqlinjection-sqlparameters">SQL Parameters</a></p>
</li><li class=" "><p><a href="#src-68881119_sqlinjection-apostropheescaping">Apostrophe escaping</a></p>
</li></ul></li><li class=" "><p><a href="#src-68881119_sqlinjection-summary">Summary</a></p>
</li></ul><p></p>
        </div>
    </div></div>
<p>In the code behind, the page has the following code:</p>
    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="keyword">using</code><code class="plain"> System.Data;</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="keyword">using</code><code class="plain"> CMS.Membership;</code></div>
<div class="line"><code class="keyword">using</code><code class="plain"> CMS.Helpers;</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="keyword">protected</code><code class="plain"> </code><code class="keyword">void</code><code class="plain"> btnSearch_Click(</code><code class="keyword">object</code><code class="plain"> sender, EventArgs e)</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">	DataSet ds = UserInfoProvider.GetUsers().Where(</code><code class="string">"UserName LIKE '%"</code><code class="plain"> + txtUserName.Text + </code><code class="string">"%'"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">if</code><code class="plain"> (!DataHelper.DataSourceIsEmpty(ds))</code></div>
<div class="line"><code class="plain">	{</code></div>
<div class="line"><code class="plain">		Response.Write(ds.Tables[0].Rows[0][</code><code class="string">"FullName"</code><code class="plain">]);</code></div>
<div class="line"><code class="plain">	}</code></div>
<div class="line"><code class="plain">} </code></div>
</div>
    </div>
<p>Now if a user inserts something like "admin", the user gets the full name of the global administrator on the output. The SQL query looks like this:</p>
    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="keyword">SELECT</code><code class="plain"> * </code><code class="keyword">FROM</code><code class="plain"> CMS_User </code><code class="keyword">WHERE</code><code class="plain"> UserName </code><code class="color1">LIKE</code><code class="plain"> </code><code class="string">'%admin%'</code><code class="plain"> </code></div>
</div>
    </div>
<p>This is a correct query which doesn't cause any problems. But if the user inserts something like "<strong class=" ">a'; DROP table CMS_User --</strong>", the resulting query is:</p>
    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="keyword">SELECT</code><code class="plain"> * </code><code class="keyword">FROM</code><code class="plain"> CMS_User </code><code class="keyword">WHERE</code><code class="plain"> UserName </code><code class="color1">LIKE</code><code class="plain"> </code><code class="string">'%a'</code><code class="plain">; </code><code class="keyword">DROP</code><code class="plain"> </code><code class="keyword">table</code><code class="plain"> CMS_User </code><code class="comments">--%'</code></div>
</div>
    </div>
<p>The query is executed, resulting in a deleted table.</p>
    <h3 $stringutils.tolowercase(${idattribute})="" class="heading "><span>What can SQL injection attacks do</span></h3>
<p>With an SQL injection vulnerability, the attacker can do exactly the same operations with the database as the web application itself. For example, the attacker can read and modify all data or the database schema. Also, T-SQL supports the xp_cmdshell() function, which executes operating system commands. So, the attacker can basically manage the whole server.</p>
    <h3 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Finding SQL injection vulnerabilities</span></h3>
<p>The first technique is based on trying. Insert strings like:</p>
<ul class=" "><li class=" "><p>'whatever â€“ basic test,</p>
</li><li class=" "><p>DROP,</p>
</li><li class=" "><p>something,</p>
</li></ul><p>to all inputs and URL parameters. Do not test only the apostrophe character (in the next chapter, you will see that you can exploit an application even without the apostrophe character).</p>
<p>The second way is to search for vulnerabilities in code. You can search for methods executing SQL queries. Then, you can check variables which are inputs of these methods. The aim of checking is searching for protection against SQL injection.</p>
    <h3 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Avoiding SQL injection in Kentico</span></h3>
<p>There are many ways of protection against SQL injection. Kentico provides:</p>
<p></p>
<ul class="toc-indentation "><li class=" "><p><a href="#src-68881119_sqlinjection-dataquery">DataQuery</a></p>
</li><li class=" "><p><a href="#src-68881119_sqlinjection-queryobjects">Query objects</a></p>
</li><li class=" "><p><a href="#src-68881119_sqlinjection-sqlparameters">SQL Parameters</a></p>
</li><li class=" "><p><a href="#src-68881119_sqlinjection-apostropheescaping">Apostrophe escaping</a></p>
</li></ul><p></p>
    <h4 $stringutils.tolowercase(${idattribute})="" class="heading "><span>DataQuery</span></h4>
<p>The best way to avoid SQL injection is to use the default Kentico API provider methods when loading data (ObjectQuery / DataQuery). The key security aspect of DataQuery is in processing parameter-driven queries.</p>
<p>To create WHERE conditions, we strongly recommend using specific <i class=" ">Where</i> methods for the given purpose, such as:</p>
<ul class=" "><li class=" "><p>WhereContains</p>
</li><li class=" "><p>WhereNull</p>
</li><li class=" "><p>WhereEquals</p>
</li><li class=" "><p>WhereStartsWith</p>
</li></ul><p>To get the full list of the Where methods, see the <a class="external-link" href="http://devnet.kentico.com/docs/8_1/api/html/AllMembers_T_CMS_DataEngine_IWhereCondition_1.htm">IWhereCondition reference</a>.</p>
    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                    <div class="title">Example</div>
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-title="Example" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="keyword">using</code><code class="plain"> CMS.Membership;</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">...</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">String avatarName = txtAvatarname.Text;</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="comments">// Loads avatar objects whose "AvatarName" column starts with a specific name</code></div>
<div class="line"><code class="plain">ObjectQuery&lt;AvatarInfo&gt; avatars = AvatarInfoProvider.GetAvatars().WhereStartsWith(</code><code class="string">"AvatarName"</code><code class="plain">, avatarName);</code></div>
</div>
    </div>
    <h4 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Query objects</span></h4>
<p>If you need to execute queries manually, use the appropriate <strong class=" ">query object classes</strong> from the Kentico <i class=" ">CMS.DataEngine</i> namespace to build parts of the query:</p>
<ul class=" "><li class=" "><p><strong class=" ">WhereCondition</strong></p>
</li><li class=" "><p><strong class=" ">Columns</strong></p>
</li><li class=" "><p><strong class=" ">OrderBy</strong></p>
</li></ul>    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                    <div class="title">Example</div>
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-title="Example" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="keyword">using</code><code class="plain"> CMS.DataEngine;</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">...</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="comments">// Builds a WHERE condition for loading documents</code></div>
<div class="line"><code class="keyword">string</code><code class="plain"> where = </code><code class="keyword">new</code><code class="plain"> WhereCondition()</code></div>
<div class="line"><code class="plain">    .WhereEquals(</code><code class="string">"AttachmentDocumentID"</code><code class="plain">, node.DocumentID)</code></div>
<div class="line"><code class="plain">    .WhereStartsWith(</code><code class="string">"AttachmentName"</code><code class="plain">, searchFileName).ToString(</code><code class="keyword">true</code><code class="plain">);</code></div>
</div>
    </div>
    <h4 $stringutils.tolowercase(${idattribute})="" class="heading "><span>SQL Parameters</span></h4>
<p>For WHERE conditions in INSERT, UPDATE and DELETE query types and stored procedures, handle parameters via <strong class=" ">QueryDataParameters</strong> objects.</p>
    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                    <div class="title">Example</div>
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-title="Example" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="keyword">using</code><code class="plain"> CMS.DataEngine;</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">...</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">QueryDataParameters parameters = </code><code class="keyword">new</code><code class="plain"> QueryDataParameters();</code></div>
<div class="line"><code class="plain">parameters.Add(</code><code class="string">"@param"</code><code class="plain">, param);</code></div>
</div>
    </div>
<p>The SQL server replaces <strong class=" ">@param </strong>with your value. The value is treated as a literal, which means that even if your value contains a piece of SQL code, the SQL server <strong class=" ">does not execute the code</strong>.</p>
    <div class="confbox admonition admonition-warning">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p><strong class=" ">Queries with the exec() function</strong></p>
<p>Parameters are almost 100% secure. But if you build a query, which is executed with the built-in <strong class=" ">exec()</strong> function, the parameters are processed the standard way (the query is executed with them, even if they contain malicious SQL code).</p>
<p>The following is an example of an <strong class=" ">unsafe query</strong>:</p>
    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                    <div class="title">Wrong</div>
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-title="Wrong" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="keyword">CREATE</code><code class="plain"> </code><code class="keyword">PROCEDURE</code><code class="plain"> injection( @param </code><code class="keyword">varchar</code><code class="plain">(30) )</code></div>
<div class="line"><code class="keyword">AS</code></div>
<div class="line"><code class="keyword">SET</code><code class="plain"> NOCOUNT </code><code class="keyword">ON</code></div>
<div class="line"><code class="keyword">DECLARE</code><code class="plain"> @query </code><code class="keyword">VARCHAR</code><code class="plain">(100)</code></div>
<div class="line"><code class="keyword">SET</code><code class="plain"> @query = </code><code class="string">'SELECT * FROM '</code><code class="plain"> + @param</code></div>
<div class="line"><code class="keyword">exec</code><code class="plain">(@query)</code></div>
<div class="line"><code class="plain">GO </code></div>
</div>
    </div>
        </div>
    </div>
    <h4 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Apostrophe escaping</span></h4>
<p>The last protection technique is manually replacing the dangerous apostrophe character with an escape sequence of two apostrophes. In code, you often build WHERE conditions for SELECT queries. When a part of the condition is a dynamically obtained string (e.g., from the database, input by a user, etc.), you must enclose it with apostrophes and perform replacing.</p>
<p>You can use two different options:</p>
<ul class=" "><li class=" "><p>To escape values in <i class=" "><strong class=" ">equals</strong></i> query patterns, use the <strong class=" ">SqlHelper.EscapeQuotes</strong> method:</p>
    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="keyword">string</code><code class="plain"> text = txtAvatarname.Text;</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="keyword">string</code><code class="plain"> where = </code><code class="string">"AvatarName = N'"</code><code class="plain"> + SqlHelper.EscapeQuotes(text) + </code><code class="string">"'"</code><code class="plain">;</code></div>
</div>
    </div>
</li><li class=" "><p>To escape values in <strong class=" "><i class=" ">LIKE</i></strong> query patterns, use both the <strong class=" ">SqlHelper.EscapeQuotes</strong> and <strong class=" ">SqlHelper.EscapeLikeValue</strong> methods:</p>
    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="keyword">string</code><code class="plain"> text = txtAvatarname.Text;</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="keyword">string</code><code class="plain"> where = </code><code class="string">"AvatarName LIKE N'%"</code><code class="plain"> + SqlHelper.EscapeLikeText(SqlHelper.EscapeQuotes(text)) + </code><code class="string">"%'"</code><code class="plain">;</code></div>
</div>
    </div>
</li></ul><p>The <i class=" ">Sqlhelper.EscapeQuotes</i> method ensures that all apostrophes are escaped to avoid SQL injection attacks. The second method <i class=" ">SqlHelper.EscapeLikeText</i> escapes wildcards used in SQL LIKE syntax â€” square brackets, percentage and underscore symbols.</p>
<p>This is a correct solution, but <strong class=" ">only for string values</strong>. Never use apostrophe escaping for other data types than strings. For example:</p>
    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                    <div class="title">Wrong</div>
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-title="Wrong" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">Guid guid = ... ;</code></div>
<div class="line"><code class="keyword">string</code><code class="plain"> where = </code><code class="string">"SomeGUID = '"</code><code class="plain"> + guid.ToString().Replace(</code><code class="string">"'"</code><code class="plain">, </code><code class="string">"''"</code><code class="plain">) + </code><code class="string">"'"</code><code class="plain">;</code></div>
</div>
    </div>
<p>In this example, replacing is unnecessary because <a class="external-link" href="http://en.wikipedia.org/wiki/GUID">GUID</a> values can only contain letters and numbers in a specific format.</p>
<p>A worse situation can occur when you believe that you are using non-string data types (for example int), but the variable you are actually using is a string:</p>
    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                    <div class="title">Wrong</div>
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-title="Wrong" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="keyword">string</code><code class="plain"> id = ... ;</code></div>
<div class="line"><code class="keyword">string</code><code class="plain"> where = </code><code class="string">"SomeID = "</code><code class="plain"> + id.Replace(</code><code class="string">"'"</code><code class="plain">, </code><code class="string">"''"</code><code class="plain">);</code></div>
</div>
    </div>
<p>There are two reasons why this code is wrong:</p>
<ul class=" "><li class=" "><p>It is possible to execute malicious code even without the apostrophe character. In the previous examples, you needed apostrophes to inject string constants into the SQL command, but there are no enclosing apostrophes for integer values.</p>
</li><li class=" "><p>In SQL, the Char() function converts numeric values to their ASCII representations. And these ASCII letters can be concatenated, so the attacker can write anything into the query.</p>
</li></ul><p>To solve such situations, convert the values to the correct data type, for example:</p>
    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                    <div class="title">Correct</div>
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-title="Correct" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="keyword">using</code><code class="plain"> CMS.Helpers;</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">...</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="keyword">string</code><code class="plain"> id = ... ;</code></div>
<div class="line"><code class="keyword">string</code><code class="plain"> where = </code><code class="string">"SomeID = "</code><code class="plain"> + ValidationHelper.GetInteger(id, 0);</code></div>
</div>
    </div>
    <h3 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Summary</span></h3>
<ul class=" "><li class=" "><p>Use the Kentico provider methods to load data whenever possible (ObjectQuery / DataQuery)</p>
</li><li class=" "><p>Protect dynamic parts in INSERT, UPDATE and DELETE queries with SQL parameters.</p>
</li><li class=" "><p>Don't ever use the <strong class=" ">exec()</strong> function in your SQL code in combination with parameters.</p>
</li><li class=" "><p>When you build a SELECT query in code, all used strings taken from external sources must be protected with the <strong class=" ">SqlHelper.EscapeQuotes</strong> and <strong class=" ">SqlHelper.EscapeLikeValue</strong> methods or use SQL parameters.</p>
</li><li class=" "><p>Always escape values from arrays (or lists etc.) when you save them into strings.</p>
</li><li class=" "><p>Never rely on JavaScript validation. JavaScript is executed on the client side so the attacker can disable validation.</p>
</li><li class=" "><p>When you work with other data types than strings, always convert the data to the given type or validate the value via regular expressions.</p>
</li></ul>        </div>

    </article>


               
            
    <footer id="ht-footer">
    <a href="#" id="ht-jump-top" class="sp-aui-icon-small sp-aui-iconfont-arrows-up"></a>
</footer></div>

<div>
    <div id="ht-mq-detect"></div>
</div>

    <script src="js/lunr.js"></script>
    <script src="js/lunr-extras.js"></script>
    <script src="assets/js/scroll-search.js"></script>

    <script src="assets/js/expand-macro.js"></script>


</body></html>