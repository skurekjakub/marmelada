<!DOCTYPE html><html><head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Handling newsletter subscriptions on MVC sites - Kentico 11 Documentation</title>

    
    <link rel="stylesheet" href="assets/css/expand-macro.css">

            <meta name="scroll-content-language-key" content="">
    
    <meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=2.0, user-scalable=yes">

<script type="text/javascript" src="assets/js/jquery.min.js"></script>
<script type="text/javascript" src="assets/js/jquery.scrollTo.min.js"></script>


<script type="text/javascript" src="assets/js/translate.js"></script>

<script type="text/javascript" src="assets/js/theme.main.js"></script>

    <script type="text/javascript" src="assets/js/iframeResizer.min.js"></script>

<link rel="stylesheet" href="assets/css/content-style.css">
    <link rel="stylesheet" href="assets/css/search.css">

<link rel="stylesheet" href="assets/css/theme.main.css">
<link rel="stylesheet" href="assets/css/theme.colors.css">

            <!-- ES5 support for older browsers, needed by lunr -->
        <script src="js/augment.js"></script> 
        <script id="worker" type="javascript/worker">

        startIndex = function() {
            idx = lunr.Index.load(lunrIndex);
            idx.pipeline.remove(lunr.stopWordFilter);
            postMessage({type: "setup-complete"});
        }

        onmessage = function (event) {
            var message = event.data;

            if ((message.type === 'setup') && message.baseUrl) {
                var url = message.baseUrl;
                importScripts(url + 'js/lunr.js');
                importScripts(url + 'js/lunr-extras.js');
                importScripts(url + 'js/lunr-index.js');
                importScripts(url + 'js/lunr-data.js');
                startIndex();
            }

            if (idx && (message.type === 'search-request') && message.query) {
                var searchWord = message.query;
                var results = idx.search(searchWord).map(function (result) {
                    return lunrData.filter(function (d) {
                        return d.id === parseInt(result.ref, 10)
                    })[0]
                });
                postMessage({type: 'search-results', results: results, query: searchWord, queryId: message.queryId});
            }
        }

    </script>
    </head>

<body pageid="68879260" elementpageid="68880505">

<div id="ht-loader">
    <noscript>
        <p style="width: 100%; text-align:center; position: absolute; margin-top: 200px;">This content cannot be displayed without JavaScript.<br>Please enable JavaScript and reload the page.</p>
    </noscript>
</div>

<div>
   	<header id="ht-headerbar">
    <div class="ht-headerbar-left">
        <a href="" id="ht-menu-toggle" class="sp-aui-icon-small sp-aui-iconfont-appswitcher"></a>
    </div>
    <div class="ht-headerbar-right">
            <div class="sp-aui-icon-small ht-search-index-loader ht-header-icon"></div>

        <div id="ht-search">
            <div class="ht-search-input" style="display: none;">
              	<a href="#" class="sp-aui-icon-small sp-aui-iconfont-remove ht-search-clear"></a>

                <form action="#" method="GET" id="search">
                    <input class="search-input" type="text" placeholder="Search" tabindex="-1" autocomplete="off" name="q" value="">
                    <input type="hidden" name="max" value="15">
                    <input type="submit" style="display:none" tabindex="-4">
                </form>

                <a href="#" id="ht-search-button" class="ht-header-icon ht-header-icon-svg">
                                        <svg width="40px" height="40px" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                        <g>
                            <path d="M29.572,28.802 L28.801,29.571 C28.515,29.857 28.187,30 27.816,30 C27.445,30 27.116,29.857 26.831,29.571 L21.392,24.134 C20.193,24.762 18.908,25.076 17.538,25.076 C15.396,25.076 13.605,24.348 12.163,22.892 C10.721,21.436 10,19.651 10,17.538 C10,15.397 10.721,13.605 12.163,12.163 C13.605,10.721 15.396,10 17.538,10 C19.651,10 21.434,10.721 22.89,12.163 C24.347,13.605 25.075,15.397 25.075,17.538 C25.075,18.937 24.761,20.222 24.132,21.393 L29.572,26.832 C29.857,27.118 30,27.446 30,27.817 C30,28.188 29.857,28.517 29.572,28.802 L29.572,28.802 Z M13.662,21.414 C14.732,22.485 16.024,23.02 17.538,23.02 C19.051,23.02 20.343,22.485 21.413,21.414 C22.484,20.344 23.019,19.052 23.019,17.538 C23.019,16.025 22.484,14.733 21.413,13.662 C20.343,12.592 19.051,12.056 17.538,12.056 C16.024,12.056 14.732,12.592 13.662,13.662 C12.591,14.733 12.056,16.025 12.056,17.538 C12.056,19.052 12.591,20.344 13.662,21.414 L13.662,21.414 Z"></path>
                        </g>
                    </svg>
              	</a>

                <div class="ht-search-dropdown ht-dropdown">
                    <ul></ul>
                </div>
            </div>
        </div>
    </div>
    </header>   	<aside id="ht-sidebar">
    <div class="ht-sidebar-content">
        <div class="ht-sidebar-content-scroll-container">
            <header class="ht-sidebar-header">
                <h1 class="ht-logo">
                    <span class="ht-logo-label">K11</span>
                    <img class="space-logo" src="global.logo">
                </h1>
                <a href="Kentico-11-Documentation-Home.html" class="ht-space-link">
                    <h2>Kentico 11 Documentation</h2>
                </a>
            </header>
                            <iframe id="ht-nav" src="toc.html?pageId=68880505"></iframe>
                <script>
                    $('iframe#ht-nav').iFrameResize(
                            { 'log': true, 'autoResize': true, 'heightCalculationMethod': 'lowestElement', 'checkOrigin': false });
                </script>
                    </div>
    </div>

</aside></div>

<div id="ht-wrap-container">

            
    <div id="ht-sidebar-dragbar">
    <div class="ht-sidebar-drag-handle">
        <span class="drag-handle-1"></span>
        <span class="drag-handle-2"></span>
        <span class="drag-handle-3"></span>
    </div>
</div>
    <article id="ht-content" class="ht-content">
        <header class="ht-content-header">
            <div id="ht-breadcrumb">
    <ul>
        <li><a href="Kentico-11-Documentation-Home.html">Kentico 11 Documentation</a></li>
                                                                                                             <li><a href="" onclick="$('.shortcut').each(function(){$(this).removeClass('shortcut')}); $(this).parent().addClass('shortcut'); return false;">...</a> </li>
                                        <li class="shortcut"><a href="Developing-websites.html">Developing websites</a></li>
                                                                                                         <li class="shortcut"><a href="Developing-sites-using-ASP.NET-MVC.html">Developing sites using ASP.NET MVC</a></li>
                                                                                                         <li class="shortcut"><a href="Implementing-on-line-marketing-features-on-MVC-sites.html">Implementing on-line marketing features on MVC sites</a></li>
                                                                                     <li><a href="Email-marketing-on-MVC-sites.html">Email marketing on MVC sites</a></li>
                                                            </ul>
</div>            <h1 id="src-68880505"> <span>Handling newsletter subscriptions on MVC sites</span></h1>
        </header>

        <div id="main-content" class="wiki-content sp-grid-section" data-index-for-search="true">
<div class="sp-grid-section"><div class="sp-grid-cell sp-grid-60"><div class="sp-grid-section"></div></div><div class="sp-grid-cell sp-grid-60"><p>You can use the <a href="email-marketing">email marketing</a> features of Kentico with websites that are presented by a <a href="developing-sites-using-asp.net-mvc">separate MVC application</a>.</p><p>In this scenario, you manage and send <a href="creating-newsletters">newsletters</a> from the administration interface of the Kentico application. All settings related to email marketing that you configure in Kentico apply (both global settings and the configuration of individual newsletters). On the side of the MVC application, you need to handle the actions that visitors perform on the pages of the website â€“ newsletter subscription and unsubscription.</p><p>To allow visitors on your MVC website to manage subscriptions for your newsletters:</p><ol class=" "><li class=" "><p>Install the <a href="installing-kentico-integration-packages"><strong class=" ">Kentico.Newsletters</strong> integration package</a> into your MVC project.</p>
</li><li class=" "><p><a href="#src-68880505_handlingnewslettersubscriptionsonmvcsites-initializingthesubscriptionservice">Initialize the subscription service</a>.</p>
</li><li class=" "><p>Implement the required functionality on your MVC site:<br></p>
<ul class=" "><li class=" "><p><a href="#src-68880505_handlingnewslettersubscriptionsonmvcsites-settingupsubscription">Subscription</a></p>
</li><li class=" "><p><a href="#src-68880505_handlingnewslettersubscriptionsonmvcsites-settingupunsubscription">Unsubscription</a></p>
</li><li class=" "><p><a href="#src-68880505_handlingnewslettersubscriptionsonmvcsites-handlingconfirmationsfordoubleopt-insubscription">Processing of subscription confirmations</a> (if your newsletters use <a href="enabling-double-opt-in-for-newsletters">double opt-in</a>)</p>
</li></ul></li><li class=" "><p><a href="#src-68880505_handlingnewslettersubscriptionsonmvcsites-enablingresourcesharing">Enable resource sharing</a> with the Kentico administration application.</p>
</li></ol><div class="sp-grid-section"></div><div class="sp-grid-section"></div></div><div class="sp-grid-cell sp-grid-40 sp-grid-sidebar"><div class="confbox panel">
            <div class="title panel-header">Related pages</div>
            <div class="panel-content">
<ul class=" "><li class=" "><p><a href="preparing-email-templates">Preparing email templates</a></p>
</li><li class=" "><p><a href="creating-newsletters">Creating newsletters</a></p>
</li><li class=" "><p><a href="tracking-marketing-emails-on-mvc-sites">Tracking marketing emails on MVC sites</a></p>
</li></ul>        </div>
    </div></div><div class="sp-grid-cell sp-grid-40 sp-grid-sidebar"><div class="confbox panel">
            <div class="title panel-header">Related pages</div>
            <div class="panel-content">
<ul class=" "><li class=" "><p><a href="preparing-email-templates">Preparing email templates</a></p>
</li><li class=" "><p><a href="creating-newsletters">Creating newsletters</a></p>
</li><li class=" "><p><a href="tracking-marketing-emails-on-mvc-sites">Tracking marketing emails on MVC sites</a></p>
</li></ul>        </div>
    </div></div></div><div class="sp-grid-section"></div>


    
    <h3 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Initializing the subscription service</span></h3>
<p>To use the newsletter subscription API, you need to initialize a <strong class=" ">NewsletterSubscriptionService</strong> instance and make it available to the related controllers.</p>
    <div class="confbox admonition admonition-tip">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p>We recommend using a <a href="initializing-kentico-services-with-dependency-injection">dependency injection container</a> to initialize service instances. When configuring the lifetime scope for <i class=" ">NewsletterSubscriptionService</i>, create a shared instance (singleton) for all requests.</p>
        </div>
    </div>
    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="keyword">using</code><code class="plain"> Kentico.Newsletters;</code></div>
<div class="line"><code class="keyword">using</code><code class="plain"> CMS.SiteProvider;</code></div>
</div>
    </div>
<p><img class="wysiwyg-unknown-macro" src="images/plugins/servlet/confluence/placeholder/unknown-macro.png" alt="images/plugins/servlet/confluence/placeholder/unknown-macro.png">
You can now call the methods of the subscription service within your application's code to perform actions related to newsletter subscription and unsubscription.</p>
    <h3 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Setting up subscription</span></h3>
<p>Use the following approach to develop actions that allow visitors to subscribe to newsletters on your website:</p>
<p></p>
    <div class="confbox admonition admonition-tip">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p><strong class=" ">Tip</strong>: To view the full code of a functional example directly in Visual Studio, download the <a class="external-link" href="https://github.com/Kentico/Mvc">Kentico MVC solution</a> from GitHub and inspect the <strong class=" ">LearningKit</strong> project. You can also run the Learning Kit website after connecting the project to a Kentico database.</p>
        </div>
    </div>
<p></p>
<ol class=" "><li class=" "><p>Create a newsletter for your MVC site in Kentico (or use an existing one). See <a href="creating-newsletters">Creating newsletters</a> for more information.</p>
</li><li class=" "><p>Create a new controller class in your MVC project or edit an existing one.</p>
</li><li class=" "><p>Implement two subscription actions â€“ one basic GET action to display a subscription form and a second POST action to handle the creation of new recipients when the form is submitted.</p>
</li><li class=" "><p>Perform the following steps within the POST action:</p>
<ol class=" "><li class=" "><p>Get a <i class=" ">ContactInfo</i> object representing the new recipient based on the email address posted from the subscription form â€“ call the <strong class=" ">ContactProvider.GetContactForSubscribing</strong> method (<i class=" ">CMS.ContactManagement</i> namespace).</p>
</li><li class=" "><p>Use the <i class=" ">CMS.Newsletters</i> API to get a <i class=" ">NewsletterInfo</i> object representing the newsletter for which you are implementing subscription.</p>
</li><li class=" "><p>Call the <strong class=" ">Subscribe</strong> method of the <a href="#src-68880505_handlingnewslettersubscriptionsonmvcsites-initializingthesubscriptionservice">subscription service</a> with the prepared <i class=" ">ContactInfo</i> and <i class=" ">NewsletterInfo</i> objects as parameters.</p>
    <div class="confbox admonition admonition-info">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p><strong class=" ">Notes</strong>:</p>
<ul class=" "><li class=" "><p>The <strong class=" ">ContactProvider.GetContactForSubscribing</strong> method automatically creates the contact object in Kentico based on the specified email address (if necessary).</p>
</li><li class=" "><p>The <strong class=" ">Subscribe</strong> method adds the contact as a recipient of the newsletter. Returns a <i class=" ">true</i> value for new recipients, <i class=" ">false</i> if a contact with the given email address is already a recipient of the newsletter.</p>
</li></ul>        </div>
    </div>
<p><img class="wysiwyg-unknown-macro" src="images/plugins/servlet/confluence/placeholder/unknown-macro.png" alt="images/plugins/servlet/confluence/placeholder/unknown-macro.png">
<img class="wysiwyg-unknown-macro" src="images/plugins/servlet/confluence/placeholder/unknown-macro.png" alt="images/plugins/servlet/confluence/placeholder/unknown-macro.png">
</p>
</li></ol></li><li class=" "><p>We recommend creating a view model for your subscription action <i class=" ">(NewsletterSubscribeViewModel</i> in the example above). The view model allows you to:</p>
<ul class=" "><li class=" "><p>Pass parameters from the subscription form (email address and, optionally, the recipient's name).</p>
</li><li class=" "><p>Use data annotations to define validation and formatting rules for the subscription data. See <a class="external-link" href="https://msdn.microsoft.com/en-us/library/system.componentmodel.dataannotations%28v=vs.110%29.aspx">System.ComponentModel.DataAnnotations</a> on MSDN for more information about the available data annotation attributes.</p>
</li><li class=" "><p>Pass information back to the subscription form, for example, a flag indicating that the newsletter requires a double opt-in subscription.<img class="wysiwyg-unknown-macro" src="images/plugins/servlet/confluence/placeholder/unknown-macro.png" alt="images/plugins/servlet/confluence/placeholder/unknown-macro.png">
</p>
</li></ul></li><li class=" "><p>Design the user interface required for newsletter subscription on your website:</p>
<ul class=" "><li class=" "><p>Create a view for the <i class=" ">Subscribe</i> action and display an appropriate subscription form. We recommend using a strongly typed view based on your subscription view model.</p>
</li><li class=" "><p>Create any other views required by the <i class=" ">Subscribe</i> action, for example, to inform users about successful subscriptions.</p>
</li></ul></li></ol><p>Your website's visitors can now subscribe to newsletters. The system automatically performs all standard Kentico subscription features, such as sending of confirmation emails based on the newsletter's <i class=" ">Subscription confirmation</i> template.</p>
<p>Continue by setting up:</p>
<ul class=" "><li class=" "><p><a href="#src-68880505_handlingnewslettersubscriptionsonmvcsites-settingupunsubscription">Handling of unsubscription requests</a></p>
</li><li class=" "><p><a href="#src-68880505_handlingnewslettersubscriptionsonmvcsites-handlingconfirmationsfordoubleopt-insubscription">Processing of subscription confirmations</a> (if your newsletters use double opt-in)</p>
</li></ul>    <h3 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Setting up unsubscription</span></h3>
<p>Users can unsubscribe from email campaigns or newsletters by clicking links placed into the content of your emails.</p>
<p>When setting up unsubscription functionality, you first need to ensure that the Kentico application generates correct unsubscription links:</p>
<ol class=" "><li class=" "><p>Make sure that your site in Kentico is configured to use <a href="extensionless-and-custom-urls">extensionless URLs</a> by default â€“ set <strong class=" ">Settings -&gt; URLs and SEO -&gt; Friendly URLs extension</strong> to an empty value.</p>
</li><li class=" "><p>Add unsubscription links into the content of your marketing emails or email templates (in the <strong class=" ">Email marketing</strong> application).</p>
    <div class="confbox admonition admonition-info">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p>Use the <i class=" ">{% EmailFeed.UnsubscribeFromEmailFeedUrl %}</i> and <i class=" ">{% EmailFeed.UnsubscribeFromAllEmailFeedsUrl %}</i> macros to generate the URLs of the links.</p>
<p>See <a href="preparing-email-templates">Preparing email templates</a> to learn more.</p>
        </div>
    </div>
</li><li class=" "><p>In the <strong class=" ">Email marketing</strong> application, edit your email feeds, open their <strong class=" ">Configuration</strong> tab and set the following properties:<br></p>
<ul class=" "><li class=" "><p><strong class=" ">Base URL</strong> â€“ must match the <i class=" ">Presentation URL</i> of your MVC site. For example: <i class=" ">http://www.SiteDomain.com</i></p>
</li><li class=" "><p><strong class=" ">Unsubscription page URL</strong> â€“ must match the route of the action that handles unsubscription requests in your MVC application. For example: <i class=" ">/NewsletterSubscription/Unsubscribe</i></p>
    <div class="confbox admonition admonition-tip">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p>To use a shared <i class=" ">Unsubscription page URL</i> for multiple email feeds, leave the property empty for individual email feeds and set the value in the <strong class=" ">Settings -&gt; On-line marketing -&gt; Email marketing -&gt; Unsubscription page URL</strong> setting.</p>
        </div>
    </div>
</li></ul></li></ol><p>Continue by implementing a controller action within your MVC application for handling of unsubscription requests:</p>
<ol class=" "><li class=" "><p>Create a new model class in your MVC project. The model will represent the parameters that Kentico generates in newsletter and email campaign unsubscription links.<img class="wysiwyg-unknown-macro" src="images/plugins/servlet/confluence/placeholder/unknown-macro.png" alt="images/plugins/servlet/confluence/placeholder/unknown-macro.png">
</p>
</li><li class=" "><p>Add a GET action to your newsletter subscription controller and perform the following steps:<br></p>
<ol class=" "><li class=" "><p>Use the unsubscription model to pass parameters from the unsubscription request.</p>
</li><li class=" "><p>Verify that the unsubscription hash is valid for the given email address â€“ call the <strong class=" ">ValidateEmail</strong> method of the <a href="#src-68880505_handlingnewslettersubscriptionsonmvcsites-initializingthesubscriptionservice">subscription service</a>, with the email address and hash from the unsubscription request as parameters.</p>
</li><li class=" "><p>To remove subscriptions, call the <strong class=" ">Unsubscribe</strong> or <strong class=" ">UnsubscribeFromAll</strong> method of the subscription service (with parameters taken from the unsubscription request). Branch the logic based on the <i class=" ">UnsubscribeFromAll</i> parameter from the unsubscription request.</p>
</li></ol>    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="keyword">using</code><code class="plain"> System.Web.Mvc;</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="keyword">using</code><code class="plain"> Kentico.Newsletters;</code></div>
</div>
    </div>
<p><img class="wysiwyg-unknown-macro" src="images/plugins/servlet/confluence/placeholder/unknown-macro.png" alt="images/plugins/servlet/confluence/placeholder/unknown-macro.png">
    </p>
</li><li class=" "><p>Create views for informing recipients about the result of their unsubscription requests.</p>
</li></ol><p>When a user clicks on an unsubscription link in a newsletter, the URL leads to the unsubscribe action on your MVC site. The action validates the parameters and either unsubscribes the recipient or displays information if the request is invalid.</p>
<p>The content of the unsubscription page depends on your implementation of the returned views.</p>
    <h3 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Handling confirmations for double opt-in subscription</span></h3>
<p>If your newsletters are configured to use <a href="enabling-double-opt-in-for-newsletters">double opt-in</a>, you need to set up additional logic on your MVC site to allow users to confirm their newsletter subscriptions.</p>
<p>When a visitor subscribes to a newsletter with double opt-in enabled, the system automatically adds the recipient with the "Waiting for confirmation" subscription status and the Kentico application sends a confirmation email to the given email address. You need to ensure that the double opt-in email contains a correct confirmation link:</p>
<ol class=" "><li class=" "><p>Make sure that your site in Kentico is configured to use <a href="extensionless-and-custom-urls">extensionless URLs</a> by default â€“ set <strong class=" ">Settings -&gt; URLs and SEO -&gt; Friendly URLs extension</strong> to an empty value.</p>
</li><li class=" "><p>Add the confirmation link into the content of the <strong class=" ">Double opt-in template</strong> assigned to your newsletter (in the <strong class=" ">Email marketing</strong> application).</p>
    <div class="confbox admonition admonition-info">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p>Use the <i class=" ">{% EmailFeed.SubscriptionConfirmationUrl %}</i> macro to generate the URL of the subscription confirmation link. See <a href="preparing-email-templates">Preparing email templates</a> to learn more.</p>
        </div>
    </div>
</li><li class=" "><p>In the <strong class=" ">Email marketing</strong> application, edit your newsletters, open their <strong class=" ">Configuration</strong> tab and set the following properties:</p>
<ul class=" "><li class=" "><p><strong class=" ">Base URL</strong> â€“ must match the <i class=" ">Presentation URL</i> of your MVC site. For example: <i class=" ">http://www.SiteDomain.com</i></p>
</li><li class=" "><p><strong class=" ">Approval page URL</strong> â€“ must match the route of the action that handles subscription confirmation requests in your MVC application. For example: <i class=" ">/NewsletterSubscription/ConfirmSubscription</i><i class=" "></i><i class=" "></i></p>
</li></ul>    <div class="confbox admonition admonition-tip">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p>To use a shared <i class=" ">Approval page URL</i> for multiple newsletters, leave the property empty for individual newsletters and set the value in the <strong class=" ">Settings -&gt; On-line marketing -&gt; Email marketing -&gt; Double opt-in approval page URL</strong> setting.</p>
        </div>
    </div>
</li></ol><p>Continue by implementing a controller action within your MVC application to handle the subscription confirmation requests:</p>
<ol class=" "><li class=" "><p>Create a new model class in your MVC project. The model will represent the parameters that Kentico generates in subscription confirmation links.<img class="wysiwyg-unknown-macro" src="images/plugins/servlet/confluence/placeholder/unknown-macro.png" alt="images/plugins/servlet/confluence/placeholder/unknown-macro.png">
</p>
</li><li class=" "><p>Add a GET action to your newsletter subscription controller and perform the following steps:<br></p>
<ol class=" "><li class=" "><p>Use the subscription confirmation model to pass parameters from the confirmation request.</p>
</li><li class=" "><p>Parse the date and time parameter from the confirmation request. The value uses a specific date and time format required by the Kentico API (see the code example below for details).</p>
</li><li class=" "><p>To confirm subscriptions, call the <strong class=" ">ConfirmSubscription</strong> method of the <a href="#src-68880505_handlingnewslettersubscriptionsonmvcsites-initializingthesubscriptionservice">subscription service</a> (with parameters taken from the hash and DateTime value in the confirmation request).</p>
</li><li class=" "><p>Handle the result of the subscription confirmation based on the <strong class=" ">ApprovalResult</strong> value returned by the <i class=" ">ConfirmSubscription</i> method (see the code example below for information about the possible values).</p>
</li></ol><p><img class="wysiwyg-unknown-macro" src="images/plugins/servlet/confluence/placeholder/unknown-macro.png" alt="images/plugins/servlet/confluence/placeholder/unknown-macro.png">
<img class="wysiwyg-unknown-macro" src="images/plugins/servlet/confluence/placeholder/unknown-macro.png" alt="images/plugins/servlet/confluence/placeholder/unknown-macro.png">
</p>
</li><li class=" "><p>Create a view for informing users about the result of their subscription confirmation requests.</p>
</li></ol><p>When a new recipient clicks the link in the confirmation email received after subscribing to a newsletter with double opt-in enabled, the confirmation action on your MVC site attempts to confirm the subscription. If the link is valid (based on the expiration interval configured in the Kentico application in <i class=" ">Settings -&gt; Onâ€‘line marketing -&gt; Email marketing -&gt; Double opt-in interval</i>), the system updates the recipient to the "Subscribed" status and the newsletter subscription becomes active.</p>
<p>The content of the subscription approval page depends on your implementation of the returned views.</p>
    <h3 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Enabling resource sharing</span></h3>
<p>When running a "content only" site (i.e. a site created using the <i class=" ">MVC Blank Site</i> template), the <strong class=" ">Email marketing</strong> application in the Kentico administration interface automatically checks the accessibility of the URLs specified for each email feed. This includes the following:</p>
<ul class=" "><li class=" "><p>Unsubscription page URL (see <a href="#src-68880505_handlingnewslettersubscriptionsonmvcsites-settingupunsubscription">Setting up unsubscription</a>)</p>
</li><li class=" "><p>Approval page URL (see <a href="#src-68880505_handlingnewslettersubscriptionsonmvcsites-handlingconfirmationsfordoubleopt-insubscription">Handling confirmations for double opt-in subscription</a>)</p>
</li><li class=" "><p>Clicked link and Opened email tracking URLs (see <a href="tracking-marketing-emails-on-mvc-sites">Tracking marketing emails on MVC sites</a>)</p>
</li></ul><p>If any of the given URLs are not accessible, the system displays a warning on the <strong class=" ">Emails</strong> tab of the email feed and the <strong class=" ">Send</strong> tab of individual emails.</p>
<p>To allow the system to verify the URLs correctly in scenarios where your MVC site and Kentico administration application run on different domains, you need to enable <a class="external-link" href="https://en.wikipedia.org/wiki/Cross-origin_resource_sharing">cross-origin resource sharing</a>. Do this by enabling the resource sharing feature for your MVC application:</p>
<ol class=" "><li class=" "><p>Edit the project's <strong class=" ">App_Start\ApplicationConfig.cs</strong> file.</p>
</li><li class=" "><p>Call the <strong class=" ">UseResourceSharingWithAdministration()</strong> method of the <i class=" ">ApplicationBuilder</i> instance in the <strong class=" ">RegisterFeatures</strong> method.</p>
</li></ol>    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="keyword">using</code><code class="plain"> Kentico.Web.Mvc;</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">...</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="keyword">public</code><code class="plain"> </code><code class="keyword">static</code><code class="plain"> </code><code class="keyword">void</code><code class="plain"> RegisterFeatures(ApplicationBuilder builder)</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    ...</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// Enables cross-origin resource sharing with the connected Kentico administration application</code></div>
<div class="line"><code class="plain">    builder.UseResourceSharingWithAdministration();</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p>When processing requests sent from the domain of the connected Kentico administration application, your MVC application now sends a response with the <i class=" ">Access-Control-Allow-Origin</i> header, which enables cross origin resource sharing.</p>
        </div>

    </article>


               
            
    <footer id="ht-footer">
    <a href="#" id="ht-jump-top" class="sp-aui-icon-small sp-aui-iconfont-arrows-up"></a>
</footer></div>

<div>
    <div id="ht-mq-detect"></div>
</div>

    <script src="js/lunr.js"></script>
    <script src="js/lunr-extras.js"></script>
    <script src="assets/js/scroll-search.js"></script>

    <script src="assets/js/expand-macro.js"></script>


</body></html>