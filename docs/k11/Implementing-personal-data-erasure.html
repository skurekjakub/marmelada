<!DOCTYPE html><html><head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Implementing personal data erasure - Kentico 11 Documentation</title>

    
    <link rel="stylesheet" href="assets/css/expand-macro.css">

            <meta name="scroll-content-language-key" content="">
    
    <meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=2.0, user-scalable=yes">

<script type="text/javascript" src="assets/js/jquery.min.js"></script>
<script type="text/javascript" src="assets/js/jquery.scrollTo.min.js"></script>


<script type="text/javascript" src="assets/js/translate.js"></script>

<script type="text/javascript" src="assets/js/theme.main.js"></script>

    <script type="text/javascript" src="assets/js/iframeResizer.min.js"></script>

<link rel="stylesheet" href="assets/css/content-style.css">
    <link rel="stylesheet" href="assets/css/search.css">

<link rel="stylesheet" href="assets/css/theme.main.css">
<link rel="stylesheet" href="assets/css/theme.colors.css">

            <!-- ES5 support for older browsers, needed by lunr -->
        <script src="js/augment.js"></script> 
        <script id="worker" type="javascript/worker">

        startIndex = function() {
            idx = lunr.Index.load(lunrIndex);
            idx.pipeline.remove(lunr.stopWordFilter);
            postMessage({type: "setup-complete"});
        }

        onmessage = function (event) {
            var message = event.data;

            if ((message.type === 'setup') && message.baseUrl) {
                var url = message.baseUrl;
                importScripts(url + 'js/lunr.js');
                importScripts(url + 'js/lunr-extras.js');
                importScripts(url + 'js/lunr-index.js');
                importScripts(url + 'js/lunr-data.js');
                startIndex();
            }

            if (idx && (message.type === 'search-request') && message.query) {
                var searchWord = message.query;
                var results = idx.search(searchWord).map(function (result) {
                    return lunrData.filter(function (d) {
                        return d.id === parseInt(result.ref, 10)
                    })[0]
                });
                postMessage({type: 'search-results', results: results, query: searchWord, queryId: message.queryId});
            }
        }

    </script>
    </head>

<body pageid="68879260">

<div id="ht-loader">
    <noscript>
        <p style="width: 100%; text-align:center; position: absolute; margin-top: 200px;">This content cannot be displayed without JavaScript.<br>Please enable JavaScript and reload the page.</p>
    </noscript>
</div>

<div>
   	<header id="ht-headerbar">
    <div class="ht-headerbar-left">
        <a href="" id="ht-menu-toggle" class="sp-aui-icon-small sp-aui-iconfont-appswitcher"></a>
    </div>
    <div class="ht-headerbar-right">
            <div class="sp-aui-icon-small ht-search-index-loader ht-header-icon"></div>

        <div id="ht-search">
            <div class="ht-search-input" style="display: none;">
              	<a href="#" class="sp-aui-icon-small sp-aui-iconfont-remove ht-search-clear"></a>

                <form action="#" method="GET" id="search">
                    <input class="search-input" type="text" placeholder="Search" tabindex="-1" autocomplete="off" name="q" value="">
                    <input type="hidden" name="max" value="15">
                    <input type="submit" style="display:none" tabindex="-4">
                </form>

                <a href="#" id="ht-search-button" class="ht-header-icon ht-header-icon-svg">
                                        <svg width="40px" height="40px" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                        <g>
                            <path d="M29.572,28.802 L28.801,29.571 C28.515,29.857 28.187,30 27.816,30 C27.445,30 27.116,29.857 26.831,29.571 L21.392,24.134 C20.193,24.762 18.908,25.076 17.538,25.076 C15.396,25.076 13.605,24.348 12.163,22.892 C10.721,21.436 10,19.651 10,17.538 C10,15.397 10.721,13.605 12.163,12.163 C13.605,10.721 15.396,10 17.538,10 C19.651,10 21.434,10.721 22.89,12.163 C24.347,13.605 25.075,15.397 25.075,17.538 C25.075,18.937 24.761,20.222 24.132,21.393 L29.572,26.832 C29.857,27.118 30,27.446 30,27.817 C30,28.188 29.857,28.517 29.572,28.802 L29.572,28.802 Z M13.662,21.414 C14.732,22.485 16.024,23.02 17.538,23.02 C19.051,23.02 20.343,22.485 21.413,21.414 C22.484,20.344 23.019,19.052 23.019,17.538 C23.019,16.025 22.484,14.733 21.413,13.662 C20.343,12.592 19.051,12.056 17.538,12.056 C16.024,12.056 14.732,12.592 13.662,13.662 C12.591,14.733 12.056,16.025 12.056,17.538 C12.056,19.052 12.591,20.344 13.662,21.414 L13.662,21.414 Z"></path>
                        </g>
                    </svg>
              	</a>

                <div class="ht-search-dropdown ht-dropdown">
                    <ul></ul>
                </div>
            </div>
        </div>
    </div>
    </header>   	<aside id="ht-sidebar">
    <div class="ht-sidebar-content">
        <div class="ht-sidebar-content-scroll-container">
            <header class="ht-sidebar-header">
                <h1 class="ht-logo">
                    <span class="ht-logo-label">K11</span>
                    <img class="space-logo" src="global.logo">
                </h1>
                <a href="Kentico-11-Documentation-Home.html" class="ht-space-link">
                    <h2>Kentico 11 Documentation</h2>
                </a>
            </header>
                            <iframe id="ht-nav" src="toc.html?pageId=76846057"></iframe>
                <script>
                    $('iframe#ht-nav').iFrameResize(
                            { 'log': true, 'autoResize': true, 'heightCalculationMethod': 'lowestElement', 'checkOrigin': false });
                </script>
                    </div>
    </div>

</aside></div>

<div id="ht-wrap-container">

            
    <div id="ht-sidebar-dragbar">
    <div class="ht-sidebar-drag-handle">
        <span class="drag-handle-1"></span>
        <span class="drag-handle-2"></span>
        <span class="drag-handle-3"></span>
    </div>
</div>
    <article id="ht-content" class="ht-content">
        <header class="ht-content-header">
            <div id="ht-breadcrumb">
    <ul>
        <li><a href="Kentico-11-Documentation-Home.html">Kentico 11 Documentation</a></li>
                                                                                                             <li><a href="" onclick="$('.shortcut').each(function(){$(this).removeClass('shortcut')}); $(this).parent().addClass('shortcut'); return false;">...</a> </li>
                                        <li class="shortcut"><a href="Configuring-Kentico.html">Configuring Kentico</a></li>
                                                                                     <li><a href="GDPR-compliance.html">GDPR compliance</a></li>
                                                            </ul>
</div>            <h1 id="src-76846057"> <span>Implementing personal data erasure</span></h1>
        </header>

        <div id="main-content" class="wiki-content sp-grid-section" data-index-for-search="true">
<div class="section-left"><p>To comply with the requirements of personal data regulations, such as the <a href="gdpr-compliance">GDPR</a>, you need to provide a way for administrators (data protection officers) to erase personal data stored within the system. This is necessary to fulfill the "right to be forgotten" of your website's visitors and users, i.e. when resolving requests to delete personal data for specific data subjects.</p><p>By default, Kentico does not provide any functionality for erasing personal data. You need to implement the data erasure based on exact knowledge of your specific website, including the following factors:</p><ul class=" "><li class=" "><p>How the website gathers, processes and stores personal data</p>
</li><li class=" "><p>The nature of the legal requirements that you wish to fulfill</p>
</li><li class=" "><p>Other legal considerations that allow or require the website's owner to hold personal data (for example e-commerce records for accounting purposes, etc.)</p>
</li></ul><p>Depending on these requirements, your personal data erasure functionality may need to completely delete objects, clear values of individual object fields (columns), or perform anonymization of certain types of data while retaining others.</p><div class="confbox admonition admonition-info">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p>See the <a href="personal-data-in-kentico">Personal data in Kentico</a> reference to learn how the system gathers, stores and uses personal data by default. The information may be helpful when planning the data erasure functionality for your website.</p>
        </div>
    </div></div>


    
    <div class="section-right"><div class="confbox panel">
            <div class="title panel-header">On this page</div>
            <div class="panel-content">
<p></p>
<ul class="toc-indentation "><li class=" "><p><a href="#src-76846057_implementingpersonaldataerasure-creatingdataerasers">Creating data erasers</a></p>
</li><li class=" "><p><a href="#src-76846057_implementingpersonaldataerasure-definingtheeraserconfiguration">Defining the eraser configuration</a></p>
</li><li class=" "><p><a href="#src-76846057_safe-id-sw1wbgvtzw50aw5ncgvyc29uywxkyxrhzxjhc3vyzs1fegftcgxl4octq3jlyxrpbmdhy29udgfjdgrhdgflcmfzzxi">Example – Creating a contact data eraser</a></p>
</li></ul><p></p>
        </div>
    </div><div class="confbox panel">
            <div class="title panel-header">Related pages</div>
            <div class="panel-content">
<ul class=" "><li class=" "><p><a href="gdpr-compliance">GDPR compliance</a></p>
</li><li class=" "><p><a href="personal-data-in-kentico">Personal data in Kentico</a></p>
</li><li class=" "><p><a href="implementing-personal-data-collection">Implementing personal data collection</a></p>
</li></ul>        </div>
    </div></div>
    
<p></p>
    <div class="confbox admonition admonition-info">
                    <p class="title">Kentico EMS required</p>
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p>Features described on this page require the <strong class=" ">Kentico EMS</strong> license.</p>
        </div>
    </div>
<p></p>
<p>Use the following process to develop the personal data erasure:</p>
    <div class="confbox admonition admonition-note">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p><strong class=" ">Prerequisite</strong>: Before you start implementing personal data erasure, you need to prepare functionality that identifies and collects the given data. For detailed information, see <a href="implementing-personal-data-collection">Implementing personal data collection</a>.</p>
        </div>
    </div>
<ol class=" "><li class=" "><p>Open your Kentico solution in Visual Studio.</p>
</li><li class=" "><p>Create custom classes that perform the required delete actions – <i class=" ">Data erasers</i>. See the <a href="#src-76846057_implementingpersonaldataerasure-creatingdataerasers">Creating data erasers</a> section for details.</p>
    <div class="confbox admonition admonition-tip">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p><strong class=" ">Class location</strong><br></p>
<p>We recommend adding custom classes as part of a new assembly (<i class=" ">Class library</i> project) in your Kentico solution. You need to add the appropriate references to both the assembly and the main Kentico web project.<br></p>
        </div>
    </div>
</li><li class=" "><p>Create a custom control in the Kentico web project to define the options that users can configure when deleting personal data. See <a href="#src-76846057_implementingpersonaldataerasure-definingtheeraserconfiguration">Defining the eraser configuration</a>.</p>
</li><li class=" "><p>Add a <a href="initializing-modules-to-run-custom-code">custom module class</a> or edit an existing one. Register your data eraser implementations and eraser configuration control within the module's <strong class=" ">OnInit</strong> method:</p>
<ul class=" "><li class=" "><p>You can register any number of data erasers and a single configuration control.</p>
</li><li class=" "><p>To register data erasers, call the <strong class=" ">PersonalDataEraserRegister.Instance.Add</strong> method (available in the <strong class=" ">CMS.DataProtection</strong> namespace). The system runs the delete actions defined within individual erasers according to the registration order (starting from the first data eraser to the last).</p>
</li><li class=" "><p>To register your eraser configuration control, call the <strong class=" ">DataProtectionControlsRegister.Instance.RegisterErasureConfigurationControl</strong> method (available in the <strong class=" ">CMS.UIControls</strong> namespace). Specify the path of the user control file in the method's parameter.</p>
</li></ul></li></ol><p>Users can now delete personal data on the <strong class=" ">Right to be forgotten</strong> tab of the <strong class=" ">Data protection</strong> application. The registered configuration control defines the content of the dialog where users choose which types of data are erased, and the data eraser implementations then perform the corresponding delete actions.</p>
    <h3 id="src-76846057_Implementingpersonaldataerasure-Creatingdataerasers" class="heading "><span>Creating data erasers</span></h3>
<p>When deleting personal data in the <strong class=" ">Data protection</strong> application, users first submit real-world identifiers to find the appropriate data within the system. The registered <i class=" ">Identity collectors</i> (see <a href="implementing-personal-data-collection">Implementing personal data collection</a>) convert these identifiers into Kentico objects, and <i class=" ">Data collectors</i> return the related personal data. To allow users to delete the collected data, you need to create <i class=" ">Data erasers</i>.</p>
<p>Data erasers are classes that implement the <strong class=" ">IPersonalDataEraser</strong> interface (available in the <strong class=" ">CMS.DataProtection</strong> namespace). Every implementation must contain the<strong class=" "> Erase</strong> method, which processes the following parameters:</p>
<ul class=" "><li class=" "><p><strong class=" ">IEnumerable&lt;BaseInfo&gt;</strong> – provides the identity objects that were added by your <i class=" ">IIdentityCollector</i> implementations. You can convert the <i class=" ">BaseInfo</i> objects to specific types, such as <i class=" ">UserInfo, ContactInfo,</i> etc.</p>
</li><li class=" "><p><strong class=" ">IDictionary&lt;string, object&gt;</strong> – a dictionary containing keys and values that were submitted in the eraser configuration dialog (see <a href="#src-76846057_implementingpersonaldataerasure-definingtheeraserconfiguration">Defining the eraser configuration</a>).</p>
</li></ul><p>The content of the <i class=" ">Erase</i> method depends on your requirements. Based on the method's parameters, you can completely delete objects, assign empty values to individual object fields (columns), or perform more complex anonymization of data.</p>
<p>When erasing personal data, make sure you delete objects including their <a href="working-with-object-versioning">version history</a> and without creating <a href="objects-recycle-bin">recycle bin</a> records. You can achieve this by using the standard <a href="database-table-api">Provider API</a> to delete objects and wrapping the code into a <strong class=" ">CMSActionContext</strong> block with the <strong class=" ">CreateVersion</strong> property set to <i class=" ">false</i>:</p>
    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="keyword">using</code><code class="plain"> (</code><code class="keyword">new</code><code class="plain"> CMS.Base.CMSActionContext() { CreateVersion = </code><code class="keyword">false</code><code class="plain"> })</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">	...</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p>Also consider the parent-child relationships and other dependencies between objects. When you delete an object, all child objects and other objects that have a required dependency on the given object are also deleted. This may have an affect on the order in which you need to delete different types of objects within the <i class=" ">Erase</i> method, or even on the registration order of your <i class=" ">IPersonalDataEraser</i> implementations.</p>
    <div class="confbox admonition admonition-info">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p>See the <a href="#src-76846057_safe-id-sw1wbgvtzw50aw5ncgvyc29uywxkyxrhzxjhc3vyzs1fegftcgxl4octq3jlyxrpbmdhy29udgfjdgrhdgflcmfzzxi">Example - Creating a contact data eraser</a> section to view a code example.</p>
        </div>
    </div>
    <h3 id="src-76846057_Implementingpersonaldataerasure-Definingtheeraserconfiguration" class="heading "><span>Defining the eraser configuration</span></h3>
<p>The <strong class=" ">Data protection</strong> application provides an interface where users can choose which types of personal data they want to erase or set other configuration options. You need to create a custom control that provides the content of this interface based on the functionality of your <a href="#src-76846057_implementingpersonaldataerasure-creatingdataerasers">Data erasers</a>:</p>
<ol class=" "><li class=" "><p>Create a Web User Control (.ascx file) in the Kentico web project (<i class=" ">CMSApp</i> or <i class=" ">CMS</i>).</p>
</li><li class=" "><p>Add components to the control's markup that allow users to set the required configuration options.</p>
</li><li class=" "><p>Switch to the code behind and make the control class inherit from <strong class=" ">ErasureConfigurationControl</strong> (available in the <strong class=" ">CMS.UIControls</strong> namespace).<strong class=" "><br></strong></p>
</li><li class=" "><p>Override the following methods:</p>
<ul class=" "><li class=" "><p><strong class=" ">GetConfiguration</strong> – return an <i class=" ">IDictionary&lt;string, object&gt;</i> collection containing all configuration values that users input through the control.</p>
</li><li class=" "><p><strong class=" ">IsValid</strong> – return a <i class=" ">bool</i> value that indicates whether the control's input is valid. Call the <i class=" ">AddError</i> method to display messages to users in cases where the input is not valid.</p>
</li></ul></li></ol><p>Once your custom control is registered, the system uses it when displaying the <strong class=" ">Select data to delete</strong> dialog in the <strong class=" ">Data protection</strong> application. The keys and values added via the control's <strong class=" ">GetConfiguration</strong> method are available as the second parameter of the <strong class=" ">Erase</strong> method in your <strong class=" ">IPersonalDataEraser</strong> implementations.</p>
    <div class="confbox admonition admonition-info">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p>See the <a href="#src-76846057_safe-id-sw1wbgvtzw50aw5ncgvyc29uywxkyxrhzxjhc3vyzs1fegftcgxl4octq3jlyxrpbmdhy29udgfjdgrhdgflcmfzzxi">Example - Creating a contact data eraser</a> section to view a code example.</p>
        </div>
    </div>
    <h3 id="src-76846057_safe-id-SW1wbGVtZW50aW5ncGVyc29uYWxkYXRhZXJhc3VyZS1FeGFtcGxl4oCTQ3JlYXRpbmdhY29udGFjdGRhdGFlcmFzZXI" class="heading "><span>Example – Creating a contact data eraser</span></h3>
<p>The following example demonstrates how to implement a personal data eraser for <a href="working-with-contacts">contacts</a> and their logged <a href="tracking-contact-activities">activities</a>. The sample eraser extends the example from the <a href="implementing-personal-data-collection">Implementing personal data collection</a> page – the collectors find contact data based on an email address identifier, and the eraser allows users to delete the given contacts and/or their activities (on the <strong class=" ">Right to be forgotten</strong> tab of the <strong class=" ">Data protection</strong> application).</p>
    <div class="confbox admonition admonition-info">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p>This example only shows the basic implementation concepts and deletes a very limited set of personal data. You can find a more extensive code example in your Kentico program files directory (by default <i class=" ">C:\Program Files\Kentico\&lt;version&gt;</i>) under the <strong class=" ">CodeSamples\CustomizationSamples\DataProtection</strong> subfolder.</p>
<p>Keep in mind that you always need to adjust your own implementation based on the personal data processing used on your website and the legal requirements that you wish to fulfill.</p>
        </div>
    </div>
<p></p>
<ul class="toc-indentation "><li class=" "><p><a href="#src-76846057_implementingpersonaldataerasure-settingupaclasslibraryanddatacollectors">Setting up a class library and data collectors</a></p>
</li><li class=" "><p><a href="#src-76846057_implementingpersonaldataerasure-creatingthedataeraser">Creating the data eraser</a></p>
</li><li class=" "><p><a href="#src-76846057_implementingpersonaldataerasure-creatingtheeraserconfigurationcontrol">Creating the eraser configuration control</a></p>
</li><li class=" "><p><a href="#src-76846057_implementingpersonaldataerasure-registeringtheeraserandconfigurationcontrol">Registering the eraser and configuration control</a></p>
</li></ul><p></p>
    <h4 id="src-76846057_Implementingpersonaldataerasure-Settingupaclasslibraryanddatacollectors" class="heading "><span>Setting up a class library and data collectors</span></h4>
<p>Before you can start creating the eraser, you need to implement data collection functionality:</p>
<ol class=" "><li class=" "><p>Recreate or reuse the entire custom project described in <a href="implementing-personal-data-collection#src-76846055_safe-id-sw1wbgvtzw50aw5ncgvyc29uywxkyxrhy29sbgvjdglvbi1fegftcgxl4octq3jlyxrpbmdjb250ywn0zgf0ywnvbgxly3rvcnm">Example - Creating contact data collectors</a> (including the <i class=" ">IIdentityCollector</i> and <i class=" ">IPersonalDataCollector</i> implementations, and the custom module class used for registration).</p>
</li><li class=" "><p>Add additional references to required Kentico libraries (DLLs) for the project:<br></p>
<ol class=" "><li class=" "><p>Right-click the custom project and select <strong class=" ">Add -&gt; Reference</strong>.</p>
</li><li class=" "><p>Select the <strong class=" ">Browse</strong> tab of the <strong class=" ">Reference manager</strong> dialog, click <strong class=" ">Browse</strong> and navigate to the <i class=" "><strong class=" ">Lib</strong> </i>folder of your Kentico web project.</p>
</li><li class=" "><p>Add references to the following libraries (in addition to the libraries already referenced in the original example):</p>
<ul class=" "><li class=" "><p><strong class=" ">CMS.Activities.dll</strong></p>
</li><li class=" "><p><strong class=" ">CMS.UIControls.dll</strong></p>
</li></ul></li></ol></li></ol>    <h4 id="src-76846057_Implementingpersonaldataerasure-Creatingthedataeraser" class="heading "><span>Creating the data eraser</span></h4>
<p>Add a new class implementing the <strong class=" ">IPersonalDataEraser</strong> interface under the custom project:</p>
    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="keyword">using</code><code class="plain"> System.Collections.Generic;</code></div>
<div class="line"><code class="keyword">using</code><code class="plain"> System.Linq;</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="keyword">using</code><code class="plain"> CMS.Activities;</code></div>
<div class="line"><code class="keyword">using</code><code class="plain"> CMS.Base;</code></div>
<div class="line"><code class="keyword">using</code><code class="plain"> CMS.ContactManagement;</code></div>
<div class="line"><code class="keyword">using</code><code class="plain"> CMS.DataEngine;</code></div>
<div class="line"><code class="keyword">using</code><code class="plain"> CMS.DataProtection;</code></div>
<div class="line"><code class="keyword">using</code><code class="plain"> CMS.Helpers;</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="keyword">public</code><code class="plain"> </code><code class="keyword">class</code><code class="plain"> ContactDataEraser : IPersonalDataEraser</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">public</code><code class="plain"> </code><code class="keyword">void</code><code class="plain"> Erase(IEnumerable&lt;BaseInfo&gt; identities, IDictionary&lt;</code><code class="keyword">string</code><code class="plain">, </code><code class="keyword">object</code><code class="plain">&gt; configuration)</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        </code><code class="comments">// Gets all contact objects added by registered IIdentityCollector implementations</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">var</code><code class="plain"> contacts = identities.OfType&lt;ContactInfo&gt;();</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">        </code><code class="comments">// Does nothing if no contacts were collected</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">if</code><code class="plain"> (!contacts.Any())</code></div>
<div class="line"><code class="plain">        {</code></div>
<div class="line"><code class="plain">            </code><code class="keyword">return</code><code class="plain">;</code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">        </code><code class="comments">// Gets a list of identifiers for the contacts</code></div>
<div class="line"><code class="plain">        List&lt;</code><code class="keyword">int</code><code class="plain">&gt; contactIds = contacts.Select(c =&gt; c.ContactID).ToList();</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">        </code><code class="comments">// The context ensures that objects are permanently deleted with all versions, without creating recycle bin records</code></div>
<div class="line"><code class="plain">        </code><code class="comments">// Contact and activity objects do not support versioning,</code></div>
<div class="line"><code class="plain">		</code><code class="comments">// but we recommend using this action context in general when deleting personal data</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">using</code><code class="plain"> (</code><code class="keyword">new</code><code class="plain"> CMSActionContext() { CreateVersion = </code><code class="keyword">false</code><code class="plain"> })</code></div>
<div class="line"><code class="plain">        {</code></div>
<div class="line"><code class="plain">            </code><code class="comments">// Deletes the activities of the given contacts (if enabled in the configuration)</code></div>
<div class="line"><code class="plain">            DeleteActivities(contactIds, configuration);</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">            </code><code class="comments">// Deletes the given contacts (if enabled in the configuration)</code></div>
<div class="line"><code class="plain">            </code><code class="comments">// Also automatically deletes activities of the given contacts (contacts are parent objects of activities)</code></div>
<div class="line"><code class="plain">            DeleteContacts(contacts, configuration);</code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">    </code><code class="keyword">private</code><code class="plain"> </code><code class="keyword">void</code><code class="plain"> DeleteActivities(List&lt;</code><code class="keyword">int</code><code class="plain">&gt; contactIds, IDictionary&lt;</code><code class="keyword">string</code><code class="plain">, </code><code class="keyword">object</code><code class="plain">&gt; configuration)</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        </code><code class="comments">// Checks whether deletion of activities is enabled in the configuration options</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">object</code><code class="plain"> deleteActivities;</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">if</code><code class="plain"> (configuration.TryGetValue(</code><code class="string">"deleteActivities"</code><code class="plain">, </code><code class="keyword">out</code><code class="plain"> deleteActivities)</code></div>
<div class="line"><code class="plain">            &amp;&amp; ValidationHelper.GetBoolean(deleteActivities, </code><code class="keyword">false</code><code class="plain">))</code></div>
<div class="line"><code class="plain">        {            </code></div>
<div class="line"><code class="plain">            </code><code class="comments">// Deletes the activities of the specified contacts</code></div>
<div class="line"><code class="plain">            </code><code class="comments">// The system may contain a very large number of activity records, so the example uses the BulkDelete API</code></div>
<div class="line"><code class="plain">            </code><code class="comments">// This is more efficient, but does not perform general actions, such as logging of synchronization tasks</code></div>
<div class="line"><code class="plain">            ActivityInfoProvider.ProviderObject.BulkDelete(</code></div>
<div class="line"><code class="plain">                </code><code class="keyword">new</code><code class="plain"> WhereCondition().WhereIn(</code><code class="string">"ActivityContactID"</code><code class="plain">, contactIds));</code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">    </code><code class="keyword">private</code><code class="plain"> </code><code class="keyword">static</code><code class="plain"> </code><code class="keyword">void</code><code class="plain"> DeleteContacts(IEnumerable&lt;ContactInfo&gt; contacts, IDictionary&lt;</code><code class="keyword">string</code><code class="plain">, </code><code class="keyword">object</code><code class="plain">&gt; configuration)</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        </code><code class="comments">// Checks whether deletion of contacts is enabled in the configuration options</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">object</code><code class="plain"> deleteContacts;</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">if</code><code class="plain"> (configuration.TryGetValue(</code><code class="string">"deleteContacts"</code><code class="plain">, </code><code class="keyword">out</code><code class="plain"> deleteContacts)</code></div>
<div class="line"><code class="plain">            &amp;&amp; ValidationHelper.GetBoolean(deleteContacts, </code><code class="keyword">false</code><code class="plain">))</code></div>
<div class="line"><code class="plain">        {</code></div>
<div class="line"><code class="plain">            </code><code class="comments">// Deletes the specified contacts</code></div>
<div class="line"><code class="plain">            </code><code class="keyword">foreach</code><code class="plain"> (ContactInfo contact </code><code class="keyword">in</code><code class="plain"> contacts)</code></div>
<div class="line"><code class="plain">            {</code></div>
<div class="line"><code class="plain">                ContactInfoProvider.DeleteContactInfo(contact);</code></div>
<div class="line"><code class="plain">            }</code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p>The sample data eraser processes the contact objects provided by the registered identity collector (see <a href="implementing-personal-data-collection#src-76846055_safe-id-sw1wbgvtzw50aw5ncgvyc29uywxkyxrhy29sbgvjdglvbi1fegftcgxl4octq3jlyxrpbmdjb250ywn0zgf0ywnvbgxly3rvcnm">Example - Creating contact data collectors</a> for details). The eraser then deletes the contacts and/or their logged activities according to configuration options, which are supplied by users through a dialog generated by a custom control.</p>
    <h4 id="src-76846057_Implementingpersonaldataerasure-Creatingtheeraserconfigurationcontrol" class="heading "><span>Creating the eraser configuration control</span></h4>
<p>To allow users to configure which objects are deleted, you need to create a custom control:</p>
<ol class=" "><li class=" "><p>Create a <i class=" ">Web User Control</i> in the Kentico web project (<i class=" ">CMSApp</i> or <i class=" ">CMS</i>), for example named <i class=" ">ContactDataEraserConfiguration.ascx</i>.<br></p>
<ul class=" "><li class=" "><p>We recommend adding the control under a custom folder related to your data protection module, for example: <i class=" ">~/CMSModules/CustomDataProtection</i></p>
</li></ul></li><li class=" "><p>Add the following markup to the control:</p>
    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">&lt;</code><code class="keyword">div</code><code class="plain"> </code><code class="color1">class</code><code class="plain">=</code><code class="string">"cms-bootstrap"</code><code class="plain">&gt;</code></div>
<div class="line"><code class="plain">    &lt;</code><code class="keyword">div</code><code class="plain"> </code><code class="color1">class</code><code class="plain">=</code><code class="string">"form-horizontal"</code><code class="plain">&gt;</code></div>
<div class="line"><code class="plain">        &lt;</code><code class="keyword">cms</code><code class="plain">:LocalizedHeading </code><code class="color1">runat</code><code class="plain">=</code><code class="string">"server"</code><code class="plain"> </code><code class="color1">Level</code><code class="plain">=</code><code class="string">"4"</code><code class="plain"> </code><code class="color1">Text</code><code class="plain">=</code><code class="string">"Contact data"</code><code class="plain"> /&gt;</code></div>
<div class="line"><code class="plain">        &lt;</code><code class="keyword">cms</code><code class="plain">:CMSCheckBox </code><code class="color1">ID</code><code class="plain">=</code><code class="string">"chbDeleteContacts"</code><code class="plain"> </code><code class="color1">runat</code><code class="plain">=</code><code class="string">"server"</code><code class="plain"> </code><code class="color1">Text</code><code class="plain">=</code><code class="string">"Delete contacts"</code><code class="plain"> /&gt;</code></div>
<div class="line"><code class="plain">        &lt;</code><code class="keyword">cms</code><code class="plain">:CMSCheckBox </code><code class="color1">ID</code><code class="plain">=</code><code class="string">"chbDeleteActivities"</code><code class="plain"> </code><code class="color1">runat</code><code class="plain">=</code><code class="string">"server"</code><code class="plain"> </code><code class="color1">Text</code><code class="plain">=</code><code class="string">"Delete contact activities"</code><code class="plain"> /&gt;</code></div>
<div class="line"><code class="plain">    &lt;/</code><code class="keyword">div</code><code class="plain">&gt;        </code></div>
<div class="line"><code class="plain">&lt;/</code><code class="keyword">div</code><code class="plain">&gt;</code></div>
</div>
    </div>
</li><li class=" "><p>Switch to the control's code behind. Make the control class inherit from <strong class=" ">ErasureConfigurationControl</strong>, with the following code:</p>
    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="keyword">using</code><code class="plain"> System.Collections.Generic;</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="keyword">using</code><code class="plain"> CMS.UIControls;</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="keyword">public</code><code class="plain"> </code><code class="keyword">partial</code><code class="plain"> </code><code class="keyword">class</code><code class="plain"> CMSModules_CustomDataProtection_ContactDataEraserConfiguration : ErasureConfigurationControl</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// Fills the eraser configuration based on the user's input    </code></div>
<div class="line"><code class="plain">    </code><code class="keyword">public</code><code class="plain"> </code><code class="keyword">override</code><code class="plain"> IDictionary&lt;</code><code class="keyword">string</code><code class="plain">, </code><code class="keyword">object</code><code class="plain">&gt; GetConfiguration(IDictionary&lt;</code><code class="keyword">string</code><code class="plain">, </code><code class="keyword">object</code><code class="plain">&gt; configuration)</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">		</code><code class="comments">// The configuration keys must match the values checked in your IPersonalDataEraser implementations</code></div>
<div class="line"><code class="plain">		configuration.Add(</code><code class="string">"deleteContacts"</code><code class="plain">, chbDeleteContacts.Checked);</code></div>
<div class="line"><code class="plain">        configuration.Add(</code><code class="string">"deleteActivities"</code><code class="plain">, chbDeleteActivities.Checked);</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">        </code><code class="keyword">return</code><code class="plain"> configuration;</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    </code><code class="comments">// Validates the eraser configuration provider by the user</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">public</code><code class="plain"> </code><code class="keyword">override</code><code class="plain"> </code><code class="keyword">bool</code><code class="plain"> IsValid()</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        </code><code class="comments">// Validates that at least one deletion checkbox is selected</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">bool</code><code class="plain"> isValid = chbDeleteContacts.Checked || chbDeleteActivities.Checked;</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">        </code><code class="keyword">if</code><code class="plain"> (!isValid )</code></div>
<div class="line"><code class="plain">        {</code></div>
<div class="line"><code class="plain">            </code><code class="comments">// Adds an error message that the control displays when the validation fails</code></div>
<div class="line"><code class="plain">            AddError(</code><code class="string">"No data was selected for deletion."</code><code class="plain">);</code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">        </code><code class="keyword">return</code><code class="plain"> isValid;</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
</li><li class=" "><p>Save the control files (build the <i class=" ">CMSApp</i> project if you have a web application installation).</p>
</li></ol><p>The control provides an interface where users can select whether to delete contacts and activities.</p>
    <h4 id="src-76846057_Implementingpersonaldataerasure-Registeringtheeraserandconfigurationcontrol" class="heading "><span>Registering the eraser and configuration control</span></h4>
<p>To register the personal data eraser and its configuration control, edit the <a href="initializing-modules-to-run-custom-code">module class</a> under the custom project and expand the initialization code in the <strong class=" ">OnInit</strong> method:</p>
    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="keyword">using</code><code class="plain"> CMS;</code></div>
<div class="line"><code class="keyword">using</code><code class="plain"> CMS.DataEngine;</code></div>
<div class="line"><code class="keyword">using</code><code class="plain"> CMS.DataProtection;</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="keyword">using</code><code class="plain"> CMS.UIControls;</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="comments">// Registers the custom module into the system</code></div>
<div class="line"><code class="plain">[assembly: RegisterModule(</code><code class="keyword">typeof</code><code class="plain">(CustomDataProtectionModule))]</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="keyword">internal</code><code class="plain"> </code><code class="keyword">class</code><code class="plain"> CustomDataProtectionModule : Module</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// Module class constructor, the system registers the module under the name "CustomDataProtection"</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">public</code><code class="plain"> CustomDataProtectionModule()</code></div>
<div class="line"><code class="plain">        : </code><code class="keyword">base</code><code class="plain">(</code><code class="string">"CustomDataProtection"</code><code class="plain">)</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">    </code><code class="comments">// Contains initialization code that is executed when the application starts</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">protected</code><code class="plain"> </code><code class="keyword">override</code><code class="plain"> </code><code class="keyword">void</code><code class="plain"> OnInit()</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">base</code><code class="plain">.OnInit();</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">        </code><code class="comments">// Adds the ContactIdentityCollector to the collection of registered identity collectors</code></div>
<div class="line"><code class="plain">        IdentityCollectorRegister.Instance.Add(</code><code class="keyword">new</code><code class="plain"> ContactIdentityCollector());</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">        </code><code class="comments">// Adds the ContactDataCollector to the collection of registered personal data collectors</code></div>
<div class="line"><code class="plain">        PersonalDataCollectorRegister.Instance.Add(</code><code class="keyword">new</code><code class="plain"> ContactDataCollector());</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">        </code><code class="comments">// Adds the ContactDataEraser to the collection of registered personal data erasers</code></div>
<div class="line"><code class="plain">        PersonalDataEraserRegister.Instance.Add(</code><code class="keyword">new</code><code class="plain"> ContactDataEraser());</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">        </code><code class="comments">// Registers the custom eraser configuration control</code></div>
<div class="line"><code class="plain">        DataProtectionControlsRegister.Instance.RegisterErasureConfigurationControl(</code><code class="string">"~/CMSModules/CustomDataProtection/ContactDataEraserConfiguration.ascx"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p>Save all changes and <strong class=" ">Build</strong> the custom project.</p>
<p>You can now delete personal data for contacts and their activities in the <strong class=" ">Data protection</strong> application. On the application's <strong class=" ">Right to be forgotten</strong> tab, you can search for data based on an email addresses. If matching contacts exist in the system, the sample collectors display their data in plain text format, and you can click <strong class=" ">Select data to delete</strong> to open the eraser configuration dialog.</p>
<p><img class="confluence-embedded-image confluence-content-image-border" src="images/download/attachments/76846057/personal_data_erasing.png" alt="images/download/attachments/76846057/personal_data_erasing.png" width="500">
        <br><span class="caption">Using the sample eraser to delete contact personal data in the Data protection application</span>
    </p>
<p>Submitting the dialog sends the collected data and selected configuration options to the registered eraser implementation, which performs the corresponding delete actions.</p>
    <div class="confbox admonition admonition-info">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p><strong class=" ">Note</strong>: Contacts have a parent-child relationship with activities. If you delete a contact object, all of the activities logged for the given contact are also deleted automatically. However, the configuration dialog allows you to delete activities while retaining contacts.</p>
        </div>
    </div>
        </div>

    </article>


               
            
    <footer id="ht-footer">
    <a href="#" id="ht-jump-top" class="sp-aui-icon-small sp-aui-iconfont-arrows-up"></a>
</footer></div>

<div>
    <div id="ht-mq-detect"></div>
</div>

    <script src="js/lunr.js"></script>
    <script src="js/lunr-extras.js"></script>
    <script src="assets/js/scroll-search.js"></script>

    <script src="assets/js/expand-macro.js"></script>


</body></html>