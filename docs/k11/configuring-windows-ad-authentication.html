<!DOCTYPE html><html><head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Configuring Windows AD authentication - Kentico 11 Documentation</title>

    
    <link rel="stylesheet" href="assets/css/expand-macro.css">

            <meta name="scroll-content-language-key" content="">
    
    <meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=2.0, user-scalable=yes">

<script type="text/javascript" src="assets/js/jquery.min.js"></script>
<script type="text/javascript" src="assets/js/jquery.scrollTo.min.js"></script>


<script type="text/javascript" src="assets/js/translate.js"></script>

<script type="text/javascript" src="assets/js/theme.main.js"></script>

    <script type="text/javascript" src="assets/js/iframeResizer.min.js"></script>

<link rel="stylesheet" href="assets/css/content-style.css">
    <link rel="stylesheet" href="assets/css/search.css">

<link rel="stylesheet" href="assets/css/theme.main.css">
<link rel="stylesheet" href="assets/css/theme.colors.css">

            <!-- ES5 support for older browsers, needed by lunr -->
        <script src="js/augment.js"></script> 
        <script id="worker" type="javascript/worker">

        startIndex = function() {
            idx = lunr.Index.load(lunrIndex);
            idx.pipeline.remove(lunr.stopWordFilter);
            postMessage({type: "setup-complete"});
        }

        onmessage = function (event) {
            var message = event.data;

            if ((message.type === 'setup') && message.baseUrl) {
                var url = message.baseUrl;
                importScripts(url + 'js/lunr.js');
                importScripts(url + 'js/lunr-extras.js');
                importScripts(url + 'js/lunr-index.js');
                importScripts(url + 'js/lunr-data.js');
                startIndex();
            }

            if (idx && (message.type === 'search-request') && message.query) {
                var searchWord = message.query;
                var results = idx.search(searchWord).map(function (result) {
                    return lunrData.filter(function (d) {
                        return d.id === parseInt(result.ref, 10)
                    })[0]
                });
                postMessage({type: 'search-results', results: results, query: searchWord, queryId: message.queryId});
            }
        }

    </script>
    </head>

<body pageid="68879260" elementpageid="68880378">

<div id="ht-loader">
    <noscript>
        <p style="width: 100%; text-align:center; position: absolute; margin-top: 200px;">This content cannot be displayed without JavaScript.<br>Please enable JavaScript and reload the page.</p>
    </noscript>
</div>

<div>
   	<header id="ht-headerbar">
    <div class="ht-headerbar-left">
        <a href="" id="ht-menu-toggle" class="sp-aui-icon-small sp-aui-iconfont-appswitcher"></a>
    </div>
    <div class="ht-headerbar-right">
            <div class="sp-aui-icon-small ht-search-index-loader ht-header-icon"></div>

        <div id="ht-search">
            <div class="ht-search-input" style="display: none;">
              	<a href="#" class="sp-aui-icon-small sp-aui-iconfont-remove ht-search-clear"></a>

                <form action="#" method="GET" id="search">
                    <input class="search-input" type="text" placeholder="Search" tabindex="-1" autocomplete="off" name="q" value="">
                    <input type="hidden" name="max" value="15">
                    <input type="submit" style="display:none" tabindex="-4">
                </form>

                <a href="#" id="ht-search-button" class="ht-header-icon ht-header-icon-svg">
                                        <svg width="40px" height="40px" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                        <g>
                            <path d="M29.572,28.802 L28.801,29.571 C28.515,29.857 28.187,30 27.816,30 C27.445,30 27.116,29.857 26.831,29.571 L21.392,24.134 C20.193,24.762 18.908,25.076 17.538,25.076 C15.396,25.076 13.605,24.348 12.163,22.892 C10.721,21.436 10,19.651 10,17.538 C10,15.397 10.721,13.605 12.163,12.163 C13.605,10.721 15.396,10 17.538,10 C19.651,10 21.434,10.721 22.89,12.163 C24.347,13.605 25.075,15.397 25.075,17.538 C25.075,18.937 24.761,20.222 24.132,21.393 L29.572,26.832 C29.857,27.118 30,27.446 30,27.817 C30,28.188 29.857,28.517 29.572,28.802 L29.572,28.802 Z M13.662,21.414 C14.732,22.485 16.024,23.02 17.538,23.02 C19.051,23.02 20.343,22.485 21.413,21.414 C22.484,20.344 23.019,19.052 23.019,17.538 C23.019,16.025 22.484,14.733 21.413,13.662 C20.343,12.592 19.051,12.056 17.538,12.056 C16.024,12.056 14.732,12.592 13.662,13.662 C12.591,14.733 12.056,16.025 12.056,17.538 C12.056,19.052 12.591,20.344 13.662,21.414 L13.662,21.414 Z"></path>
                        </g>
                    </svg>
              	</a>

                <div class="ht-search-dropdown ht-dropdown">
                    <ul></ul>
                </div>
            </div>
        </div>
    </div>
    </header>   	<aside id="ht-sidebar">
    <div class="ht-sidebar-content">
        <div class="ht-sidebar-content-scroll-container">
            <header class="ht-sidebar-header">
                <h1 class="ht-logo">
                    <span class="ht-logo-label">K11</span>
                    <img class="space-logo" src="global.logo">
                </h1>
                <a href="Kentico-11-Documentation-Home.html" class="ht-space-link">
                    <h2>Kentico 11 Documentation</h2>
                </a>
            </header>
                            <iframe id="ht-nav" src="toc.html?pageId=68880378"></iframe>
                <script>
                    $('iframe#ht-nav').iFrameResize(
                            { 'log': true, 'autoResize': true, 'heightCalculationMethod': 'lowestElement', 'checkOrigin': false });
                </script>
                    </div>
    </div>

</aside></div>

<div id="ht-wrap-container">

            
    <div id="ht-sidebar-dragbar">
    <div class="ht-sidebar-drag-handle">
        <span class="drag-handle-1"></span>
        <span class="drag-handle-2"></span>
        <span class="drag-handle-3"></span>
    </div>
</div>
    <article id="ht-content" class="ht-content">
        <header class="ht-content-header">
            <div id="ht-breadcrumb">
    <ul>
        <li><a href="Kentico-11-Documentation-Home.html">Kentico 11 Documentation</a></li>
                                                                                                             <li><a href="" onclick="$('.shortcut').each(function(){$(this).removeClass('shortcut')}); $(this).parent().addClass('shortcut'); return false;">...</a> </li>
                                        <li class="shortcut"><a href="Managing-users.html">Managing users</a></li>
                                                                                     <li><a href="User-registration-and-authentication.html">User registration and authentication</a></li>
                                                            </ul>
</div>            <h1 id="src-68880378"> <span>Configuring Windows AD authentication</span></h1>
        </header>

        <div id="main-content" class="wiki-content sp-grid-section" data-index-for-search="true">
<div class="sp-grid-cell sp-grid-60"><p>Kentico supports Windows integrated authentication. This means that when a user signs in to a Windows domain, Kentico automatically recognizes their identity without requiring a user name and password.</p><div class="confbox admonition admonition-note">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p><strong class=" ">Prerequisite</strong></p>
<p>For Windows authentication to work, the application must be able to access the following attributes of user objects in Active Directory (i.e. the attributes cannot be protected or confidential):</p>
<ul class=" "><li class=" "><p><strong class=" ">memberof</strong></p>
</li><li class=" "><p><strong class=" ">userAccountControl</strong></p>
</li></ul>        </div>
    </div><p>When an authenticated user comes to a site configured for Windows authentication, the system automatically creates a matching user account in the Kentico database.</p><p>Additionally, the system imports the user's domain groups as roles. If an existing user is added to new groups in Active Directory, Kentico imports new roles (the update occurs upon reauthentication, i.e. after the user's session expires). However, existing roles are not removed from users in Kentico when the matching users in Active Directory are removed from groups.</p><p>The imported roles do <i class=" "><strong class=" ">not</strong></i> authorize the users to perform any actions in Kentico by default. You need to configure <a href="configuring-permissions">permissions</a> and <a href="ui-personalization">UI personalization</a> settings for the imported roles manually if you wish to use them.</p><div class="confbox admonition admonition-tip">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p><strong class=" ">Disabling the automatic role import</strong></p>
<p>If you wish to disable the automatic import of user domain groups as roles in Kentico, add the following key to the <i class=" ">/configuration/appSettings</i> section of your project's web.config file:</p>
    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">&lt;add key=</code><code class="string">"CMSImportWindowsRoles"</code><code class="plain"> value=</code><code class="string">"false"</code><code class="plain"> /&gt;</code></div>
</div>
    </div>
        </div>
    </div></div>
    



    
    <div class="sp-grid-cell sp-grid-40 sp-grid-sidebar"><div class="confbox panel">
            <div class="title panel-header">On this page</div>
            <div class="panel-content">
<p></p>
<ul class="toc-indentation "><li class=" "><p><a href="#src-68880378_configuringwindowsadauthentication-configuringwindowsauthentication">Configuring Windows authentication</a></p>
</li><li class=" "><p><a href="#src-68880378_configuringwindowsadauthentication-enablingwindowsauthenticationiniis">Enabling Windows authentication in IIS</a></p>
</li><li class=" "><p><a href="#src-68880378_configuringwindowsadauthentication-settingupadministratoraccessafterenablingwindowsauthentication">Setting up administrator access after enabling Windows authentication</a></p>
</li><li class=" "><p><a href="#src-68880378_configuringwindowsadauthentication-forbiddencharacterreplacementduringactivedirectoryimport">Forbidden character replacement during Active Directory import</a></p>
</li></ul><p></p>
        </div>
    </div></div>
    
    <h3 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Configuring Windows authentication</span></h3>
<p>Follow the steps below to switch the application to <i class=" ">Windows authentication</i> mode:</p>
<ol class=" "><li class=" "><p>Edit the <i class=" ">web.config</i> file of the web project.</p>
</li><li class=" "><p>Set the <strong class=" ">mode</strong> attribute of the <strong class=" ">&lt;authentication&gt;</strong> element in the <i class=" ">&lt;system.web&gt;</i> section to <strong class=" ">Windows</strong>:</p>
    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">&lt;authentication mode=</code><code class="string">"Windows"</code><code class="plain">&gt;</code></div>
</div>
    </div>
</li><li class=" "><p>(Optional) You can also make Windows authentication required for access to the live site. To achieve this result, uncomment the following <strong class=" ">&lt;location&gt;</strong> element in your web.config:</p>
    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">&lt;location path=</code><code class="string">""</code><code class="plain">&gt;</code></div>
<div class="line"><code class="plain">  &lt;system.web&gt;</code></div>
<div class="line"><code class="plain">    &lt;authorization&gt;</code></div>
<div class="line"><code class="plain">      &lt;deny users=</code><code class="string">"?"</code><code class="plain">/&gt;</code></div>
<div class="line"><code class="plain">    &lt;/authorization&gt;</code></div>
<div class="line"><code class="plain">  &lt;/system.web&gt;</code></div>
<div class="line"><code class="plain">&lt;/location&gt;</code></div>
</div>
    </div>
    <div class="confbox admonition admonition-info">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p>If you want to require Windows authentication for only a part of the live website, see <a href="securing-a-website-section-using-windows-authentication">Securing a website section using Windows authentication</a>.</p>
        </div>
    </div>
</li><li class=" "><p>Save the modified web.config file.</p>
</li><li class=" "><p>Close all browsers with Kentico, open the website in a new browser and try to access the administration interface (<i class=" ">&lt;site domain&gt;/admin</i>).<br></p>
<ul class=" "><li class="confluence-link "><p>If you encounter a <strong class=" ">401 </strong>error, continue to the <i class=" ">Enabling Windows authentication in IIS </i>section below.</p>
</li></ul></li></ol><p>With this configuration, the system automatically authenticates users from Windows Active Directory and imports them to the Kentico database.</p>
<p>You need to manually <a href="#src-68880378_configuringwindowsadauthentication-settingupadministratoraccessafterenablingwindowsauthentication">set up administrator access</a> for your new AD user account.</p>
    <div class="confbox admonition admonition-info">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p><strong class=" ">Sign out button missing with Windows authentication</strong></p>
<p>When Windows authentication is enabled, the <strong class=" ">Sign out</strong> button in user menu in the top right corner of the administration interface is not displayed. The same applies to the live site, where the sign out link is not displayed in all web parts that can be used to sign out.</p>
        </div>
    </div>
    <h3 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Enabling Windows authentication in IIS</span></h3>
<p>If you are experiencing the <strong class=" ">401 error</strong> with Windows authentication, you need to enable Windows authentication in your IIS:</p>
<ol class=" "><li class=" "><p>Start the <strong class=" ">Internet Information Services (IIS) Manager</strong>.</p>
</li><li class=" "><p>Locate and select your site in the IIS tree.</p>
</li><li class=" "><p>Double-click the <strong class=" ">Authentication</strong> icon.<br><br><img class="confluence-embedded-image" src="images/download/attachments/5212098/Authentication_feature_IIS.png" alt="images/download/attachments/5212098/Authentication_feature_IIS.png" width="500">
        <br><span class="caption">Open the Authentication feature in IIS</span>
    </p>
    <div class="confbox admonition admonition-note">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p><strong class=" ">Windows Authentication missing in the list</strong></p>
<p>If your IIS installation does not contain Windows Authentication by default, you need to install it:</p>
<ol class=" "><li class=" "><p>Go to <strong class=" ">Control Panel -&gt; Programs and Features -&gt; Turn windows features on or off</strong>.</p>
</li><li class=" "><p>Expand <strong class=" ">Internet Information Services -&gt; World Wide Web Services</strong>.</p>
</li><li class=" "><p>Under <strong class=" ">Security</strong>, select the <strong class=" ">Windows Authentication</strong> check box.</p>
</li><li class=" "><p>Click <strong class=" ">OK</strong> to finish the configuration.</p>
</li></ol><p>Windows Authentication appears as an option in IIS website authentication settings.</p>
        </div>
    </div>
</li><li class=" "><p>Select <strong class=" ">Windows Authentication</strong>.</p>
</li><li class=" "><p>Click <strong class=" ">Enable</strong> in the <strong class=" ">Actions</strong> menu.<br><br></p>
<img class="confluence-embedded-image" src="images/download/attachments/5212098/Enable_windows_authentication.png" alt="images/download/attachments/5212098/Enable_windows_authentication.png" width="500">
        <br><span class="caption">Enable the Windows authentication</span>
    </li></ol><p>IIS now allows Windows authentication on your site.</p>
    <h3 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Setting up administrator access after enabling Windows authentication</span></h3>
<p>When you access the Kentico administration interface (<i class=" ">&lt;site domain&gt;/admin</i>) for the first time after configuring Windows authentication, you will encounter an <i class=" ">Access denied</i> message. Windows authentication logs you in under a new user account that the system automatically created based on your Active Directory user name, but the account does not have any permissions.</p>
<p>To allow access to all features as an administrator under Windows authentication, you need to manually grant administrator permissions to your new user account:</p>
<ol class=" "><li class=" "><p>Access the Kentico administration interface at least once under Windows authentication (to ensure that the system imports your AD user).</p>
</li><li class=" "><p>Edit the project's <i class=" ">web.config</i> file and switch back to <strong class=" ">Forms</strong> authentication (set the <strong class=" ">mode</strong> attribute of the <strong class=" ">&lt;authentication&gt;</strong> element in the <i class=" ">&lt;system.web&gt;</i> section back to <strong class=" ">Forms</strong>).</p>
</li><li class=" "><p>Log back in to the Kentico administration using forms authentication (under your original administrator account).</p>
</li><li class=" "><p>Open the <strong class=" ">Users</strong> application.</p>
</li><li class=" "><p>Edit the new user that matches your domain user name (the format is<i class=" "> domain-username</i>, for example <i class=" ">office-johns</i>).</p>
</li><li class=" "><p>On the <strong class=" ">General</strong> tab, set the <strong class=" ">Privilege level</strong> to <i class=" ">Global administrator</i>.</p>
</li><li class=" "><p>Click <strong class=" ">Save</strong> and log out.</p>
</li><li class=" "><p>Edit your <i class=" ">web.config</i> file and switch to <strong class=" ">Windows</strong> authentication again.</p>
</li></ol><p>Close all browsers with Kentico, open the website in a new browser and access the administration interface. Make sure the system recognizes you as a global administrator without the need to manually log in.</p>
    <h3 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Forbidden character replacement during Active Directory import</span></h3>
<p>When importing users and roles, forbidden characters in the names are replaced by the character defined in <strong class=" ">Settings -&gt; URLs and SEO -&gt; Forbidden characters replacement</strong>.</p>
<p>The default value is a dash "-" (<i class=" ">domain-username</i> instead of <i class=" ">domain\username</i>). If you are using a different character, please change the entered user name accordingly.</p>
<p>You can override this setting by adding the following keys to the <i class=" ">AppSettings</i> section of your <i class=" ">web.config</i> file. In both cases, the value must be exactly one character:</p>
    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">&lt;add key=</code><code class="string">"CMSForbiddenUserNameCharactersReplacement"</code><code class="plain"> value=</code><code class="string">"-"</code><code class="plain"> /&gt;</code></div>
</div>
    </div>
    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">&lt;add key=</code><code class="string">"CMSForbiddenRoleNameCharactersReplacement"</code><code class="plain"> value=</code><code class="string">"-"</code><code class="plain"> /&gt;</code></div>
</div>
    </div>
<p>If you want to achieve the same functionality as in <strong class=" ">older versions</strong> of Kentico (<strong class=" ">office\username</strong>), forbidden characters replacement can be turned off completely using the following two keys. This may cause problems when using wildcard URLs with user names in the wildcard part and is therefore not recommended.</p>
    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">&lt;add key=</code><code class="string">"CMSEnsureSafeUserNames"</code><code class="plain"> value=</code><code class="string">"false"</code><code class="plain"> /&gt;</code></div>
</div>
    </div>
    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">&lt;add key=</code><code class="string">"CMSEnsureSafeRoleNames"</code><code class="plain"> value=</code><code class="string">"false"</code><code class="plain"> /&gt;</code></div>
</div>
    </div>
        </div>

    </article>


               
            
    <footer id="ht-footer">
    <a href="#" id="ht-jump-top" class="sp-aui-icon-small sp-aui-iconfont-arrows-up"></a>
</footer></div>

<div>
    <div id="ht-mq-detect"></div>
</div>

    <script src="js/lunr.js"></script>
    <script src="js/lunr-extras.js"></script>
    <script src="assets/js/scroll-search.js"></script>

    <script src="assets/js/expand-macro.js"></script>


</body></html>