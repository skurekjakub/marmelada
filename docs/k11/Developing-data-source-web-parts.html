<!DOCTYPE html><html><head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Developing data source web parts - Kentico 11 Documentation</title>

    
    <link rel="stylesheet" href="assets/css/expand-macro.css">

            <meta name="scroll-content-language-key" content="">
    
    <meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=2.0, user-scalable=yes">

<script type="text/javascript" src="assets/js/jquery.min.js"></script>
<script type="text/javascript" src="assets/js/jquery.scrollTo.min.js"></script>


<script type="text/javascript" src="assets/js/translate.js"></script>

<script type="text/javascript" src="assets/js/theme.main.js"></script>

    <script type="text/javascript" src="assets/js/iframeResizer.min.js"></script>

<link rel="stylesheet" href="assets/css/content-style.css">
    <link rel="stylesheet" href="assets/css/search.css">

<link rel="stylesheet" href="assets/css/theme.main.css">
<link rel="stylesheet" href="assets/css/theme.colors.css">

            <!-- ES5 support for older browsers, needed by lunr -->
        <script src="js/augment.js"></script> 
        <script id="worker" type="javascript/worker">

        startIndex = function() {
            idx = lunr.Index.load(lunrIndex);
            idx.pipeline.remove(lunr.stopWordFilter);
            postMessage({type: "setup-complete"});
        }

        onmessage = function (event) {
            var message = event.data;

            if ((message.type === 'setup') && message.baseUrl) {
                var url = message.baseUrl;
                importScripts(url + 'js/lunr.js');
                importScripts(url + 'js/lunr-extras.js');
                importScripts(url + 'js/lunr-index.js');
                importScripts(url + 'js/lunr-data.js');
                startIndex();
            }

            if (idx && (message.type === 'search-request') && message.query) {
                var searchWord = message.query;
                var results = idx.search(searchWord).map(function (result) {
                    return lunrData.filter(function (d) {
                        return d.id === parseInt(result.ref, 10)
                    })[0]
                });
                postMessage({type: 'search-results', results: results, query: searchWord, queryId: message.queryId});
            }
        }

    </script>
    </head>

<body pageid="68879260" elementpageid="68882210">

<div id="ht-loader">
    <noscript>
        <p style="width: 100%; text-align:center; position: absolute; margin-top: 200px;">This content cannot be displayed without JavaScript.<br>Please enable JavaScript and reload the page.</p>
    </noscript>
</div>

<div>
   	<header id="ht-headerbar">
    <div class="ht-headerbar-left">
        <a href="" id="ht-menu-toggle" class="sp-aui-icon-small sp-aui-iconfont-appswitcher"></a>
    </div>
    <div class="ht-headerbar-right">
            <div class="sp-aui-icon-small ht-search-index-loader ht-header-icon"></div>

        <div id="ht-search">
            <div class="ht-search-input" style="display: none;">
              	<a href="#" class="sp-aui-icon-small sp-aui-iconfont-remove ht-search-clear"></a>

                <form action="#" method="GET" id="search">
                    <input class="search-input" type="text" placeholder="Search" tabindex="-1" autocomplete="off" name="q" value="">
                    <input type="hidden" name="max" value="15">
                    <input type="submit" style="display:none" tabindex="-4">
                </form>

                <a href="#" id="ht-search-button" class="ht-header-icon ht-header-icon-svg">
                                        <svg width="40px" height="40px" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                        <g>
                            <path d="M29.572,28.802 L28.801,29.571 C28.515,29.857 28.187,30 27.816,30 C27.445,30 27.116,29.857 26.831,29.571 L21.392,24.134 C20.193,24.762 18.908,25.076 17.538,25.076 C15.396,25.076 13.605,24.348 12.163,22.892 C10.721,21.436 10,19.651 10,17.538 C10,15.397 10.721,13.605 12.163,12.163 C13.605,10.721 15.396,10 17.538,10 C19.651,10 21.434,10.721 22.89,12.163 C24.347,13.605 25.075,15.397 25.075,17.538 C25.075,18.937 24.761,20.222 24.132,21.393 L29.572,26.832 C29.857,27.118 30,27.446 30,27.817 C30,28.188 29.857,28.517 29.572,28.802 L29.572,28.802 Z M13.662,21.414 C14.732,22.485 16.024,23.02 17.538,23.02 C19.051,23.02 20.343,22.485 21.413,21.414 C22.484,20.344 23.019,19.052 23.019,17.538 C23.019,16.025 22.484,14.733 21.413,13.662 C20.343,12.592 19.051,12.056 17.538,12.056 C16.024,12.056 14.732,12.592 13.662,13.662 C12.591,14.733 12.056,16.025 12.056,17.538 C12.056,19.052 12.591,20.344 13.662,21.414 L13.662,21.414 Z"></path>
                        </g>
                    </svg>
              	</a>

                <div class="ht-search-dropdown ht-dropdown">
                    <ul></ul>
                </div>
            </div>
        </div>
    </div>
    </header>   	<aside id="ht-sidebar">
    <div class="ht-sidebar-content">
        <div class="ht-sidebar-content-scroll-container">
            <header class="ht-sidebar-header">
                <h1 class="ht-logo">
                    <span class="ht-logo-label">K11</span>
                    <img class="space-logo" src="global.logo">
                </h1>
                <a href="Kentico-11-Documentation-Home.html" class="ht-space-link">
                    <h2>Kentico 11 Documentation</h2>
                </a>
            </header>
                            <iframe id="ht-nav" src="toc.html?pageId=68882210"></iframe>
                <script>
                    $('iframe#ht-nav').iFrameResize(
                            { 'log': true, 'autoResize': true, 'heightCalculationMethod': 'lowestElement', 'checkOrigin': false });
                </script>
                    </div>
    </div>

</aside></div>

<div id="ht-wrap-container">

            
    <div id="ht-sidebar-dragbar">
    <div class="ht-sidebar-drag-handle">
        <span class="drag-handle-1"></span>
        <span class="drag-handle-2"></span>
        <span class="drag-handle-3"></span>
    </div>
</div>
    <article id="ht-content" class="ht-content">
        <header class="ht-content-header">
            <div id="ht-breadcrumb">
    <ul>
        <li><a href="Kentico-11-Documentation-Home.html">Kentico 11 Documentation</a></li>
                                                                                                             <li><a href="" onclick="$('.shortcut').each(function(){$(this).removeClass('shortcut')}); $(this).parent().addClass('shortcut'); return false;">...</a> </li>
                                        <li class="shortcut"><a href="Custom-development.html">Custom development</a></li>
                                                                                                         <li class="shortcut"><a href="Developing-web-parts.html">Developing web parts</a></li>
                                                                                     <li><a href="Advanced-web-part-development-scenarios.html">Advanced web part development scenarios</a></li>
                                                            </ul>
</div>            <h1 id="src-68882210"> <span>Developing data source web parts</span></h1>
        </header>

        <div id="main-content" class="wiki-content sp-grid-section" data-index-for-search="true">
<div class="sp-grid-cell sp-grid-60"><p>Data source <a href="developing-web-parts">web parts</a> are responsible for loading data. You can display the retrieved data on the website by connecting the data source to a listing web part.</p><p>To develop custom data source web parts, you need to create two separate user controls:</p><ol class=" "><li class=" "><p>The first control loads the data. This control must inherit from <strong class=" ">CMSBaseDataSource</strong> (found in the <i class=" ">CMS.DocumentEngine.Web.UI</i> namespace).</p>
</li><li class=" "><p>The second user control contains the first control in its markup and serves as the source file for the actual web part. Must inherit from <strong class=" ">CMSAbstractWebPart</strong>.</p>
</li></ol><h3 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Example - Creating a user data source</span></h3><p>The following example shows how to create a custom data source that loads user data from the Kentico database.</p><p>Open your web project in Visual Studio and create two user controls according to the sections below.</p><div class="confbox admonition admonition-note">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p><strong class=" ">Note</strong></p>
<p>Set the values of the <i class=" ">Inherits</i> attributes in the user control declarations and the class names according to the names and locations of your controls. If your Kentico project was installed as a web application, you need to rename the <i class=" ">CodeFile</i> attributes to <i class=" ">Codebehind</i>.</p>
<p>The code in the example assumes that the control is placed inside the <strong class=" ">~/CMSGlobalFiles</strong> folder (you may need to manually create this folder if you wish to use the default code). When developing your own controls, you can use another location and adjust the <i class=" ">Inherits</i> attribute and the corresponding class names as required.</p>
        </div>
    </div></div>

    


    
    <div class="sp-grid-cell sp-grid-40 sp-grid-sidebar"><div class="sp-grid-cell sp-grid-40 sp-grid-sidebar"><div class="confbox panel">
            <div class="title panel-header">On this page</div>
            <div class="panel-content">
<ul class="toc-indentation "><li class=" "><p><a href="#src-68882210_developingdatasourcewebparts-example-creatingauserdatasource">Example - Creating a user data source</a></p>
<ul class="toc-indentation "><li class=" "><p><a href="#src-68882210_developingdatasourcewebparts-registeringthewebpart">Registering the web part</a></p>
</li><li class=" "><p><a href="#src-68882210_developingdatasourcewebparts-result">Result</a></p>
</li></ul></li><li class=" "><p><a href="#src-68882210_safe-id-rgv2zwxvcgluz2rhdgfzb3vyy2v3zwjwyxj0cy1fegftcgxl4octsw1wbgvtzw50aw5nzgf0yxnvdxjjzwnhy2hpbmc">Example – Implementing data source caching</a></p>
</li></ul>        </div>
    </div><div class="confbox panel">
            <div class="title panel-header">Related pages</div>
            <div class="panel-content">
<ul class=" "><li class=" "><p><a href="loading-and-displaying-data-on-websites">Loading and displaying data on websites</a></p>
</li><li class=" "><p><a href="creating-new-web-parts">Creating new web parts</a></p>
</li></ul>        </div>
    </div></div><div class="confbox panel">
            <div class="title panel-header">On this page</div>
            <div class="panel-content">
<ul class="toc-indentation "><li class=" "><p><a href="#src-68882210_developingdatasourcewebparts-example-creatingauserdatasource">Example - Creating a user data source</a></p>
<ul class="toc-indentation "><li class=" "><p><a href="#src-68882210_developingdatasourcewebparts-registeringthewebpart">Registering the web part</a></p>
</li><li class=" "><p><a href="#src-68882210_developingdatasourcewebparts-result">Result</a></p>
</li></ul></li><li class=" "><p><a href="#src-68882210_safe-id-rgv2zwxvcgluz2rhdgfzb3vyy2v3zwjwyxj0cy1fegftcgxl4octsw1wbgvtzw50aw5nzgf0yxnvdxjjzwnhy2hpbmc">Example – Implementing data source caching</a></p>
</li></ul>        </div>
    </div><div class="confbox panel">
            <div class="title panel-header">Related pages</div>
            <div class="panel-content">
<ul class=" "><li class=" "><p><a href="loading-and-displaying-data-on-websites">Loading and displaying data on websites</a></p>
</li><li class=" "><p><a href="creating-new-web-parts">Creating new web parts</a></p>
</li></ul>        </div>
    </div></div>
    
    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                    <div class="title">DataSourceControl.ascx</div>
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-title="DataSourceControl.ascx" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">&lt;%@ Control Language=</code><code class="string">"C#"</code><code class="plain"> AutoEventWireup=</code><code class="string">"true"</code><code class="plain"> CodeFile=</code><code class="string">"DataSourceControl.ascx.cs"</code><code class="plain"> Inherits=</code><code class="string">"CMSGlobalFiles_DataSourceControl"</code><code class="plain"> %&gt;</code></div>
<div class="line"><code class="plain">&lt;%--Leave the markup of the first user control empty--%&gt;</code></div>
</div>
    </div>
    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                    <div class="title">DataSourceControl.ascx.cs</div>
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-title="DataSourceControl.ascx.cs" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="keyword">using</code><code class="plain"> System;</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="keyword">using</code><code class="plain"> CMS.DocumentEngine.Web.UI;</code></div>
<div class="line"><code class="keyword">using</code><code class="plain"> CMS.Membership;</code></div>
<div class="line"><code class="keyword">using</code><code class="plain"> CMS.FormEngine.Web.UI;</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="comments">/// &lt;summary&gt;</code></div>
<div class="line"><code class="comments">/// User data source. Loads all users according to a specified Where condition.</code></div>
<div class="line"><code class="comments">/// &lt;/summary&gt;</code></div>
<div class="line"><code class="keyword">public</code><code class="plain"> </code><code class="keyword">partial</code><code class="plain"> </code><code class="keyword">class</code><code class="plain"> CMSGlobalFiles_DataSourceControl : CMSBaseDataSource</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    </code><code class="comments">/// &lt;summary&gt;</code></div>
<div class="line"><code class="plain">    </code><code class="comments">/// Assigns a handler for the 'OnFilterChanged' event if there is a filter attached to the data source.</code></div>
<div class="line"><code class="plain">    </code><code class="comments">/// You do not need to implement this method if you do not plan to use filters with the data source web part.</code></div>
<div class="line"><code class="plain">   &nbsp;</code><code class="comments">/// &lt;/summary&gt;</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">protected</code><code class="plain"> </code><code class="keyword">override</code><code class="plain"> </code><code class="keyword">void</code><code class="plain"> OnInit(EventArgs e)</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">if</code><code class="plain"> (SourceFilterControl != </code><code class="keyword">null</code><code class="plain">)</code></div>
<div class="line"><code class="plain">        {</code></div>
<div class="line"><code class="plain">            SourceFilterControl.OnFilterChanged += </code><code class="keyword">new</code><code class="plain"> ActionEventHandler(DataFilter_OnFilterChanged);</code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">        </code><code class="keyword">base</code><code class="plain">.OnInit(e);</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">    </code><code class="comments">/// &lt;summary&gt;</code></div>
<div class="line"><code class="plain">    </code><code class="comments">/// Handles the OnFilterChanged event.</code></div>
<div class="line"><code class="plain">    </code><code class="comments">/// You do not need to implement this method if you do not plan to use filters with the data source web part.</code></div>
<div class="line"><code class="plain">   &nbsp;</code><code class="comments">/// &lt;/summary&gt;</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">void</code><code class="plain"> DataFilter_OnFilterChanged()</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        </code><code class="comments">// Clears the old data</code></div>
<div class="line"><code class="plain">        InvalidateLoadedData();</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">        </code><code class="comments">// Raises the change event</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">this</code><code class="plain">.RaiseOnFilterChanged();</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">    </code><code class="comments">/// &lt;summary&gt;</code></div>
<div class="line"><code class="plain">    </code><code class="comments">/// Loads the data of the data source.</code></div>
<div class="line"><code class="plain">    </code><code class="comments">/// &lt;/summary&gt;</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">protected</code><code class="plain"> </code><code class="keyword">override</code><code class="plain"> </code><code class="keyword">object</code><code class="plain"> GetDataSourceFromDB()</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        </code><code class="comments">// Initializes the data properties according to the filter settings</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">if</code><code class="plain"> (SourceFilterControl != </code><code class="keyword">null</code><code class="plain">)</code></div>
<div class="line"><code class="plain">        {</code></div>
<div class="line"><code class="plain">            SourceFilterControl.InitDataProperties(</code><code class="keyword">this</code><code class="plain">);</code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">		</code><code class="comments">// Loads the data. The WhereCondition and OrderBy properties are inherited from the parent class.</code></div>
<div class="line"><code class="plain">		DataSource = UserInfoProvider.GetUsersDataWithSettings()</code></div>
<div class="line"><code class="plain">										.Where(WhereCondition)</code></div>
<div class="line"><code class="plain">										.OrderBy(OrderBy)</code></div>
<div class="line"><code class="plain">										.TypedResult;</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">        </code><code class="keyword">return</code><code class="plain"> DataSource;</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                    <div class="title">DataSourceWebPart.ascx</div>
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-title="DataSourceWebPart.ascx" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">&lt;%@ Control Language=</code><code class="string">"C#"</code><code class="plain"> AutoEventWireup=</code><code class="string">"true"</code><code class="plain"> CodeFile=</code><code class="string">"~/CMSGlobalFiles/DataSourceWebPart.ascx.cs"</code><code class="plain"> Inherits=</code><code class="string">"CMSGlobalFiles_DataSourceWebPart"</code><code class="plain"> %&gt;</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">&lt;%@ Register Src=</code><code class="string">"~/CMSGlobalFiles/DataSourceControl.ascx"</code><code class="plain"> TagPrefix=</code><code class="string">"cms"</code><code class="plain"> TagName=</code><code class="string">"DataSourceControl"</code><code class="plain"> %&gt;</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">&lt;cms:DataSourceControl ID=</code><code class="string">"srcUsers"</code><code class="plain"> runat=</code><code class="string">"server"</code><code class="plain"> /&gt;</code></div>
</div>
    </div>
    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                    <div class="title">DataSourceWebPart.ascx.cs</div>
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-title="DataSourceWebPart.ascx.cs" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="keyword">using</code><code class="plain"> CMS.PortalEngine.Web.UI;</code></div>
<div class="line"><code class="keyword">using</code><code class="plain"> CMS.Helpers;</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="keyword">public</code><code class="plain"> </code><code class="keyword">partial</code><code class="plain"> </code><code class="keyword">class</code><code class="plain"> CMSGlobalFiles_DataSourceWebPart : CMSAbstractWebPart</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    </code><code class="comments">/// &lt;summary&gt;</code></div>
<div class="line"><code class="plain">    </code><code class="comments">/// Gets or sets the value of the WhereCondition web part property.</code></div>
<div class="line"><code class="plain">    </code><code class="comments">/// &lt;/summary&gt;</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">public</code><code class="plain"> </code><code class="keyword">string</code><code class="plain"> WhereCondition</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">get</code></div>
<div class="line"><code class="plain">        {</code></div>
<div class="line"><code class="plain">            </code><code class="keyword">return</code><code class="plain"> ValidationHelper.GetString(</code><code class="keyword">this</code><code class="plain">.GetValue(</code><code class="string">"WhereCondition"</code><code class="plain">), </code><code class="string">""</code><code class="plain">);</code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">set</code></div>
<div class="line"><code class="plain">        {</code></div>
<div class="line"><code class="plain">            </code><code class="keyword">this</code><code class="plain">.SetValue(</code><code class="string">"WhereCondition"</code><code class="plain">, value);</code></div>
<div class="line"><code class="plain">            srcUsers.WhereCondition = value;</code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">    </code><code class="comments">/// &lt;summary&gt;</code></div>
<div class="line"><code class="plain">    </code><code class="comments">/// Gets or sets the value of the OrderBy web part property.</code></div>
<div class="line"><code class="plain">    </code><code class="comments">/// &lt;/summary&gt;</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">public</code><code class="plain"> </code><code class="keyword">string</code><code class="plain"> OrderBy</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">get</code></div>
<div class="line"><code class="plain">        {</code></div>
<div class="line"><code class="plain">            </code><code class="keyword">return</code><code class="plain"> ValidationHelper.GetString(</code><code class="keyword">this</code><code class="plain">.GetValue(</code><code class="string">"OrderBy"</code><code class="plain">), </code><code class="string">""</code><code class="plain">);</code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">set</code></div>
<div class="line"><code class="plain">        {</code></div>
<div class="line"><code class="plain">            </code><code class="keyword">this</code><code class="plain">.SetValue(</code><code class="string">"OrderBy"</code><code class="plain">, value);</code></div>
<div class="line"><code class="plain">            srcUsers.OrderBy = value;</code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">    </code><code class="comments">/// &lt;summary&gt;</code></div>
<div class="line"><code class="plain">    </code><code class="comments">/// Gets or sets the value of the FilterName web part property.</code></div>
<div class="line"><code class="plain">    </code><code class="comments">/// &lt;/summary&gt;</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">public</code><code class="plain"> </code><code class="keyword">string</code><code class="plain"> FilterName</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">get</code></div>
<div class="line"><code class="plain">        {</code></div>
<div class="line"><code class="plain">            </code><code class="keyword">return</code><code class="plain"> ValidationHelper.GetString(</code><code class="keyword">this</code><code class="plain">.GetValue(</code><code class="string">"FilterName"</code><code class="plain">), </code><code class="string">""</code><code class="plain">);</code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">set</code></div>
<div class="line"><code class="plain">        {</code></div>
<div class="line"><code class="plain">            </code><code class="keyword">this</code><code class="plain">.SetValue(</code><code class="string">"FilterName"</code><code class="plain">, value);</code></div>
<div class="line"><code class="plain">            srcUsers.SourceFilterName = value;</code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">    </code><code class="comments">/// &lt;summary&gt;</code></div>
<div class="line"><code class="plain">    </code><code class="comments">/// Content loaded event handler.</code></div>
<div class="line"><code class="plain">    </code><code class="comments">/// &lt;/summary&gt;</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">public</code><code class="plain"> </code><code class="keyword">override</code><code class="plain"> </code><code class="keyword">void</code><code class="plain"> OnContentLoaded()</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">base</code><code class="plain">.OnContentLoaded();</code></div>
<div class="line"><code class="plain">        SetupControl();</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">    </code><code class="comments">/// &lt;summary&gt;</code></div>
<div class="line"><code class="plain">    </code><code class="comments">/// Initializes the properties of the internal data source control.</code></div>
<div class="line"><code class="plain">    </code><code class="comments">/// &lt;/summary&gt;</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">protected</code><code class="plain"> </code><code class="keyword">void</code><code class="plain"> SetupControl()</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">if</code><code class="plain"> (</code><code class="keyword">this</code><code class="plain">.StopProcessing)</code></div>
<div class="line"><code class="plain">        {</code></div>
<div class="line"><code class="plain">            </code><code class="comments">// Does nothing if the web part is disabled</code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">else</code></div>
<div class="line"><code class="plain">        {</code></div>
<div class="line"><code class="plain">            </code><code class="keyword">this</code><code class="plain">.srcUsers.WhereCondition = </code><code class="keyword">this</code><code class="plain">.WhereCondition;</code></div>
<div class="line"><code class="plain">            </code><code class="keyword">this</code><code class="plain">.srcUsers.OrderBy = </code><code class="keyword">this</code><code class="plain">.OrderBy;</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">            </code><code class="comments">// Sets the inner data source's name according to the web part's 'Web part control ID' property.</code></div>
<div class="line"><code class="plain">            </code><code class="comments">// This allows listing web parts to connect to the inner control.</code></div>
<div class="line"><code class="plain">            </code><code class="comments">// The identifier property is named 'FilterName' because data sources inherit the property from </code></div>
<div class="line"><code class="plain">            </code><code class="comments">// a base class shared with filter objects.</code></div>
<div class="line"><code class="plain">            </code><code class="keyword">this</code><code class="plain">.srcUsers.FilterName = (</code><code class="keyword">string</code><code class="plain">)</code><code class="keyword">this</code><code class="plain">.GetValue(</code><code class="string">"WebPartControlID"</code><code class="plain">);</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">            </code><code class="comments">// Connects the attached filter, as specified by the 'Filter name' property of the web part</code></div>
<div class="line"><code class="plain">            </code><code class="keyword">this</code><code class="plain">.srcUsers.SourceFilterName = </code><code class="keyword">this</code><code class="plain">.FilterName;</code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p>If your Kentico project was installed as a web application, you must <strong class=" ">Build</strong> the project.</p>
    <h4 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Registering the web part</span></h4>
<p>Register the <strong class=" ">DataSourceWebPart.ascx</strong> control as a new web part in Kentico.</p>
<ol class=" "><li class=" "><p>Open the <strong class=" ">Web parts</strong> application.</p>
</li><li class=" "><p>Create a new web part. See <a href="creating-new-web-parts">Creating new web parts</a> for details.</p>
</li><li class=" "><p>Type <i class=" ">Custom user data source</i> as the web part's <strong class=" ">Display name</strong>.</p>
</li><li class=" "><p>Set the <strong class=" ">Type</strong> of the web part to <i class=" ">Data source</i> on the <strong class=" ">General</strong> tab.</p>
</li><li class=" "><p>On the <strong class=" ">Properties</strong> tab, define the following properties for the web part:<br><br></p>
<ul class=" "><li class=" "><p><strong class=" ">Field name</strong>: OrderBy</p>
</li><li class=" "><p><strong class=" ">Data type</strong>: Text</p>
</li><li class=" "><p><strong class=" ">Size</strong>: 500</p>
</li><li class=" "><p><strong class=" ">Field caption</strong>: SQL Order by clause</p>
</li><li class=" "><p><strong class=" ">Form control</strong>: Order by<br><br></p>
</li><li class=" "><p><strong class=" ">Field name</strong>: WhereCondition</p>
</li><li class=" "><p><strong class=" ">Data type</strong>: Text</p>
</li><li class=" "><p><strong class=" ">Size</strong>: 500</p>
</li><li class=" "><p><strong class=" ">Field caption</strong>: SQL Where condition</p>
</li><li class=" "><p><strong class=" ">Form control</strong>: Where condition<br><br></p>
</li><li class=" "><p><strong class=" ">Field name</strong>: FilterName</p>
</li><li class=" "><p><strong class=" ">Data type</strong>: Text</p>
</li><li class=" "><p><strong class=" ">Size</strong>: 200</p>
</li><li class=" "><p><strong class=" ">Field caption</strong>: Filter name</p>
</li><li class=" "><p><strong class=" ">Form control</strong>: Text box</p>
</li></ul></li></ol>    <h4 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Result</span></h4>
<p>The custom data source web part is now ready and you can try out its functionality.</p>
<p>Open the <strong class=" ">Pages</strong> application, create a new page and add the following web parts on the <strong class=" ">Design</strong> tab:</p>
    <div class="tablewrap">
        <table class="wrapped confluenceTable">
                    <colgroup>
                                    <col>
                                    <col>
                            </colgroup>
        <thead class=" ">    <tr>
            <td class="confluenceTh" rowspan="1" colspan="1">
    <p>Web part</p>
            </td>
                <td class="confluenceTh" rowspan="1" colspan="1">
    <p>Instructions</p>
            </td>
        </tr>
</thead><tfoot class=" "></tfoot><tbody class=" ">    <tr>
            <td class="confluenceTd" rowspan="1" colspan="1">
    <p>Custom user data source</p>
            </td>
                <td class="confluenceTd" rowspan="1" colspan="1">
    <p>Type <i class=" ">UsersFilter</i> into the <strong class=" ">Filter name</strong> property.</p>
            </td>
        </tr>
    <tr>
            <td class="confluenceTd" rowspan="1" colspan="1">
    <p>Users filter</p>
            </td>
                <td class="confluenceTd" rowspan="1" colspan="1">
    <p>Leave the default property values. The <strong class=" ">Web part control ID</strong> is set to <i class=" ">UsersFilter</i> by default, which connects the filter to the custom data source.</p>
            </td>
        </tr>
    <tr>
            <td class="confluenceTd" rowspan="1" colspan="1">
    <p>Basic repeater</p>
            </td>
                <td class="confluenceTd" rowspan="1" colspan="1">
    <ol class=" "><li class=" "><p>Enter the ID of the Custom user data source web part into the <strong class=" ">Data source name</strong> property: <i class=" ">CustomUserDataSource</i></p>
</li><li class=" "><p>Set an appropriate <strong class=" ">Transformation name</strong> for displaying users, for example: <i class=" ">Community.Transformations.MembersList</i></p>
</li></ol>            </td>
        </tr>
</tbody>        </table>
            </div>
<p>The page displays a list of all users in the system. You can modify the list by configuring the <i class=" ">SQL Where condition</i> and <i class=" ">SQL Order by clause</i> properties of the data source. Visitors can dynamically narrow down the list directly on the page using the connected filter.</p>
    <h3 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Example – Implementing data source caching</span></h3>
<p>This example builds on the previous one to add <a href="caching-the-data-of-page-components">caching</a> functionality for the retrieved data. Cached data does not need to be retrieved every time the page is requested, which increases the website performance and lowers database overhead.</p>
<p>To implement data source caching for the previous example, you need to:</p>
<ol class=" "><li class=" "><p>Add the following code to the <strong class=" ">DataSourceWebPart.ascx.cs</strong> file:</p>
    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                    <div class="title">DataSourceWebPart.ascx.cs</div>
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-title="DataSourceWebPart.ascx.cs" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="keyword">public</code><code class="plain"> </code><code class="keyword">partial</code><code class="plain"> </code><code class="keyword">class</code><code class="plain"> CMSGlobalFiles_DataSourceWebPart : CMSAbstractWebPart</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">&nbsp;</code></div>
<div class="line"><code class="plain">...</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">&nbsp;   </code><code class="comments">/// &lt;summary&gt;</code></div>
<div class="line"><code class="plain">    </code><code class="comments">/// Gets or sets the cache item name.</code></div>
<div class="line"><code class="plain">    </code><code class="comments">/// &lt;/summary&gt;</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">public</code><code class="plain"> </code><code class="keyword">override</code><code class="plain"> </code><code class="keyword">string</code><code class="plain"> CacheItemName</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">get</code></div>
<div class="line"><code class="plain">        {</code></div>
<div class="line"><code class="plain">            </code><code class="keyword">return</code><code class="plain"> </code><code class="keyword">base</code><code class="plain">.CacheItemName;</code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">set</code></div>
<div class="line"><code class="plain">        {</code></div>
<div class="line"><code class="plain">            </code><code class="keyword">base</code><code class="plain">.CacheItemName = value;</code></div>
<div class="line"><code class="plain">            srcUsers.CacheItemName = value;</code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">    </code><code class="comments">/// &lt;summary&gt;</code></div>
<div class="line"><code class="plain">    </code><code class="comments">/// Cache dependencies, each cache dependency on a new line.</code></div>
<div class="line"><code class="plain">    </code><code class="comments">/// &lt;/summary&gt;</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">public</code><code class="plain"> </code><code class="keyword">override</code><code class="plain"> </code><code class="keyword">string</code><code class="plain"> CacheDependencies</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">get</code></div>
<div class="line"><code class="plain">        {</code></div>
<div class="line"><code class="plain">            </code><code class="keyword">return</code><code class="plain"> ValidationHelper.GetString(</code><code class="keyword">base</code><code class="plain">.CacheDependencies, srcUsers.CacheDependencies);</code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">set</code></div>
<div class="line"><code class="plain">        {</code></div>
<div class="line"><code class="plain">            </code><code class="keyword">base</code><code class="plain">.CacheDependencies = value;</code></div>
<div class="line"><code class="plain">            srcUsers.CacheDependencies = value;</code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">	</code><code class="comments">/// &lt;summary&gt;</code></div>
<div class="line"><code class="plain">    </code><code class="comments">/// Gets or sets the cache minutes.</code></div>
<div class="line"><code class="plain">    </code><code class="comments">/// &lt;/summary&gt;</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">public</code><code class="plain"> </code><code class="keyword">override</code><code class="plain"> </code><code class="keyword">int</code><code class="plain"> CacheMinutes</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">get</code></div>
<div class="line"><code class="plain">        {</code></div>
<div class="line"><code class="plain">            </code><code class="keyword">return</code><code class="plain"> </code><code class="keyword">base</code><code class="plain">.CacheMinutes;</code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">set</code></div>
<div class="line"><code class="plain">        {</code></div>
<div class="line"><code class="plain">            </code><code class="keyword">base</code><code class="plain">.CacheMinutes = value;</code></div>
<div class="line"><code class="plain">            srcUsers.CacheMinutes = value;</code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">&nbsp;</code></div>
<div class="line"><code class="plain">...</code></div>
<div class="line"><code class="plain">&nbsp;</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
</li><li class=" "><p>Replace the <strong class=" ">SetupControl()</strong> method implementation (in <strong class=" ">DataSourceWebPart.ascx.cs</strong>) with the following:</p>
    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="keyword">protected</code><code class="plain"> </code><code class="keyword">void</code><code class="plain"> SetupControl()</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">if</code><code class="plain"> (</code><code class="keyword">this</code><code class="plain">.StopProcessing)</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        </code><code class="comments">// Does nothing if the web part is disabled</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">else</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">this</code><code class="plain">.srcUsers.WhereCondition = </code><code class="keyword">this</code><code class="plain">.WhereCondition;</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">this</code><code class="plain">.srcUsers.OrderBy = </code><code class="keyword">this</code><code class="plain">.OrderBy;</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">        </code><code class="comments">// Sets the inner data source's name according to the web part's 'Web part control ID' property.</code></div>
<div class="line"><code class="plain">        </code><code class="comments">// This allows listing web parts to connect to the inner control.</code></div>
<div class="line"><code class="plain">        </code><code class="comments">// The identifier property is named 'FilterName' because data sources inherit the property from </code></div>
<div class="line"><code class="plain">        </code><code class="comments">// a base class shared with filter objects.</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">this</code><code class="plain">.srcUsers.FilterName = (string)</code><code class="keyword">this</code><code class="plain">.GetValue(</code><code class="string">"WebPartControlID"</code><code class="plain">);</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">        </code><code class="comments">// Connects the attached filter, as specified by the 'Filter name' property of the web part</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">this</code><code class="plain">.srcUsers.SourceFilterName = </code><code class="keyword">this</code><code class="plain">.FilterName;</code></div>
<div class="line"><code class="plain">               </code></div>
<div class="line"><code class="plain">        </code><code class="keyword">this</code><code class="plain">.srcUsers.CacheItemName = </code><code class="keyword">this</code><code class="plain">.CacheItemName;</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">this</code><code class="plain">.srcUsers.CacheDependencies = </code><code class="keyword">this</code><code class="plain">.CacheDependencies;</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">this</code><code class="plain">.srcUsers.CacheMinutes = </code><code class="keyword">this</code><code class="plain">.CacheMinutes;            </code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
</li><li class=" "><p>(Optional) In <strong class=" ">DataSourceControl.ascx.cs</strong>, override the <strong class=" ">GetDefaultCacheKey()</strong> and <strong class=" ">GetDefaultCacheDependencies()</strong><strong class=" "> </strong>methods, generating the cache item name and cache dependencies, with your custom logic. The code sample below shows the default implementation of these methods for the <i class=" ">UsersDataSource</i> web part.</p>
    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">using CMS.Helpers;</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">...</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="comments">/// &lt;summary&gt;</code></div>
<div class="line"><code class="comments">/// Gets default cache key.</code></div>
<div class="line"><code class="comments">/// &lt;/summary&gt;</code></div>
<div class="line"><code class="keyword">protected</code><code class="plain"> override object[] GetDefaultCacheKey()</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> </code><code class="keyword">new</code><code class="plain"> object[] { </code><code class="string">"customuserdatasource"</code><code class="plain">, CacheHelper.BaseCacheKey, ClientID, WhereCondition, OrderBy};</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line">&nbsp;</div>
<div class="line">&nbsp;</div>
<div class="line"><code class="comments">/// &lt;summary&gt;</code></div>
<div class="line"><code class="comments">/// Gets the default cache dependencies for the data source.</code></div>
<div class="line"><code class="comments">/// &lt;/summary&gt;</code></div>
<div class="line"><code class="keyword">public</code><code class="plain"> override string GetDefaultCacheDependencies()</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    </code><code class="comments">// Get default dependencies</code></div>
<div class="line"><code class="plain">    string result = base.GetDefaultCacheDependencies();</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">    </code><code class="keyword">if</code><code class="plain"> (result != </code><code class="keyword">null</code><code class="plain">)</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        result += </code><code class="string">"\n"</code><code class="plain">;</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">    result += </code><code class="string">"cms.user|all"</code><code class="plain">;</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">    </code><code class="keyword">return</code><code class="plain"> result;</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
</li><li class=" "><p>If your Kentico project was installed as a web application, <strong class=" ">Build</strong> the project.</p>
</li><li class=" "><p>Open the <i class=" ">Custom user data source</i> web part in the<strong class=" "> Web parts</strong> application and switch to the <strong class=" ">Properties</strong> tab.</p>
</li><li class=" "><p>Click<strong class=" "> ...</strong> next to the <strong class=" ">New field</strong> button and select <strong class=" ">New category</strong>.</p>
</li><li class=" "><p>Enter <i class=" ">Data caching</i> as the <strong class=" ">Category caption</strong> and move the category below the existing properties.</p>
</li><li class=" "><p>Add the following fields under the category:<br><br></p>
<ul class=" "><li class=" "><p><strong class=" ">Field name</strong>: CacheItemName</p>
</li><li class=" "><p><strong class=" ">Data type</strong>: Text</p>
</li><li class=" "><p><strong class=" ">Size</strong>: 500</p>
</li><li class=" "><p><strong class=" ">Field caption</strong>: Cache item name</p>
</li><li class=" "><p><strong class=" ">Form control</strong>: Text box<br><br></p>
</li><li class=" "><p><strong class=" ">Field name</strong>: CacheMinutes</p>
</li><li class=" "><p><strong class=" ">Data type</strong>: Integer number</p>
</li><li class=" "><p><strong class=" ">Field caption</strong>: Cache minutes</p>
</li><li class=" "><p><strong class=" ">Form control</strong>: Text box<br><br></p>
</li><li class=" "><p><strong class=" ">Field name</strong>: CacheDependencies</p>
</li><li class=" "><p><strong class=" ">Data type</strong>: Long text</p>
</li><li class=" "><p><strong class=" ">Field caption</strong>: Cache dependencies</p>
</li><li class=" "><p><strong class=" ">Form control</strong>: Cache dependencies<br></p>
</li></ul></li><li class=" "><p>Insert the web part onto a page and set the values of the newly created fields to, for example, the following:<br><br></p>
<ul class=" "><li class=" "><p><strong class=" ">CacheItemName</strong>: CustomUserDataSourceCache</p>
</li><li class=" "><p><strong class=" ">CacheMinutes</strong>: 10</p>
</li><li class=" "><p><strong class=" ">CacheDependencies</strong>: cms.user|all</p>
</li></ul></li></ol><p>The data is now set to cache for a duration of 10 minutes (controlled by the <strong class=" ">CacheMinutes</strong> field) and any changes to <strong class=" ">cms.user </strong>objects<a href="setting-cache-dependencies">&nbsp;automatically invalidate the cache</a> (controlled by the <strong class=" ">CacheDependencies</strong> field).</p>
        </div>

    </article>


               
            
    <footer id="ht-footer">
    <a href="#" id="ht-jump-top" class="sp-aui-icon-small sp-aui-iconfont-arrows-up"></a>
</footer></div>

<div>
    <div id="ht-mq-detect"></div>
</div>

    <script src="js/lunr.js"></script>
    <script src="js/lunr-extras.js"></script>
    <script src="assets/js/scroll-search.js"></script>

    <script src="assets/js/expand-macro.js"></script>


</body></html>