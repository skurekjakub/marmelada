<!DOCTYPE html><html><head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Integrating Google Analytics Enhanced Ecommerce - Kentico 11 Documentation</title>

    
    <link rel="stylesheet" href="assets/css/expand-macro.css">

            <meta name="scroll-content-language-key" content="">
    
    <meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=2.0, user-scalable=yes">

<script type="text/javascript" src="assets/js/jquery.min.js"></script>
<script type="text/javascript" src="assets/js/jquery.scrollTo.min.js"></script>


<script type="text/javascript" src="assets/js/translate.js"></script>

<script type="text/javascript" src="assets/js/theme.main.js"></script>

    <script type="text/javascript" src="assets/js/iframeResizer.min.js"></script>

<link rel="stylesheet" href="assets/css/content-style.css">
    <link rel="stylesheet" href="assets/css/search.css">

<link rel="stylesheet" href="assets/css/theme.main.css">
<link rel="stylesheet" href="assets/css/theme.colors.css">

            <!-- ES5 support for older browsers, needed by lunr -->
        <script src="js/augment.js"></script> 
        <script id="worker" type="javascript/worker">

        startIndex = function() {
            idx = lunr.Index.load(lunrIndex);
            idx.pipeline.remove(lunr.stopWordFilter);
            postMessage({type: "setup-complete"});
        }

        onmessage = function (event) {
            var message = event.data;

            if ((message.type === 'setup') && message.baseUrl) {
                var url = message.baseUrl;
                importScripts(url + 'js/lunr.js');
                importScripts(url + 'js/lunr-extras.js');
                importScripts(url + 'js/lunr-index.js');
                importScripts(url + 'js/lunr-data.js');
                startIndex();
            }

            if (idx && (message.type === 'search-request') && message.query) {
                var searchWord = message.query;
                var results = idx.search(searchWord).map(function (result) {
                    return lunrData.filter(function (d) {
                        return d.id === parseInt(result.ref, 10)
                    })[0]
                });
                postMessage({type: 'search-results', results: results, query: searchWord, queryId: message.queryId});
            }
        }

    </script>
    </head>

<body pageid="68879260" elementpageid="76843852">

<div id="ht-loader">
    <noscript>
        <p style="width: 100%; text-align:center; position: absolute; margin-top: 200px;">This content cannot be displayed without JavaScript.<br>Please enable JavaScript and reload the page.</p>
    </noscript>
</div>

<div>
   	<header id="ht-headerbar">
    <div class="ht-headerbar-left">
        <a href="" id="ht-menu-toggle" class="sp-aui-icon-small sp-aui-iconfont-appswitcher"></a>
    </div>
    <div class="ht-headerbar-right">
            <div class="sp-aui-icon-small ht-search-index-loader ht-header-icon"></div>

        <div id="ht-search">
            <div class="ht-search-input" style="display: none;">
              	<a href="#" class="sp-aui-icon-small sp-aui-iconfont-remove ht-search-clear"></a>

                <form action="#" method="GET" id="search">
                    <input class="search-input" type="text" placeholder="Search" tabindex="-1" autocomplete="off" name="q" value="">
                    <input type="hidden" name="max" value="15">
                    <input type="submit" style="display:none" tabindex="-4">
                </form>

                <a href="#" id="ht-search-button" class="ht-header-icon ht-header-icon-svg">
                                        <svg width="40px" height="40px" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                        <g>
                            <path d="M29.572,28.802 L28.801,29.571 C28.515,29.857 28.187,30 27.816,30 C27.445,30 27.116,29.857 26.831,29.571 L21.392,24.134 C20.193,24.762 18.908,25.076 17.538,25.076 C15.396,25.076 13.605,24.348 12.163,22.892 C10.721,21.436 10,19.651 10,17.538 C10,15.397 10.721,13.605 12.163,12.163 C13.605,10.721 15.396,10 17.538,10 C19.651,10 21.434,10.721 22.89,12.163 C24.347,13.605 25.075,15.397 25.075,17.538 C25.075,18.937 24.761,20.222 24.132,21.393 L29.572,26.832 C29.857,27.118 30,27.446 30,27.817 C30,28.188 29.857,28.517 29.572,28.802 L29.572,28.802 Z M13.662,21.414 C14.732,22.485 16.024,23.02 17.538,23.02 C19.051,23.02 20.343,22.485 21.413,21.414 C22.484,20.344 23.019,19.052 23.019,17.538 C23.019,16.025 22.484,14.733 21.413,13.662 C20.343,12.592 19.051,12.056 17.538,12.056 C16.024,12.056 14.732,12.592 13.662,13.662 C12.591,14.733 12.056,16.025 12.056,17.538 C12.056,19.052 12.591,20.344 13.662,21.414 L13.662,21.414 Z"></path>
                        </g>
                    </svg>
              	</a>

                <div class="ht-search-dropdown ht-dropdown">
                    <ul></ul>
                </div>
            </div>
        </div>
    </div>
    </header>   	<aside id="ht-sidebar">
    <div class="ht-sidebar-content">
        <div class="ht-sidebar-content-scroll-container">
            <header class="ht-sidebar-header">
                <h1 class="ht-logo">
                    <span class="ht-logo-label">K11</span>
                    <img class="space-logo" src="global.logo">
                </h1>
                <a href="Kentico-11-Documentation-Home.html" class="ht-space-link">
                    <h2>Kentico 11 Documentation</h2>
                </a>
            </header>
                            <iframe id="ht-nav" src="toc.html?pageId=76843852"></iframe>
                <script>
                    $('iframe#ht-nav').iFrameResize(
                            { 'log': true, 'autoResize': true, 'heightCalculationMethod': 'lowestElement', 'checkOrigin': false });
                </script>
                    </div>
    </div>

</aside></div>

<div id="ht-wrap-container">

            
    <div id="ht-sidebar-dragbar">
    <div class="ht-sidebar-drag-handle">
        <span class="drag-handle-1"></span>
        <span class="drag-handle-2"></span>
        <span class="drag-handle-3"></span>
    </div>
</div>
    <article id="ht-content" class="ht-content">
        <header class="ht-content-header">
            <div id="ht-breadcrumb">
    <ul>
        <li><a href="Kentico-11-Documentation-Home.html">Kentico 11 Documentation</a></li>
                                                                                                             <li><a href="" onclick="$('.shortcut').each(function(){$(this).removeClass('shortcut')}); $(this).parent().addClass('shortcut'); return false;">...</a> </li>
                                        <li class="shortcut"><a href="E-commerce-features.html">E-commerce features</a></li>
                                                                                     <li><a href="Customizing-and-developing-your-store.html">Customizing and developing your store</a></li>
                                                            </ul>
</div>            <h1 id="src-76843852"> <span>Integrating Google Analytics Enhanced Ecommerce</span></h1>
        </header>

        <div id="main-content" class="wiki-content sp-grid-section" data-index-for-search="true">
<div class="sp-grid-section"><div class="sp-grid-cell sp-grid-60"><p>By using the Google Analytics Enhanced Ecommerce features, you can measure and analyze shopping activity on your website (product impressions, purchases, etc.). Kentico provides functionality that helps get the data of products and purchases in a format suitable for logging via Google Analytics.</p><p>Visit the <a class="external-link" href="http://www.google.com/analytics">Google Analytics website</a> to set up a Google Analytics account for the website that you wish to monitor.</p><div class="confbox admonition admonition-info">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p><strong class=" ">MVC websites</strong></p>
<p>The information on this page applies to e-commerce sites developed using the <a href="developing-websites-using-the-portal-engine">portal engine</a>.</p>
<p>If you are developing your on-line store using ASP.NET MVC, see: <a href="google-analytics-enhanced-ecommerce-on-mvc-sites">Google Analytics Enhanced Ecommerce on MVC sites</a></p>
        </div>
    </div><div class="sp-grid-section"></div></div><div class="sp-grid-cell sp-grid-40 sp-grid-sidebar"><div class="confbox panel">
            <div class="title panel-header">On this page</div>
            <div class="panel-content">
<p></p>
<ul class="toc-indentation "><li class=" "><p><a href="#src-76843852_integratinggoogleanalyticsenhancedecommerce-addinggoogletagmanager">Adding Google Tag Manager</a></p>
</li><li class=" "><p><a href="#src-76843852_integratinggoogleanalyticsenhancedecommerce-collectinge-commercedata">Collecting e-commerce data</a></p>
<ul class="toc-indentation "><li class=" "><p><a href="#src-76843852_integratinggoogleanalyticsenhancedecommerce-productimpressions">Product impressions</a></p>
</li><li class=" "><p><a href="#src-76843852_integratinggoogleanalyticsenhancedecommerce-productclicks">Product clicks</a></p>
</li><li class=" "><p><a href="#src-76843852_integratinggoogleanalyticsenhancedecommerce-viewsofproductdetails">Views of product details</a></p>
</li><li class=" "><p><a href="#src-76843852_integratinggoogleanalyticsenhancedecommerce-checkoutsteps">Checkout steps</a></p>
</li><li class=" "><p><a href="#src-76843852_integratinggoogleanalyticsenhancedecommerce-purchases">Purchases</a></p>
</li></ul></li></ul><p></p>
        </div>
    </div></div></div>

    
    
    <h3 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Adding Google Tag Manager</span></h3>
<p>Before you can start measuring e-commerce activities, you need to add Google Tag Manager to the pages of your website:</p>
<ol class=" "><li class=" "><p>Open the <strong class=" ">Pages</strong> application in Kentico.</p>
</li><li class=" "><p>Select the root page of your site's content tree.</p>
</li><li class=" "><p>Open the <strong class=" ">Master page</strong> tab (in <strong class=" ">Edit</strong> mode).</p>
</li><li class=" "><p>Copy the snippets from the <a class="external-link" href="https://developers.google.com/tag-manager/quickstart">Google Tag Manager Quick Start Guide</a> into the master page content.<br></p>
<ul class=" "><li class=" "><p>Use the appropriate areas to add the snippets into the <i class=" ">&lt;head&gt;</i> tag and after the opening <i class=" ">&lt;body&gt;</i> tag.</p>
</li></ul></li><li class=" "><p>Click <strong class=" ">Save</strong>.</p>
</li></ol>    <div class="confbox admonition admonition-note">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p><strong class=" ">Note</strong>: You need to repeat the process for any additional master pages that do not inherit content from the site's root page (if you wish to use Google Analytics tracking in the website subsections under the given master pages).</p>
        </div>
    </div>
<p>You can now start collecting your site's e-commerce data and tracking events using Google Analytics. See the following sections for more information about setting up individual types of tracking.</p>
    <h3 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Collecting e-commerce data</span></h3>
<p>We recommend using a <a class="external-link" href="https://developers.google.com/tag-manager/devguide">data layer</a> to collect and send data to Google Analytics. For detailed information, see the <a class="external-link" href="https://developers.google.com/tag-manager/enhanced-ecommerce">Enhanced Ecommerce (UA) Developer Guide</a>.</p>
<p>Kentico provides the following <a href="reference---macro-methods">macro methods</a> that allow you to get the appropriate JSON data, which you can push into the data layer:</p>
<ul class=" "><li class=" "><p><strong class=" ">GetGtmProductJson</strong> – returns data for a specified product. Provides the following fields by default: <i class=" ">id</i> (the product's <i class=" ">SKU</i> value), <i class=" ">name</i>, <i class=" ">price</i> and <i class=" ">brand</i></p>
    <div class="confbox admonition admonition-info">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p>The <i class=" ">GetGtmProductJson</i> method is available for both <a href="reference---macro-methods">macros</a> (for<i class=" "> Text / XML</i> transformations and general usage in the Kentico administration interface) and <a href="reference---transformation-methods">ASCX transformations</a>. The method's ASCX transformation variant always returns data for the currently transformed product.</p>
        </div>
    </div>
    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                    <div class="title">Example of returned JSON data</div>
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-title="Example of returned JSON data" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">  </code><code class="string">"id"</code><code class="plain"> : </code><code class="string">"AER-AP"</code><code class="plain">,</code></div>
<div class="line"><code class="plain">  </code><code class="string">"name"</code><code class="plain"> : </code><code class="string">"AeroPress"</code><code class="plain">,</code></div>
<div class="line"><code class="plain">  </code><code class="string">"price"</code><code class="plain"> : 18.12,</code></div>
<div class="line"><code class="plain">  </code><code class="string">"brand"</code><code class="plain"> : </code><code class="string">"Aerobie"</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
</li><li class=" "><p><strong class=" ">GetGtmShoppingCartItemsJson</strong> – returns data for all products in the current shopping cart. By default, provides the same fields as the <i class=" ">GetGtmProductJson</i> method and also adds the unit <i class=" ">quantity</i> for each product.</p>
    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                    <div class="title">Example of returned JSON data</div>
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-title="Example of returned JSON data" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">[{</code></div>
<div class="line"><code class="plain">  </code><code class="string">"name"</code><code class="plain">: </code><code class="string">"Anfim Super Caimano"</code><code class="plain">,</code></div>
<div class="line"><code class="plain">  </code><code class="string">"id"</code><code class="plain">: </code><code class="string">"ANF-GR-CAIMANO"</code><code class="plain">,</code></div>
<div class="line"><code class="plain">  </code><code class="string">"price"</code><code class="plain">: 1245.92,</code></div>
<div class="line"><code class="plain">  </code><code class="string">"brand"</code><code class="plain">: </code><code class="string">"Anfim"</code><code class="plain">,</code></div>
<div class="line"><code class="plain">  </code><code class="string">"quantity"</code><code class="plain">: 1</code></div>
<div class="line"><code class="plain">},</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">  </code><code class="string">"name"</code><code class="plain">: </code><code class="string">"Colombia Carlos Imbachi (16 oz)"</code><code class="plain">,</code></div>
<div class="line"><code class="plain">  </code><code class="string">"id"</code><code class="plain">: </code><code class="string">"CO-COL-IMBACHI-16-OZ"</code><code class="plain">,</code></div>
<div class="line"><code class="plain">  </code><code class="string">"price"</code><code class="plain">: 14,</code></div>
<div class="line"><code class="plain">  </code><code class="string">"brand"</code><code class="plain">: </code><code class="string">"SA Coffee"</code><code class="plain">,</code></div>
<div class="line"><code class="plain">  </code><code class="string">"quantity"</code><code class="plain">: 4</code></div>
<div class="line"><code class="plain">}]</code></div>
</div>
    </div>
</li><li class=" "><p><strong class=" ">GetGtmPurchaseJson</strong> – returns data representing completed orders (purchases). Provides the following JSON data by default:</p>
<ul class=" "><li class=" "><p><i class=" ">actionField</i> object representing the overall purchase, with the following fields:</p>
<ul class=" "><li class=" "><p><i class=" ">id</i> (the integer ID of the Kentico order object)</p>
</li><li class=" "><p><i class=" ">revenue</i> (the order's <i class=" ">GrandTotal</i> value, i.e. the final price including discounts, shipping, tax, and reductions from applied <a href="working-with-gift-cards">gift cards</a>)<i class=" "><br></i></p>
</li><li class=" "><p><i class=" ">shipping</i><i class=" "><br></i></p>
</li><li class=" "><p><i class=" ">tax</i></p>
</li></ul></li><li class=" "><p><i class=" ">products</i> object containing all products within the order (the product data format is the same as provided by the <i class=" ">GetGtmShoppingCartItemsJson</i> method)</p>
</li></ul>    <div class="confbox admonition admonition-note">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p><strong class=" ">Important</strong>: The <i class=" ">GetGtmPurchaseJson</i> method only works on the page that you display to customers after they go through your website's <a href="configuring-steps-of-the-checkout-process">checkout process</a> (the page specified by the <strong class=" ">Final step URL</strong> property of your site's <strong class=" ">Page wizard manager</strong> web part, typically a payment page or "thank you" page).</p>
        </div>
    </div>
    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                    <div class="title">Example of returned JSON data</div>
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-title="Example of returned JSON data" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">  </code><code class="string">"actionField"</code><code class="plain">: {</code></div>
<div class="line"><code class="plain">    </code><code class="string">"id"</code><code class="plain">: 123,</code></div>
<div class="line"><code class="plain">    </code><code class="string">"revenue"</code><code class="plain">: 1376.68,</code></div>
<div class="line"><code class="plain">    </code><code class="string">"shipping"</code><code class="plain">: 0,</code></div>
<div class="line"><code class="plain">    </code><code class="string">"tax"</code><code class="plain">: 74.76</code></div>
<div class="line"><code class="plain">  },</code></div>
<div class="line"><code class="plain">  </code><code class="string">"products"</code><code class="plain">: [{</code></div>
<div class="line"><code class="plain">    </code><code class="string">"name"</code><code class="plain">: </code><code class="string">"Anfim Super Caimano"</code><code class="plain">,</code></div>
<div class="line"><code class="plain">    </code><code class="string">"id"</code><code class="plain">: </code><code class="string">"ANF-GR-CAIMANO"</code><code class="plain">,</code></div>
<div class="line"><code class="plain">    </code><code class="string">"price"</code><code class="plain">: 1245.92,</code></div>
<div class="line"><code class="plain">    </code><code class="string">"brand"</code><code class="plain">: </code><code class="string">"Anfim"</code><code class="plain">,</code></div>
<div class="line"><code class="plain">    </code><code class="string">"quantity"</code><code class="plain">: 1</code></div>
<div class="line"><code class="plain">    },</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">    </code><code class="string">"name"</code><code class="plain">: </code><code class="string">"Colombia Carlos Imbachi (16 oz)"</code><code class="plain">,</code></div>
<div class="line"><code class="plain">    </code><code class="string">"id"</code><code class="plain">: </code><code class="string">"CO-COL-IMBACHI-16-OZ"</code><code class="plain">,</code></div>
<div class="line"><code class="plain">    </code><code class="string">"price"</code><code class="plain">: 14,</code></div>
<div class="line"><code class="plain">    </code><code class="string">"brand"</code><code class="plain">: </code><code class="string">"SA Coffee"</code><code class="plain">,</code></div>
<div class="line"><code class="plain">    </code><code class="string">"quantity"</code><code class="plain">: 4</code></div>
<div class="line"><code class="plain">  }]</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
</li></ul>    <div class="confbox admonition admonition-info">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p><strong class=" ">Customizing the returned JSON data</strong></p>
<p>By default, the listed methods do not set all of the optional fields that can be processed by Google Analytics. You can extend the returned data by calling the methods with an additional parameter containing a JSON string. The string is then processed and merged into the resulting JSON data.</p>
<p>For example, the following macro returns JSON data for a specified product, including the default fields (<i class=" ">id</i>, <i class=" ">name</i>, <i class=" ">price</i>, <i class=" ">brand</i>) and an additional <i class=" ">list</i> field:</p>
    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">{% GetGtmProductJson(SKUID, </code><code class="string">"{'list' : 'Search Results'}"</code><code class="plain"> %}</code></div>
</div>
    </div>
<p>If you require more advanced modifications, developers can fully customize how the system creates the JSON data for products and orders.</p>
<p>See: <a href="customizing-e-commerce-data-for-google-analytics">Customizing e-commerce data for Google Analytics</a></p>
        </div>
    </div>
<p>Use the methods to create a Google Analytics implementation that suits the purposes of your website. The following sections contain best practices for various types of e-commerce tracking on Kentico portal engine sites:</p>
<p></p>
<ul class="toc-indentation "><li class=" "><p><a href="#src-76843852_integratinggoogleanalyticsenhancedecommerce-productimpressions">Product impressions</a></p>
</li><li class=" "><p><a href="#src-76843852_integratinggoogleanalyticsenhancedecommerce-productclicks">Product clicks</a></p>
</li><li class=" "><p><a href="#src-76843852_integratinggoogleanalyticsenhancedecommerce-viewsofproductdetails">Views of product details</a></p>
</li><li class=" "><p><a href="#src-76843852_integratinggoogleanalyticsenhancedecommerce-checkoutsteps">Checkout steps</a></p>
</li><li class=" "><p><a href="#src-76843852_integratinggoogleanalyticsenhancedecommerce-purchases">Purchases</a></p>
</li></ul><p></p>
    <h4 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Product impressions</span></h4>
<p>To log impressions of products displayed to visitors:</p>
<ol class=" "><li class=" "><p>Edit the <a href="writing-transformations">transformations</a> that you use to display products on your website.</p>
</li><li class=" "><p>Identify a suitable HTML element wrapping the content of individual products within the transformation code and use the <strong class=" ">GetGtmProductJson</strong> method to add the product JSON data into a <a class="external-link" href="https://www.w3schools.com/tags/att_global_data.asp">data attribute</a>.</p>
    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                    <div class="title">Text / XML transformation example </div>
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-title="Text / XML transformation example " data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">&lt;</code><code class="keyword">article</code><code class="plain"> </code><code class="color1">class</code><code class="plain">=</code><code class="string">"product-tile"</code><code class="plain"> </code><code class="color1">data-gtm-product</code><code class="plain">=</code><code class="string">'{% GetGtmProductJson(SKUID) %}'</code><code class="plain">&gt;</code></div>
</div>
    </div>
    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                    <div class="title">ASCX transformation example </div>
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-title="ASCX transformation example " data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">&lt;</code><code class="keyword">article</code><code class="plain"> </code><code class="color1">class</code><code class="plain">=</code><code class="string">"product-tile"</code><code class="plain"> data-gtm-product='&lt;%# GetGtmProductJson() %&gt;'&gt;</code></div>
</div>
    </div>
    <div class="confbox admonition admonition-note">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p><strong class=" ">Note</strong>: Use single quotes to enclose the values of the data attribute to ensure that the returned JSON value containing double quotes is processed correctly.</p>
        </div>
    </div>
</li><li class=" "><p>Add the <strong class=" ">Javascript</strong> <a href="using-and-configuring-web-parts">web part</a> onto the templates of pages that display products.</p>
</li><li class=" "><p>Run a script that collects the values of the product data attributes and pushes them into the data layer. For example, configure the web part in the following way:</p>
<ul class=" "><li class=" "><p><strong class=" ">In-line script</strong>:</p>
    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">document.addEventListener(</code><code class="string">"DOMContentLoaded"</code><code class="plain">, </code><code class="keyword">function</code><code class="plain">(event) {</code></div>
<div class="line"><code class="plain">  let productElements = document.getElementsByClassName(</code><code class="string">"product-tile"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">  let gtmJsonProductImpressions = [];</code></div>
<div class="line"><code class="plain">  </code><code class="keyword">for</code><code class="plain"> (let i=0;i&lt;productElements.length;i++) {</code></div>
<div class="line"><code class="plain">    gtmJsonProductImpressions.push(productElements[i].getAttribute(</code><code class="string">"data-gtm-product"</code><code class="plain">));</code></div>
<div class="line"><code class="plain">  }</code></div>
<div class="line"><code class="plain">  </code><code class="keyword">if</code><code class="plain"> (gtmJsonProductImpressions.length &gt; 0) {</code></div>
<div class="line"><code class="plain">    dataLayer.push({</code></div>
<div class="line"><code class="plain">	  </code><code class="string">"ecommerce"</code><code class="plain">: {</code></div>
<div class="line"><code class="plain">	    </code><code class="string">"currencyCode"</code><code class="plain">: </code><code class="string">"{% ECommerceContext.CurrentCurrency.CurrencyCode %}"</code><code class="plain">,</code></div>
<div class="line"><code class="plain">        </code><code class="string">"impressions"</code><code class="plain">: gtmJsonProductImpressions</code></div>
<div class="line"><code class="plain">      }</code></div>
<div class="line"><code class="plain">    });</code></div>
<div class="line"><code class="plain">  }</code></div>
<div class="line"><code class="plain">});</code></div>
</div>
    </div>
</li><li class=" "><p><strong class=" ">In-line script page location</strong>: Startup script <i class=" ">(renders the script tag near the end of the page's &lt;body&gt; content)</i></p>
</li><li class=" "><p><strong class=" ">Generate script tags</strong>: yes (checked)</p>
</li></ul></li></ol>    <h4 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Product clicks</span></h4>
<p>To log clicks of product links:</p>
<ol class=" "><li class=" "><p>Define a JavaScript function for the pages containing product links (for example using the <strong class=" ">Javascript</strong> <a href="using-and-configuring-web-parts">web part</a> or by linking an external .js file).</p>
<ul class=" "><li class=" "><p>Within the function, push the product data into the data layer. The function must have parameters containing the product JSON data and the URL of the clicked link.</p>
</li><li class=" "><p>Use the <i class=" ">eventCallback</i> datalayer variable to perform redirection after the product data is sent to Google Analytics.</p>
    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                    <div class="title">Function example</div>
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-title="Function example" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="keyword">function</code><code class="plain"> productClick(productJson, link) {</code></div>
<div class="line"><code class="plain">  dataLayer.push({</code></div>
<div class="line"><code class="plain">    </code><code class="string">"event"</code><code class="plain">: </code><code class="string">"productClick"</code><code class="plain">,</code></div>
<div class="line"><code class="plain">    </code><code class="string">"ecommerce"</code><code class="plain">: {</code></div>
<div class="line"><code class="plain">      </code><code class="string">"click"</code><code class="plain">: {</code></div>
<div class="line"><code class="plain">        </code><code class="string">"actionField"</code><code class="plain">: {</code><code class="string">"list"</code><code class="plain"> : </code><code class="string">"Search Results"</code><code class="plain">},</code></div>
<div class="line"><code class="plain">        </code><code class="string">"products"</code><code class="plain">: [productJson]</code></div>
<div class="line"><code class="plain">      }</code></div>
<div class="line"><code class="plain">    },</code></div>
<div class="line"><code class="plain">    </code><code class="string">"eventCallback"</code><code class="plain">: </code><code class="keyword">function</code><code class="plain"> () {</code></div>
<div class="line"><code class="plain">      document.location.href = link;</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">  });</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
</li></ul></li><li class=" "><p>Add an <strong class=" ">onclick</strong> script to your product links (for example within product list <a href="writing-transformations">transformations</a>) and call the defined product click function.</p>
<ul class=" "><li class=" "><p>Use the <strong class=" ">GetGtmProductJson</strong> method to get the JSON data of the clicked product, either directly in the <i class=" ">onclick</i> attribute or get the value from a <a class="external-link" href="https://www.w3schools.com/tags/att_global_data.asp">data attribute</a> of a related product element.</p>
    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                    <div class="title">Text / XML transformation example </div>
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-title="Text / XML transformation example " data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">&lt;</code><code class="keyword">article</code><code class="plain"> </code><code class="color1">class</code><code class="plain">=</code><code class="string">"product-tile"</code><code class="plain"> </code><code class="color1">data-gtm-product</code><code class="plain">=</code><code class="string">'{% GetGtmProductJson(SKUID) %}'</code><code class="plain">&gt;</code></div>
<div class="line"><code class="plain">  &lt;</code><code class="keyword">a</code><code class="plain"> </code><code class="color1">href</code><code class="plain">=</code><code class="string">"{% GetDocumentUrl() %}"</code><code class="plain"> </code><code class="color1">onclick</code><code class="plain">=</code><code class="string">'productClick(this.parentNode.getAttribute("data-gtm-product"), "{% GetDocumentUrl() %}" );return false;'</code><code class="plain">&gt;</code></div>
<div class="line"><code class="plain">    ...</code></div>
<div class="line"><code class="plain">  &lt;/</code><code class="keyword">a</code><code class="plain">&gt;  </code></div>
<div class="line"><code class="plain">&lt;/</code><code class="keyword">article</code><code class="plain">&gt;</code></div>
</div>
    </div>
    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                    <div class="title">ASCX transformation example </div>
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-title="ASCX transformation example " data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">&lt;</code><code class="keyword">article</code><code class="plain"> </code><code class="color1">class</code><code class="plain">=</code><code class="string">"product-tile"</code><code class="plain"> data-gtm-product='&lt;%# GetGtmProductJson() %&gt;'&gt;</code></div>
<div class="line"><code class="plain">  &lt;</code><code class="keyword">a</code><code class="plain"> href="&lt;%# GetDocumentUrl() %&gt;" onclick='productClick(this.parentNode.getAttribute("data-gtm-product"), "&lt;%# GetDocumentUrl() %&gt;" );return false;'&gt;</code></div>
<div class="line"><code class="plain">    ...</code></div>
<div class="line"><code class="plain">  &lt;/</code><code class="keyword">a</code><code class="plain">&gt;</code></div>
<div class="line"><code class="plain">&lt;/</code><code class="keyword">article</code><code class="plain">&gt;</code></div>
</div>
    </div>
</li></ul></li></ol>    <h4 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Views of product details</span></h4>
<p>To log views of product detail pages by visitors:</p>
<ol class=" "><li class=" "><p>Edit the <a href="writing-transformations">transformations</a> that you use to display product details on your website.</p>
</li><li class=" "><p>Add a script tag to the end of the transformation, and write a script that pushes the product data into the data layer. Use the <strong class=" ">GetGtmProductJson</strong> method to get the JSON data of the transformed product.</p>
    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                    <div class="title">ASCX transformation example </div>
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-title="ASCX transformation example " data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">...</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">&lt;script type=</code><code class="string">"text/javascript"</code><code class="plain">&gt;</code></div>
<div class="line"><code class="plain">document.addEventListener(</code><code class="string">"DOMContentLoaded"</code><code class="plain">, function (event) {    </code></div>
<div class="line"><code class="plain">  dataLayer.push({</code></div>
<div class="line"><code class="plain">    </code><code class="string">"ecommerce"</code><code class="plain">: {</code></div>
<div class="line"><code class="plain">      </code><code class="string">"detail"</code><code class="plain"> : {</code></div>
<div class="line"><code class="plain">        </code><code class="string">"actionField"</code><code class="plain">: {</code><code class="string">"list"</code><code class="plain">: </code><code class="string">"Gallery"</code><code class="plain">},</code></div>
<div class="line"><code class="plain">        </code><code class="string">"products"</code><code class="plain">: [&lt;%# GetGtmProductJson() %&gt;]</code></div>
<div class="line"><code class="plain">      }</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">  });</code></div>
<div class="line"><code class="plain">});</code></div>
<div class="line"><code class="plain">&lt;/script&gt;</code></div>
</div>
    </div>
</li></ol>    <h4 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Checkout steps</span></h4>
<p>To log progress of visitors through the steps of your website's checkout process:</p>
<ol class=" "><li class=" "><p>Open the <strong class=" ">Pages</strong> application.</p>
</li><li class=" "><p>Locate the pages that define the <a href="configuring-steps-of-the-checkout-process">steps of your site's checkout process</a>.</p>
</li><li class=" "><p>Add the <strong class=" ">Javascript</strong> <a href="using-and-configuring-web-parts">web part</a> to the first checkout step where modifications of the shopping cart content are no longer allowed.</p>
</li><li class=" "><p>Run a script that pushes the required checkout data into the data layer, including the shopping cart's product data. Use the <strong class=" ">GetGtmShoppingCartItemsJson</strong> method to get the JSON data of the products in the current shopping cart. For example, configure the web part in the following way:</p>
<ul class=" "><li class=" "><p><strong class=" ">In-line script</strong>:</p>
    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">document.addEventListener(</code><code class="string">"DOMContentLoaded"</code><code class="plain">, </code><code class="keyword">function</code><code class="plain">(event) {</code></div>
<div class="line"><code class="plain">  dataLayer.push({</code></div>
<div class="line"><code class="plain">    </code><code class="string">"event"</code><code class="plain">: </code><code class="string">"checkout"</code><code class="plain">,</code></div>
<div class="line"><code class="plain">    </code><code class="string">"ecommerce"</code><code class="plain">: {</code></div>
<div class="line"><code class="plain">      </code><code class="string">"checkout"</code><code class="plain">: {</code></div>
<div class="line"><code class="plain">        </code><code class="string">"actionField"</code><code class="plain">: {</code><code class="string">"step"</code><code class="plain">: 1},</code></div>
<div class="line"><code class="plain">        </code><code class="string">"products"</code><code class="plain">: {% GetGtmShoppingCartItemsJson() %} </code></div>
<div class="line"><code class="plain">      }</code></div>
<div class="line"><code class="plain">    }   </code></div>
<div class="line"><code class="plain">  });</code></div>
<div class="line"><code class="plain">});</code></div>
</div>
    </div>
</li><li class=" "><p><strong class=" ">In-line script page location</strong>: Startup script <i class=" ">(renders the script tag near the end of the page's &lt;body&gt; content)</i></p>
</li><li class=" "><p><strong class=" ">Generate script tags</strong>: yes (checked)</p>
</li></ul></li><li class=" "><p>Add the <strong class=" ">Javascript</strong> web part to the remaining checkout steps.</p>
</li><li class=" "><p>For each step, run a script that pushes the required checkout data into the data layer, but without including the <i class=" ">products</i> field. For example:</p>
    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">document.addEventListener(</code><code class="string">"DOMContentLoaded"</code><code class="plain">, </code><code class="keyword">function</code><code class="plain">(event) {</code></div>
<div class="line"><code class="plain">  dataLayer.push({</code></div>
<div class="line"><code class="plain">    </code><code class="string">"event"</code><code class="plain">: </code><code class="string">"checkout"</code><code class="plain">,</code></div>
<div class="line"><code class="plain">    </code><code class="string">"ecommerce"</code><code class="plain">: {</code></div>
<div class="line"><code class="plain">      </code><code class="string">"checkout"</code><code class="plain">: {</code></div>
<div class="line"><code class="plain">        </code><code class="string">"actionField"</code><code class="plain">: {</code></div>
<div class="line"><code class="plain">          </code><code class="string">"step"</code><code class="plain">: 2,</code></div>
<div class="line"><code class="plain">         &nbsp;</code><code class="string">"option"</code><code class="plain"> : </code><code class="string">"{% ECommerceContext.CurrentShoppingCart.ShippingOption.ShippingOptionDisplayName %}"</code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line"><code class="plain">      }</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">  });</code></div>
<div class="line"><code class="plain">});</code></div>
</div>
    </div>
</li></ol>    <h4 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Purchases</span></h4>
<p>To log purchases (i.e. completed <a href="orders">orders</a>) on your website:</p>
<ol class=" "><li class=" "><p>Open the <strong class=" ">Pages</strong> application.</p>
</li><li class=" "><p>Select the page that you display to customers after they go through your website's <a href="configuring-steps-of-the-checkout-process">checkout process</a> (i.e. the page specified by the <strong class=" ">Final step URL</strong> property of your site's <strong class=" ">Page wizard manager</strong> web part, typically a payment page or "thank you" page).</p>
</li><li class=" "><p>Ensure that the page has the context of the completed order after a customer makes a purchase. The system provides this context using the <strong class=" ">o</strong> parameter in the URL query string (the parameter's value is a hash, not the actual ID of the related order).</p>
<ul class=" "><li class=" "><p>If you log the purchase directly on the page specified as the <i class=" ">Final step URL</i> of your site's checkout process, you do not need to make any adjustments.</p>
</li><li class=" "><p>If you want to log the purchase at a later point, you need to propagate the <i class=" ">o</i> query string parameter to the given page. For example, if your <i class=" ">Final step URL</i> leads to a payment page containing the <strong class=" ">Payment form</strong> web part, and you want to log the purchase on the page specified in the web part's <strong class=" ">Thank you page URL</strong> property, you can include the <i class=" ">o</i> parameter by adding the following macro to the URL value:</p>
    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                    <div class="title">Example - Thank you page URL</div>
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-title="Example - Thank you page URL" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">~/Order-Completed{% </code><code class="keyword">if</code><code class="plain"> (!String.IsNullOrEmpty(Querystring.o)) {</code><code class="string">"?o="</code><code class="plain"> + Querystring.o} %}</code></div>
</div>
    </div>
</li></ul></li><li class=" "><p>Add the <strong class=" ">Javascript</strong> <a href="using-and-configuring-web-parts">web part</a> onto the page where you want to log the purchase.</p>
</li><li class=" "><p>Expand the <strong class=" ">Behavior</strong> category of the web part's properties and click <strong class=" ">Edit value</strong> (<img class="confluence-embedded-image confluence-thumbnail" src="images/download/thumbnails/68879208/edit_value.png" alt="images/download/thumbnails/68879208/edit_value.png" height="13">
) next to the <strong class=" ">Enabled</strong> property.</p>
</li><li class=" "><p>Add the following macro condition into the value:</p>
    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">{% !String.IsNullOrEmpty(QueryString.o) %}</code></div>
</div>
    </div>
    <div class="confbox admonition admonition-info">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p>The condition prevents logging of empty purchases by ensuring that the JavaScript runs only if the page is viewed after completing an order (i.e. the URL query string contains the <i class=" ">o</i> parameter).</p>
        </div>
    </div>
</li><li class=" "><p>Run a script that pushes the completed order's JSON data into the data layer. Use the <strong class=" ">GetGtmPurchaseJson</strong> macro method to get all data required for the <i class=" ">purchase</i> field. For example, configure the web part in the following way:</p>
<ul class=" "><li class=" "><p><strong class=" ">In-line script</strong>:</p>
    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">document.addEventListener(</code><code class="string">"DOMContentLoaded"</code><code class="plain">, </code><code class="keyword">function</code><code class="plain">(event) {</code></div>
<div class="line"><code class="plain">  dataLayer.push({</code></div>
<div class="line"><code class="plain">    </code><code class="string">"ecommerce"</code><code class="plain">: {</code></div>
<div class="line"><code class="plain">      </code><code class="string">"purchase"</code><code class="plain">: {% GetGtmPurchaseJson() %}</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">  });</code></div>
<div class="line"><code class="plain">});</code></div>
</div>
    </div>
</li><li class=" "><p><strong class=" ">In-line script page location</strong>: Startup script <i class=" ">(renders the script tag near the end of the page's &lt;body&gt; content)</i></p>
</li><li class=" "><p><strong class=" ">Generate script tags</strong>: yes (checked)</p>
</li></ul></li></ol>        </div>

    </article>


               
            
    <footer id="ht-footer">
    <a href="#" id="ht-jump-top" class="sp-aui-icon-small sp-aui-iconfont-arrows-up"></a>
</footer></div>

<div>
    <div id="ht-mq-detect"></div>
</div>

    <script src="js/lunr.js"></script>
    <script src="js/lunr-extras.js"></script>
    <script src="assets/js/scroll-search.js"></script>

    <script src="assets/js/expand-macro.js"></script>


</body></html>