<!DOCTYPE html><html><head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Customizing discounts - Kentico 11 Documentation</title>

    
    <link rel="stylesheet" href="assets/css/expand-macro.css">

            <meta name="scroll-content-language-key" content="">
    
    <meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=2.0, user-scalable=yes">

<script type="text/javascript" src="assets/js/jquery.min.js"></script>
<script type="text/javascript" src="assets/js/jquery.scrollTo.min.js"></script>


<script type="text/javascript" src="assets/js/translate.js"></script>

<script type="text/javascript" src="assets/js/theme.main.js"></script>

    <script type="text/javascript" src="assets/js/iframeResizer.min.js"></script>

<link rel="stylesheet" href="assets/css/content-style.css">
    <link rel="stylesheet" href="assets/css/search.css">

<link rel="stylesheet" href="assets/css/theme.main.css">
<link rel="stylesheet" href="assets/css/theme.colors.css">

            <!-- ES5 support for older browsers, needed by lunr -->
        <script src="js/augment.js"></script> 
        <script id="worker" type="javascript/worker">

        startIndex = function() {
            idx = lunr.Index.load(lunrIndex);
            idx.pipeline.remove(lunr.stopWordFilter);
            postMessage({type: "setup-complete"});
        }

        onmessage = function (event) {
            var message = event.data;

            if ((message.type === 'setup') && message.baseUrl) {
                var url = message.baseUrl;
                importScripts(url + 'js/lunr.js');
                importScripts(url + 'js/lunr-extras.js');
                importScripts(url + 'js/lunr-index.js');
                importScripts(url + 'js/lunr-data.js');
                startIndex();
            }

            if (idx && (message.type === 'search-request') && message.query) {
                var searchWord = message.query;
                var results = idx.search(searchWord).map(function (result) {
                    return lunrData.filter(function (d) {
                        return d.id === parseInt(result.ref, 10)
                    })[0]
                });
                postMessage({type: 'search-results', results: results, query: searchWord, queryId: message.queryId});
            }
        }

    </script>
    </head>

<body pageid="68879260" elementpageid="76842976">

<div id="ht-loader">
    <noscript>
        <p style="width: 100%; text-align:center; position: absolute; margin-top: 200px;">This content cannot be displayed without JavaScript.<br>Please enable JavaScript and reload the page.</p>
    </noscript>
</div>

<div>
   	<header id="ht-headerbar">
    <div class="ht-headerbar-left">
        <a href="" id="ht-menu-toggle" class="sp-aui-icon-small sp-aui-iconfont-appswitcher"></a>
    </div>
    <div class="ht-headerbar-right">
            <div class="sp-aui-icon-small ht-search-index-loader ht-header-icon"></div>

        <div id="ht-search">
            <div class="ht-search-input" style="display: none;">
              	<a href="#" class="sp-aui-icon-small sp-aui-iconfont-remove ht-search-clear"></a>

                <form action="#" method="GET" id="search">
                    <input class="search-input" type="text" placeholder="Search" tabindex="-1" autocomplete="off" name="q" value="">
                    <input type="hidden" name="max" value="15">
                    <input type="submit" style="display:none" tabindex="-4">
                </form>

                <a href="#" id="ht-search-button" class="ht-header-icon ht-header-icon-svg">
                                        <svg width="40px" height="40px" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                        <g>
                            <path d="M29.572,28.802 L28.801,29.571 C28.515,29.857 28.187,30 27.816,30 C27.445,30 27.116,29.857 26.831,29.571 L21.392,24.134 C20.193,24.762 18.908,25.076 17.538,25.076 C15.396,25.076 13.605,24.348 12.163,22.892 C10.721,21.436 10,19.651 10,17.538 C10,15.397 10.721,13.605 12.163,12.163 C13.605,10.721 15.396,10 17.538,10 C19.651,10 21.434,10.721 22.89,12.163 C24.347,13.605 25.075,15.397 25.075,17.538 C25.075,18.937 24.761,20.222 24.132,21.393 L29.572,26.832 C29.857,27.118 30,27.446 30,27.817 C30,28.188 29.857,28.517 29.572,28.802 L29.572,28.802 Z M13.662,21.414 C14.732,22.485 16.024,23.02 17.538,23.02 C19.051,23.02 20.343,22.485 21.413,21.414 C22.484,20.344 23.019,19.052 23.019,17.538 C23.019,16.025 22.484,14.733 21.413,13.662 C20.343,12.592 19.051,12.056 17.538,12.056 C16.024,12.056 14.732,12.592 13.662,13.662 C12.591,14.733 12.056,16.025 12.056,17.538 C12.056,19.052 12.591,20.344 13.662,21.414 L13.662,21.414 Z"></path>
                        </g>
                    </svg>
              	</a>

                <div class="ht-search-dropdown ht-dropdown">
                    <ul></ul>
                </div>
            </div>
        </div>
    </div>
    </header>   	<aside id="ht-sidebar">
    <div class="ht-sidebar-content">
        <div class="ht-sidebar-content-scroll-container">
            <header class="ht-sidebar-header">
                <h1 class="ht-logo">
                    <span class="ht-logo-label">K11</span>
                    <img class="space-logo" src="global.logo">
                </h1>
                <a href="Kentico-11-Documentation-Home.html" class="ht-space-link">
                    <h2>Kentico 11 Documentation</h2>
                </a>
            </header>
                            <iframe id="ht-nav" src="toc.html?pageId=76842976"></iframe>
                <script>
                    $('iframe#ht-nav').iFrameResize(
                            { 'log': true, 'autoResize': true, 'heightCalculationMethod': 'lowestElement', 'checkOrigin': false });
                </script>
                    </div>
    </div>

</aside></div>

<div id="ht-wrap-container">

            
    <div id="ht-sidebar-dragbar">
    <div class="ht-sidebar-drag-handle">
        <span class="drag-handle-1"></span>
        <span class="drag-handle-2"></span>
        <span class="drag-handle-3"></span>
    </div>
</div>
    <article id="ht-content" class="ht-content">
        <header class="ht-content-header">
            <div id="ht-breadcrumb">
    <ul>
        <li><a href="Kentico-11-Documentation-Home.html">Kentico 11 Documentation</a></li>
                                                                                                             <li><a href="" onclick="$('.shortcut').each(function(){$(this).removeClass('shortcut')}); $(this).parent().addClass('shortcut'); return false;">...</a> </li>
                                        <li class="shortcut"><a href="E-commerce-features.html">E-commerce features</a></li>
                                                                                     <li><a href="Customizing-and-developing-your-store.html">Customizing and developing your store</a></li>
                                                            </ul>
</div>            <h1 id="src-76842976"> <span>Customizing discounts</span></h1>
        </header>

        <div id="main-content" class="wiki-content sp-grid-section" data-index-for-search="true">
<div class="sp-grid-section"><div class="sp-grid-cell sp-grid-60"><p>The Kentico E-commerce Solution allows you to customize how the system applies <a href="discounts">discounts</a> to products and orders. For example, you can:</p><ul class=" "><li class=" "><p>Define and apply custom discounts (for example discounts provided by an external system or application)</p>
</li><li class=" "><p>Adjust or override the functionality of the default discount types</p>
</li></ul><div class="confbox admonition admonition-note">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p><strong class=" ">Note</strong>: If you only need to set up custom conditions under which discounts are applied, you may be able to achieve your goal by creating <a href="configuring-discount-rules">discount macro rules</a>.</p>
        </div>
    </div><p>To customize discounts:</p><ol class=" "><li class=" "><p>Open your Kentico project in Visual Studio.</p>
</li><li class=" "><p>Create new classes that implement one or more of the <a href="#src-76842976_customizingdiscounts-discountcustomizationinterfaces">discount customization interfaces</a> (described below).</p>
    <div class="confbox admonition admonition-tip">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p><strong class=" ">Class location</strong><br></p>
<p>For production sites, we recommend creating a new assembly (Class library project) in your Kentico solution and including the classes there. Then, add the appropriate references to both the assembly and the main Kentico web project. For more information, see <a href="best-practices-for-customization">Best practices for customization</a>.</p>
        </div>
    </div>
</li><li class=" "><p>Implement all methods required by the given interfaces.</p>
</li><li class=" "><p>Register your implementations of the interfaces using the <strong class=" ">RegisterImplementation</strong> assembly attribute.</p>
</li></ol><p>When you reload the website, the system uses the custom implementations that you registered instead of the default discount functionality.</p><div class="sp-grid-section"></div></div><div class="sp-grid-cell sp-grid-40 sp-grid-sidebar"><div class="confbox panel">
            <div class="title panel-header">On this page</div>
            <div class="panel-content">
<p></p>
<ul class="toc-indentation "><li class=" "><p><a href="#src-76842976_customizingdiscounts-discountcustomizationinterfaces">Discount customization interfaces</a></p>
<ul class="toc-indentation "><li class=" "><p><a href="#src-76842976_safe-id-q3vzdg9taxppbmdkaxnjb3vudhmtuhjvzhvjdc1szxzlbgrpc2nvdw50cyhjyxrhbg9nyw5kdm9sdw1lkq">Product-level discounts (catalog and volume)</a></p>
</li><li class=" "><p><a href="#src-76842976_customizingdiscounts-productcoupons">Product coupons</a></p>
</li><li class=" "><p><a href="#src-76842976_customizingdiscounts-buyxgetydiscounts">Buy X Get Y discounts</a></p>
</li><li class=" "><p><a href="#src-76842976_customizingdiscounts-orderdiscounts">Order discounts</a></p>
</li><li class=" "><p><a href="#src-76842976_customizingdiscounts-shippingdiscounts">Shipping discounts</a></p>
</li><li class=" "><p><a href="#src-76842976_customizingdiscounts-giftcards">Gift cards</a></p>
</li></ul></li><li class=" "><p><a href="#src-76842976_safe-id-q3vzdg9taxppbmdkaxnjb3vudhmtrxhhbxbszekak0fkzgluz2fjdxn0b21wcm9kdwn0zglzy291bnq">Example – Adding a custom product discount</a></p>
</li><li class=" "><p><a href="#src-76842976_safe-id-q3vzdg9taxppbmdkaxnjb3vudhmtrxhhbxbszekak1vzaw5ny3vzdg9tdm9sdw1lzglzy291bnrz">Example – Using custom volume discounts</a></p>
</li></ul><p></p>
        </div>
    </div><div class="confbox panel">
            <div class="title panel-header">Related pages</div>
            <div class="panel-content">
<ul class=" "><li class=" "><p><a href="discounts">Discounts</a></p>
</li><li class=" "><p><a href="configuring-discount-rules">Configuring discount rules</a></p>
</li></ul>        </div>
    </div></div></div>
    


    
    
    <h3 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Discount customization interfaces</span></h3>
<p><span id="src-76842976_Customizingdiscounts-DiscountInterfaceList"></span></p>
    <div class="confbox admonition admonition-info">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p>All mentioned interfaces can be found in the <strong class=" ">CMS.Ecommerce</strong> namespace.</p>
        </div>
    </div>
<p></p>
<ul class="toc-indentation "><li class=" "><p><a href="#src-76842976_safe-id-q3vzdg9taxppbmdkaxnjb3vudhmtuhjvzhvjdc1szxzlbgrpc2nvdw50cyhjyxrhbg9nyw5kdm9sdw1lkq">Product-level discounts (catalog and volume)</a></p>
</li><li class=" "><p><a href="#src-76842976_customizingdiscounts-productcoupons">Product coupons</a></p>
</li><li class=" "><p><a href="#src-76842976_customizingdiscounts-buyxgetydiscounts">Buy X Get Y discounts</a></p>
</li><li class=" "><p><a href="#src-76842976_customizingdiscounts-orderdiscounts">Order discounts</a></p>
</li><li class=" "><p><a href="#src-76842976_customizingdiscounts-shippingdiscounts">Shipping discounts</a></p>
</li><li class=" "><p><a href="#src-76842976_customizingdiscounts-giftcards">Gift cards</a></p>
</li></ul><p></p>
    <h4 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Product-level discounts (catalog and volume)</span></h4>
<p>The system uses the following interfaces to load discounts that apply to individual units of products (includes <a href="working-with-catalog-discounts">Catalog</a> and <a href="working-with-volume-discounts">Volume</a> discounts by default):</p>
<ul class=" "><li class=" "><p><strong class=" ">ICatalogDiscountSource</strong> – implementations must contain the <i class=" ">GetDiscounts</i> method, which returns an <i class=" ">IEnumerable</i> collection of <i class=" ">DiscountInfo</i> objects (representing applied catalog discounts) for a specified product (<i class=" ">SKUInfo</i>). Additional data related to the discount calculation context is available in the method's <i class=" ">PriceParameters</i> parameter.<br><br></p>
</li><li class=" "><p><strong class=" ">IVolumeDiscountSource</strong> – implementations must contain the <i class=" ">GetDiscount</i> method, which returns a <i class=" ">VolumeDiscountInfo</i> object for a specified product (<i class=" ">SKUInfo</i>) and unit quantity. Return <i class=" ">null</i> to apply no volume discount.<br><br></p>
</li><li class=" "><p><strong class=" ">IProductDiscountSource</strong> – encapsulates the overall retrieval of product-level discounts. By default uses the <i class=" ">ICatalogDiscountSource</i> and <i class=" ">IVolumeDiscountSource</i> implementations to load catalog and volume discounts. Implementations of <i class=" ">IProductDiscountSource</i> must contain the <i class=" ">GetDiscounts</i> method, which returns an <i class=" ">IEnumerable</i> collection of <i class=" ">DiscountCollection</i> objects (representing applied discounts) for a specified product (<i class=" ">SKUInfo</i>). Additional data related to the discount calculation context is available in the method's <i class=" ">PriceParameters</i> parameter.</p>
</li></ul><p>The <strong class=" ">PriceParameters</strong> parameter available in the methods of <i class=" ">ICatalogDiscountSource</i> and <i class=" ">IProductDiscountSource</i> provides the following properties:</p>
<ul class=" "><li class=" "><p><strong class=" ">Currency</strong> – the currency (<i class=" ">CurrencyInfo</i>) in which the discount is calculated (for discounts with fixed values).</p>
</li><li class=" "><p><strong class=" ">Quantity</strong> – the number of product units.</p>
</li><li class=" "><p><strong class=" ">SiteID</strong> – an identifier of the site on which the discount is calculated.</p>
</li><li class=" "><p><strong class=" ">User</strong> – the user object (<i class=" ">UserInfo</i>) for which the discount is calculated. Is <i class=" ">null</i> for anonymous customers who are not registered as website users.</p>
</li><li class=" "><p><strong class=" ">Customer</strong> – the <a href="customers">customer</a> object (<i class=" ">CustomerInfo</i>) for which the discount is calculated. Is <i class=" ">null</i> when calculating prices for anonymous visitors before they enter customer details in the checkout process.</p>
</li><li class=" "><p><strong class=" ">CalculationDate</strong> – a <i class=" ">DateTime</i> value storing the time for which the discount is calculated (can be used to check the validity of discounts). For most calculations, the value is equal to the current time. When calculating discounts for existing orders, the value is equal to the date and time when the order was created.</p>
</li></ul><p>See the following customization examples:</p>
<ul class=" "><li class=" "><p><a href="#src-76842976_safe-id-q3vzdg9taxppbmdkaxnjb3vudhmtrxhhbxbszekak0fkzgluz2fjdxn0b21wcm9kdwn0zglzy291bnq">Example - Adding a custom product discount</a></p>
</li><li class=" "><p><a href="#src-76842976_safe-id-q3vzdg9taxppbmdkaxnjb3vudhmtrxhhbxbszekak1vzaw5ny3vzdg9tdm9sdw1lzglzy291bnrz">Example - Using custom volume discounts</a></p>
</li></ul>    <div class="confbox admonition admonition-info">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p>The E-commerce API uses the following additional interfaces to connect the discount sources with the overall product price calculation logic (see <a href="customizing-product-prices">Customizing product prices</a> to learn more):</p>
<ul class=" "><li class=" "><p><strong class=" ">IDiscountApplicator</strong> – general service for applying multiple discounts (also used for <a href="working-with-order-discounts">order discounts</a> and <a href="working-with-free-shipping-offers">free shipping offers</a>). Implementations must contain the <i class=" ">ApplyDiscounts</i> method, which performs the following functions:</p>
<ul class=" "><li class=" "><p>Processes parameters that specify a base price (<i class=" ">decimal</i>) and an <i class=" ">IEnumerable</i> collection of <i class=" ">DiscountCollection</i> objects (representing applied discounts).</p>
</li><li class=" "><p>Returns a summary of the applied discounts as a <i class=" ">ValuesSummary</i> object containing discount name and value pairs.</p>
</li></ul></li><li class=" "><p><strong class=" ">IProductDiscountService</strong> – builds the overall summary of applied product-level discounts. Implementations must contain the <i class=" ">GetProductDiscounts</i> method, which returns a <i class=" ">ValuesSummary</i> object for a specified product (<i class=" ">SKUInfo</i>), base price (<i class=" ">decimal</i>), and price calculation parameters (<i class=" ">PriceParameters</i>). The default <i class=" ">IProductDiscountService</i> implementation gets the collection of <i class=" ">DiscountCollection</i> objects using the registered <i class=" ">IProductDiscountSource</i>, and then creates the <i class=" ">ValuesSummary</i> using the <i class=" ">IDiscountApplicator</i> implementation.</p>
</li></ul><p>Customization of these interfaces is not required or recommended for typical discount customization scenarios.</p>
        </div>
    </div>
<p><a href="#src-76842976_customizingdiscounts-discountinterfacelist">&gt; Back to the discount interface list</a></p>
    <h4 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Product coupons</span></h4>
<p>The system uses the <strong class=" ">IProductCouponSource</strong> interface to load discounts that require a coupon code and apply to shopping cart lines (each line represents one or more units of a product). See <a href="working-with-product-coupons">Working with product coupons</a> to learn about the default functionality.</p>
    <div class="confbox admonition admonition-note">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p>The <strong class=" ">IProductCouponSource</strong> interface is only intended for customization scenarios that utilize the default Kentico product coupon objects (i.e. objects represented by the <i class=" ">MultiBuyDiscountInfo</i> class in the API and managed in the <i class=" ">Product coupons</i> application of the administration interface).</p>
<p>If you need to integrate product coupons from an external source or service, we recommend adding a custom step (<i class=" ">IShoppingCartCalculator</i> implementation) into the overall shopping cart calculation process. See <a href="customizing-the-shopping-cart-calculation">Customizing the shopping cart calculation</a> for more information.</p>
        </div>
    </div>
<p>Implementations of <i class=" ">IProductCouponSource</i> must contain the <strong class=" ">GetDiscounts</strong> method. The method provides a <strong class=" ">DiscountsParameters</strong> parameter with the following properties:</p>
<ul class=" "><li class=" "><p><strong class=" ">CouponCodes</strong> – a collection of <a href="working-with-coupon-codes">coupon codes</a> that the customer added to the order.</p>
</li><li class=" "><p><strong class=" ">Currency</strong> – the currency (<i class=" ">CurrencyInfo</i>) in which the discount is calculated.</p>
</li><li class=" "><p><strong class=" ">DueDate</strong> – a <i class=" ">DateTime</i> value used to evaluate the validity of discounts. For most calculations, the value is equal to the current time. When calculating discounts for existing orders, the value is equal to the date and time when the order was created.</p>
</li><li class=" "><p><strong class=" ">SiteID</strong> – an identifier of the site on which the discount is calculated.</p>
</li><li class=" "><p><strong class=" ">User</strong> – the user object (<i class=" ">UserInfo</i>) for which the discount is calculated. Is <i class=" ">null</i> for anonymous customers who are not registered as website users.</p>
</li></ul><p>The <i class=" ">GetDiscounts</i> method must return an <i class=" ">IEnumerable</i> collection of <strong class=" ">IMultiBuyDiscount</strong> objects representing the applied discounts (we recommended using instances of the default <strong class=" ">MultiBuyDiscount</strong> class).</p>
    <div class="confbox admonition admonition-info">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p>The E-commerce API additionally uses the<strong class=" "> IMultiBuyDiscountsApplicator</strong> and <strong class=" ">IProductCouponService</strong> interfaces to connect the product coupon source with the overall shopping cart and order calculation logic. However, customization of these interfaces is not required for typical scenarios. For such advanced cases, we instead recommend adding a custom step (<i class=" ">IShoppingCartCalculator</i> implementation) into the overall shopping cart calculation process (see <a href="customizing-the-shopping-cart-calculation">Customizing the shopping cart calculation</a> for more information).</p>
        </div>
    </div>
<p><a href="#src-76842976_customizingdiscounts-discountinterfacelist">&gt; Back to the discount interface list</a></p>
    <h4 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Buy X Get Y discounts</span></h4>
<p>The system uses the <strong class=" ">IMultiBuyDiscountSource</strong> interface to load discounts that work based on combinations of products and apply to shopping cart lines (each line represents one or more units of a product). See <a href="working-with-buy-x-get-y-discounts">Working with Buy X Get Y discounts</a> to learn about the default functionality.</p>
<p>Implementations of <i class=" ">IMultiBuyDiscountSource</i> must contain the <strong class=" ">GetDiscounts</strong> method, which provides a <strong class=" ">DiscountsParameters</strong> parameter (see the <a href="#src-76842976_customizingdiscounts-productcoupons">Product coupons</a> section to learn about the available properties). The <i class=" ">GetDiscounts</i> method must return an <i class=" ">IEnumerable</i> collection of <strong class=" ">IMultiBuyDiscount</strong> objects representing the applied discounts (we recommended using instances of the default <strong class=" ">MultiBuyDiscount</strong> class).</p>
<p>If you need to modify how the system evaluates whether the content of a shopping cart is eligible for a Buy X Get Y discount, create a custom implementation of the <strong class=" ">IMultiBuyDiscountsEvaluator</strong> interface. We recommend using the following general approach:</p>
<ol class=" "><li class=" "><p>Add a custom class that inherits from the <strong class=" ">MultiBuyDiscountsEvaluator</strong> class (the default <i class=" ">IMultiBuyDiscountSource</i> implementation).</p>
</li><li class=" "><p>Override the virtual methods that you wish to change.</p>
</li><li class=" "><p>Register your custom class using the <strong class=" ">RegisterImplementation</strong> assembly attribute.</p>
</li></ol>    <div class="confbox admonition admonition-info">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p>The E-commerce API additionally uses the<strong class=" "> IMultiBuyDiscountsApplicator</strong> and <strong class=" ">IMultiBuyDiscountsService</strong> interfaces to connect the Buy X Get Y functionality with the overall shopping cart and order calculation logic. However, customization of these interfaces is not required for typical scenarios. For such advanced cases, we recommend implementing your custom discount functionality as a separate step (<i class=" ">IShoppingCartCalculator</i> implementation) in the overall shopping cart calculation process. See <a href="customizing-the-shopping-cart-calculation">Customizing the shopping cart calculation</a> for more information.</p>
        </div>
    </div>
<p><a href="#src-76842976_customizingdiscounts-discountinterfacelist">&gt; Back to the discount interface list</a></p>
    <h4 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Order discounts</span></h4>
<p>The system uses the <strong class=" ">IOrderDiscountSource</strong> interface to load discounts that apply to entire orders/purchases (<a href="working-with-order-discounts">Order discounts</a> by default). Implementations must contain the <strong class=" ">GetDiscounts</strong> method, which provides the following parameters:</p>
<ul class=" "><li class=" "><p>A <strong class=" ">CalculatorData</strong> object holding data related to the shopping cart or order to which the discount is applied. See <a href="customizing-the-shopping-cart-calculation">Customizing the shopping cart calculation</a> for more information.</p>
</li><li class=" "><p>A decimal value matching the total price of the order (before shipping costs, taxes and gift cards).</p>
</li></ul><p>The <i class=" ">GetDiscounts</i> method must return an <i class=" ">IEnumerable</i> collection of <strong class=" ">DiscountCollection</strong> objects representing the applied discounts.</p>
    <div class="confbox admonition admonition-info">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p>The E-commerce API uses the general <strong class=" ">IDiscountApplicator</strong> interface to connect the order discount source with the overall shopping cart and order calculation logic (see <a href="customizing-the-shopping-cart-calculation">Customizing the shopping cart calculation</a> to learn more).</p>
<p>Implementations of <i class=" ">IDiscountApplicator</i> must contain the <i class=" ">ApplyDiscounts</i> method, which performs the following functions:</p>
<ul class=" "><li class=" "><p>Processes parameters that specify a base price (<i class=" ">decimal</i>) and an <i class=" ">IEnumerable</i> collection of <i class=" ">DiscountCollection</i> objects (representing applied discounts).</p>
</li><li class=" "><p>Returns a summary of the applied discounts as a <i class=" ">ValuesSummary</i> object containing discount name and value pairs.</p>
</li></ul><p>Customization of this interface is not required or recommended for typical discount customization scenarios.</p>
        </div>
    </div>
<p><a href="#src-76842976_customizingdiscounts-discountinterfacelist">&gt; Back to the discount interface list</a></p>
    <h4 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Shipping discounts</span></h4>
<p>The system uses the <strong class=" ">IShippingDiscountSource</strong> interface to load discounts that apply to <a href="configuring-shipping-options">shipping</a> costs (<a href="working-with-free-shipping-offers">Free shipping offers</a> by default). Implementations must contain the following methods:</p>
<ul class=" "><li class=" "><p><strong class=" ">GetDiscounts</strong> – returns an <i class=" ">IEnumerable</i> collection of <i class=" ">IDiscount</i> objects representing the applied discounts. Provides the following parameters:</p>
<ul class=" "><li class=" "><p>A <strong class=" ">CalculatorData</strong> object holding data related to the shopping cart or order to which the shipping discount is applied. See <a href="customizing-the-shopping-cart-calculation">Customizing the shopping cart calculation</a> for more information.</p>
</li><li class=" "><p>A decimal value matching the total price of the order (before taxes and gift cards).</p>
</li></ul></li><li class=" "><p><strong class=" ">GetRemainingAmountForFreeShipping</strong> – returns a decimal value indicating how much the order's price would need to increase to fulfill the conditions of a shipping discount. Return 0 if there is no valid shipping discount or if the shipping is already free. Provides the same parameters as the <i class=" ">GetDiscounts</i> method.</p>
</li></ul>    <div class="confbox admonition admonition-info">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p>The E-commerce API uses the following additional interfaces to connect the shipping discount source with the overall shopping cart and order calculation logic (see <a href="customizing-the-shopping-cart-calculation">Customizing the shopping cart calculation</a> to learn more).</p>
<ul class=" "><li class=" "><p><strong class=" ">IDiscountApplicator</strong> – general service for applying multiple discounts (also used for product-level discounts and order discounts). Implementations must contain the <i class=" ">ApplyDiscounts</i> method, which performs the following functions:<br></p>
<ul class=" "><li class=" "><p>Processes parameters that specify a base price (<i class=" ">decimal</i>) and an <i class=" ">IEnumerable</i> collection of <i class=" ">DiscountCollection</i> objects (representing applied discounts).</p>
</li><li class=" "><p>Returns a summary of the applied discounts as a <i class=" ">ValuesSummary</i> object containing discount name and value pairs.</p>
</li></ul></li><li class=" "><p><strong class=" ">IShippingPriceService</strong> – calculates the final shipping price. The default <i class=" ">IShippingPriceService</i> implementation gets shipping discounts using the registered <i class=" ">IShippingtDiscountSource</i>, and then creates the required shipping discount summary using the <i class=" ">IDiscountApplicator</i> implementation.</p>
</li></ul><p>Customization of the <i class=" ">IDiscountApplicator</i> interface is not required or recommended for typical discount customization scenarios.</p>
<p>To learn more about customization of shipping cost customizations in general, refer to the <a href="shipping-related-customizing">Shipping-related customizing</a> chapter.</p>
        </div>
    </div>
<p><a href="#src-76842976_customizingdiscounts-discountinterfacelist">&gt; Back to the discount interface list</a></p>
    <h4 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Gift cards</span></h4>
<p>The system uses the <strong class=" ">IGiftCardSource</strong> interface to load gift cards that reduce the final price of orders (see <a href="working-with-gift-cards">Working with gift cards</a> to learn about the default functionality).</p>
    <div class="confbox admonition admonition-note">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p>The <strong class=" ">IGiftCardSource</strong> interface is only intended for customization scenarios that utilize the default Kentico gift card objects (i.e. gift cards represented by the <i class=" ">GiftCardInfo</i> class in the API and managed in the <i class=" ">Gift cards</i> application of the administration interface).</p>
<p>If you need to integrate gift cards from an external source or service, we recommend adding a custom step (<i class=" ">IShoppingCartCalculator</i> implementation) into the overall shopping cart calculation process. See <a href="customizing-the-shopping-cart-calculation">Customizing the shopping cart calculation</a> for more information.</p>
        </div>
    </div>
<p>Implementations of <i class=" ">IGiftCardSource</i> must contain the <strong class=" ">GetGiftCards</strong> method, which provides the following parameters:</p>
<ul class=" "><li class=" "><p>A <strong class=" ">CalculatorData</strong> object holding data related to the shopping cart or order to which the gift card is applied (see <a href="customizing-the-shopping-cart-calculation">Customizing the shopping cart calculation</a>). For example, use the <i class=" ">CalculatorData.Request.CouponCodes</i> property to get a collection of <a href="working-with-coupon-codes">coupon codes</a> that the customer added to the order.</p>
</li><li class=" "><p>A decimal value matching the total price of the order (including other discounts, shipping costs and taxes).</p>
</li></ul><p>The <i class=" ">GetGiftCards</i> method must return an <i class=" ">IEnumerable</i> collection of <strong class=" ">GiftCardApplication</strong> objects representing the applied gift cards.</p>
<p><a href="#src-76842976_customizingdiscounts-discountinterfacelist">&gt; Back to the discount interface list</a></p>
    <h3 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Example – Adding a custom product discount</span></h3>
<p>The following example demonstrates how to implement a custom product-level discount. This customization applies all valid catalog and volume discounts from Kentico, and then additionally reduces the price of all products by 10% for customers who are registered users on the website.</p>
<p>Prepare a separate project for custom classes in your Kentico solution:</p>
<ol class=" "><li class=" "><p>Open your Kentico solution in Visual Studio.</p>
</li><li class=" "><p>Create a new <i class=" ">Class Library</i> project in the Kentico solution (or reuse an existing custom project).</p>
</li><li class=" "><p>Add references to the required Kentico libraries (DLLs) for the new project:<br></p>
<ol class=" "><li class=" "><p>Right-click the project and select <strong class=" ">Add -&gt; Reference</strong>.</p>
</li><li class=" "><p>Select the <strong class=" ">Browse</strong> tab of the <strong class=" ">Reference manager</strong> dialog, click <strong class=" ">Browse</strong> and navigate to the <i class=" "><strong class=" ">Lib</strong> </i>folder of your Kentico web project.</p>
</li><li class=" "><p>Add references to the following libraries (and any others that you may need in your custom code):</p>
<ul class=" "><li class=" "><p><strong class=" ">CMS.Base.dll</strong></p>
</li><li class=" "><p><strong class=" ">CMS.Core.dll</strong></p>
</li><li class=" "><p><strong class=" ">CMS.DataEngine.dll</strong></p>
</li><li class=" "><p><strong class=" ">CMS.Ecommerce.dll</strong></p>
</li><li class=" "><p><strong class=" ">CMS.Globalization.dll</strong></p>
</li><li class=" "><p><strong class=" ">CMS.Helpers.dll</strong></p>
</li><li class=" "><p><strong class=" ">CMS.Membership.dll</strong></p>
</li></ul></li></ol></li><li class=" "><p>Reference the custom project from the Kentico web project <i class=" ">(CMSApp</i> or <i class=" ">CMS)</i>.</p>
</li><li class=" "><p>Edit the custom project's <strong class=" ">AssemblyInfo.cs</strong> file (in the <i class=" ">Properties</i> folder).</p>
</li><li class=" "><p>Add the <strong class=" ">AssemblyDiscoverable</strong> assembly attribute:<br></p>
    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="keyword">using</code><code class="plain"> CMS;</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">[assembly:AssemblyDiscoverable]</code></div>
</div>
    </div>
</li></ol><p></p>
<p>Continue by creating a custom implementation of the <strong class=" ">IProductDiscountSource</strong> interface:</p>
<ol class=" "><li class=" "><p>Add a new class under the custom project, inheriting from the default <strong class=" ">ProductDiscountSource</strong> class (and implementing the <i class=" ">IProductDiscountSource</i> interface).</p>
    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="keyword">using</code><code class="plain"> System.Collections.Generic;</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="keyword">using</code><code class="plain"> CMS;</code></div>
<div class="line"><code class="keyword">using</code><code class="plain"> CMS.Ecommerce;</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="comments">// Registers the custom implementation of IProductDiscountSource</code></div>
<div class="line"><code class="plain">[assembly: RegisterImplementation(</code><code class="keyword">typeof</code><code class="plain">(IProductDiscountSource), </code><code class="keyword">typeof</code><code class="plain">(CustomProductDiscountSource))]</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="keyword">public</code><code class="plain"> </code><code class="keyword">class</code><code class="plain"> CustomProductDiscountSource : ProductDiscountSource, IProductDiscountSource</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    </code><code class="comments">/// &lt;summary&gt;</code></div>
<div class="line"><code class="plain">    </code><code class="comments">/// Constructor with parameters that accept instances of services required by the ProductDiscountSource base class.</code></div>
<div class="line"><code class="plain">    </code><code class="comments">/// &lt;/summary&gt;</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">public</code><code class="plain"> CustomProductDiscountSource(ICatalogDiscountSource catalogDiscountSource, IVolumeDiscountSource volumeDiscountSource, ISiteMainCurrencySource mainCurrencySource, ICurrencyConverterFactory currencyConverterFactory, IRoundingServiceFactory roundingServiceFactory) </code></div>
<div class="line"><code class="plain">        : </code><code class="keyword">base</code><code class="plain">(catalogDiscountSource, volumeDiscountSource, mainCurrencySource, currencyConverterFactory, roundingServiceFactory)</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">    </code><code class="comments">/// &lt;summary&gt;</code></div>
<div class="line"><code class="plain">    </code><code class="comments">/// Creates a collection of product-level discounts that apply to a specified product.</code></div>
<div class="line"><code class="plain">    </code><code class="comments">/// Additional data related to the price and purchase context is provided in the PriceParameters.</code></div>
<div class="line"><code class="plain">    </code><code class="comments">/// &lt;/summary&gt;</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">public</code><code class="plain"> </code><code class="keyword">override</code><code class="plain"> IEnumerable&lt;DiscountCollection&gt; GetDiscounts(SKUInfo sku, </code><code class="keyword">decimal</code><code class="plain"> standardPrice, PriceParameters priceParams)</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">var</code><code class="plain"> discountGroups = </code><code class="keyword">new</code><code class="plain"> List&lt;DiscountCollection&gt;();</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">        </code><code class="comments">// Adds the default Kentico catalog and volume discounts (using methods from the ProductDiscountSource base class)</code></div>
<div class="line"><code class="plain">        AddCatalogDiscounts(discountGroups, sku, priceParams);</code></div>
<div class="line"><code class="plain">        AddVolumeDiscounts(discountGroups, sku, priceParams);</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">        </code><code class="comments">// Adds a custom discount</code></div>
<div class="line"><code class="plain">        </code><code class="comments">// The custom discount uses multiplicative stacking with any applied catalog or volume discounts</code></div>
<div class="line"><code class="plain">        </code><code class="comments">// (i.e. the custom discount is calculated from the price reduced by other discounts)</code></div>
<div class="line"><code class="plain">        AddCustomDiscounts(discountGroups, sku, priceParams);</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">        </code><code class="keyword">return</code><code class="plain"> discountGroups;</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">    </code><code class="comments">/// &lt;summary&gt;</code></div>
<div class="line"><code class="plain">    </code><code class="comments">/// Adds a custom discount for a specified product.</code></div>
<div class="line"><code class="plain">    </code><code class="comments">/// &lt;/summary&gt;</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">private</code><code class="plain"> </code><code class="keyword">void</code><code class="plain"> AddCustomDiscounts(List&lt;DiscountCollection&gt; discountGroups, SKUInfo sku, PriceParameters priceParams)</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        </code><code class="comments">// Adds the discount only for customers who are registered users on the website</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">if</code><code class="plain"> (priceParams.User != </code><code class="keyword">null</code><code class="plain">)</code></div>
<div class="line"><code class="plain">        {</code></div>
<div class="line"><code class="plain">            </code><code class="comments">// Creates a 10% custom discount (using a method from the ProductDiscountSource base class)</code></div>
<div class="line"><code class="plain">            IDiscount customDiscount = CreatePercentageProductDiscount(</code><code class="string">"Discount for registered users"</code><code class="plain">, 0.1m, priceParams);</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">            </code><code class="comments">// Adds the custom discount to the collection of overall product discounts</code></div>
<div class="line"><code class="plain">            </code><code class="keyword">var</code><code class="plain"> discountCollection = </code><code class="keyword">new</code><code class="plain"> DiscountCollection(</code><code class="keyword">new</code><code class="plain">[] { customDiscount });</code></div>
<div class="line"><code class="plain">            discountGroups.Add(discountCollection);</code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line"><code class="plain">    }    </code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
</li><li class=" "><p>Save all changes and <strong class=" ">Build</strong> the custom project.</p>
</li></ol><p>The registered <strong class=" ">CustomProductDiscountSource</strong> implementation extends the Kentico product-level discounts. The custom discount source retains the default catalog and volume discount functionality by inheriting from the <strong class=" ">ProductDiscountSource</strong> class (the default implementation of <i class=" ">IProductDiscountSource</i>). The added custom discount affects both price calculations during the checkout process and prices displayed in product catalogs on the live site (when using appropriate <a href="reference---transformation-methods">transformation methods</a>).</p>
    <h3 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Example – Using custom volume discounts</span></h3>
<p>The following example demonstrates how to override the default volume discount functionality of Kentico. The example defines the volume discount rules directly in the code, but you can use the same basic approach to load the discount parameters from an external source or service.</p>
<ol class=" "><li class=" "><p>Recreate or reuse the custom project from the <a href="#src-76842976_safe-id-q3vzdg9taxppbmdkaxnjb3vudhmtrxhhbxbszekak0fkzgluz2fjdxn0b21wcm9kdwn0zglzy291bnq">previous example</a>.</p>
</li><li class=" "><p>Add a new class under the custom project, implementing the <i class=" ">IVolumeDiscountSource</i> interface.</p>
</li><li class=" "><p>Save all changes and <strong class=" ">Build</strong> the custom project.</p>
</li></ol>    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="keyword">using</code><code class="plain"> CMS;</code></div>
<div class="line"><code class="keyword">using</code><code class="plain"> CMS.Ecommerce;</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="comments">// Registers the custom implementation of IVolumeDiscountSource</code></div>
<div class="line"><code class="plain">[assembly: RegisterImplementation(</code><code class="keyword">typeof</code><code class="plain">(IVolumeDiscountSource), </code><code class="keyword">typeof</code><code class="plain">(CustomVolumeDiscountSource))]</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="keyword">public</code><code class="plain"> </code><code class="keyword">class</code><code class="plain"> CustomVolumeDiscountSource : IVolumeDiscountSource</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">    </code><code class="comments">/// &lt;summary&gt;</code></div>
<div class="line"><code class="plain">    </code><code class="comments">/// Returns an appropriate volume discount for a specified product (SKU) and unit quantity.</code></div>
<div class="line"><code class="plain">    </code><code class="comments">/// &lt;/summary&gt;</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">public</code><code class="plain"> VolumeDiscountInfo GetDiscount(SKUInfo sku, </code><code class="keyword">decimal</code><code class="plain"> quantity)</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        </code><code class="comments">// No volume discount applies if the unit quantity is lower than 3</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">if</code><code class="plain"> (quantity &lt; 3)</code></div>
<div class="line"><code class="plain">        {</code></div>
<div class="line"><code class="plain">            </code><code class="keyword">return</code><code class="plain"> </code><code class="keyword">null</code><code class="plain">;</code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">        </code><code class="comments">// Defines a custom volume discount</code></div>
<div class="line"><code class="plain">        </code><code class="comments">// The discount value is percentage-based, calculated according to the purchased unit quantity</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">var</code><code class="plain"> customVolumeDiscount = </code><code class="keyword">new</code><code class="plain"> VolumeDiscountInfo</code></div>
<div class="line"><code class="plain">        {</code></div>
<div class="line"><code class="plain">            VolumeDiscountSKUID = sku.SKUID,</code></div>
<div class="line"><code class="plain">            VolumeDiscountMinCount = 3,</code></div>
<div class="line"><code class="plain">            VolumeDiscountIsFlatValue = </code><code class="keyword">false</code><code class="plain">,</code></div>
<div class="line"><code class="plain">            VolumeDiscountValue = GetDiscountValue(quantity)</code></div>
<div class="line"><code class="plain">        };</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">        </code><code class="keyword">return</code><code class="plain"> customVolumeDiscount;        </code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">    </code></div>
<div class="line"><code class="plain">    </code><code class="comments">/// &lt;summary&gt;</code></div>
<div class="line"><code class="plain">    </code><code class="comments">/// Calculates the volume discount value based on the unit quantity.</code></div>
<div class="line"><code class="plain">    </code><code class="comments">/// &lt;/summary&gt;</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">private</code><code class="plain"> </code><code class="keyword">decimal</code><code class="plain"> GetDiscountValue(</code><code class="keyword">decimal</code><code class="plain"> quantity)</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        </code><code class="comments">// 5% discount if the unit quantity is at least 3, but below 5</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">if</code><code class="plain"> (quantity &lt; 5)</code></div>
<div class="line"><code class="plain">        {</code></div>
<div class="line"><code class="plain">            </code><code class="keyword">return</code><code class="plain"> 5m;</code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line"><code class="plain">        </code><code class="comments">// 10% discount if the unit quantity is at least 5, but below 10</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">if</code><code class="plain"> (quantity &lt; 10)</code></div>
<div class="line"><code class="plain">        {</code></div>
<div class="line"><code class="plain">            </code><code class="keyword">return</code><code class="plain"> 10m;</code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line"><code class="plain">        </code><code class="comments">// 15% discount if the unit quantity is at least 10, but below 15</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">if</code><code class="plain"> (quantity &lt; 15)</code></div>
<div class="line"><code class="plain">        {</code></div>
<div class="line"><code class="plain">            </code><code class="keyword">return</code><code class="plain"> 15m;</code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line"><code class="plain">        </code><code class="comments">// 20% discount for 15 or more units</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">return</code><code class="plain"> 20m;</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p>The registered <strong class=" ">CustomVolumeDiscountSource</strong> implementation fully replaces the default Kentico volume discounts. When a customer adds the required number of product units to their shopping cart, the system automatically applies the corresponding discount to the unit price. Any <a href="working-with-volume-discounts">volume discounts</a> defined in the Kentico administration interface no longer apply.<br></p>
        </div>

    </article>


               
            
    <footer id="ht-footer">
    <a href="#" id="ht-jump-top" class="sp-aui-icon-small sp-aui-iconfont-arrows-up"></a>
</footer></div>

<div>
    <div id="ht-mq-detect"></div>
</div>

    <script src="js/lunr.js"></script>
    <script src="js/lunr-extras.js"></script>
    <script src="assets/js/scroll-search.js"></script>

    <script src="assets/js/expand-macro.js"></script>


</body></html>