<!DOCTYPE html><html><head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Developing for Microsoft Azure - best practices - Kentico 11 Documentation</title>

    
    <link rel="stylesheet" href="assets/css/expand-macro.css">

            <meta name="scroll-content-language-key" content="">
    
    <meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=2.0, user-scalable=yes">

<script type="text/javascript" src="assets/js/jquery.min.js"></script>
<script type="text/javascript" src="assets/js/jquery.scrollTo.min.js"></script>


<script type="text/javascript" src="assets/js/translate.js"></script>

<script type="text/javascript" src="assets/js/theme.main.js"></script>

    <script type="text/javascript" src="assets/js/iframeResizer.min.js"></script>

<link rel="stylesheet" href="assets/css/content-style.css">
    <link rel="stylesheet" href="assets/css/search.css">

<link rel="stylesheet" href="assets/css/theme.main.css">
<link rel="stylesheet" href="assets/css/theme.colors.css">

            <!-- ES5 support for older browsers, needed by lunr -->
        <script src="js/augment.js"></script> 
        <script id="worker" type="javascript/worker">

        startIndex = function() {
            idx = lunr.Index.load(lunrIndex);
            idx.pipeline.remove(lunr.stopWordFilter);
            postMessage({type: "setup-complete"});
        }

        onmessage = function (event) {
            var message = event.data;

            if ((message.type === 'setup') && message.baseUrl) {
                var url = message.baseUrl;
                importScripts(url + 'js/lunr.js');
                importScripts(url + 'js/lunr-extras.js');
                importScripts(url + 'js/lunr-index.js');
                importScripts(url + 'js/lunr-data.js');
                startIndex();
            }

            if (idx && (message.type === 'search-request') && message.query) {
                var searchWord = message.query;
                var results = idx.search(searchWord).map(function (result) {
                    return lunrData.filter(function (d) {
                        return d.id === parseInt(result.ref, 10)
                    })[0]
                });
                postMessage({type: 'search-results', results: results, query: searchWord, queryId: message.queryId});
            }
        }

    </script>
    </head>

<body pageid="68879260" elementpageid="68881700">

<div id="ht-loader">
    <noscript>
        <p style="width: 100%; text-align:center; position: absolute; margin-top: 200px;">This content cannot be displayed without JavaScript.<br>Please enable JavaScript and reload the page.</p>
    </noscript>
</div>

<div>
   	<header id="ht-headerbar">
    <div class="ht-headerbar-left">
        <a href="" id="ht-menu-toggle" class="sp-aui-icon-small sp-aui-iconfont-appswitcher"></a>
    </div>
    <div class="ht-headerbar-right">
            <div class="sp-aui-icon-small ht-search-index-loader ht-header-icon"></div>

        <div id="ht-search">
            <div class="ht-search-input" style="display: none;">
              	<a href="#" class="sp-aui-icon-small sp-aui-iconfont-remove ht-search-clear"></a>

                <form action="#" method="GET" id="search">
                    <input class="search-input" type="text" placeholder="Search" tabindex="-1" autocomplete="off" name="q" value="">
                    <input type="hidden" name="max" value="15">
                    <input type="submit" style="display:none" tabindex="-4">
                </form>

                <a href="#" id="ht-search-button" class="ht-header-icon ht-header-icon-svg">
                                        <svg width="40px" height="40px" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                        <g>
                            <path d="M29.572,28.802 L28.801,29.571 C28.515,29.857 28.187,30 27.816,30 C27.445,30 27.116,29.857 26.831,29.571 L21.392,24.134 C20.193,24.762 18.908,25.076 17.538,25.076 C15.396,25.076 13.605,24.348 12.163,22.892 C10.721,21.436 10,19.651 10,17.538 C10,15.397 10.721,13.605 12.163,12.163 C13.605,10.721 15.396,10 17.538,10 C19.651,10 21.434,10.721 22.89,12.163 C24.347,13.605 25.075,15.397 25.075,17.538 C25.075,18.937 24.761,20.222 24.132,21.393 L29.572,26.832 C29.857,27.118 30,27.446 30,27.817 C30,28.188 29.857,28.517 29.572,28.802 L29.572,28.802 Z M13.662,21.414 C14.732,22.485 16.024,23.02 17.538,23.02 C19.051,23.02 20.343,22.485 21.413,21.414 C22.484,20.344 23.019,19.052 23.019,17.538 C23.019,16.025 22.484,14.733 21.413,13.662 C20.343,12.592 19.051,12.056 17.538,12.056 C16.024,12.056 14.732,12.592 13.662,13.662 C12.591,14.733 12.056,16.025 12.056,17.538 C12.056,19.052 12.591,20.344 13.662,21.414 L13.662,21.414 Z"></path>
                        </g>
                    </svg>
              	</a>

                <div class="ht-search-dropdown ht-dropdown">
                    <ul></ul>
                </div>
            </div>
        </div>
    </div>
    </header>   	<aside id="ht-sidebar">
    <div class="ht-sidebar-content">
        <div class="ht-sidebar-content-scroll-container">
            <header class="ht-sidebar-header">
                <h1 class="ht-logo">
                    <span class="ht-logo-label">K11</span>
                    <img class="space-logo" src="global.logo">
                </h1>
                <a href="Kentico-11-Documentation-Home.html" class="ht-space-link">
                    <h2>Kentico 11 Documentation</h2>
                </a>
            </header>
                            <iframe id="ht-nav" src="toc.html?pageId=68881700"></iframe>
                <script>
                    $('iframe#ht-nav').iFrameResize(
                            { 'log': true, 'autoResize': true, 'heightCalculationMethod': 'lowestElement', 'checkOrigin': false });
                </script>
                    </div>
    </div>

</aside></div>

<div id="ht-wrap-container">

            
    <div id="ht-sidebar-dragbar">
    <div class="ht-sidebar-drag-handle">
        <span class="drag-handle-1"></span>
        <span class="drag-handle-2"></span>
        <span class="drag-handle-3"></span>
    </div>
</div>
    <article id="ht-content" class="ht-content">
        <header class="ht-content-header">
            <div id="ht-breadcrumb">
    <ul>
        <li><a href="Kentico-11-Documentation-Home.html">Kentico 11 Documentation</a></li>
                                                                                     <li><a href="Running-Kentico-on-Microsoft-Azure.html">Running Kentico on Microsoft Azure</a></li>
                                                            </ul>
</div>            <h1 id="src-68881700"> <span>Developing for Microsoft Azure - best practices</span></h1>
        </header>

        <div id="main-content" class="wiki-content sp-grid-section" data-index-for-search="true">
<div class="sp-grid-cell sp-grid-60"></div><p>There are usually several different ways of how to set up the development environment for your Kentico projects running on Azure. This page provides our recommendations on the best options, explains several pitfalls you might encounter and offers solutions to certain problems.</p>
<p>Please note that some recommendations apply only to certain Azure environments, so <strong class=" ">proceed with the topics that apply to your environment</strong>.</p>
<p><span id="src-68881700_DevelopingforMicrosoftAzurebestpractices-Top"></span></p>
    <div class="confbox panel">
            <div class="panel-content">
    <h4 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Azure Web Apps</span></h4>
<p><span class="status green ">WEB APPS</span>
</p>
<p></p>
<ul class="toc-indentation "><li class=" "><p><a href="#src-68881700_developingformicrosoftazurebestpractices-database">Database</a></p>
<ul class="toc-indentation "><li class=" "><p><a href="#src-68881700_developingformicrosoftazurebestpractices-databaseconnectionslimit">Database connections limit</a></p>
</li></ul></li><li class=" "><p><a href="#src-68881700_developingformicrosoftazurebestpractices-webfarms">Web farms</a></p>
<ul class="toc-indentation "><li class=" "><p><a href="#src-68881700_safe-id-rgv2zwxvcgluz2zvck1py3jvc29mdef6dxjlymvzdhbyywn0awnlcy1uagvudw1izxjvzmluc3rhbmnlcyh3zwjmyxjtc2vydmvycylizwluz3vzzwrpc25vdghpz2hlcnroyw50agvudw1izxjvzndlymzhcm1zzxj2zxjzaw5jbhvkzwrpbnlvdxjsawnlbnnl">The number of instances (web farm servers) being used is not higher than the number of web farm servers included in your license</a></p>
</li></ul></li><li class=" "><p><a href="#src-68881700_developingformicrosoftazurebestpractices-storage">Storage</a></p>
<ul class="toc-indentation "><li class=" "><p><a href="#src-68881700_developingformicrosoftazurebestpractices-eachprojecthasitsownblobstorageorblobstoragecontainer">Each project has its own blob storage or blob storage container</a></p>
</li><li class=" "><p><a href="#src-68881700_developingformicrosoftazurebestpractices-thecmshashstringsaltkeyisidenticalinallenvironments">The CMSHashStringSalt key is identical in all environments</a></p>
</li><li class=" "><p><a href="#src-68881700_developingformicrosoftazurebestpractices-mediafilesstoredonblobstoragearedividedintofolders">Media files stored on blob storage are divided into folders</a></p>
</li><li class=" "><p><a href="#src-68881700_developingformicrosoftazurebestpractices-azurewebappshavetheblobstorageconfiguredinoneoftherecommendedways">Azure Web Apps have the blob storage configured in one of the recommended ways</a></p>
</li></ul></li><li class=" "><p><a href="#src-68881700_developingformicrosoftazurebestpractices-temporaryandcachedfiles">Temporary and cached files</a></p>
<ul class="toc-indentation "><li class=" "><p><a href="#src-68881700_developingformicrosoftazurebestpractices-deletingfilesfromtheazurecacheandazuretempfolders">Deleting files from the AzureCache and AzureTemp folders</a></p>
</li><li class=" "><p><a href="#src-68881700_developingformicrosoftazurebestpractices-preventingazurecachefoldersfrombloating">Preventing Azure cache folders from bloating</a></p>
</li></ul></li><li class=" "><p><a href="#src-68881700_developingformicrosoftazurebestpractices-locallystoredsearchindexes">Locally stored search indexes</a></p>
</li></ul><p></p>
        </div>
    </div>
    <div class="confbox panel">
            <div class="panel-content">
    <h4 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Azure Cloud Services</span></h4>
<p><span class="status blue ">CLOUD SERVICES</span>
</p>
<p></p>
<ul class="toc-indentation "><li class=" "><p><a href="#src-68881700_developingformicrosoftazurebestpractices-database">Database</a></p>
<ul class="toc-indentation "><li class=" "><p><a href="#src-68881700_developingformicrosoftazurebestpractices-productionandstagingdeploymentshaveindividualdatabases">Production and staging deployments have individual databases</a></p>
</li><li class=" "><p><a href="#src-68881700_developingformicrosoftazurebestpractices-onedeploymenthasoneproductiondatabase">One deployment has one production database</a></p>
</li><li class=" "><p><a href="#src-68881700_developingformicrosoftazurebestpractices-databaseconnectionslimit">Database connections limit</a></p>
</li></ul></li><li class=" "><p><a href="#src-68881700_developingformicrosoftazurebestpractices-webfarms">Web farms</a></p>
<ul class="toc-indentation "><li class=" "><p><a href="#src-68881700_safe-id-rgv2zwxvcgluz2zvck1py3jvc29mdef6dxjlymvzdhbyywn0awnlcy1uagvudw1izxjvzmluc3rhbmnlcyh3zwjmyxjtc2vydmvycylizwluz3vzzwrpc25vdghpz2hlcnroyw50agvudw1izxjvzndlymzhcm1zzxj2zxjzaw5jbhvkzwrpbnlvdxjsawnlbnnl">The number of instances (web farm servers) being used is not higher than the number of web farm servers included in your license</a></p>
</li><li class=" "><p><a href="#src-68881700_developingformicrosoftazurebestpractices-web.configkeysrelatedtowebfarmsarenotset">Web.config keys related to web farms are not set</a></p>
</li><li class=" "><p><a href="#src-68881700_developingformicrosoftazurebestpractices-webfarmmodesettingissetbythesystem">Web farm mode setting is set by the system</a></p>
</li></ul></li><li class=" "><p><a href="#src-68881700_developingformicrosoftazurebestpractices-storage">Storage</a></p>
<ul class="toc-indentation "><li class=" "><p><a href="#src-68881700_safe-id-rgv2zwxvcgluz2zvck1py3jvc29mdef6dxjlymvzdhbyywn0awnlcy1fywnozgv2zwxvcg1lbnqsc3rhz2luz29ychjvzhvjdglvbmvudmlyb25tzw50agfzaxrzb3duymxvynn0b3jhz2u">Each development, staging or production environment has its own blob storage</a></p>
</li><li class=" "><p><a href="#src-68881700_developingformicrosoftazurebestpractices-eachprojecthasitsownblobstorageorblobstoragecontainer">Each project has its own blob storage or blob storage container</a></p>
</li><li class=" "><p><a href="#src-68881700_developingformicrosoftazurebestpractices-thecmshashstringsaltkeyisidenticalinallenvironments">The CMSHashStringSalt key is identical in all environments</a></p>
</li><li class=" "><p><a href="#src-68881700_developingformicrosoftazurebestpractices-mediafilesstoredonblobstoragearedividedintofolders">Media files stored on blob storage are divided into folders</a></p>
</li><li class=" "><p><a href="#src-68881700_developingformicrosoftazurebestpractices-thewebanalyticsstoragefolderismappedtotheserverfilesystem">The Web analytics storage folder is mapped to the server file system</a></p>
</li></ul></li><li class=" "><p><a href="#src-68881700_developingformicrosoftazurebestpractices-temporaryandcachedfiles">Temporary and cached files</a></p>
<ul class="toc-indentation "><li class=" "><p><a href="#src-68881700_developingformicrosoftazurebestpractices-deletingfilesfromtheazurecacheandazuretempfolders">Deleting files from the AzureCache and AzureTemp folders</a></p>
</li><li class=" "><p><a href="#src-68881700_developingformicrosoftazurebestpractices-increasingthesizeofazurecacheandazuretempfolders">Increasing the size of AzureCache and AzureTemp folders</a></p>
</li><li class=" "><p><a href="#src-68881700_developingformicrosoftazurebestpractices-preventingazurecachefoldersfrombloating">Preventing Azure cache folders from bloating</a></p>
</li></ul></li><li class=" "><p><a href="#src-68881700_developingformicrosoftazurebestpractices-locallystoredsearchindexes">Locally stored search indexes</a></p>
</li></ul><p></p>
        </div>
    </div>
    <div class="confbox panel">
            <div class="panel-content">
    <h4 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Standard server connected to an Azure Blob Storage</span></h4>
<p><span class="status yellow ">BLOB STORAGE</span>
 Details: <a href="configuring-azure-storage">Configuring Azure storage</a></p>
<p></p>
<ul class="toc-indentation "><li class=" "><p><a href="#src-68881700_developingformicrosoftazurebestpractices-storage">Storage</a></p>
<ul class="toc-indentation "><li class=" "><p><a href="#src-68881700_developingformicrosoftazurebestpractices-eachprojecthasitsownblobstorageorblobstoragecontainer">Each project has its own blob storage or blob storage container</a></p>
</li><li class=" "><p><a href="#src-68881700_developingformicrosoftazurebestpractices-mediafilesstoredonblobstoragearedividedintofolders">Media files stored on blob storage are divided into folders</a></p>
</li></ul></li><li class=" "><p><a href="#src-68881700_developingformicrosoftazurebestpractices-temporaryandcachedfiles">Temporary and cached files</a></p>
<ul class="toc-indentation "><li class=" "><p><a href="#src-68881700_developingformicrosoftazurebestpractices-deletingfilesfromtheazurecacheandazuretempfolders">Deleting files from the AzureCache and AzureTemp folders</a></p>
</li><li class=" "><p><a href="#src-68881700_developingformicrosoftazurebestpractices-preventingazurecachefoldersfrombloating">Preventing Azure cache folders from bloating</a></p>
</li></ul></li></ul><p></p>
        </div>
    </div>
    <h3 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Database</span></h3>
<p>General rule: every deployment and every project must be connected to its own database, and only one database.</p>
    <h4 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Production and staging deployments have individual databases</span></h4>
<p>Applies to: <span class="status green ">WEB APPS</span>
 <span class="status blue ">CLOUD SERVICES</span>
</p>
<p>When you use a staging environment to test your website before promoting it to production, always use different databases for each deployment (slot). This ensures that your staging deployment, does not damage your production database.</p>
<p><img class="confluence-embedded-image" src="images/download/attachments/68881700/Azure_projects_with_databases.png" alt="images/download/attachments/68881700/Azure_projects_with_databases.png">
        <br><span class="caption">Setup of Azure deployment slots for production and staging</span>
    </p>
<p>To set up your projects this way, modify the connection string in your local project to connect to a different database (you can create a copy of your production database through the Azure management portal) than your production project before you deploy the project to the staging slot.</p>
<p>If you need to switch the staging and production deployments but not the databases, you can set different connection strings in the <a class="external-link" href="https://portal.azure.com/">Azure Management Portal</a>.</p>
<p>For web apps:</p>
<ol class=" "><li class=" "><p>Select your App service in the management portal.</p>
</li><li class=" "><p>Open the <strong class=" ">Application settings</strong> tab.</p>
</li><li class=" "><p>Configure the <strong class=" ">CMSConnectionString</strong> in the <i class=" ">Connection strings</i> section to connect either to the product or the copied database.</p>
</li></ol><p>For cloud services:</p>
<ol class=" "><li class=" "><p>Select your Cloud service in the management portal.</p>
</li><li class=" "><p>Open the <strong class=" ">Configuration</strong> tab.</p>
</li><li class=" "><p>Select <strong class=" ">Production</strong> or <strong class=" ">Staging</strong> slot and configure the <strong class=" ">CMSConnectionString</strong> key to connect either to the production database or the copied database.</p>
</li></ol>    <h4 $stringutils.tolowercase(${idattribute})="" class="heading "><span>One deployment has one production database</span></h4>
<p>Applies to: <span class="status green ">WEB APPS</span>
 <span class="status blue ">CLOUD SERVICES</span>
</p>
<p>If you want to increase the number of web role instances in your production project to create a web farm, always use only one database for the whole deployment.</p>
<p>By increasing the number of web role instances, you assign more virtual machines to your project. This creates a web farm. Using the Automatic web farm functionality, the system creates web farm servers dynamically according to the assigned virtual machines (instances). See <a href="setting-up-web-farms">Setting up web farms</a> for more information on web farm functionality.</p>
<p>However, for the web farm to work, all web role instances of your cloud service must <strong class=" ">use the same database</strong>. The only thing you need to do is to set one connection string for your whole production project.</p>
<p><img class="confluence-embedded-image" src="images/download/attachments/68881700/Web_farm_on_Azure.png" alt="images/download/attachments/68881700/Web_farm_on_Azure.png">
        <br><span class="caption">Web farm environment of an Azure production project</span>
    </p>
    <div class="confbox admonition admonition-note">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p><strong class=" ">Note:</strong> Do not increase the number of instances of the Smart search worker role.</p>
        </div>
    </div>
    <div class="confbox admonition admonition-note">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p><strong class=" ">Geo-replication</strong></p>
<p>Please note that Kentico does NOT support geo-replication for databases. You can use some of the following recommendations instead:</p>
<ul class=" "><li class=" "><p>Scale your application to multiple instances for load balancing.</p>
</li><li class=" "><p>Use <a href="configuring-azure-cdn">Content Delivery Network</a> to speed up delivery of files.</p>
</li><li class=" "><p>Use two separate environments synchronized through <a href="content-staging">content staging</a>.</p>
</li></ul>        </div>
    </div>
    <h4 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Database connections limit</span></h4>
<p>Applies to: <span class="status green ">WEB APPS</span>
 <span class="status blue ">CLOUD SERVICES</span>
</p>
<p>If you need to adjust the database connections limit using the <strong class=" ">Max Pool Size</strong> attribute in the connection string, see <a class="external-link" href="https://docs.microsoft.com/en-us/azure/sql-database/sql-database-resource-limits">Azure SQL Database resource limits</a>.</p>
<p>When setting the limit, the value is for all web roles and worker roles combined (in case of Azure Cloud Services). This means that if you want to set the maximum limit of concurrent requests to the database to 180 and you have 2 CMSApp web roles and one SmartSearchWorker role, then you should set the pool to the maximum size of 60.</p>
    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">&lt;</code><code class="keyword">connectionStrings</code><code class="plain">&gt;</code></div>
<div class="line"><code class="plain">    &lt;</code><code class="keyword">add</code><code class="plain"> </code><code class="color1">name</code><code class="plain">=</code><code class="string">"CMSConnectionString"</code><code class="plain"> </code><code class="color1">connectionString</code><code class="plain">=</code><code class="string">"Data Source=tcp:YourServerName.database.windows.net,1433;Initial Catalog=YourDatabaseName;User Id=YourUsername@YourServerName;Password=YourPassword;Max Pool Size=60"</code><code class="plain"> /&gt;</code></div>
<div class="line"><code class="plain">&lt;/</code><code class="keyword">connectionStrings</code><code class="plain">&gt;</code></div>
</div>
    </div>
<p class="title">There is no need to adjust this value if you do not have specific reasons to do so or encounter the error 10928.</p>
<p class="title"><a href="#src-68881700_developingformicrosoftazurebestpractices-top">&gt; Back to the top list</a></p>
    <h3 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Web farms</span></h3>
    <h4 $stringutils.tolowercase(${idattribute})="" class="heading "><span>The number of instances (web farm servers) being used is not higher than the number of web farm servers included in your license</span></h4>
<p>Applies to: <span class="status green ">WEB APPS</span>
 <span class="status blue ">CLOUD SERVICES</span>
</p>
<p>Do not increase the number of instances of your Azure project unless you have obtained a license with a corresponding number of web farm servers included. If you increase the number of instances beyond the number your license allows, the web farm server functionality will stop working completely.</p>
<p>Please contact your account manager to obtain a license for a higher number of web farm servers before increasing the number of instances in your Azure project.</p>
    <h4 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Web.config keys related to web farms are not set</span></h4>
<p>Applies to: <span class="status blue ">CLOUD SERVICES</span>
</p>
<p>Please do not configure any web.config keys related to web farms in your Azure projects. The Azure projects have web farms configured automatically and setting these keys may disrupt the system.</p>
    <h4 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Web farm mode setting is set by the system</span></h4>
<p>Applies to: <span class="status blue ">CLOUD SERVICES</span>
</p>
<p>Because Azure projects have web farm mechanisms configured <i class=" ">automatically</i>, the <strong class=" ">Web farm mode</strong> setting which you can configure in the administration interface does not have any effect on the system. You can find the setting in the <strong class=" ">Settings</strong> application <strong class=" ">-&gt; Versioning &amp; Synchronization -&gt; Web farm</strong>.</p>
<p>The other settings, that can be used on Azure, are described in <a href="settings---web-farm">Settings - Web farm</a>.</p>
    <div class="confbox admonition admonition-warning">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p><strong class=" ">Enabling web farms on Azure Web Apps</strong></p>
<p>This section applies only to Azure projects deployed in Azure Cloud Services. Other projects do not have web farms configured automatically and these settings work as usual. If you create an <strong class=" ">Azure Web App</strong> by deploying a project from Visual Studio (see <a href="setting-up-kentico-in-azure-web-apps#src-68881682_settingupkenticoinazurewebapps-creatingazurewebappsfromvisualstudio">Creating Web Apps from Visual Studio</a>), you need to enable web farm functionality manually. See <a href="enabling-web-farms-on-azure-web-apps">Enabling web farms on Azure Web Apps</a> for details.</p>
        </div>
    </div>
<p><a href="#src-68881700_developingformicrosoftazurebestpractices-top">&gt; Back to the top list</a></p>
    <h3 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Storage</span></h3>
    <h4 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Each development, staging or production environment has its own blob storage</span></h4>
<p>Applies to: <span class="status blue ">CLOUD SERVICES</span>
</p>
<p>We recommend that every environment you use (local project, staging deployment or production deployment) is connected to a <strong class=" ">different Azure blob storage</strong>. If you use only one storage for all your environments, the system will be inconsistent. For example, deleting a media library file in the local project will lead to missing references in the production project, if the file is used there. You can also configure your projects to use <strong class=" ">different containers</strong> on one blob storage – <a href="#src-68881700_developingformicrosoftazurebestpractices-eachprojecthasitsownblobstorageorblobstoragecontainer">see the next section</a>.</p>
<p><img class="confluence-embedded-image" src="images/download/attachments/68881700/Azure_And_local_project_staging.png" alt="images/download/attachments/68881700/Azure_And_local_project_staging.png">
        <br><span class="caption">Using a different storage for each development or production environment</span>
    </p>
<p>We also recommend that you implicitly connect your local development project to an Azure blob storage instead of the default locally emulated storage. Using the Azure blob storage from the beginning allows you to access the storage from anywhere and may prevent difficulties when moving files between local file system and the blob storage. If you do not abide by this recommendation, you will have to update all media links manually after you move the media files to the blob storage. Or, you will have to deploy the media files together with the project in its file system, which can be problematic, as this usually greatly increases the size of the deployment package.</p>
<p>For synchronizing files and changes between the different storages of each environment, you can use the <a href="content-staging">Content staging</a> module. However, the <strong class=" ">CMSHashStringSalt</strong> key value in the web.config file must be identical in all environments for the Staging module to work properly. See the next section for details.</p>
    <h4 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Each project has its own blob storage or blob storage container</span></h4>
<p>Applies to: <span class="status green ">WEB APPS</span>
 <span class="status blue ">CLOUD SERVICES</span>
 <span class="status yellow ">BLOB STORAGE</span>
</p>
<p>If you have multiple projects connected to Azure Blob Storage, for example for testing and production, every project must have its own blob storage or at least a different blob storage container configured.</p>
<p>To configure your projects to use different containers, add the following key to the web.config file with the name of the new container as its value. Set a different value for each project.</p>
<ul class=" "><li class=" "><p><strong class=" ">CMSAzureRootContainer</strong> - this key specifies the name of the blob container that will serve as the root of the application's file system on the Azure Blob Storage account. The default value is cmsstorage.</p>
</li></ul>    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">&lt;add key=</code><code class="string">"CMSAzureRootContainer"</code><code class="plain"> value=</code><code class="string">"CustomRoot"</code><code class="plain">/&gt;</code></div>
</div>
    </div>
    <h4 $stringutils.tolowercase(${idattribute})="" class="heading "><span>The CMSHashStringSalt key is identical in all environments</span></h4>
<p>Applies to: <span class="status green ">WEB APPS</span>
 <span class="status blue ">CLOUD SERVICES</span>
 all projects that use <a href="content-staging">Content staging</a></p>
<p>The <strong class=" ">CMSHashStringSalt</strong> key defines the salt value that the system uses in hash functions, for example in <a href="working-with-macro-signatures">macro signatures</a> and media library links. For the content to be synchronized properly through Content staging, the value of this key must be identical in all environments you use. Otherwise, the hash values of objects will be different in different environments. Therefore, make sure that the value of this web.config key is set to a single static value, for example a random GUID, before you deploy your project to the Azure environment.</p>
    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">&lt;</code><code class="keyword">appSettings</code><code class="plain">&gt;</code></div>
<div class="line"><code class="plain">	&lt;</code><code class="keyword">add</code><code class="plain"> </code><code class="color1">key</code><code class="plain">=</code><code class="string">"CMSHashStringSalt"</code><code class="plain"> </code><code class="color1">value</code><code class="plain">=</code><code class="string">"eb2d6fac-8b9e-427c-b98b-3c562dffbb35"</code><code class="plain"> /&gt;</code></div>
<div class="line"><code class="plain">&lt;/</code><code class="keyword">appSettings</code><code class="plain">&gt;</code></div>
</div>
    </div>
    <h4 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Media files stored on blob storage are divided into folders</span></h4>
<p>Applies to: <span class="status green ">WEB APPS</span>
 <span class="status blue ">CLOUD SERVICES</span>
 <span class="status yellow ">BLOB STORAGE</span>
</p>
<p>Storing a large number of media files in a single folder can significantly affect the performance of your project when editing the files in the Media library application.</p>
<p>Instead of storing all files in one folder, create a structure and divide the files into multiple folders. The number of files in one folder directly affects the performance of the Media library user interface.</p>
    <h4 $stringutils.tolowercase(${idattribute})="" class="heading "><span>The Web analytics storage folder is mapped to the server file system</span></h4>
<p>Applies to: <span class="status blue ">CLOUD SERVICES</span>
</p>
<p>By default, <strong class=" ">web analytics logs</strong> are also stored on the blob storage. The Web analytics module writes and processes logs every minute, which can cause problems on the blob storage with latencies. Moreover, the Web analytics module can create a large number of files, which further degrades the performance of the blob storage.</p>
<p>We highly recommend that you map the folder which stores Web analytics data to the file system of the server. See <a href="mapping-the-web-analytics-storage-folder-to-the-server-file-system">Mapping the Web analytics storage folder to the server file system</a> for instructions.</p>
    <h4 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Azure Web Apps have the blob storage configured in one of the recommended ways</span></h4>
<p>Applies to: <span class="status green ">WEB APPS</span>
</p>
<p>See <a href="increasing-storage-capacity-on-azure-web-apps">Increasing storage capacity on Azure Web Apps</a>.</p>
<p><a href="#src-68881700_developingformicrosoftazurebestpractices-top">&gt; Back to the top list</a></p>
    <h3 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Temporary and cached files</span></h3>
    <h4 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Deleting files from the AzureCache and AzureTemp folders</span></h4>
<p>Applies to: <span class="status green ">WEB APPS</span>
 <span class="status blue ">CLOUD SERVICES</span>
 <span class="status yellow ">BLOB STORAGE</span>
</p>
<p>If Kentico is connected to the Azure Blob Storage, it creates two storage folders, <strong class=" ">AzureCache</strong> and <strong class=" ">AzureTemp</strong>, in its own file system. These folders store temporary files and their capacity is limited by default. If your project depletes the allocated space, local smart search indexes may stop working or media libraries may stop accepting files. This can result in the following error:</p>
    <div class="confbox admonition admonition-warning has-no-icon">
                        <div class="admonition-body">
<p><i class=" "><strong class=" ">"There is not enough space on the disk.</strong><strong class=" ">"</strong></i></p>
        </div>
    </div>
<p>If this happens, you can temporarily solve these problems by cleaning the AzureCache and AzureTemp folders. In order to solve the problem permanently, see <a href="preventing-azure-cache-folders-from-bloating">Preventing Azure cache folders from bloating</a>.</p>
<p>To delete files in <strong class=" ">AzureCache</strong> and <strong class=" ">AzureTemp</strong> folders:</p>
<ol class=" "><li class=" "><p>Connect to your project.</p>
<ul class=" "><li class=" "><p>Web Apps - you can use FTP or Visual Studio, etc.</p>
</li><li class=" "><p>Cloud Services - use remote desktop. In the Azure management portal, open your cloud service on the <strong class=" ">Instances</strong> tab and click <strong class=" ">Connect</strong>. Download the remote desktop file, run it and submit remote desktop credentials.</p>
</li></ul></li><li class=" "><p>Locate the<i class=" "> C:\Resources\Directory\&lt;GUID&gt;.CMSApp.AzureCache </i>and <i class=" "><i class=" ">C:\Resources\Directory\<i class=" ">&lt;GUID&gt;</i>.CMSApp.AzureTemp </i></i>folders and clean the temporary files from them<i class=" "><i class=" ">.</i></i></p>
</li></ol>    <h4 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Increasing the size of AzureCache and AzureTemp folders</span></h4>
<p>Applies to: <span class="status blue ">CLOUD SERVICES</span>
</p>
<p>To increase the size of these folders:</p>
<ol class=" "><li class=" "><p>Open your Azure project in Visual Studio.</p>
</li><li class=" "><p>Double-click the <strong class=" ">CMSApp</strong> role in <strong class=" ">CMSAzure\Roles</strong> folder.</p>
</li><li class=" "><p>Switch to the <strong class=" ">Local Storage</strong> tab.</p>
<ul class=" "><li class=" "><p>On this tab, you can set the size of these folders in Megabytes.</p>
</li><li class=" "><p>The<strong class=" "> Clean on role recycle</strong> option defines if the folder should be emptied when the web role is re-imaged form the deployment package (can happen automatically after updates).</p>
</li></ul></li></ol><p>You can also set the size of these folders in the ServiceDefinition.csdef file:</p>
    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">&lt;</code><code class="keyword">LocalResources</code><code class="plain">&gt;</code></div>
<div class="line"><code class="plain">	&lt;</code><code class="keyword">LocalStorage</code><code class="plain"> </code><code class="color1">name</code><code class="plain">=</code><code class="string">"AzureTemp"</code><code class="plain"> </code><code class="color1">cleanOnRoleRecycle</code><code class="plain">=</code><code class="string">"true"</code><code class="plain"> </code><code class="color1">sizeInMB</code><code class="plain">=</code><code class="string">"100000"</code><code class="plain">/&gt;</code></div>
<div class="line"><code class="plain">	&lt;</code><code class="keyword">LocalStorage</code><code class="plain"> </code><code class="color1">name</code><code class="plain">=</code><code class="string">"AzureCache"</code><code class="plain"> </code><code class="color1">cleanOnRoleRecycle</code><code class="plain">=</code><code class="string">"false"</code><code class="plain"> </code><code class="color1">sizeInMB</code><code class="plain">=</code><code class="string">"100000"</code><code class="plain">/&gt;</code></div>
<div class="line"><code class="plain">&lt;/</code><code class="keyword">LocalResources</code><code class="plain">&gt;</code></div>
</div>
    </div>
<p>You can find details about the allocated resources for web roles in the following article: <a class="external-link" href="https://docs.microsoft.com/en-us/azure/cloud-services/cloud-services-sizes-specs">Sizes for Cloud Services</a> (section <strong class=" ">Sizes for web and worker role instances</strong>). The local resource disk for the default Small web role instance is 224 GB large.</p>
    <h4 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Preventing Azure cache folders from bloating</span></h4>
<p>Applies to: <span class="status green ">WEB APPS</span>
 <span class="status blue ">CLOUD SERVICES</span>
 <span class="status yellow ">BLOB STORAGE</span>
</p>
<p>See <a href="preventing-azure-cache-folders-from-bloating">Preventing Azure cache folders from bloating</a> for more recommendations on how to keep these folders from getting full.</p>
<p><a href="#src-68881700_developingformicrosoftazurebestpractices-top">&gt; Back to the top list</a></p>
    <h3 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Locally stored search indexes</span></h3>
<p>To find tips about using local search indexes when running on Azure, see: <a href="troubleshooting-local-search-indexes-on-azure">Troubleshooting local search indexes on Azure</a></p>
        </div>

    </article>


               
            
    <footer id="ht-footer">
    <a href="#" id="ht-jump-top" class="sp-aui-icon-small sp-aui-iconfont-arrows-up"></a>
</footer></div>

<div>
    <div id="ht-mq-detect"></div>
</div>

    <script src="js/lunr.js"></script>
    <script src="js/lunr-extras.js"></script>
    <script src="assets/js/scroll-search.js"></script>

    <script src="assets/js/expand-macro.js"></script>


</body></html>