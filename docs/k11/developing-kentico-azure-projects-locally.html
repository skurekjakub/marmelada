<!DOCTYPE html><html><head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Developing Kentico Azure projects locally - Kentico 11 Documentation</title>

    
    <link rel="stylesheet" href="assets/css/expand-macro.css">

            <meta name="scroll-content-language-key" content="">
    
    <meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=2.0, user-scalable=yes">

<script type="text/javascript" src="assets/js/jquery.min.js"></script>
<script type="text/javascript" src="assets/js/jquery.scrollTo.min.js"></script>


<script type="text/javascript" src="assets/js/translate.js"></script>

<script type="text/javascript" src="assets/js/theme.main.js"></script>

    <script type="text/javascript" src="assets/js/iframeResizer.min.js"></script>

<link rel="stylesheet" href="assets/css/content-style.css">
    <link rel="stylesheet" href="assets/css/search.css">

<link rel="stylesheet" href="assets/css/theme.main.css">
<link rel="stylesheet" href="assets/css/theme.colors.css">

            <!-- ES5 support for older browsers, needed by lunr -->
        <script src="js/augment.js"></script> 
        <script id="worker" type="javascript/worker">

        startIndex = function() {
            idx = lunr.Index.load(lunrIndex);
            idx.pipeline.remove(lunr.stopWordFilter);
            postMessage({type: "setup-complete"});
        }

        onmessage = function (event) {
            var message = event.data;

            if ((message.type === 'setup') && message.baseUrl) {
                var url = message.baseUrl;
                importScripts(url + 'js/lunr.js');
                importScripts(url + 'js/lunr-extras.js');
                importScripts(url + 'js/lunr-index.js');
                importScripts(url + 'js/lunr-data.js');
                startIndex();
            }

            if (idx && (message.type === 'search-request') && message.query) {
                var searchWord = message.query;
                var results = idx.search(searchWord).map(function (result) {
                    return lunrData.filter(function (d) {
                        return d.id === parseInt(result.ref, 10)
                    })[0]
                });
                postMessage({type: 'search-results', results: results, query: searchWord, queryId: message.queryId});
            }
        }

    </script>
    </head>

<body pageid="68879260" elementpageid="68881711">

<div id="ht-loader">
    <noscript>
        <p style="width: 100%; text-align:center; position: absolute; margin-top: 200px;">This content cannot be displayed without JavaScript.<br>Please enable JavaScript and reload the page.</p>
    </noscript>
</div>

<div>
   	<header id="ht-headerbar">
    <div class="ht-headerbar-left">
        <a href="" id="ht-menu-toggle" class="sp-aui-icon-small sp-aui-iconfont-appswitcher"></a>
    </div>
    <div class="ht-headerbar-right">
            <div class="sp-aui-icon-small ht-search-index-loader ht-header-icon"></div>

        <div id="ht-search">
            <div class="ht-search-input" style="display: none;">
              	<a href="#" class="sp-aui-icon-small sp-aui-iconfont-remove ht-search-clear"></a>

                <form action="#" method="GET" id="search">
                    <input class="search-input" type="text" placeholder="Search" tabindex="-1" autocomplete="off" name="q" value="">
                    <input type="hidden" name="max" value="15">
                    <input type="submit" style="display:none" tabindex="-4">
                </form>

                <a href="#" id="ht-search-button" class="ht-header-icon ht-header-icon-svg">
                                        <svg width="40px" height="40px" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                        <g>
                            <path d="M29.572,28.802 L28.801,29.571 C28.515,29.857 28.187,30 27.816,30 C27.445,30 27.116,29.857 26.831,29.571 L21.392,24.134 C20.193,24.762 18.908,25.076 17.538,25.076 C15.396,25.076 13.605,24.348 12.163,22.892 C10.721,21.436 10,19.651 10,17.538 C10,15.397 10.721,13.605 12.163,12.163 C13.605,10.721 15.396,10 17.538,10 C19.651,10 21.434,10.721 22.89,12.163 C24.347,13.605 25.075,15.397 25.075,17.538 C25.075,18.937 24.761,20.222 24.132,21.393 L29.572,26.832 C29.857,27.118 30,27.446 30,27.817 C30,28.188 29.857,28.517 29.572,28.802 L29.572,28.802 Z M13.662,21.414 C14.732,22.485 16.024,23.02 17.538,23.02 C19.051,23.02 20.343,22.485 21.413,21.414 C22.484,20.344 23.019,19.052 23.019,17.538 C23.019,16.025 22.484,14.733 21.413,13.662 C20.343,12.592 19.051,12.056 17.538,12.056 C16.024,12.056 14.732,12.592 13.662,13.662 C12.591,14.733 12.056,16.025 12.056,17.538 C12.056,19.052 12.591,20.344 13.662,21.414 L13.662,21.414 Z"></path>
                        </g>
                    </svg>
              	</a>

                <div class="ht-search-dropdown ht-dropdown">
                    <ul></ul>
                </div>
            </div>
        </div>
    </div>
    </header>   	<aside id="ht-sidebar">
    <div class="ht-sidebar-content">
        <div class="ht-sidebar-content-scroll-container">
            <header class="ht-sidebar-header">
                <h1 class="ht-logo">
                    <span class="ht-logo-label">K11</span>
                    <img class="space-logo" src="global.logo">
                </h1>
                <a href="Kentico-11-Documentation-Home.html" class="ht-space-link">
                    <h2>Kentico 11 Documentation</h2>
                </a>
            </header>
                            <iframe id="ht-nav" src="toc.html?pageId=68881711"></iframe>
                <script>
                    $('iframe#ht-nav').iFrameResize(
                            { 'log': true, 'autoResize': true, 'heightCalculationMethod': 'lowestElement', 'checkOrigin': false });
                </script>
                    </div>
    </div>

</aside></div>

<div id="ht-wrap-container">

            
    <div id="ht-sidebar-dragbar">
    <div class="ht-sidebar-drag-handle">
        <span class="drag-handle-1"></span>
        <span class="drag-handle-2"></span>
        <span class="drag-handle-3"></span>
    </div>
</div>
    <article id="ht-content" class="ht-content">
        <header class="ht-content-header">
            <div id="ht-breadcrumb">
    <ul>
        <li><a href="Kentico-11-Documentation-Home.html">Kentico 11 Documentation</a></li>
                                                                                                             <li><a href="" onclick="$('.shortcut').each(function(){$(this).removeClass('shortcut')}); $(this).parent().addClass('shortcut'); return false;">...</a> </li>
                                        <li class="shortcut"><a href="Running-Kentico-on-Microsoft-Azure.html">Running Kentico on Microsoft Azure</a></li>
                                                                                     <li><a href="Running-Kentico-in-Azure-Cloud-Services.html">Running Kentico in Azure Cloud Services</a></li>
                                                            </ul>
</div>            <h1 id="src-68881711"> <span>Developing Kentico Azure projects locally</span></h1>
        </header>

        <div id="main-content" class="wiki-content sp-grid-section" data-index-for-search="true">
<div class="sp-grid-section"><div class="sp-grid-cell sp-grid-60"><p>You can start developing the application in the local computing emulator provided by Azure SDK. You can use the emulator to test the website during its development without actually hosting it in the cloud.</p><p>You can use either a standard SQL database or the Azure SQL Database (note that when developing locally with a database in the cloud, you may experience slower performance based on the location of the server and database services).</p><p>However, we recommend that you use a Microsoft Azure Storage account as a file system for your project.</p><h3 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Developing Azure projects locally in the emulator</span></h3><ol class=" "><li class=" "><p>Prepare an SQL database or prepare a database on Microsoft Azure:</p>
<ol class=" "><li class=" "><p><a href="preparing-the-azure-cloud-environment#src-68881718_preparingtheazurecloudenvironment-creatingamicrosoftazuresqlserverandadatabase">Create a new Azure SQL Server and a database</a>.</p>
</li><li class=" "><p><a href="preparing-the-azure-cloud-environment#src-68881718_preparingtheazurecloudenvironment-addingfirewallrulesforaserver">Add firewall rules for the server</a>.</p>
</li></ol></li><li class=" "><p><a href="preparing-the-azure-cloud-environment#src-68881718_preparingtheazurecloudenvironment-creatingamicrosoftazurestorage">Create an Azure Storage account</a> through the Microsoft Azure Management Portal.</p>
</li><li class=" "><p>Open your Azure project in Visual Studio.</p>
</li><li class=" "><p>Right-click the <strong class=" ">CMSAzure\Roles\CMSApp</strong> role and select <strong class=" ">Properties</strong>.</p>
</li><li class=" "><p>Switch to the <strong class=" ">Settings</strong> tab.</p>
</li><li class=" "><p>Select <strong class=" ">Local</strong> as the Service Configuration.</p>
</li><li class=" "><p>Set the value of <strong class=" ">CMSConnectionString</strong> key to the connection string for your database.</p>
<ul class=" "><li class=" "><p>If you are connecting to an Azure SQL Database, you can find the connection string on the <a class="external-link" href="https://portal.azure.com/">Azure Management Portal</a> in <strong class=" ">SQL Databases -&gt;</strong> select your database <strong class=" ">-&gt; Overview </strong>tab <strong class=" ">-&gt; Show database connection strings</strong> link.</p>
    <div class="confbox admonition admonition-tip">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p>Use 'username@servername' for the User ID connection string parameter.</p>
        </div>
    </div>
</li></ul></li><li class=" "><p>Based on what storage you want to use, choose one of the following options - either the Azure storage or the Storage emulator:<br></p>
<ul class=" "><li class=" "><p>Azure storage - set the values of <strong class=" ">CMSAzureAccountName</strong> and <strong class=" ">CMSAzureSharedKey</strong> keys for your Azure Storage.</p>
<ul class=" "><li class=" "><p>You can find these values on the <a class="external-link" href="https://portal.azure.com/">Azure Management Portal</a> in <strong class=" ">Your storage account</strong> <strong class=" ">-&gt; Access keys </strong>tab. Use the <strong class=" ">Storage account name</strong> and one of the generated access key values (Azure     <span style="color: #252525;">
provides two access keys so that you can maintain connections using one key while regenerating the other    </span>
).</p>
</li></ul></li><li class=" "><p>Storage emulator - set <i class=" "><strong class=" ">devstoreaccount1</strong> </i>as the <strong class=" ">CMSAzureAccountName</strong> and <i class=" "><strong class=" ">Eby8vdM02xNOcqFlqUwJPLlmEtlCDXJ1OUzFT50uSRZ6IFsuFq2UVErCz4I6tq/K1SZFPTOtr/KBHBeksoGMGw</strong></i><i class=" "><strong class=" ">==</strong></i> as the <strong class=" ">CMSAzureSharedKey</strong>.</p>
<ul class=" "><li class=" "><p>See <a class="external-link" href="https://docs.microsoft.com/en-us/azure/storage/storage-use-emulator">Use the Azure Storage Emulator for Development and Testing</a> for more information.</p>
</li></ul></li></ul></li><li class=" "><p>Repeat the same steps for the <strong class=" ">SmartSearchWorker</strong> role.</p>
</li><li class=" "><p>Right-click the <strong class=" ">CMSAzure</strong> project in the Solution Explorer and select <strong class=" ">Set as StartUp Project</strong>.</p>
</li><li class=" "><p>Run the project in the debug mode.</p>
</li><li class=" "><p>Go through the Kentico database installation when the system automatically opens the database installation in a browser.</p>
<ul class=" "><li class=" "><p>If developing on the Azure SQL Server, enter the SQL server name in the following format: <i class=" ">servername.database.windows.net</i>.<br></p>
<img class="confluence-embedded-image confluence-content-image-border" src="images/download/attachments/68881711/CloudServiceDatabaseInstall.png" alt="images/download/attachments/68881711/CloudServiceDatabaseInstall.png" width="500">
        <br><span class="caption">Setting up the Azure SQL server</span>
    </li></ul></li></ol><p>Your web project is now prepared for local development.</p><div class="confbox admonition admonition-note">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p><strong class=" ">CMSHashStringSalt key</strong></p>
<p>We recommend that you make sure that the <strong class=" ">CMSHashStringSalt</strong> key is set to a single static value in your web.config file. See <a href="developing-for-microsoft-azure---best-practices#src-68881700_developingformicrosoftazurebestpractices-thecmshashstringsaltkeyisidenticalinallenvironments">The CMSHashStringSalt key is identical in all environments</a>.</p>
        </div>
    </div><div class="sp-grid-section"></div></div><div class="sp-grid-cell sp-grid-40 sp-grid-sidebar"><div class="confbox panel">
            <div class="title panel-header">On this page</div>
            <div class="panel-content">
<p></p>
<ul class="toc-indentation "><li class=" "><p><a href="#src-68881711_developingkenticoazureprojectslocally-developingazureprojectslocallyintheemulator">Developing Azure projects locally in the emulator</a></p>
</li><li class=" "><p><a href="#src-68881711_developingkenticoazureprojectslocally-developingazureprojectslocallyaswebapplications">Developing Azure projects locally as web applications</a></p>
</li><li class=" "><p><a href="#src-68881711_developingkenticoazureprojectslocally-deployinglocallydevelopedazureprojects">Deploying locally developed Azure projects</a></p>
<ul class="toc-indentation "><li class=" "><p><a href="#src-68881711_developingkenticoazureprojectslocally-deploymentwithmigrationtoanewdatabase">Deployment with migration to a new database</a></p>
</li><li class=" "><p><a href="#src-68881711_developingkenticoazureprojectslocally-deploymentwhenusingthesamedatabase">Deployment when using the same database</a></p>
</li><li class=" "><p><a href="#src-68881711_developingkenticoazureprojectslocally-webdeploy">Web Deploy</a></p>
</li></ul></li><li class=" "><p><a href="#src-68881711_developingkenticoazureprojectslocally-finaldeploy">Final deploy</a></p>
</li><li class=" "><p><a href="#src-68881711_developingkenticoazureprojectslocally-settinguppost-productiondevelopmentofazureprojects">Setting up post-production development of Azure projects</a></p>
<ul class="toc-indentation "><li class=" "><p><a href="#src-68881711_developingkenticoazureprojectslocally-deployingupdatedproductionprojects">Deploying updated production projects</a></p>
</li></ul></li></ul><p></p>
        </div>
    </div><div class="confbox panel">
            <div class="title panel-header">Related pages</div>
            <div class="panel-content">
<ul class=" "><li class=" "><p><a href="architecture-of-microsoft-azure-cloud-services">Architecture of Microsoft Azure Cloud Services</a></p>
</li><li class=" "><p><a href="lifecycle-for-developing-kentico-projects-in-azure-cloud-services">Lifecycle for developing Kentico projects in Azure Cloud Services</a></p>
</li></ul>        </div>
    </div></div></div>


    

    
    
    
    <h3 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Developing Azure projects locally as web applications</span></h3>
<p>If you are having trouble running your project in the local emulator, you can develop your Azure project as a normal web application project. We recommend this approach only if you do not plan to perform any customizations specific to the Microsoft Azure environment.</p>
<ol class=" "><li class=" "><p>Prepare an SQL database or <a href="preparing-the-azure-cloud-environment#src-68881718_preparingtheazurecloudenvironment-creatingamicrosoftazuresqlserverandadatabase">create a new Azure SQL Server and database.</a></p>
</li><li class=" "><p><a href="preparing-the-azure-cloud-environment#src-68881718_preparingtheazurecloudenvironment-creatingamicrosoftazurestorage">Create an Azure Storage account</a> through the Azure Management Portal.</p>
</li><li class=" "><p>Open your Azure project in Visual Studio using the <strong class=" ">WebApp.sln</strong> file.</p>
</li><li class=" "><p>Open the <strong class=" ">CMSApp\Web.config</strong> file.</p>
</li><li class=" "><p>Add the <strong class=" ">CMSConnectionString</strong> key and value to the &lt;connectionStrings&gt; section of the web.config file.</p>
    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">&lt;</code><code class="keyword">connectionStrings</code><code class="plain">&gt;</code></div>
<div class="line"><code class="plain">    &lt;</code><code class="keyword">add</code><code class="plain"> </code><code class="color1">name</code><code class="plain">=</code><code class="string">"CMSConnectionString"</code><code class="plain"> </code><code class="color1">connectionString</code><code class="plain">=</code><code class="string">"Data Source=tcp:YourServerName.database.windows.net,1433;Initial Catalog=YourDatabaseName;User Id=YourUsername@YourServerName;Password=YourPassword;"</code><code class="plain"> /&gt;</code></div>
<div class="line"><code class="plain">&lt;/</code><code class="keyword">connectionStrings</code><code class="plain">&gt;</code></div>
</div>
    </div>
<ul class=" "><li class=" "><p>Replace <strong class=" ">YourServerName</strong>, <strong class=" ">YourDatabaseName</strong>, <strong class=" ">YourUsername</strong> and <strong class=" ">YourPassword</strong> with your own values.</p>
</li><li class=" "><p>You can find the connection string of Azure SQL Database on the <a class="external-link" href="https://portal.azure.com/">Azure Management Portal</a> in <strong class=" ">SQL Databases -&gt;</strong> select the database <strong class=" ">-&gt; Overview </strong>tab <strong class=" ">-&gt; Show database connection strings</strong> link.</p>
</li></ul></li><li class=" "><p>Add the <strong class=" ">CMSAzureAccountName</strong> and <strong class=" ">CMSAzureSharedKey</strong> keys to the &lt;appSettings&gt; section of the web.config file.</p>
    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">&lt;</code><code class="keyword">appSettings</code><code class="plain">&gt;</code></div>
<div class="line"><code class="plain">	...</code></div>
<div class="line"><code class="plain">	&lt;</code><code class="keyword">add</code><code class="plain"> </code><code class="color1">key</code><code class="plain">=</code><code class="string">"CMSExternalStorageName"</code><code class="plain"> </code><code class="color1">value</code><code class="plain">=</code><code class="string">"azure"</code><code class="plain"> /&gt;</code></div>
<div class="line"><code class="plain">	&lt;</code><code class="keyword">add</code><code class="plain"> </code><code class="color1">key</code><code class="plain">=</code><code class="string">"CMSAzureAccountName"</code><code class="plain"> </code><code class="color1">value</code><code class="plain">=</code><code class="string">"YourStorageAccountName"</code><code class="plain"> /&gt;</code></div>
<div class="line"><code class="plain">	&lt;</code><code class="keyword">add</code><code class="plain"> </code><code class="color1">key</code><code class="plain">=</code><code class="string">"CMSAzureSharedKey"</code><code class="plain"> </code><code class="color1">value</code><code class="plain">=</code><code class="string">"YourPrimaryAccessKey"</code><code class="plain"> /&gt;</code></div>
<div class="line"><code class="plain">&lt;/</code><code class="keyword">appSettings</code><code class="plain">&gt;</code></div>
</div>
    </div>
<ul class=" "><li class=" "><p>Replace <strong class=" ">YourStorageAccountName</strong> and <strong class=" ">YourPrimaryAccessKey</strong> with your own values.</p>
</li><li class=" "><p>You can find these values on the <a class="external-link" href="https://portal.azure.com/">Azure Management Portal</a> in <strong class=" ">Your storage account</strong> <strong class=" ">-&gt; Access keys </strong>tab. Use the <strong class=" ">Storage account name</strong> and one of the generated access key values (Azure     <span style="color: #252525;">
provides two access keys so that you can maintain connections using one key while regenerating the other    </span>
).</p>
</li></ul></li><li class=" "><p>Right-click the <strong class=" ">CMSApp</strong> project in the Solution Explorer and select <strong class=" ">Set as StartUp Project</strong>.</p>
</li><li class=" "><p>Run the project in <strong class=" ">debug</strong> mode.</p>
</li><li class=" "><p>Go through the Kentico database installation when the system automatically opens the database installation in a browser.</p>
<ul class=" "><li class=" "><p>If developing on Azure SQL Server, enter the SQL server name in the following format: <i class=" ">servername.database.windows.net</i>.</p>
</li></ul></li></ol><p>You can now develop your project as a standard web application project.</p>
    <div class="confbox admonition admonition-note">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p><strong class=" ">CMSHashStringSalt key</strong></p>
<p>We recommend that you make sure that the <strong class=" ">CMSHashStringSalt</strong> key is set to a single static value in your web.config file. See <a href="developing-for-microsoft-azure---best-practices#src-68881700_developingformicrosoftazurebestpractices-thecmshashstringsaltkeyisidenticalinallenvironments">The CMSHashStringSalt key is identical in all environments</a>.</p>
        </div>
    </div>
    <div class="confbox admonition admonition-note">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p><strong class=" ">Storing media files, metafiles and attachments when developing Azure projects as web applications<br></strong></p>
<p>If you store media files, metafiles and attachments in the file system (the <strong class=" ">Settings -&gt; System -&gt; Files -&gt; Store files in the file system </strong>setting is selected) when you develop your Azure project as a web application, these files are stored downright in your project folders as media files. This may cause problems after you deploy your project to the Microsoft Azure platform, as these files are regarded as read-only and deleting such files from the administration interface may not be allowed.</p>
<p>Therefore, we recommend that you configure your project to either:</p>
<ul class=" "><li class=" "><p>Store files only in the database - clear the <strong class=" ">Store files in the file system</strong> setting and select the <strong class=" ">Store files in the database</strong> setting in <strong class=" ">Settings -&gt; System -&gt; Files</strong>.<br>or</p>
</li><li class=" "><p>Store such files in the Azure blob storage - select the <strong class=" ">Store files in the file system</strong> setting and configure the <strong class=" ">CMSAzureAccountName </strong>and <strong class=" ">CMSAzureSharedKey </strong>keys in your web.config file as specified in this section.</p>
</li></ul><p>You can find more information about the file storing settings in <a href="storing-files">Storing files</a>.</p>
<p><strong class=" ">Error associated with this problem:</strong></p>
<ul class=" "><li class=" "><p>"Failed to publish document: File.Delete: File &lt;filename&gt; cannot be deleted because it exists in application file system."</p>
</li></ul>        </div>
    </div>
    <h3 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Deploying locally developed Azure projects</span></h3>
<p>When you are ready, you can move your locally developed Azure project to the production environment while still being able to make changes to the project locally. For this scenario to work, you must use only <strong class=" ">one instance</strong> of the CMSApp web role.</p>
    <h4 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Deployment with migration to a new database</span></h4>
<p>This procedure presumes that you used a local SQL database and you want to migrate the database to the Azure SQL Database.</p>
<ol class=" "><li class=" "><p><a href="preparing-the-azure-cloud-environment#src-68881718_preparingtheazurecloudenvironment-creatingamicrosoftazurecloudservice">Create a Cloud Service</a>.</p>
</li><li class=" "><p><a href="preparing-the-azure-cloud-environment#src-68881718_preparingtheazurecloudenvironment-creatingamicrosoftazuresqlserverandadatabase">Create a new Azure SQL Database Server and a database</a> and configure the server's firewall to accept your IP address.</p>
</li><li class=" "><p>Deploy your SQL server, for example according to instructions in the <a class="external-link" href="https://docs.microsoft.com/en-us/azure/sql-database/sql-database-cloud-migrate">Migrate SQL Server database to SQL Database</a> article.</p>
</li><li class=" "><p>Open your Azure project in Visual Studio using the <strong class=" ">CMSAzure.sln</strong> file.</p>
</li><li class=" "><p>In <strong class=" ">Properties</strong> of the <strong class=" ">CMSApp</strong> web role, on the <strong class=" ">Settings</strong> tab, in the <strong class=" ">Cloud</strong> service configuration, fill the <strong class=" ">CMSAzureAccountName</strong> and <strong class=" ">CMSAzureSharedKey</strong> keys with appropriate values for your Azure Storage (the same as for the Local configuration).</p>
</li><li class=" "><p>Set the <strong class=" ">CMSConnectionString</strong> value to the connection string of the new Azure SQL database.</p>
</li><li class=" "><p><a href="configuring-kentico-azure-projects-for-cloud-services#src-68881729_configuringkenticoazureprojectsforcloudservices-configuringsmartsearch">Configure the SmartSearchWorker role</a>.</p>
</li><li class=" "><p><a href="deploying-azure-projects-to-cloud-services">Deploy your project to the created Cloud Service</a>.<br></p>
<ul class=" "><li class=" "><p>Make sure that the <strong class=" ">Enable Remote Desktop for all roles</strong> and <strong class=" ">Enable Web Deploy for all web roles (requires Remote Desktop)</strong> options are selected.</p>
</li></ul></li></ol><p>Now you can deploy changes to the project files quickly using the <a href="#src-68881711_developingkenticoazureprojectslocally-webdeploy">Web Deploy</a> functionality.</p>
    <div class="confbox admonition admonition-tip">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p><strong class=" ">Tip</strong>: You can also use other approaches to deploy an on-premise database to Azure SQL Database. See the <a class="external-link" href="https://docs.microsoft.com/en-us/azure/sql-database/sql-database-cloud-migrate">SQL Server database migration to SQL Database in the cloud</a> article for more information.</p>
        </div>
    </div>
    <div class="confbox admonition admonition-info">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p><strong class=" ">Alternative database deployment</strong></p>
<p>If the database deployment process does not suit you, you can export and import your Kentico website instead. This way you can choose particular object types which you want to deploy.</p>
<ol class=" "><li class=" "><p><a href="preparing-the-azure-cloud-environment#src-68881718_preparingtheazurecloudenvironment-creatingamicrosoftazurecloudservice">Create a Cloud Service</a>.</p>
</li><li class=" "><p><a href="preparing-the-azure-cloud-environment#src-68881718_preparingtheazurecloudenvironment-creatingamicrosoftazuresqlserverandadatabase">Create a new Azure SQL Server and a database</a>.</p>
</li><li class=" "><p>Open the Kentico administration interface and open the <strong class=" ">Sites</strong> application.</p>
</li><li class=" "><p>Click <strong class=" ">Export site</strong>.</p>
</li><li class=" "><p>In <strong class=" ">Properties</strong> of the <strong class=" ">CMSApp</strong> web role, on the <strong class=" ">Settings</strong> tab, in the <strong class=" ">Cloud</strong> service configuration, fill the <strong class=" ">CMSAzureAccountName</strong> and <strong class=" ">CMSAzureSharedKey</strong> keys with appropriate values for your Azure Storage (the same as for the Local configuration).</p>
</li><li class=" "><p>Set the <strong class=" ">CMSConnectionString</strong> value to the connection string of the new Azure SQL database.</p>
</li><li class=" "><p><a href="configuring-kentico-azure-projects-for-cloud-services#src-68881729_configuringkenticoazureprojectsforcloudservices-configuringsmartsearch">Configure the SmartSearchWorker role</a>.</p>
</li><li class=" "><p><a href="deploying-azure-projects-to-cloud-services">Deploy your project to the created Cloud Service</a>.<br></p>
<ul class=" "><li class=" "><p>Make sure that the <strong class=" ">Enable Remote Desktop for all roles</strong> and <strong class=" ">Enable Web Deploy for all web roles (requires Remote Desktop)</strong> are selected.</p>
</li></ul></li><li class=" "><p>Install a new database for your project.</p>
</li><li class=" "><p>Import the previously exported website in <strong class=" ">Sites</strong> application <strong class=" ">-&gt; Import site or objects</strong>.</p>
</li></ol>        </div>
    </div>
    <h4 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Deployment when using the same database</span></h4>
<p>This procedure presumes that you are using the Azure SQL Database from the beginning and you do not need to migrate the database.</p>
<ol class=" "><li class="confluence-link "><p><a href="preparing-the-azure-cloud-environment#src-68881718_preparingtheazurecloudenvironment-creatingamicrosoftazurecloudservice">Create a Cloud Service</a>.</p>
</li><li class="confluence-link "><p>Open your Azure project in Visual Studio using the <strong class=" ">CMSAzure.sln</strong> file.</p>
</li><li class=" "><p>In <strong class=" ">Properties</strong> of the <strong class=" ">CMSApp</strong> web role, on the <strong class=" ">Settings</strong> tab, in the <strong class=" ">Cloud</strong> service configuration, fill the <strong class=" ">CMSAzureAccountName</strong> and <strong class=" ">CMSAzureSharedKey</strong> keys with appropriate values for your Azure Storage (the same as for the Local configuration).</p>
</li><li class=" "><p>Set the <strong class=" ">CMSConnectionString</strong> value to the connection string of your database (the same as for the Local configuration).</p>
</li><li class=" "><p><a href="configuring-kentico-azure-projects-for-cloud-services#src-68881729_configuringkenticoazureprojectsforcloudservices-configuringsmartsearch">Configure the SmartSearchWorker role</a>.</p>
</li><li class=" "><p><a href="deploying-azure-projects-to-cloud-services">Deploy your project to the created Cloud Service</a>.<br></p>
<ul class=" "><li class=" "><p>Make sure that the <strong class=" ">Enable Remote Desktop for all roles</strong> and <strong class=" ">Enable Web Deploy for all web roles (requires Remote Desktop)</strong> options are selected.</p>
</li></ul></li></ol><p>Now you can deploy changes to the project files quickly using the <a href="#src-68881711_developingkenticoazureprojectslocally-webdeploy">Web Deploy</a> functionality.</p>
    <h4 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Web Deploy</span></h4>
<p>If you are performing web deploy from the <strong class=" ">same computer</strong> from which you performed the initial deployment, the procedure is straightforward; you can use an already created publish profile:</p>
<ol class=" "><li class=" "><p>Right-click the <strong class=" ">CMSApp</strong> project and select <strong class=" ">Publish</strong>.</p>
</li><li class=" "><p>Select the existing publish profile from the drop-down list.</p>
</li><li class=" "><p>Switch to the <strong class=" ">Connection</strong> tab.</p>
</li><li class=" "><p>Provide the password for remote desktop connection.</p>
</li><li class=" "><p>Click <strong class=" ">Publish</strong>.</p>
</li></ol><p>If you are performing web deploy from a <strong class=" ">different computer</strong> than the one from which you performed the initial deployment, you need to create a new publish profile:</p>
<ol class=" "><li class=" "><p>Right-click the <strong class=" ">CMSApp</strong> project and select <strong class=" ">Publish</strong>.</p>
</li><li class=" "><p>Click the drop-down list and select &lt;New profile...&gt;.</p>
</li><li class=" "><p>Type the name of the profile and click <strong class=" ">OK</strong>.</p>
</li><li class=" "><p>On the <strong class=" ">Connection</strong> tab, select <strong class=" ">Web Deploy</strong> as the Publish method.</p>
</li><li class=" "><p>Provide the <strong class=" ">Server</strong> address:<br></p>
<ol class=" "><li class=" "><p>Open the <a class="external-link" href="https://portal.azure.com">Azure Management Portal</a> in a browser.</p>
</li><li class=" "><p>Select <strong class=" ">Cloud services -&gt;</strong> your cloud service <strong class=" ">-&gt; Overview </strong>tab.</p>
</li><li class=" "><p>Copy the <strong class=" ">Site URL</strong> without the protocol (http://) and trailing slash (/) to the Server field of the web deploy profile in the following format:</p>
    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">https://YourSiteURL:8172/MsDeploy.axd</code></div>
</div>
    </div>
</li></ol></li><li class=" "><p>Provide the <strong class=" ">Site name</strong>:<br></p>
<ul class=" "><li class=" "><p>This corresponds to the name of your website registered in IIS of the server.</p>
</li><li class=" "><p>You can find the name by remotely connecting to the server (<strong class=" ">Cloud services -&gt;</strong> your cloud service <strong class=" ">-&gt; Instances </strong>tab -&gt; Click <strong class=" ">Connect</strong> in the bottom panel and run the downloaded file).</p>
</li><li class=" "><p>The default value is <strong class=" ">CMSApp_IN_0_Web</strong>.</p>
</li></ul></li><li class=" "><p>Type the username and password for remote desktop connection.<br></p>
<img class="confluence-embedded-image confluence-content-image-border" src="images/download/attachments/68881711/CloudServiceWebDeployConnectionSetup.png" alt="images/download/attachments/68881711/CloudServiceWebDeployConnectionSetup.png" width="500">
        <br><span class="caption">Configuring Web Deploy for local development</span>
    </li><li class=" "><p>Switch to the <strong class=" ">Settings</strong> tab.</p>
</li><li class=" "><p>Choose the build Configuration.</p>
</li><li class=" "><p>Click <strong class=" ">Publish</strong>.</p>
</li></ol>    <h3 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Final deploy</span></h3>
<p>When your project is fully developed and ready to go live, <a href="deploying-azure-projects-to-cloud-services">Deploy your project</a> again, with the <strong class=" ">Enable Remote Desktop for all roles</strong> and <strong class=" ">Enable Web Deploy for all web roles (requires Remote Desktop)</strong> options <strong class=" ">cleared</strong>. After that, your CMSApp web role can use more than one instance.</p>
    <h3 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Setting up post-production development of Azure projects</span></h3>
<p class="confluence-link">If you realize that you need to make changes to your Azure project already in the production, you can utilize the <a href="content-staging">content staging</a> functionality to synchronize the database changes between your local development and production projects. However, you will still need to deploy your project files.</p>
<p>Moreover, you may want to set up a new blob storage to separate the content files of your local and production projects. The synchronization of these files will be handled by the content staging functionality.</p>
<p>Although there are other ways to develop your projects after you promote them to the production, we recommend the following configuration:</p>
<ol class=" "><li class=" "><p><a href="preparing-the-azure-cloud-environment#src-68881718_preparingtheazurecloudenvironment-preparingthecloudenvironment">Create a new Azure Storage</a>.</p>
</li><li class=" "><p>Set the local configuration of your project to connect to a local database and the newly created blob storage:</p>
<ol class=" "><li class=" "><p>Open your Azure project in Visual Studio using the <strong class=" ">CMSAzure.sln</strong> file.</p>
</li><li class=" "><p>Double-click the <strong class=" ">CMSAzure\Roles\CMSApp</strong> role.</p>
</li><li class=" "><p>Switch to the <strong class=" ">Settings</strong> tab and select <strong class=" ">Local</strong> as the Service Configuration.</p>
</li><li class=" "><p>Make sure that the value of <strong class=" ">CMSConnectionString</strong> key is set to the connection string for your local database (you can use your existing development database or copy your production database to a local server).</p>
</li><li class=" "><p>Set the values of <strong class=" ">CMSAzureAccountName</strong> and <strong class=" ">CMSAzureSharedKey</strong> keys for the newly created Azure Storage.</p>
<ul class=" "><li class=" "><p>You can find these values on the <a class="external-link" href="https://portal.azure.com/">Azure Management Portal</a> in <strong class=" ">Your storage account</strong> <strong class=" ">-&gt; Access keys </strong>tab. Use the <strong class=" ">Storage account name</strong> and one of the generated access key values (Azure     <span style="color: #252525;">
provides two access keys so that you can maintain connections using one key while regenerating the other    </span>
).</p>
</li></ul></li><li class=" "><p>Set these settings also for the <strong class=" ">SmartSearchWorker</strong> role.</p>
</li></ol></li><li class=" "><p><a href="configuring-content-staging">Configure the content staging</a> between your projects. Configure your local project as the source server and production project as the target server.</p>
    <div class="confbox admonition admonition-note">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p><strong class=" ">Staging large files (larger than 2 GB)</strong></p>
<p>By default, the system will not stage files that are larger than 2 GB. If you need to stage larger files, <a href="staging-large-files">change the maximum content and request size</a> values in your projects.</p>
        </div>
    </div>
    <div class="confbox admonition admonition-warning">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p><strong class=" ">CMSHashStringSalt key</strong></p>
<p>The <strong class=" ">CMSHashStringSalt</strong> key defines the salt value that the system uses in hash functions, for example in <a href="working-with-macro-signatures">macro signatures</a> and media library links. For the content to be synchronized properly through Content staging, the value of this key must be identical in all environments you use. Otherwise, the hash values of objects will be different in different environments.</p>
<p>Therefore, make sure that the value of this web.config key is set to a single static value, for example a random GUID. If the key is not present in the web.config file, it means that its default value is the connection string of your project. In this case, we recommend that you add this key to your local project with the connection string of your production project as a value.</p>
<p><strong class=" ">Note:</strong> We do not recommend changing the <strong class=" ">CMSHashStringSalt</strong> key value for the production project, as it will break macro signatures and media library links.</p>
        </div>
    </div>
</li></ol><p>Your local project is now configured to be developed separately from the production project.</p>
    <h4 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Deploying updated production projects</span></h4>
<p>After you have configured the content staging functionality for your projects, you can propagate object changes to the production project through the content staging functionality (see <a href="synchronizing-the-content">Synchronizing the content</a>). If you develop custom code, you also need to redeploy your project to the Staging environment and swap staging with production.</p>
<ol class=" "><li class=" "><p>Make sure that the cloud configuration in your project is set to connect to the production database and production Azure storage.</p>
<ol class=" "><li class=" "><p>Open your Azure project in Visual Studio using the <strong class=" ">CMSAzure.sln</strong> file.</p>
</li><li class=" "><p>Double-click the <strong class=" ">CMSAzure\Roles\CMSApp</strong> role.</p>
</li><li class=" "><p>Switch to the <strong class=" ">Settings</strong> tab and select <strong class=" ">Cloud</strong> as the Service Configuration.</p>
</li><li class=" "><p>Make sure that the value of <strong class=" ">CMSConnectionString</strong> key is set to the connection string for your production database.</p>
</li><li class=" "><p>Set the values of <strong class=" ">CMSAzureAccountName</strong> and <strong class=" ">CMSAzureSharedKey</strong> keys for the production Azure Storage.</p>
</li><li class=" "><p>Set these settings also for the <strong class=" ">SmartSearchWorker</strong> role.</p>
</li></ol></li><li class=" "><p><a href="deploying-azure-projects-to-cloud-services">Deploy your project</a> with the <strong class=" ">Enable Remote Desktop for all roles</strong> and <strong class=" ">Enable Web Deploy for all web roles (requires Remote Desktop)</strong> options CLEARED.</p>
</li><li class=" "><p>Disable Smart search functionality in the staging deployment (Smart search cannot run simultaneously on two projects connected to the same database):</p>
<ol class=" "><li class=" "><p>Open the Kentico administration interface and the <strong class=" ">Settings</strong> application.</p>
</li><li class=" "><p>Select the <strong class=" ">System -&gt; Search</strong> category.</p>
</li><li class=" "><p>Clear the <strong class=" ">Enable smart search indexing</strong> setting.</p>
</li><li class=" "><p>Click <strong class=" ">Save</strong>.</p>
</li></ol></li><li class=" "><p>Test that the staging website works as expected.</p>
    <div class="confbox admonition admonition-warning">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p>Do not make any changes to the website at this moment. The staging website is connected to the production database and blob storage, which could cause inconsistencies if objects are modified through the staging project.</p>
        </div>
    </div>
</li><li class=" "><p>Swap production deployment with staging deployment:</p>
<ol class=" "><li class=" "><p>Open the <a class="external-link" href="https://portal.azure.com/">Azure Management Portal</a>.</p>
</li><li class=" "><p>Select your Cloud service and switch to the <strong class=" ">Overview </strong>tab.</p>
</li><li class=" "><p>Click <strong class=" ">Swap</strong> in the top panel. Azure instantly swaps the production and staging deployments.</p>
</li></ol></li><li class=" "><p>Stop or delete the Staging deployment (so that you can enable Smart search again).</p>
</li><li class=" "><p>Enable Smart search functionality in the production deployment.</p>
</li><li class=" "><p>Open the administration interface of your <strong class=" ">local</strong> project and <a href="synchronizing-the-content">synchronize the content changes</a>.</p>
</li></ol><p>You have redeployed your locally developed changes to the production.</p>
        </div>

    </article>


               
            
    <footer id="ht-footer">
    <a href="#" id="ht-jump-top" class="sp-aui-icon-small sp-aui-iconfont-arrows-up"></a>
</footer></div>

<div>
    <div id="ht-mq-detect"></div>
</div>

    <script src="js/lunr.js"></script>
    <script src="js/lunr-extras.js"></script>
    <script src="assets/js/scroll-search.js"></script>

    <script src="assets/js/expand-macro.js"></script>


</body></html>