<!DOCTYPE html><html><head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Improving custom macro performance in scoring and contact groups - Kentico 11 Documentation</title>

    
    <link rel="stylesheet" href="assets/css/expand-macro.css">

            <meta name="scroll-content-language-key" content="">
    
    <meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=2.0, user-scalable=yes">

<script type="text/javascript" src="assets/js/jquery.min.js"></script>
<script type="text/javascript" src="assets/js/jquery.scrollTo.min.js"></script>


<script type="text/javascript" src="assets/js/translate.js"></script>

<script type="text/javascript" src="assets/js/theme.main.js"></script>

    <script type="text/javascript" src="assets/js/iframeResizer.min.js"></script>

<link rel="stylesheet" href="assets/css/content-style.css">
    <link rel="stylesheet" href="assets/css/search.css">

<link rel="stylesheet" href="assets/css/theme.main.css">
<link rel="stylesheet" href="assets/css/theme.colors.css">

            <!-- ES5 support for older browsers, needed by lunr -->
        <script src="js/augment.js"></script> 
        <script id="worker" type="javascript/worker">

        startIndex = function() {
            idx = lunr.Index.load(lunrIndex);
            idx.pipeline.remove(lunr.stopWordFilter);
            postMessage({type: "setup-complete"});
        }

        onmessage = function (event) {
            var message = event.data;

            if ((message.type === 'setup') && message.baseUrl) {
                var url = message.baseUrl;
                importScripts(url + 'js/lunr.js');
                importScripts(url + 'js/lunr-extras.js');
                importScripts(url + 'js/lunr-index.js');
                importScripts(url + 'js/lunr-data.js');
                startIndex();
            }

            if (idx && (message.type === 'search-request') && message.query) {
                var searchWord = message.query;
                var results = idx.search(searchWord).map(function (result) {
                    return lunrData.filter(function (d) {
                        return d.id === parseInt(result.ref, 10)
                    })[0]
                });
                postMessage({type: 'search-results', results: results, query: searchWord, queryId: message.queryId});
            }
        }

    </script>
    </head>

<body pageid="68879260" elementpageid="68882610">

<div id="ht-loader">
    <noscript>
        <p style="width: 100%; text-align:center; position: absolute; margin-top: 200px;">This content cannot be displayed without JavaScript.<br>Please enable JavaScript and reload the page.</p>
    </noscript>
</div>

<div>
   	<header id="ht-headerbar">
    <div class="ht-headerbar-left">
        <a href="" id="ht-menu-toggle" class="sp-aui-icon-small sp-aui-iconfont-appswitcher"></a>
    </div>
    <div class="ht-headerbar-right">
            <div class="sp-aui-icon-small ht-search-index-loader ht-header-icon"></div>

        <div id="ht-search">
            <div class="ht-search-input" style="display: none;">
              	<a href="#" class="sp-aui-icon-small sp-aui-iconfont-remove ht-search-clear"></a>

                <form action="#" method="GET" id="search">
                    <input class="search-input" type="text" placeholder="Search" tabindex="-1" autocomplete="off" name="q" value="">
                    <input type="hidden" name="max" value="15">
                    <input type="submit" style="display:none" tabindex="-4">
                </form>

                <a href="#" id="ht-search-button" class="ht-header-icon ht-header-icon-svg">
                                        <svg width="40px" height="40px" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                        <g>
                            <path d="M29.572,28.802 L28.801,29.571 C28.515,29.857 28.187,30 27.816,30 C27.445,30 27.116,29.857 26.831,29.571 L21.392,24.134 C20.193,24.762 18.908,25.076 17.538,25.076 C15.396,25.076 13.605,24.348 12.163,22.892 C10.721,21.436 10,19.651 10,17.538 C10,15.397 10.721,13.605 12.163,12.163 C13.605,10.721 15.396,10 17.538,10 C19.651,10 21.434,10.721 22.89,12.163 C24.347,13.605 25.075,15.397 25.075,17.538 C25.075,18.937 24.761,20.222 24.132,21.393 L29.572,26.832 C29.857,27.118 30,27.446 30,27.817 C30,28.188 29.857,28.517 29.572,28.802 L29.572,28.802 Z M13.662,21.414 C14.732,22.485 16.024,23.02 17.538,23.02 C19.051,23.02 20.343,22.485 21.413,21.414 C22.484,20.344 23.019,19.052 23.019,17.538 C23.019,16.025 22.484,14.733 21.413,13.662 C20.343,12.592 19.051,12.056 17.538,12.056 C16.024,12.056 14.732,12.592 13.662,13.662 C12.591,14.733 12.056,16.025 12.056,17.538 C12.056,19.052 12.591,20.344 13.662,21.414 L13.662,21.414 Z"></path>
                        </g>
                    </svg>
              	</a>

                <div class="ht-search-dropdown ht-dropdown">
                    <ul></ul>
                </div>
            </div>
        </div>
    </div>
    </header>   	<aside id="ht-sidebar">
    <div class="ht-sidebar-content">
        <div class="ht-sidebar-content-scroll-container">
            <header class="ht-sidebar-header">
                <h1 class="ht-logo">
                    <span class="ht-logo-label">K11</span>
                    <img class="space-logo" src="global.logo">
                </h1>
                <a href="Kentico-11-Documentation-Home.html" class="ht-space-link">
                    <h2>Kentico 11 Documentation</h2>
                </a>
            </header>
                            <iframe id="ht-nav" src="toc.html?pageId=68882610"></iframe>
                <script>
                    $('iframe#ht-nav').iFrameResize(
                            { 'log': true, 'autoResize': true, 'heightCalculationMethod': 'lowestElement', 'checkOrigin': false });
                </script>
                    </div>
    </div>

</aside></div>

<div id="ht-wrap-container">

            
    <div id="ht-sidebar-dragbar">
    <div class="ht-sidebar-drag-handle">
        <span class="drag-handle-1"></span>
        <span class="drag-handle-2"></span>
        <span class="drag-handle-3"></span>
    </div>
</div>
    <article id="ht-content" class="ht-content">
        <header class="ht-content-header">
            <div id="ht-breadcrumb">
    <ul>
        <li><a href="Kentico-11-Documentation-Home.html">Kentico 11 Documentation</a></li>
                                                                                                             <li><a href="" onclick="$('.shortcut').each(function(){$(this).removeClass('shortcut')}); $(this).parent().addClass('shortcut'); return false;">...</a> </li>
                                        <li class="shortcut"><a href="On-line-marketing-features.html">On-line marketing features</a></li>
                                                                                                         <li class="shortcut"><a href="Configuring-and-customizing-your-on-line-marketing-features.html">Configuring and customizing your on-line marketing features</a></li>
                                                                                     <li><a href="On-line-marketing-macros.html">On-line marketing macros</a></li>
                                                            </ul>
</div>            <h1 id="src-68882610"> <span>Improving custom macro performance in scoring and contact groups</span></h1>
        </header>

        <div id="main-content" class="wiki-content sp-grid-section" data-index-for-search="true">
<div class="sp-grid-section"><div class="sp-grid-cell sp-grid-60"><div class="sp-grid-section"></div></div><div class="sp-grid-cell sp-grid-60"><p>This topic describes two ways in which you can improve <a href="macro-expressions">macro</a> performance in scoring and contact groups:</p><ol class=" "><li class=" "><p><a href="#src-68882610_improvingcustommacroperformanceinscoringandcontactgroups-creatingacustommacroruletranslator">Create a custom macro rule translator</a> - by default, <a href="registering-custom-macro-methods">custom macro</a> rules that you use in scoring and contact group conditions evaluate individually for each contact. You can improve the recalculation performance by implementing and registering translators for these macro rules. Once a macro rule has a translator registered, a database query is constructed that then selects only the contacts that fit the given macro condition.</p>
</li><li class=" "><p><a href="#src-68882610_improvingcustommacroperformanceinscoringandcontactgroups-recalculatingcontactgrouprulesonlyforspecificactivities">Limit unnecessary recalculations</a> - you can further improve your site performance by making sure your <a href="registering-custom-macro-methods">custom</a> contact group and scoring macro rules are recalculated only when users perform activity types that are relevant to the macro rule.</p>
</li></ol><div class="confbox admonition admonition-info has-no-icon">
                        <div class="admonition-body">
<p><strong class=" ">Default macro rules</strong></p>
<p>Macro rules available in Kentico by default have both these optimizations implemented out of the box.</p>
        </div>
    </div><h3 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Creating a custom macro rule translator</span></h3><ol class=" "><li class=" "><p>Create a class that implements    <span style="color: #ff6600;">
     </span>
the <i class=" ">IMacroRuleInstanceTranslator</i> interface.</p>
</li><li class=" "><p>Implement the logic of the macro rule in a method that returns a query of the <i class=" ">ObjectQuery&lt;ContactInfo&gt; </i>type. The returned object needs to contain the contacts that fulfill the condition. Note that you do not have to handle contextual information, such as site context, in the query.</p>
    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                    <div class="title">Example of an implemented ContactIsFemaleMacro rule translator</div>
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-title="Example of an implemented ContactIsFemaleMacro rule translator" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="keyword">using</code><code class="plain"> System;</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="keyword">using</code><code class="plain"> CMS.DataEngine;</code></div>
<div class="line"><code class="keyword">using</code><code class="plain"> CMS.Membership;</code></div>
<div class="line"><code class="keyword">using</code><code class="plain"> CMS.ContactManagement;</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="keyword">internal</code><code class="plain"> </code><code class="keyword">class</code><code class="plain"> ContactIsFemaleInstanceTranslator: IMacroRuleInstanceTranslator</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    </code><code class="comments">/// &lt;summary&gt;</code></div>
<div class="line"><code class="plain">    </code><code class="comments">/// Translates ContactIsFemaleMacro rule.</code></div>
<div class="line"><code class="plain">    </code><code class="comments">/// &lt;/summary&gt;</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">public</code><code class="plain"> ObjectQuery&lt;ContactInfo&gt; Translate(MacroRuleInstance macroRuleInstance)</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">if</code><code class="plain"> (macroRuleInstance == </code><code class="keyword">null</code><code class="plain">)</code></div>
<div class="line"><code class="plain">        {</code></div>
<div class="line"><code class="plain">            </code><code class="keyword">throw</code><code class="plain"> </code><code class="keyword">new</code><code class="plain"> ArgumentNullException(</code><code class="string">"macroRuleInstance"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">if</code><code class="plain"> (macroRuleInstance.MacroRuleName != </code><code class="string">"ContactIsFemaleMacro"</code><code class="plain">)</code></div>
<div class="line"><code class="plain">        {</code></div>
<div class="line"><code class="plain">            </code><code class="keyword">throw</code><code class="plain"> </code><code class="keyword">new</code><code class="plain"> ArgumentException(</code><code class="string">"[ContactIsFemaleTranslator.Translate]: Only macro rule instances of type ContactIsFemaleMacro can be translated"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">        }</code></div>
<div class="line"><code class="plain">		</code></div>
<div class="line"><code class="plain">		</code><code class="keyword">var</code><code class="plain"> ruleParameters = macroRuleInstance.Parameters;</code></div>
<div class="line"><code class="plain">		</code><code class="comments">// ruleParameters contains the data user enters in macro fields</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">string</code><code class="plain"> paramIs = ruleParameters[</code><code class="string">"_is"</code><code class="plain">].Value;</code></div>
<div class="line"><code class="plain">        QueryOperator queryOperator = paramIs == </code><code class="string">"!"</code><code class="plain"> ? QueryOperator.NotEquals : QueryOperator.Equals;</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">        </code><code class="keyword">return</code><code class="plain"> ContactInfoProvider.GetContacts().Where(</code><code class="string">"ContactGender"</code><code class="plain">, queryOperator, (</code><code class="keyword">int</code><code class="plain">)UserGenderEnum.Female);</code></div>
<div class="line"><code class="plain">    }</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
</li><li class=" "><p>Register an instance of the <i class=" ">MacroRuleMetadata </i>class by calling the <i class=" ">MacroRuleMetadataContainer.RegisterMetadata</i> method.</p>
<ul class=" "><li class=" "><p>To register the class at the beginning of the application's lifecycle, create a <a href="initializing-modules-to-run-custom-code">custom module class</a> and override the <strong class=" ">OnInit</strong> method.<br></p>
</li><li class=" "><p>Either add the module class into a custom project within the Kentico solution (recommended) or directly into the Kentico web project (into a custom folder under the <strong class=" ">CMSApp</strong> project for <i class=" ">web application</i> installations, into the <strong class=" ">App_Code</strong> folder for <i class=" ">web site</i> installations).</p>
    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="keyword">using</code><code class="plain"> System.Collections.Generic;</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="keyword">using</code><code class="plain"> CMS;</code></div>
<div class="line"><code class="keyword">using</code><code class="plain"> CMS.Base;</code></div>
<div class="line"><code class="keyword">using</code><code class="plain"> CMS.DataEngine;</code></div>
<div class="line"><code class="keyword">using</code><code class="plain"> CMS.ContactManagement;</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="comments">// Registers the custom module into the system</code></div>
<div class="line"><code class="plain">[assembly: RegisterModule(</code><code class="keyword">typeof</code><code class="plain">(CustomInitializationModule))]</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="keyword">public</code><code class="plain"> </code><code class="keyword">class</code><code class="plain"> CustomInitializationModule : Module</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">	</code><code class="comments">// Module class constructor, the system registers the module under the name "CustomInit"</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">public</code><code class="plain"> CustomInitializationModule()</code></div>
<div class="line"><code class="plain">		: </code><code class="keyword">base</code><code class="plain">(</code><code class="string">"CustomInit"</code><code class="plain">)</code></div>
<div class="line"><code class="plain">	{</code></div>
<div class="line"><code class="plain">	}</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">	</code><code class="comments">// Contains initialization code that is executed when the application starts</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">protected</code><code class="plain"> </code><code class="keyword">override</code><code class="plain"> </code><code class="keyword">void</code><code class="plain"> OnInit()</code></div>
<div class="line"><code class="plain">	{</code></div>
<div class="line"><code class="plain">		</code><code class="keyword">base</code><code class="plain">.OnInit();</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">		MacroRuleMetadata metadata = </code><code class="keyword">new</code><code class="plain"> MacroRuleMetadata(</code></div>
<div class="line"><code class="plain">			</code><code class="string">"ContactIsFemaleMacro"</code><code class="plain">,</code></div>
<div class="line"><code class="plain">			</code><code class="keyword">new</code><code class="plain"> ContactIsFemaleInstanceTranslator(),</code></div>
<div class="line"><code class="plain">			affectingActivities: </code><code class="keyword">new</code><code class="plain"> List&lt;</code><code class="keyword">string</code><code class="plain">&gt;(0),</code></div>
<div class="line"><code class="plain">			affectingAttributes: </code><code class="keyword">new</code><code class="plain"> List&lt;</code><code class="keyword">string</code><code class="plain">&gt;(0));</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">		MacroRuleMetadataContainer.RegisterMetadata(metadata);</code></div>
<div class="line"><code class="plain">	}</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
</li></ul></li><li class=" "><p>Save the files.<br><strong class=" ">Important</strong>: Note that this way, the recalculation is not performed for any contact activity or attribute change. You can <a href="#src-68882610_improvingcustommacroperformanceinscoringandcontactgroups-recalculatingcontactgroupandscoringrulesonlyforspecificactivitiesandattributes">make the rule recalculate</a> for a specific set of activities and attribute changes.</p>
</li></ol><p>Now, when you use the translated macro rule in a scoring or contact group condition, the query is only performed once when you run recalculation.</p><div class="confbox admonition admonition-note">
                    <p class="title">Compound conditions</p>
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p>All macro rules used in a contact group or scoring macro conditions need to be translated. Otherwise, the evaluation will be performed in a non-optimized way.</p>
        </div>
    </div><div class="sp-grid-section"></div><div class="sp-grid-section"></div></div><div class="sp-grid-cell sp-grid-40 sp-grid-sidebar"><div class="confbox panel">
            <div class="title panel-header">On this page</div>
            <div class="panel-content">
<p></p>
<ul class="toc-indentation "><li class=" "><p><a href="#src-68882610_improvingcustommacroperformanceinscoringandcontactgroups-creatingacustommacroruletranslator">Creating a custom macro rule translator</a></p>
</li><li class=" "><p><a href="#src-68882610_improvingcustommacroperformanceinscoringandcontactgroups-recalculatingcontactgroupandscoringrulesonlyforspecificactivitiesandattributes">Recalculating contact group and scoring rules only for specific activities and attributes</a></p>
</li></ul><p></p>
        </div>
    </div><div class="confbox panel">
            <div class="title panel-header">Related pages</div>
            <div class="panel-content">
<ul class=" "><li class=" "><p><a href="segmenting-contacts-into-contact-groups">Segmenting contacts into contact groups</a></p>
</li><li class=" "><p><a href="scoring-contacts">Scoring contacts</a></p>
</li><li class=" "><p><a href="macro-expressions">Macro expressions</a></p>
</li><li class=" "><p><a href="creating-macro-rules">Creating macro rules</a></p>
</li></ul>        </div>
    </div></div><div class="sp-grid-cell sp-grid-40 sp-grid-sidebar"><div class="confbox panel">
            <div class="title panel-header">On this page</div>
            <div class="panel-content">
<p></p>
<ul class="toc-indentation "><li class=" "><p><a href="#src-68882610_improvingcustommacroperformanceinscoringandcontactgroups-creatingacustommacroruletranslator">Creating a custom macro rule translator</a></p>
</li><li class=" "><p><a href="#src-68882610_improvingcustommacroperformanceinscoringandcontactgroups-recalculatingcontactgroupandscoringrulesonlyforspecificactivitiesandattributes">Recalculating contact group and scoring rules only for specific activities and attributes</a></p>
</li></ul><p></p>
        </div>
    </div><div class="confbox panel">
            <div class="title panel-header">Related pages</div>
            <div class="panel-content">
<ul class=" "><li class=" "><p><a href="segmenting-contacts-into-contact-groups">Segmenting contacts into contact groups</a></p>
</li><li class=" "><p><a href="scoring-contacts">Scoring contacts</a></p>
</li><li class=" "><p><a href="macro-expressions">Macro expressions</a></p>
</li><li class=" "><p><a href="creating-macro-rules">Creating macro rules</a></p>
</li></ul>        </div>
    </div></div></div><div class="sp-grid-section"></div>
    
    

    
    
    
<p></p>
    <div class="confbox admonition admonition-info">
                    <p class="title">Kentico EMS required</p>
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p>Features described on this page require the <strong class=" ">Kentico EMS</strong> license.</p>
        </div>
    </div>
<p></p>
    <h3 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Recalculating contact group and scoring rules only for specific activities and attributes</span></h3>
<p>Another way of improving your site performance is by making sure that contact groups and scores are recalculated only when necessary. You can make sure your custom contact group and scoring macro rules are only recalculated for specified activities or when specific contact attributes change.</p>
<p><strong class=" ">Examples:</strong></p>
<ul class=" "><li class=" "><p>The "ContactIsFemale" macro doesn't need to be rebuilt by any contact activity that the visitor performs on a site. Instead, it only needs to be rebuilt by a change in the contact's "contactgender" attribute.</p>
</li><li class=" "><p>A rule that checks whether a contact is registered for an event ("CMSContactIsRegisteredForSpecifiedEvent" macro by default) only needs to be rebuilt when a visitor performs an event booking activity on a site ("EVENT_BOOKING" activity by default).</p>
</li><li class=" "><p>A rule that checks whether a contact has visited a page ("CMSContactHasVisitedSpecifiedPageInLastXDays" macro by default) only needs to be rebuilt when a visitor performs an event booking activity on a site ("PAGE_VISIT" activity by default).</p>
</li></ul><p>To specify the activities and attribute changes that rebuild your custom macro rule:</p>
<ol class=" "><li class=" "><p>Create a <a href="#src-68882610_improvingcustommacroperformanceinscoringandcontactgroups-creatingacustommacroruletranslator">custom macro rule translator</a>.</p>
</li><li class=" "><p>Extend the metadata instantiation by the following parameters:</p>
<ol class=" "><li class=" "><p><strong class=" ">IList&lt;string&gt; affectingActivities </strong>- a list of activities for which you want the macro to rebuild.</p>
</li><li class=" "><p><strong class=" ">IList&lt;string&gt;</strong> <strong class=" ">affectingAttributes</strong> - a list of attributes for which you want the macro to rebuild.</p>
</li></ol>    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                    <div class="title">Rebuild custom macro rule for specific activities or attribute changes</div>
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-title="Rebuild custom macro rule for specific activities or attribute changes" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="keyword">protected</code><code class="plain"> </code><code class="keyword">override</code><code class="plain"> </code><code class="keyword">void</code><code class="plain"> OnInit()</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">	...</code></div>
<div class="line"><code class="plain">	MacroRuleMetadata metadata = </code><code class="keyword">new</code><code class="plain"> MacroRuleMetadata(</code></div>
<div class="line"><code class="plain">		</code><code class="string">"CustomMacroRule"</code><code class="plain">,&nbsp;</code></div>
<div class="line"><code class="plain">		</code><code class="keyword">new</code><code class="plain"> CustomMacroRuleTranslator(),&nbsp;</code></div>
<div class="line"><code class="plain">		affectingActivities: </code><code class="keyword">new</code><code class="plain"> List&lt;</code><code class="keyword">string</code><code class="plain">&gt;</code></div>
<div class="line"><code class="plain">		{</code></div>
<div class="line"><code class="plain">			</code><code class="comments">// Recalculate for a predefined activity</code></div>
<div class="line"><code class="plain">			PredefinedActivityType.PAGE_VISIT,</code></div>
<div class="line"><code class="plain">			</code><code class="comments">// Recalculate for a custom activity</code></div>
<div class="line"><code class="plain">			</code><code class="string">"custom_activity_codename"</code></div>
<div class="line"><code class="plain">		}</code></div>
<div class="line"><code class="plain">		affectingAttributes: </code><code class="keyword">new</code><code class="plain"> List&lt;</code><code class="keyword">string</code><code class="plain">&gt;</code></div>
<div class="line"><code class="plain">		{</code></div>
<div class="line"><code class="plain">			</code><code class="comments">// Recalculate when specific attributes change</code></div>
<div class="line"><code class="plain">			</code><code class="string">"contactgender"</code><code class="plain">,</code></div>
<div class="line"><code class="plain">			</code><code class="string">"contactcountryid"</code></div>
<div class="line"><code class="plain">		});	</code></div>
<div class="line"><code class="plain">	MacroRuleMetadataContainer.RegisterMetadata(metadata);</code></div>
<div class="line"><code class="plain">	...</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                    <div class="title">Do not rebuild custom macro rule for any activities or attribute changes</div>
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-title="Do not rebuild custom macro rule for any activities or attribute changes" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="keyword">protected</code><code class="plain"> </code><code class="keyword">override</code><code class="plain"> </code><code class="keyword">void</code><code class="plain"> OnInit()</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">	...</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">var</code><code class="plain"> noNeedToRecalculate = </code><code class="keyword">new</code><code class="plain"> List&lt;</code><code class="keyword">string</code><code class="plain">&gt;(0);</code></div>
<div class="line"><code class="plain"> </code></div>
<div class="line"><code class="plain">	MacroRuleMetadata metadata = </code><code class="keyword">new</code><code class="plain"> MacroRuleMetadata(</code></div>
<div class="line"><code class="plain">		</code><code class="string">"CustomMacroRule"</code><code class="plain">,</code></div>
<div class="line"><code class="plain">		</code><code class="keyword">new</code><code class="plain"> CustomMacroRuleTranslator(),</code></div>
<div class="line"><code class="plain">		affectingActivities : noNeedToRecalculate,</code></div>
<div class="line"><code class="plain">		affectingAttributes : noNeedToRecalculate</code></div>
<div class="line"><code class="plain">		);</code></div>
<div class="line"><code class="plain">	MacroRuleMetadataContainer.RegisterMetadata(metadata);</code></div>
<div class="line"><code class="plain">	...</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
    <div class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                    <div class="title">Rebuild custom macro rule for all activities and attribute changes</div>
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-title="Rebuild custom macro rule for all activities and attribute changes" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="keyword">protected</code><code class="plain"> </code><code class="keyword">override</code><code class="plain"> </code><code class="keyword">void</code><code class="plain"> OnInit()</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">	...</code></div>
<div class="line"><code class="plain">	MacroRuleMetadata metadata = </code><code class="keyword">new</code><code class="plain"> MacroRuleMetadata(</code></div>
<div class="line"><code class="plain">        </code><code class="string">"CustomMacroRule"</code><code class="plain">,</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">new</code><code class="plain"> CustomMacroRuleTranslator(),</code></div>
<div class="line"><code class="plain">        affectingActivities: </code><code class="keyword">new</code><code class="plain"> List&lt;</code><code class="keyword">string</code><code class="plain">&gt;</code></div>
<div class="line"><code class="plain">		{</code></div>
<div class="line"><code class="plain">            MacroRuleMetadata.ALL_ACTIVITIES</code></div>
<div class="line"><code class="plain">		},</code></div>
<div class="line"><code class="plain">		affectingAttributes: </code><code class="keyword">new</code><code class="plain"> List&lt;</code><code class="keyword">string</code><code class="plain">&gt;</code></div>
<div class="line"><code class="plain">		{</code></div>
<div class="line"><code class="plain">			MacroRuleMetadata.ALL_ATTRIBUTES</code></div>
<div class="line"><code class="plain">		});</code></div>
<div class="line"><code class="plain">    MacroRuleMetadataContainer.RegisterMetadata(metadata);</code></div>
<div class="line"><code class="plain">	...</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p><strong class=" ">Note</strong>: You can also combine the parameters as you see fit.<br></p>
</li><li class=" "><p>Save the files.</p>
</li></ol><p>Now, only the specified contact activities or changes in contact attributes will trigger a recalculation of the custom macro rule.</p>
        </div>

    </article>


               
            
    <footer id="ht-footer">
    <a href="#" id="ht-jump-top" class="sp-aui-icon-small sp-aui-iconfont-arrows-up"></a>
</footer></div>

<div>
    <div id="ht-mq-detect"></div>
</div>

    <script src="js/lunr.js"></script>
    <script src="js/lunr-extras.js"></script>
    <script src="assets/js/scroll-search.js"></script>

    <script src="assets/js/expand-macro.js"></script>


</body></html>