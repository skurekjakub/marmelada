<!DOCTYPE html><html><head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Working with consents on MVC sites - Kentico 11 Documentation</title>

    
    <link rel="stylesheet" href="assets/css/expand-macro.css">

            <meta name="scroll-content-language-key" content="">
    
    <meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=2.0, user-scalable=yes">

<script type="text/javascript" src="assets/js/jquery.min.js"></script>
<script type="text/javascript" src="assets/js/jquery.scrollTo.min.js"></script>


<script type="text/javascript" src="assets/js/translate.js"></script>

<script type="text/javascript" src="assets/js/theme.main.js"></script>

    <script type="text/javascript" src="assets/js/iframeResizer.min.js"></script>

<link rel="stylesheet" href="assets/css/content-style.css">
    <link rel="stylesheet" href="assets/css/search.css">

<link rel="stylesheet" href="assets/css/theme.main.css">
<link rel="stylesheet" href="assets/css/theme.colors.css">

            <!-- ES5 support for older browsers, needed by lunr -->
        <script src="js/augment.js"></script> 
        <script id="worker" type="javascript/worker">

        startIndex = function() {
            idx = lunr.Index.load(lunrIndex);
            idx.pipeline.remove(lunr.stopWordFilter);
            postMessage({type: "setup-complete"});
        }

        onmessage = function (event) {
            var message = event.data;

            if ((message.type === 'setup') && message.baseUrl) {
                var url = message.baseUrl;
                importScripts(url + 'js/lunr.js');
                importScripts(url + 'js/lunr-extras.js');
                importScripts(url + 'js/lunr-index.js');
                importScripts(url + 'js/lunr-data.js');
                startIndex();
            }

            if (idx && (message.type === 'search-request') && message.query) {
                var searchWord = message.query;
                var results = idx.search(searchWord).map(function (result) {
                    return lunrData.filter(function (d) {
                        return d.id === parseInt(result.ref, 10)
                    })[0]
                });
                postMessage({type: 'search-results', results: results, query: searchWord, queryId: message.queryId});
            }
        }

    </script>
    </head>

<body pageid="68879260" elementpageid="76846045">

<div id="ht-loader">
    <noscript>
        <p style="width: 100%; text-align:center; position: absolute; margin-top: 200px;">This content cannot be displayed without JavaScript.<br>Please enable JavaScript and reload the page.</p>
    </noscript>
</div>

<div>
   	<header id="ht-headerbar">
    <div class="ht-headerbar-left">
        <a href="" id="ht-menu-toggle" class="sp-aui-icon-small sp-aui-iconfont-appswitcher"></a>
    </div>
    <div class="ht-headerbar-right">
            <div class="sp-aui-icon-small ht-search-index-loader ht-header-icon"></div>

        <div id="ht-search">
            <div class="ht-search-input" style="display: none;">
              	<a href="#" class="sp-aui-icon-small sp-aui-iconfont-remove ht-search-clear"></a>

                <form action="#" method="GET" id="search">
                    <input class="search-input" type="text" placeholder="Search" tabindex="-1" autocomplete="off" name="q" value="">
                    <input type="hidden" name="max" value="15">
                    <input type="submit" style="display:none" tabindex="-4">
                </form>

                <a href="#" id="ht-search-button" class="ht-header-icon ht-header-icon-svg">
                                        <svg width="40px" height="40px" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                        <g>
                            <path d="M29.572,28.802 L28.801,29.571 C28.515,29.857 28.187,30 27.816,30 C27.445,30 27.116,29.857 26.831,29.571 L21.392,24.134 C20.193,24.762 18.908,25.076 17.538,25.076 C15.396,25.076 13.605,24.348 12.163,22.892 C10.721,21.436 10,19.651 10,17.538 C10,15.397 10.721,13.605 12.163,12.163 C13.605,10.721 15.396,10 17.538,10 C19.651,10 21.434,10.721 22.89,12.163 C24.347,13.605 25.075,15.397 25.075,17.538 C25.075,18.937 24.761,20.222 24.132,21.393 L29.572,26.832 C29.857,27.118 30,27.446 30,27.817 C30,28.188 29.857,28.517 29.572,28.802 L29.572,28.802 Z M13.662,21.414 C14.732,22.485 16.024,23.02 17.538,23.02 C19.051,23.02 20.343,22.485 21.413,21.414 C22.484,20.344 23.019,19.052 23.019,17.538 C23.019,16.025 22.484,14.733 21.413,13.662 C20.343,12.592 19.051,12.056 17.538,12.056 C16.024,12.056 14.732,12.592 13.662,13.662 C12.591,14.733 12.056,16.025 12.056,17.538 C12.056,19.052 12.591,20.344 13.662,21.414 L13.662,21.414 Z"></path>
                        </g>
                    </svg>
              	</a>

                <div class="ht-search-dropdown ht-dropdown">
                    <ul></ul>
                </div>
            </div>
        </div>
    </div>
    </header>   	<aside id="ht-sidebar">
    <div class="ht-sidebar-content">
        <div class="ht-sidebar-content-scroll-container">
            <header class="ht-sidebar-header">
                <h1 class="ht-logo">
                    <span class="ht-logo-label">K11</span>
                    <img class="space-logo" src="global.logo">
                </h1>
                <a href="Kentico-11-Documentation-Home.html" class="ht-space-link">
                    <h2>Kentico 11 Documentation</h2>
                </a>
            </header>
                            <iframe id="ht-nav" src="toc.html?pageId=76846045"></iframe>
                <script>
                    $('iframe#ht-nav').iFrameResize(
                            { 'log': true, 'autoResize': true, 'heightCalculationMethod': 'lowestElement', 'checkOrigin': false });
                </script>
                    </div>
    </div>

</aside></div>

<div id="ht-wrap-container">

            
    <div id="ht-sidebar-dragbar">
    <div class="ht-sidebar-drag-handle">
        <span class="drag-handle-1"></span>
        <span class="drag-handle-2"></span>
        <span class="drag-handle-3"></span>
    </div>
</div>
    <article id="ht-content" class="ht-content">
        <header class="ht-content-header">
            <div id="ht-breadcrumb">
    <ul>
        <li><a href="Kentico-11-Documentation-Home.html">Kentico 11 Documentation</a></li>
                                                                                                             <li><a href="" onclick="$('.shortcut').each(function(){$(this).removeClass('shortcut')}); $(this).parent().addClass('shortcut'); return false;">...</a> </li>
                                        <li class="shortcut"><a href="Developing-websites.html">Developing websites</a></li>
                                                                                                         <li class="shortcut"><a href="Developing-sites-using-ASP.NET-MVC.html">Developing sites using ASP.NET MVC</a></li>
                                                                                     <li><a href="Developing-MVC-applications.html">Developing MVC applications</a></li>
                                                            </ul>
</div>            <h1 id="src-76846045"> <span>Working with consents on MVC sites</span></h1>
        </header>

        <div id="main-content" class="wiki-content sp-grid-section" data-index-for-search="true">
<div class="sp-grid-cell sp-grid-60"><p>In Kentico, consents are records used to inform website visitors about the means of collecting and manipulating their personal data by the system, site administrators, marketers and anyone else who has access to said data, including third-parties to whom this data is forwarded.</p><p>You can use consents to comply with the requirements of the <a href="gdpr-compliance">GDPR</a> and other personal data regulations.</p><p>Whenever any personal data of a visitor is obtained, it is necessary to have a consent agreement from the visitor to legally process this data. This includes <a href="tracking-contacts-on-mvc-sites">tracking of contacts</a> and their <a href="logging-activities-on-mvc-sites">activities</a> on the live site. Every consent agreement of a visitor is directly connected to a corresponding <a href="working-with-contacts">contact</a>. Deleting contacts from the system therefore also causes deletion of the contact's consent agreements.</p><div class="confbox admonition admonition-note">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p><strong class=" ">Prerequisite</strong></p>
<p>Since consent agreements are directly connected to contacts, you need to enable <a href="tracking-contacts-on-mvc-sites">contact tracking</a> in your connected Kentico instance and in the MVC application.</p>
        </div>
    </div><p>This page describes how to set up consent functionality on MVC sites. To learn how to create consents in the Kentico administration interface or use consents on <a href="developing-websites-using-the-portal-engine">portal engine</a> websites, see <a href="working-with-consents">Working with consents</a>.</p><p></p><div class="confbox admonition admonition-tip">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p><strong class=" ">Tip</strong>: To view the full code of a functional example directly in Visual Studio, download the <a class="external-link" href="https://github.com/Kentico/Mvc">Kentico MVC solution</a> from GitHub and inspect the <strong class=" ">LearningKit</strong> project. You can also run the Learning Kit website after connecting the project to a Kentico database.</p>
        </div>
    </div><p></p></div>


    


    

    <div class="sp-grid-cell sp-grid-40 sp-grid-sidebar"><div class="sp-grid-cell sp-grid-40 sp-grid-sidebar"><div class="confbox panel">
            <div class="title panel-header">On this page</div>
            <div class="panel-content">
<p></p>
<ul class="toc-indentation "><li class=" "><p><a href="#src-76846045_workingwithconsentsonmvcsites-settinguptrackingconsent">Setting up tracking consent</a></p>
</li><li class=" "><p><a href="#src-76846045_workingwithconsentsonmvcsites-addingconsentstoforms">Adding consents to forms</a></p>
</li><li class=" "><p><a href="#src-76846045_workingwithconsentsonmvcsites-addingregistrationandsubscriptionconsents">Adding registration and subscription consents</a></p>
</li><li class=" "><p><a href="#src-76846045_workingwithconsentsonmvcsites-creatingconditionsbasedonconsents">Creating conditions based on consents</a></p>
</li><li class=" "><p><a href="#src-76846045_workingwithconsentsonmvcsites-revokingconsentagreements">Revoking consent agreements</a></p>
</li></ul><p></p>
        </div>
    </div><div class="confbox panel">
            <div class="title panel-header">Related pages</div>
            <div class="panel-content">
<ul class=" "><li class=" "><p><a href="working-with-forms-on-mvc-sites">Working with forms on MVC sites</a></p>
</li><li class=" "><p><a href="working-with-consents">Working with consents</a></p>
</li></ul>        </div>
    </div></div><div class="confbox panel">
            <div class="title panel-header">On this page</div>
            <div class="panel-content">
<p></p>
<ul class="toc-indentation "><li class=" "><p><a href="#src-76846045_workingwithconsentsonmvcsites-settinguptrackingconsent">Setting up tracking consent</a></p>
</li><li class=" "><p><a href="#src-76846045_workingwithconsentsonmvcsites-addingconsentstoforms">Adding consents to forms</a></p>
</li><li class=" "><p><a href="#src-76846045_workingwithconsentsonmvcsites-addingregistrationandsubscriptionconsents">Adding registration and subscription consents</a></p>
</li><li class=" "><p><a href="#src-76846045_workingwithconsentsonmvcsites-creatingconditionsbasedonconsents">Creating conditions based on consents</a></p>
</li><li class=" "><p><a href="#src-76846045_workingwithconsentsonmvcsites-revokingconsentagreements">Revoking consent agreements</a></p>
</li></ul><p></p>
        </div>
    </div><div class="confbox panel">
            <div class="title panel-header">Related pages</div>
            <div class="panel-content">
<ul class=" "><li class=" "><p><a href="working-with-forms-on-mvc-sites">Working with forms on MVC sites</a></p>
</li><li class=" "><p><a href="working-with-consents">Working with consents</a></p>
</li></ul>        </div>
    </div></div>
    
<p></p>
    <div class="confbox admonition admonition-info">
                    <p class="title">Kentico EMS required</p>
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p>Features described on this page require the <strong class=" ">Kentico EMS</strong> license.</p>
        </div>
    </div>
<p></p>
    <h3 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Setting up tracking consent</span></h3>
<p>When creating a consent for the <a href="tracking-contacts-on-mvc-sites">tracking of contacts</a> and <a href="logging-activities-on-mvc-sites">activities</a>, you need to provide a way for visitors to adjust their allowed <a href="cookie-levels">cookie level</a>. The system only performs the tracking for visitors whose cookie level is <i class=" ">Visitor </i>or higher.</p>
<p>To ensure that visitors are not tracked until they give the tracking consent, set the <strong class=" ">default cookie level</strong> for the website in your connected Kentico instance:</p>
<ol class=" "><li class=" "><p>Open the <strong class=" ">Settings</strong> application.</p>
</li><li class=" "><p>Navigate to the <strong class=" ">System</strong> category in the settings tree.</p>
</li><li class=" "><p>Set the value of the <strong class=" ">Default cookie level</strong> setting to <i class=" ">System</i> or <i class=" ">Essential</i>.</p>
    <div class="confbox admonition admonition-info">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p><strong class=" ">Note</strong>: With the <strong class=" ">System</strong> cookie level, basic functionality such as authentication may not work for visitors by default (if your authentication cookie is <a href="registering-custom-cookies">registered</a> with the <i class=" ">Essential</i> level). See <a href="working-with-users-on-mvc-sites">Working with users on MVC sites</a> for more information.</p>
        </div>
    </div>
</li><li class=" "><p>Click <strong class=" ">Save</strong>.</p>
</li></ol><p>To allow visitors to give and revoke agreements with the tracking consent on your MVC site, you need to develop corresponding components.</p>
    <h4 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Creating the consent</span></h4>
<p>Start by <a href="working-with-consents">defining the tracking consent</a> in the Kentico administration interface (in the <strong class=" ">Data protection</strong> application on the <strong class=" ">Consents</strong> tab).</p>
    <h4 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Creating the consent model</span></h4>
<p>We recommend creating a view model class in your MVC project to represent data related to the tracking consent. Include the following properties:</p>
<ul class=" "><li class=" "><p>A string property for storing the consent's short text</p>
</li><li class=" "><p>A boolean property to indicate whether an agreement with the consent was given</p>
</li></ul><p><img class="wysiwyg-unknown-macro" src="images/plugins/servlet/confluence/placeholder/unknown-macro.png" alt="images/plugins/servlet/confluence/placeholder/unknown-macro.png">
    </p>
    <h4 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Creating the controller</span></h4>
<p>Create a new controller class in your MVC project or edit an existing one:</p>
<ul class=" "><li class=" "><p>Add using statements for the following namespace from the Kentico API (and any other namespaces that you need):<img class="wysiwyg-unknown-macro" src="images/plugins/servlet/confluence/placeholder/unknown-macro.png" alt="images/plugins/servlet/confluence/placeholder/unknown-macro.png">
</p>
</li><li class=" "><p>Initialize instances of the following services, which are necessary to manage contacts and tracking consent:</p>
<ul class=" "><li class=" "><p><strong class=" ">IConsentAgreementService </strong>– to manage consent agreements.</p>
</li><li class=" "><p><strong class=" ">IContactTrackingService </strong>– to obtain the contact linked to the current visitor on the live site.</p>
</li><li class=" "><p><strong class=" ">ICurrentCookieLevelProvider </strong>– to manage the current visitor's cookie level.</p>
</li></ul>    <div class="confbox admonition admonition-tip">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p>We recommend using a <a href="initializing-kentico-services-with-dependency-injection">dependency injection container</a> to initialize service instances.</p>
        </div>
    </div>
<p><img class="wysiwyg-unknown-macro" src="images/plugins/servlet/confluence/placeholder/unknown-macro.png" alt="images/plugins/servlet/confluence/placeholder/unknown-macro.png">
    </p>
</li><li class=" "><p>Implement a GET action that displays information about the tracking consent:<img class="wysiwyg-unknown-macro" src="images/plugins/servlet/confluence/placeholder/unknown-macro.png" alt="images/plugins/servlet/confluence/placeholder/unknown-macro.png">
</p>
</li><li class=" "><p>Implement POST actions for creating and revoking consent agreements:</p>
<ul class=" "><li class=" "><p>Retrieve the visitor's contact using the <strong class=" ">GetCurrentContact</strong> method of the <strong class=" ">IContactTrackingService</strong> instance (see <a href="tracking-contacts-on-mvc-sites">Tracking contacts on MVC sites</a>).</p>
</li><li class=" "><p>Modify the visitor's cookie level according to the performed action – call the <strong class=" ">SetCurrentCookieLevel</strong> method of the <strong class=" ">ICurrentCookieLevelProvider</strong> instance.</p>
<ul class=" "><li class=" "><p>Set the <i class=" ">All </i>level when creating tracking consent agreements.</p>
</li><li class=" "><p>Set the default cookie level from the site's settings when revoking agreements.</p>
</li></ul></li><li class=" "><p>Create or revoke the consent agreement using the <strong class=" ">Agree</strong> or <strong class=" ">Revoke</strong> methods of the <strong class=" ">IConsentAgreementService</strong> instance.</p>
</li></ul><p><img class="wysiwyg-unknown-macro" src="images/plugins/servlet/confluence/placeholder/unknown-macro.png" alt="images/plugins/servlet/confluence/placeholder/unknown-macro.png">
<img class="wysiwyg-unknown-macro" src="images/plugins/servlet/confluence/placeholder/unknown-macro.png" alt="images/plugins/servlet/confluence/placeholder/unknown-macro.png">
</p>
</li></ul>    <h4 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Creating the view</span></h4>
<p>To display the tracking consent and inputs for giving or revoking agreements on your website, add an appropriate view to your MVC project. For example, you can add the consent presentation to a partial view that is included in your MVC website's main layout. This ensures that the input to give the tracking consent is displayed on all pages.</p>
<p>Depending on your preferences and legal requirements, you can either hide the view's output for visitors who have given the tracking consent or display content that allows the consent to be revoked.</p>
<p>Visitors on your website now have an option to give agreements with your tracking consent. New visitors are not tracked as contacts until they positively confirm that they agree with the tracking.</p>
    <h3 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Adding consents to forms</span></h3>
<p>Your MVC site may contain <a href="working-with-forms-on-mvc-sites">forms</a> that allow visitors to submit personal data. To collect consent agreements regarding the processing of this data, you need to modify the corresponding form's definition in the Kentico application, as well as related components in the MVC application.</p>
<p>In the Kentico back-end application:</p>
<ul class=" "><li class=" "><p>Create an appropriate <a href="working-with-consents">consent</a> in the <strong class=" ">Data protection</strong> application.</p>
</li><li class=" "><p>Add a consent agreement field to an existing form or create a new form (in the <strong class=" ">Forms</strong> application).</p>
</li><li class=" "><p>Ensure that the form's fields are <a href="mapping-fields-to-contact-attributes">mapped to contact attributes</a>.</p>
</li></ul><p>In the MVC application:</p>
<ul class=" "><li class=" "><p>Modify the appropriate controller to create consent agreements (use an <i class=" ">IFormConsentAgreementService</i> instance from the <i class=" ">CMS.DataProtection</i> namespace of the Kentico API).</p>
</li><li class=" "><p>Update the class <a href="generating-classes-for-kentico-objects">generated</a> for the form so that it includes the new consent field.</p>
</li><li class=" "><p>Extend your form submission view model to store consent data.</p>
</li><li class=" "><p>Modify your form's view to include an input option through which visitors can give consent agreements.</p>
</li></ul><p>The following sections describe how to extend the example from <a href="working-with-forms-on-mvc-sites">Working with forms on MVC sites</a>. You need to set up a form in your MVC application before you can follow this scenario and add the consent features.</p>
    <h4 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Modifying the feedback form</span></h4>
<p>Add a field for storing consent agreements to the form:</p>
<ol class=" "><li class=" "><p>Edit the desired form in the <strong class=" ">Forms</strong> application.</p>
</li><li class=" "><p>Switch to the <strong class=" ">Fields</strong> tab and create a <strong class=" ">New field</strong>.</p>
</li><li class=" "><p>Set the properties of the field:</p>
<ul class=" "><li class=" "><p><strong class=" ">Field name</strong>: ConsentAgreement</p>
</li><li class=" "><p><strong class=" ">Data type</strong>: <i class=" ">Unique identifier (GUID)</i></p>
</li></ul></li><li class=" "><p>Click <strong class=" ">Save</strong>.</p>
</li><li class=" "><p>Select the <strong class=" ">Contact mapping</strong> tab and map the form's fields to the appropriate contact atrributes (see <a href="mapping-fields-to-contact-attributes">Mapping fields to contact attributes</a>).</p>
</li><li class=" "><p>Switch to the <strong class=" ">Code</strong> tab.</p>
</li><li class=" "><p>Transfer the updated code to the <a href="generating-classes-for-kentico-objects">generated class</a> representing the form's data items in your MVC application <i class=" ">(FeedbackFormItem</i> in the example).</p>
</li></ol>    <h4 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Modifying the form model</span></h4>
<p>Edit the form's view model class and add two properties:</p>
<ul class=" "><li class=" "><p>A string property for storing the consent's short text</p>
</li><li class=" "><p>A boolean property to indicate whether an agreement with the consent was given</p>
</li></ul><p><img class="wysiwyg-unknown-macro" src="images/plugins/servlet/confluence/placeholder/unknown-macro.png" alt="images/plugins/servlet/confluence/placeholder/unknown-macro.png">
    </p>
    <h4 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Modifying the controller</span></h4>
<p>To process the consent agreements, you need to modify the controller class that you use to display the form and process the submitted data:</p>
<ol class=" "><li class=" "><p>Initialize <strong class=" ">IFormConsentAgreementService</strong> and <strong class=" ">IContactTrackingService</strong><i class=" "> </i>instances, and make them available in the controller's code.</p>
    <div class="confbox admonition admonition-tip">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p>We recommend using a <a href="initializing-kentico-services-with-dependency-injection">dependency injection container</a> to initialize service instances.</p>
        </div>
    </div>
</li><li class=" "><p>Modify the GET action that displays the form, and set the consent properties of the view model.</p>
</li><li class=" "><p>Modify the POST action that handles the form submission:</p>
<ol class=" "><li class=" "><p>Retrieve the visitor's contact using the <strong class=" ">GetCurrentContact</strong> method of the <strong class=" ">IContactTrackingService</strong> instance (see <a href="tracking-contacts-on-mvc-sites">Tracking contacts on MVC sites</a>).</p>
</li><li class=" "><p>Evaluate whether consent was given for the submitted form data. If yes, create a new consent agreement using the <strong class=" ">Agree</strong> method of the <strong class=" ">IFormConsentAgreementService</strong> instance.</p>
</li><li class=" "><p>Assign the GUID identifier of the returned consent agreement object into the consent field within the form item's data.</p>
</li></ol></li></ol><p><img class="wysiwyg-unknown-macro" src="images/plugins/servlet/confluence/placeholder/unknown-macro.png" alt="images/plugins/servlet/confluence/placeholder/unknown-macro.png">
Visitors on your MVC site now have an option to agree with the consent text when submitting the form. When processing the form's data, the sample controller creates a consent agreement for the given contact and stores the agreement's identifier into the corresponding form record field.</p>
    <h3 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Adding registration and subscription consents</span></h3>
<p>You can collect consent agreements in any scenarios where visitors submit an input form. For example, when <a href="user-registration-on-mvc-sites">registering as users</a> on the website or <a href="handling-newsletter-subscriptions-on-mvc-sites">subscribing to a newsletter</a>.</p>
<p>To set up the consent functionality, use a similar approach as described for <a href="#src-76846045_workingwithconsentsonmvcsites-addingconsentstoforms">form consents</a>:</p>
<ol class=" "><li class=" "><p>Prepare an appropriate <a href="working-with-consents">consent</a> in the Kentico administration interface (in the <strong class=" ">Data protection</strong> application on the <strong class=" ">Consents</strong> tab).</p>
</li><li class=" "><p>Expand the related controllers, models and views in your MVC project:</p>
<ol class=" "><li class=" "><p>Display the consent text in the appropriate form (registration or subscription), along with an input that allows visitors to give their consent.</p>
</li><li class=" "><p>Initialize instances of the <strong class=" ">IFormConsentAgreementService</strong> and <strong class=" ">IContactTrackingService</strong> interfaces, and make them available in the controller's code.</p>
</li><li class=" "><p>Get the visitor's contact (see <a href="tracking-contacts-on-mvc-sites">Tracking contacts on MVC sites</a>) and the appropriate consent object (by calling the <strong class=" ">ConsentInfoProvider.GetConsentInfo</strong> method).<br></p>
</li><li class=" "><p>In the post action that handles the submitted data, evaluate whether the consent was given and call the <strong class=" ">Agree</strong> method of the <strong class=" ">IFormConsentAgreementService</strong> instance to create a consent agreement.</p>
    <div class="confbox admonition admonition-info">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p><strong class=" ">IFormConsentAgreementService and IConsentAgreementService</strong></p>
<p>The <i class=" ">IFormConsentAgreementService.Agree</i> method automatically handles scenarios where the contact parameter is <i class=" ">null</i> (for example for visitors who have not given an agreement with the tracking consent). In these cases, the method creates a new contact object with the related data and connects it with the consent agreement.</p>
<p>If you only wish to create the consent in cases where contact tracking is enabled, you can add a null condition for the visitor's contact object and use the <i class=" ">IConsentAgreementService.Agree</i> method instead.</p>
        </div>
    </div>
</li></ol></li></ol><p>Visitors can now give their consent with personal data processing when submitting the corresponding forms (e.g. during registration or when subscribing to a newsletter).</p>
    <h3 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Creating conditions based on consents</span></h3>
<p>If you have any functionality that stores or processes personal data, you can create conditions to ensure that it only runs for contacts who have given consent.</p>
<ol class=" "><li class=" "><p>Initialize an instance of the <strong class=" ">IConsentAgreementService</strong> interface and make it available in your code.<strong class=" "><br></strong></p>
</li><li class=" "><p>Obtain the related contact and consent objects.</p>
</li><li class=" "><p>Evaluate whether the contact has given an agreement with the given consent by calling the <strong class=" ">IsAgreed</strong> method of the <strong class=" ">IConsentAgreementService</strong> instance.</p>
</li></ol>    <h3 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Revoking consent agreements</span></h3>
<p>To ensure compliance of your website with the GDPR or other data protection regulations, you need to give visitors the option to revoke their previously given consent agreements. We recommend creating a privacy page, where visitors can view the consents for which they have given agreements and potentially revoke them.</p>
    <div class="confbox admonition admonition-info">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p>"It shall be as easy to withdraw as to give consent."</p>
<p>(Source: <a class="external-link" href="http://eur-lex.europa.eu/legal-content/EN/TXT/?uri=CELEX:32016R0679#d1e2001-1-1">GDPR Article 7</a>, Paragraph 3)</p>
        </div>
    </div>
<p>The following sections describe how to create a privacy page on MVC sites. The privacy page lists accepted consents for visitors, and allows them to view the full consent details or revoke their agreements.</p>
<ul class=" "><li class=" "><p>Create a model representing the list of consents for which visitors have given agreements.</p>
</li><li class=" "><p>Create a model representing consent details.</p>
</li><li class=" "><p>Create a controller that provides actions for displaying and revoking consents.</p>
</li><li class=" "><p>Create views for the consent list and details pages.</p>
</li></ul>    <h4 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Creating the models</span></h4>
<ul class=" "><li class=" "><p>Add a model class that represents the list of consents for which visitors have given agreements.<img class="wysiwyg-unknown-macro" src="images/plugins/servlet/confluence/placeholder/unknown-macro.png" alt="images/plugins/servlet/confluence/placeholder/unknown-macro.png">
</p>
    <div class="confbox admonition admonition-info">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p><strong class=" "><i class=" ">Consent</i> and <i class=" ">ConsentInfo</i> objects</strong></p>
<p>The Kentico API uses <strong class=" ">ConsentInfo</strong> objects to work with consents in general. However, when you load consents for which a contact has given an agreement, the <i class=" ">ConsentAgreementService.GetAgreedConsents</i> method returns a collection of <strong class=" ">Consent</strong> objects. Instances of the <i class=" ">Consent</i> class provide the <i class=" ">GetConsentText</i> method, which automatically retrieves either the current texts of the given consent or the texts of the archived consent version for which the agreement was given.</p>
<p>When displaying accepted consents to visitors, always work with <i class=" ">Consent</i> objects to ensure that the correct consent text version is used (for scenarios where the consent text was changed after agreements had been given).</p>
<p>For more information, see the <i class=" ">Viewing archived consents</i> section of the <a href="working-with-consents">Working with consents</a> page.</p>
        </div>
    </div>
    <div class="confbox admonition admonition-tip">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p><strong class=" ">Tip</strong>: You can directly use an <i class=" ">IEnumerable&lt;Consent&gt;</i> collection as a model if you do not need to work with any other data in your controller or views. However, having a dedicated model class allows you to extend the model based on future requirements.</p>
        </div>
    </div>
</li><li class=" "><p>Add a model class that represents the full details of a consent, including properties for the short text, full text, and any other information about the consent you may need.<img class="wysiwyg-unknown-macro" src="images/plugins/servlet/confluence/placeholder/unknown-macro.png" alt="images/plugins/servlet/confluence/placeholder/unknown-macro.png">
</p>
</li></ul>    <h4 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Creating the controller</span></h4>
<p>Create a new controller class in your MVC project or edit an existing one:</p>
<ul class=" "><li class=" "><p>Add using statements for the following namespaces from the Kentico API (and any other namespaces that you need):<img class="wysiwyg-unknown-macro" src="images/plugins/servlet/confluence/placeholder/unknown-macro.png" alt="images/plugins/servlet/confluence/placeholder/unknown-macro.png">
</p>
</li><li class=" "><p>Initialize instances of the <strong class=" ">IConsentAgreementService</strong>,<strong class=" "> IContactTrackingService</strong> and <strong class=" ">ICurrentCookieLevelProvider</strong> interfaces, and make them available in the controller's code:<img class="wysiwyg-unknown-macro" src="images/plugins/servlet/confluence/placeholder/unknown-macro.png" alt="images/plugins/servlet/confluence/placeholder/unknown-macro.png">
</p>
    <div class="confbox admonition admonition-tip">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p>We recommend using a <a href="initializing-kentico-services-with-dependency-injection">dependency injection container</a> to initialize service instances.</p>
        </div>
    </div>
</li><li class=" "><p>Implement a GET action which retrieves a list of all consents accepted by the visitor:</p>
<ol class=" "><li class=" "><p>Retrieve the visitor's contact using the <strong class=" ">GetCurrentContact</strong> method of the <strong class=" ">IContactTrackingService</strong> instance (see <a href="tracking-contacts-on-mvc-sites">Tracking contacts on MVC sites</a>).</p>
</li><li class=" "><p>Get the consents for which the contact has given an agreement by calling the <strong class=" ">GetAgreedConsents</strong> method of the <strong class=" ">IConsentAgreementService</strong> instance.</p>
</li><li class=" "><p>Create an instance of the consent list model class and pass it to the view.</p>
</li></ol><p><img class="wysiwyg-unknown-macro" src="images/plugins/servlet/confluence/placeholder/unknown-macro.png" alt="images/plugins/servlet/confluence/placeholder/unknown-macro.png">
    </p>
</li><li class=" "><p>Implement a GET action which retrieves the full details of a specified consent:</p>
<ol class=" "><li class=" "><p>Retrieve the current contact using the contact tracking service.</p>
</li><li class=" "><p>Get the consents for which the contact has given an agreement using the consent agreement service, and select the required consent based on the action's parameter. This approach ensures that the correct consent text version is used in cases where the text was changed after the agreement had been given.</p>
</li><li class=" "><p>Create an instance of the consent details model class, set its properties, and pass it to the view.</p>
</li></ol><p><img class="wysiwyg-unknown-macro" src="images/plugins/servlet/confluence/placeholder/unknown-macro.png" alt="images/plugins/servlet/confluence/placeholder/unknown-macro.png">
    </p>
</li><li class=" "><p>Implement a POST action that revokes agreements for a specified consent:</p>
<ol class=" "><li class=" "><p>Retrieve the current contact using the contact tracking service and the required consent (by calling the <strong class=" ">ConsentInfoProvider.GetConsentInfo</strong> method).</p>
</li><li class=" "><p>Create a revocation for the consent agreement using the <strong class=" ">Revoke</strong> method of the <strong class=" ">IConsentAgreementService</strong> instance.</p>
    <div class="confbox admonition admonition-note">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p>When revoking the <a href="#src-76846045_workingwithconsentsonmvcsites-settinguptrackingconsent">tracking consent</a>, you also need to lower the visitor's cookie level to ensure that contact tracking is disabled. Call the <strong class=" ">SetCurrentCookieLevel</strong> method of the <strong class=" ">ICurrentCookieLevelProvider</strong> instance and set the default cookie level from the site's settings.</p>
        </div>
    </div>
</li></ol><p><img class="wysiwyg-unknown-macro" src="images/plugins/servlet/confluence/placeholder/unknown-macro.png" alt="images/plugins/servlet/confluence/placeholder/unknown-macro.png">
    </p>
    <div class="confbox admonition admonition-note">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p><strong class=" ">Clearing personal data for revoked consents</strong></p>
<p>When a visitor revokes a consent agreement, you may also need to delete or anonymize certain types of <a href="personal-data-in-kentico">personal data</a> stored by the system.</p>
<p>To perform additional actions of this type whenever a consent agreement is revoked, assign a custom handler to the system's <strong class=" ">DataProtectionEvents.RevokeConsentAgreement </strong><a href="reference---global-system-events">global event</a>.</p>
<p>See also: <a href="implementing-personal-data-erasure">Implementing personal data erasure</a></p>
        </div>
    </div>
</li></ul>    <h4 $stringutils.tolowercase(${idattribute})="" class="heading "><span>Creating the views</span></h4>
<p>Add appropriate views to your MVC project to display the consent list (privacy page) and the consent details.</p>
    <div class="confbox admonition admonition-tip">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p>Consent text values may contain HTML tags added via the editor in the Kentico administration interface (for formatting or content such as links). To ensure that the text is displayed correctly, disable the HTML encoding for the values using the <strong class=" ">Html.Raw</strong> method or the <strong class=" ">Html.Kentico().ResolveUrls</strong> extension method (also handles correct resolving of link URLs).</p>
<p>For example:<img class="wysiwyg-unknown-macro" src="images/plugins/servlet/confluence/placeholder/unknown-macro.png" alt="images/plugins/servlet/confluence/placeholder/unknown-macro.png">
</p>
        </div>
    </div>
<p>Visitors on your site are now able to view a list of all consents for which they have given an agreement. They can also access the full details of the given consents and revoke their agreements if required.</p>
        </div>

    </article>


               
            
    <footer id="ht-footer">
    <a href="#" id="ht-jump-top" class="sp-aui-icon-small sp-aui-iconfont-arrows-up"></a>
</footer></div>

<div>
    <div id="ht-mq-detect"></div>
</div>

    <script src="js/lunr.js"></script>
    <script src="js/lunr-extras.js"></script>
    <script src="assets/js/scroll-search.js"></script>

    <script src="assets/js/expand-macro.js"></script>


</body></html>