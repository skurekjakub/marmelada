<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>$space.name - $page.title</title>

        $include.template("/include/include-htmlhead.vm")
        <link rel="stylesheet" type="text/css" href="${theme.baseUrl}/assets/css/theme.search.css">
    </head>
    
    <body>
        ## Google Tag Manager
        <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-TSQNPJN" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    
        <div id="ht-loader">
            <noscript>
                <p style="width: 100%; text-align:center; position: absolute; margin-top: 200px;">This content cannot be displayed without JavaScript.<br>Please enable JavaScript and reload the page.</p>
            </noscript>
        </div>

        $include.template("/include/include-headerbar.vm")

        ## Old version note
        $include.template("/include/include-old-version-note.vm")
    
        <div id="ht-wrap-container">
            <div class="container">
                <div class="ht-layout">
                    <div class="ht-layout-sidebar">
                        $include.template("/include/include-sidebar.vm")
                    </div>
                    <div class="ht-layout-main">
                        <article class="ht-content">
                            $include.template("/include/include-searchbox.vm")

                            ## --- No search results
                            #if($searchResults.total == 0)
                                <div class="search-left-noresults">                                        
                                    <h2>No pages found for '<strong>$searchRequest.queryString</strong>' in $space.name</h2>
                                </div>
                                #if(!$space.key.toLowerCase().contains("tutorial") && !$space.key.toLowerCase().contains("api"))
                                    <div class="search-reference-wrapper">
                                        $include.template("/include/include-reference-mostsearched.vm")
                                    </div>
                                #end

                            ## --- Some search results
                            #else                  

                                <p class="search-results-found">
                                $searchResults.total #if ($searchResults.total > 1) pages #else page#end found for '<strong>$searchRequest.queryString</strong>' in $space.name
                                </p>

                                <div id="search-results">
                                    #foreach($result in $searchResults.items)
                                        <section class="search-result">
                                            <header>
                                                <h2>
                                                <a href="$result.link">$result.displayTitle</a>
                                                                                    
                                                ## Labels showing the dev models that individual search results are available for
                                                ## Only displayed when label filtering is disabled, i.e. when showing all results
                                                #if ($searchRequest.labels.isEmpty())
                                                    #if ($space.link.contains("/k12") && !$space.link.contains("api"))
                                                        #if ($result.object.labels.contains("mvc"))
                                                            <span class="search-result-label mvc-result">MVC</span>
                                                        #elseif ($result.object.labels.contains("pe"))
                                                            <span class="search-result-label pe-result">Portal Engine</span>
                                                        #elseif ($result.object.labels.contains("all_models"))
                                                            <span class="search-result-label mvc-result">MVC</span>
                                                            <span class="search-result-label pe-result">Portal Engine</span>
                                                        #end
                                                    #end
                                                #end
                                                
												## Labels showing the target persona of pages in the search results
												## Only used in the XP docs
												#if ($repository.key == "XP")
													#if ($result.link.contains("/developers-and-admins"))
														<span class="search-result-label dev-result">Developers & Admins</span>
													#elseif ($result.link.contains("/business-users"))
														<span class="search-result-label business-result">Business users</span>
													#else
														<span class="search-result-label dev-result">Developers & Admins</span>
														<span class="search-result-label business-result">Business users</span>
													#end													
												#end
												
                                                </h2>
                                            </header>
                                            <div class="search-result-content">
                                                <p><a class="search-result-link" href="$result.absoluteLink">$result.absoluteLink</a></p>
                                                <p class="search-result-desc">$result.getDescription(500)...</p>
                                            </div>
                                        </section>
                                    #end
                                </div>
                            #end

                            ## -------------------------PAGINATION------------------------
                            ## Only show if more results than can fit on one page exist
                            #if($searchResults.total > 10)

                                ## Calculate page numbers based on searchResults.startIndex
                                ## First page
                                #if($searchResults.startIndex == 0)
                                    #set($starthelp = 0)
                                    #set($end = 4)
                                    #set($range = [$starthelp..$end])
                                #else
                                    #set($starthelp = ($searchResults.startIndex/$searchResults.maxResultsPerPage))
                                    ## Second page
                                    #if(($starthelp == 1))
                                        #set($start = $starthelp - 1)
                                        #set($end = $starthelp + 3)
                                        #set($range = [$start..$end])
                                    ## Page before the last
                                    #elseif($starthelp == (($searchResults.total - ($searchResults.total % $searchResults.maxResultsPerPage)) / $searchResults.maxResultsPerPage) - 1)
                                        #set($start = $starthelp - 3)
                                        #set($end = $starthelp + 1)
                                        #set($range = [$start..$end])
                                    ## Last page
                                    #elseif($starthelp == (($searchResults.total - ($searchResults.total % $searchResults.maxResultsPerPage)) / $searchResults.maxResultsPerPage))
                                        #set($start = $starthelp - 4)
                                        #set($end = $starthelp )
                                        #set($range = [$start..$end])
                                    ## No bounds to worry about
                                    #else
                                        #set($start = $starthelp - 2)
                                        #set($end = $starthelp + 2)
                                        #set($range = [$start..$end])
                                    #end
                                #end
                                <div class="pagination">
                                    ## Generate link to a previous page (if it exists)
                                    #if($pager.hasPrev)
                                        <a href="$pager.prevLink">Previous</a>
                                    #end
                                    ## Generate links for pagination
                                
                                    ## Prepares the label filtering query string parameter
                                    #set($labelParam="&l=")
                                    #if($searchRequest.labels.isEmpty())
                                        #set($labelParam="")
                                    #else
                                        #set($j = 0)
                                        #foreach($label in $searchRequest.labels)
                                            #set($labelParam = $labelParam + $label)
                                            #if($j < $searchRequest.labels.size() - 1)
                                                #set($labelParam = $labelParam + ",")
                                            #end
                                            #set($j = $j + 1)
                                        #end
                                    #end
                                
                                    #foreach($i in $range)
                                        #set($startindex = $i * $searchResults.maxResultsPerPage)
                                        #set($pagenumber = $i + 1)
                                        ## Prevent rendering of out of bounds pages, search results use zero-based indexing, using $startindex + 1 to prevent rendering of an extra page which would display zero search results 
                                        #if(($startindex < 0) || ( ($startindex + 1) > $searchResults.total))
                                        #else
                                            ## Render links and bold the current page
                                            #if($i == $starthelp)
                                                <span><strong><a href="$space.absoluteLink/search?q=$searchRequest.queryString&amp;start=$startindex&amp;max=$searchResults.maxResultsPerPage$labelParam">$pagenumber</a></strong></span>
                                            #else
                                                <span><a href="$space.absoluteLink/search?q=$searchRequest.queryString&amp;start=$startindex&amp;max=$searchResults.maxResultsPerPage$labelParam">$pagenumber</a></span>
                                            #end
                                        #end
                                    #end

                                    ## Generate link to a next page (if it exists)
                                    #if($pager.hasNext)
                                        <span><a href="$pager.nextLink">Next</a></span>
                                    #end
                                </div>

                            #end
                        </article>
                    </div>
                </div> ## row
            </div> ## container
        </div> ## ht-wrap-container

        $include.template("/include/include-footer.vm")

        <div>
            <div id="ht-mq-detect"></div>
        </div>
        
        $include.template("/include/include-bodyendscripts.vm")
    </body>
</html>