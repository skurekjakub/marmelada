<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Synchronizing database changes not managed by continuous integration - Kentico 11 Documentation</title>

    
    <link rel="stylesheet" href="assets/css/expand-macro.css">

            <meta name="scroll-content-language-key" content="">
    
    <meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=2.0, user-scalable=yes">

<script type="text/javascript" src="assets/js/jquery.min.js"></script>
<script type="text/javascript" src="assets/js/jquery.scrollTo.min.js"></script>


<script type="text/javascript" src="assets/js/translate.js"></script>

<script type="text/javascript" src="assets/js/theme.main.js"></script>

    <script type="text/javascript" src="assets/js/iframeResizer.min.js"></script>

<link rel="stylesheet" href="assets/css/content-style.css">
    <link rel="stylesheet" href="assets/css/search.css">

<link rel="stylesheet" href="assets/css/theme.main.css">
<link rel="stylesheet" href="assets/css/theme.colors.css">

            <!-- ES5 support for older browsers, needed by lunr -->
        <script src="js/augment.js"></script> 
        <script id="worker" type="javascript/worker">

        startIndex = function() {
            idx = lunr.Index.load(lunrIndex);
            idx.pipeline.remove(lunr.stopWordFilter);
            postMessage({type: "setup-complete"});
        }

        onmessage = function (event) {
            var message = event.data;

            if ((message.type === 'setup') && message.baseUrl) {
                var url = message.baseUrl;
                importScripts(url + 'js/lunr.js');
                importScripts(url + 'js/lunr-extras.js');
                importScripts(url + 'js/lunr-index.js');
                importScripts(url + 'js/lunr-data.js');
                startIndex();
            }

            if (idx && (message.type === 'search-request') && message.query) {
                var searchWord = message.query;
                var results = idx.search(searchWord).map(function (result) {
                    return lunrData.filter(function (d) {
                        return d.id === parseInt(result.ref, 10)
                    })[0]
                });
                postMessage({type: 'search-results', results: results, query: searchWord, queryId: message.queryId});
            }
        }

    </script>
    </head>

<body pageid="68879260">

<div id="ht-loader">
    <noscript>
        <p style="width: 100%; text-align:center; position: absolute; margin-top: 200px;">This content cannot be displayed without JavaScript.<br>Please enable JavaScript and reload the page.</p>
    </noscript>
</div>

<div>
   	<header id="ht-headerbar">
    <div class="ht-headerbar-left">
        <a href="" id="ht-menu-toggle" class="sp-aui-icon-small sp-aui-iconfont-appswitcher"></a>
    </div>
    <div class="ht-headerbar-right">
            <div class="sp-aui-icon-small ht-search-index-loader ht-header-icon"></div>

        <div id="ht-search">
            <div class="ht-search-input" style="display: none;">
              	<a href="#" class="sp-aui-icon-small sp-aui-iconfont-remove ht-search-clear"></a>

                <form action="#" method="GET" id="search">
                    <input class="search-input" type="text" placeholder="Search" tabindex="-1" autocomplete="off" name="q" value="">
                    <input type="hidden" name="max" value="15" />
                    <input type="submit" style="display:none" tabindex="-4"/>
                </form>

                <a href="#" id="ht-search-button" class="ht-header-icon ht-header-icon-svg">
                                        <svg width="40px" height="40px" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                        <g>
                            <path d="M29.572,28.802 L28.801,29.571 C28.515,29.857 28.187,30 27.816,30 C27.445,30 27.116,29.857 26.831,29.571 L21.392,24.134 C20.193,24.762 18.908,25.076 17.538,25.076 C15.396,25.076 13.605,24.348 12.163,22.892 C10.721,21.436 10,19.651 10,17.538 C10,15.397 10.721,13.605 12.163,12.163 C13.605,10.721 15.396,10 17.538,10 C19.651,10 21.434,10.721 22.89,12.163 C24.347,13.605 25.075,15.397 25.075,17.538 C25.075,18.937 24.761,20.222 24.132,21.393 L29.572,26.832 C29.857,27.118 30,27.446 30,27.817 C30,28.188 29.857,28.517 29.572,28.802 L29.572,28.802 Z M13.662,21.414 C14.732,22.485 16.024,23.02 17.538,23.02 C19.051,23.02 20.343,22.485 21.413,21.414 C22.484,20.344 23.019,19.052 23.019,17.538 C23.019,16.025 22.484,14.733 21.413,13.662 C20.343,12.592 19.051,12.056 17.538,12.056 C16.024,12.056 14.732,12.592 13.662,13.662 C12.591,14.733 12.056,16.025 12.056,17.538 C12.056,19.052 12.591,20.344 13.662,21.414 L13.662,21.414 Z"></path>
                        </g>
                    </svg>
              	</a>

                <div class="ht-search-dropdown ht-dropdown">
                    <ul></ul>
                </div>
            </div>
        </div>
    </div>
    </header>   	<aside id="ht-sidebar">
    <div class="ht-sidebar-content">
        <div class="ht-sidebar-content-scroll-container">
            <header class="ht-sidebar-header">
                <h1 class="ht-logo">
                    <span class="ht-logo-label">K11</span>
                    <img class="space-logo" src="global.logo" />
                </h1>
                <a href="Kentico-11-Documentation-Home.html" class="ht-space-link">
                    <h2>Kentico 11 Documentation</h2>
                </a>
            </header>
                            <iframe id="ht-nav" src="toc.html?pageId=70451861"></iframe>
                <script>
                    $('iframe#ht-nav').iFrameResize(
                            { 'log': true, 'autoResize': true, 'heightCalculationMethod': 'lowestElement', 'checkOrigin': false });
                </script>
                    </div>
    </div>

</aside></div>

<div id="ht-wrap-container">

            
    <div id="ht-sidebar-dragbar">
    <div class="ht-sidebar-drag-handle">
        <span class="drag-handle-1"></span>
        <span class="drag-handle-2"></span>
        <span class="drag-handle-3"></span>
    </div>
</div>
    <article id="ht-content" class="ht-content">
        <header class="ht-content-header">
            <div id="ht-breadcrumb">
    <ul>
        <li><a href="Kentico-11-Documentation-Home.html">Kentico 11 Documentation</a></li>
                                                                                                             <li><a href="" onclick="$('.shortcut').each(function(){$(this).removeClass('shortcut')}); $(this).parent().addClass('shortcut'); return false;">...</a> </li>
                                        <li class="shortcut"><a href="Developing-websites.html">Developing websites</a></li>
                                                                                                         <li class="shortcut"><a href="Preparing-your-environment-for-team-development.html">Preparing your environment for team development</a></li>
                                                                                     <li><a href="Setting-up-continuous-integration.html">Setting up continuous integration</a></li>
                                                            </ul>
</div>            <h1 id="src-70451861"> <span>Synchronizing database changes not managed by continuous integration</span></h1>
        </header>

        <div id="main-content" class="wiki-content sp-grid-section" data-index-for-search="true">
<p   
>The Kentico   <a   href="Setting-up-continuous-integration">continuous integration solution</a> handles serialization of data of most objects from the database into XML files on the file system. However,   <a   href="Object-types-supported-by-continuous-integration">not all database changes</a> are supported by it. Changes to database indexes, functions, stored procedures, custom views, and so on are all unsupported by continuous integration. To keep the main database consistent across your development instances, these changes need to be handled manually. We recommend using   <a   href="#src-70451861_Synchronizingdatabasechangesnotmanagedbycontinuousintegration-Synchronizingdatabasechangesusingmigrationscripts">migration scripts</a> to synchronize database changes not managed by the Kentico continuous integration solution.</p>
    <h3 id="src-70451861_Synchronizingdatabasechangesnotmanagedbycontinuousintegration-Synchronizingdatabasechangesusingmigrationscripts" class="heading "><span>Synchronizing database changes using migration scripts</span></h3>
<p   
>A migration script allows you to alter a database by changing all or part of a database. This alteration can be as simple as adding or removing a column to a table, or a complex refactoring task such as splitting tables or changing column properties in a way that could affect the data it stores.</p>
    <div  class="confbox admonition admonition-info">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p   
>The rest of this page assumes you are using a development environment utilizing the Kentico continuous integration solution. See   <a   href="Setting-up-continuous-integration">Setting up continuous integration</a> for more information.</p>
        </div>
    </div>
    <h4 id="src-70451861_Synchronizingdatabasechangesnotmanagedbycontinuousintegration-Utilizingmigrationscriptsinacontinuousintegrationworkflow" class="heading "><span>Utilizing migration scripts in a continuous integration workflow</span></h4>
<p   
>The Kentico continuous integration solution supports the use of migration scripts. The ~\<strong class=" ">CMS\App_Data\</strong><strong class=" ">CIRepository</strong> folder contains, in addition to serialized database object data, the following files:</p>
<ul class=" "><li class=" "><p   
><strong class=" ">@migrations</strong> &ndash; folder for storing all created migrations connected to a particular repository. Since all migration scripts for a repository are stored in this folder, their file names need to be unique.</p>
</li><li class=" "><p  class="auto-cursor-target" 
><strong class=" ">Before.txt</strong> &ndash; holds the file names of all migrations applied before the <i class=" ">CIRepository</i> folder   <a   href="Restoring-continuous-integration-files-to-the-database">is restored</a> to the database. Insert only the migration file names without the .sql suffix. Each file name must be inserted on a <strong class=" ">separate line</strong>.</p>
</li><li class=" "><p  class="auto-cursor-target" 
><strong class=" ">After.txt </strong>&ndash;<strong class=" "> </strong>holds the file names of all migrations applied after the <i class=" ">CIRepository</i> folder is restored to the database. Insert only the migration file names without the .sql suffix. Each file name must be inserted on a <strong class=" ">separate line</strong>.</p>
</li></ul><p   
>Additionally, the database of a Kentico instance contains a <strong class=" ">CI_Migration</strong> table, which stores the file names of migrations already executed on the database.</p>
    <div  class="confbox panel">
            <div class="title panel-header">On this page</div>
            <div class="panel-content">
<p   
></p>
<ul class="toc-indentation "><li class=" "><p   
>  <a   href="#src-70451861_Synchronizingdatabasechangesnotmanagedbycontinuousintegration-Synchronizingdatabasechangesusingmigrationscripts">Synchronizing database changes using migration scripts</a></p>
<ul class="toc-indentation "><li class=" "><p   
>  <a   href="#src-70451861_Synchronizingdatabasechangesnotmanagedbycontinuousintegration-Utilizingmigrationscriptsinacontinuousintegrationworkflow">Utilizing migration scripts in a continuous integration workflow</a></p>
</li><li class=" "><p   
>  <a   href="#src-70451861_Synchronizingdatabasechangesnotmanagedbycontinuousintegration-RestoringthecontinuousintegrationrepositoryviaRunRestore.ps1">Restoring the continuous integration repository via RunRestore.ps1</a></p>
</li><li class=" "><p   
>  <a   href="#src-70451861_Synchronizingdatabasechangesnotmanagedbycontinuousintegration-Decidingwhentoexecuteamigration">Deciding when to execute a migration</a></p>
</li><li class=" "><p   
>  <a   href="#src-70451861_Synchronizingdatabasechangesnotmanagedbycontinuousintegration-Example-Creatingmigrationscriptstosynchronizedatabasechanges">Example - Creating migration scripts to synchronize database changes</a></p>
</li><li class=" "><p   
>  <a   href="#src-70451861_Synchronizingdatabasechangesnotmanagedbycontinuousintegration-Retrievingthelatestversionofyourprojectandupdatingthedatabase">Retrieving the latest version of your project and updating the database</a></p>
</li></ul></li><li class=" "><p   
>  <a   href="#src-70451861_Synchronizingdatabasechangesnotmanagedbycontinuousintegration-Rollingbackdatabasechanges">Rolling back database changes</a></p>
<ul class="toc-indentation "><li class=" "><p   
>  <a   href="#src-70451861_Synchronizingdatabasechangesnotmanagedbycontinuousintegration-Example-Rollingbackchanges">Example - Rolling back changes</a></p>
</li><li class=" "><p   
>  <a   href="#src-70451861_Synchronizingdatabasechangesnotmanagedbycontinuousintegration-Restoringthedatabasetoaspecificpointintime">Restoring the database to a specific point in time</a></p>
</li></ul></li></ul><p   
></p>
        </div>
    </div>
    <div  class="confbox panel">
            <div class="title panel-header">Related pages</div>
            <div class="panel-content">
<ul class=" "><li class=" "><p   
>  <a   href="Continuous-integration-repository-structure">Continuous integration repository structure</a></p>
</li><li class=" "><p   
>  <a   href="Object-types-supported-by-continuous-integration">Object types supported by continuous integration</a></p>
</li><li class=" "><p   
>  <a   href="Restoring-continuous-integration-files-to-the-database">Restoring continuous integration files to the database</a></p>
</li><li class=" "><p   
>  <a   href="Using-continuous-integration-with-Visual-Studio">Using continuous integration with Visual Studio</a></p>
</li></ul>        </div>
    </div>
<p   
>When you need to create or modify objects not supported by continuous integration (for example table indexes, functions, or stored procedures) and you want to share these changes with your team members or commit them to a source control system (for example <a  class="external-link" href="https://www.visualstudio.com/tfs/">Team Foundation Server</a> or <a  class="external-link" href="https://git-scm.com/">Git</a>), you need to:</p>
<ol class=" "><li class=" "><p   
>Write a migration script that applies the required change to the database. Refer to the   <a   href="#src-70451861_Synchronizingdatabasechangesnotmanagedbycontinuousintegration-Example-Creatingmigrationscriptstosynchronizedatabasechanges">Example - Creating migration scripts to synchronize database changes</a> section for an example of the process.</p>
</li><li class=" "><p  class="auto-cursor-target" 
>Reference the migration script in either the <i class=" ">Before.txt</i> or <i class=" ">After.txt</i> file.</p>
    <div  class="confbox admonition admonition-tip">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p   
>If you are not sure when a migration should be executed, see the   <a   href="#src-70451861_Synchronizingdatabasechangesnotmanagedbycontinuousintegration-Decidingwhentoexecuteamigration">Deciding when to execute a migration</a> section for specific scenarios and examples.</p>
        </div>
    </div>
</li><li class=" "><p   
>Execute the migration script alongside the continuous integration repository restore on databases you want to keep synchronized.</p>
</li></ol><p   
>You can download a sample PowerShell script automating the process here: <a   href="attachments/70451908_3_RunRestore.ps1">RunRestore.ps1</a></p>
    <h4 id="src-70451861_Synchronizingdatabasechangesnotmanagedbycontinuousintegration-RestoringthecontinuousintegrationrepositoryviaRunRestore.ps1" class="heading "><span>Restoring the continuous integration repository via RunRestore.ps1</span></h4>
<p   
>If you use the <i class=" ">RunRestore.ps1</i> script, the database restore process consists of these steps:</p>
<ol class=" "><li class=" "><p   
>Call the <i class=" ">RunRestore.ps1</i> script from a command-line interface. Use the full path to a Kentico instance&#39;s CMS folder as the argument.</p>
<ul class=" "><li class=" "><p   
>For example: <i class=" ">.\RunRestore.ps1 C:\inetpub\wwwroot\Kentico11\CMS</i></p>
</li></ul></li><li class=" "><p   
>The <i class=" ">RunRestore.ps1</i> script:</p>
<ul class=" "><li class=" "><p   
>Retrieves the <i class=" ">CMSConnectionString</i> from the given project&#39;s web.config file.</p>
</li><li class=" "><p   
>Creates an <i class=" ">App_Offline.htm</i> file in the directory, stopping the instance.</p>
</li><li class=" "><p   
>Iterates through migrations referenced in <i class=" ">Before.txt</i><i class=" "> </i>and applies them to the target database if necessary. The file names of the applied migrations are recorded in the <i class=" ">CI_Migration</i> table.</p>
</li><li class=" "><p   
>Executes &quot;<i class=" ">ContinuousIntegration.exe<strong class=" "> </strong>-r -s&quot;</i>, deserializing the objects stored in the project&#39;s <i class=" ">CIRepository</i> folder and creates, overwrites or removes corresponding data in the database (specified by the connection string in the given project&#39;s web.config file)</p>
</li><li class=" "><p   
>Iterates through migrations referenced in <i class=" ">After.txt</i> and applies them to the target database if necessary. The file names of the applied migrations are recorded in the <i class=" ">CI_Migration</i> table.</p>
</li><li class=" "><p   
>Removes the <i class=" ">App_Offline.htm</i> file from the directory, bringing the instance back online.</p>
</li></ul></li></ol><p   
>The targeted project&#39;s database now contains the <i class=" ">CIRepository</i> data and modifications applied via migration scripts.</p>
    <h4 id="src-70451861_Synchronizingdatabasechangesnotmanagedbycontinuousintegration-Decidingwhentoexecuteamigration" class="heading "><span>Deciding when to execute a migration</span></h4>
<p   
>After creating a migration script, you need to decide whether it is going to be applied before or after the   <a   href="Restoring-continuous-integration-files-to-the-database">continuous integration files are restored</a>.</p>
<p   
>The <i class=" ">Before.txt </i>file should only contain migrations that manipulate the database before the continuous integration files are restored. These migrations can, for example:</p>
<ul class=" "><li class=" "><p   
>Drop indexes before their tables are deleted by the restore process.</p>
</li><li class=" "><p   
>Delete foreign key constraints before their tables are deleted by the restore process.</p>
</li></ul><p   
>The <i class=" ">After.txt</i> file should only contain migrations that manipulate the restored database. These migrations can, for example:</p>
<ul class=" "><li class=" "><p   
>Create new indexes.</p>
</li><li class=" "><p   
>Create new views.</p>
</li><li class=" "><p   
>Add foreign key constraints.</p>
</li><li class=" "><p   
>Add or modify stored procedures.</p>
</li></ul>    <div  class="confbox admonition admonition-note">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p   
><strong class=" ">Important</strong>: If you have multiple migrations, carefully consider the order in which they should be executed. The migration scripts in both the <i class=" ">Before.txt</i> and <i class=" ">After.txt</i> files are executed from the first to the last line.</p>
        </div>
    </div>
    <h4 id="src-70451861_Synchronizingdatabasechangesnotmanagedbycontinuousintegration-Example-Creatingmigrationscriptstosynchronizedatabasechanges" class="heading "><span>Example - Creating migration scripts to synchronize database changes</span></h4>
<p   
>If you need to create a new index on, for example, a column <strong class=" ">OfficeName </strong>in a custom module class table <strong class=" ">CompanyOffices </strong>and want this change to be reflected in the repository, you need to:</p>
<ol class=" "><li class=" "><p   
>Create a new migration script (for example, <strong class=" ">AddOfficeNameIndex.sql</strong>):</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                    <div class="title">AddOfficeNameIndex.sql</div>
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-title="AddOfficeNameIndex.sql" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="keyword">CREATE</code><code class="plain"> </code><code class="keyword">INDEX</code><code class="plain"> IX_CompanyOffices_OfficeName </code><code class="keyword">ON</code><code class="plain"> CompanyOffices(OfficeName);</code></div>
</div>
    </div>
</li><li class=" "><p   
>Add the migration script to the <i class=" ">@migrations</i> folder.</p>
</li><li class=" "><p   
>Add the migration name to a new line in the <i class=" ">After.txt<strong class=" "> </strong></i>file (the index should only be created after the database is updated).</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                    <div class="title">After.txt</div>
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-title="After.txt" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">...</code></div>
<div class="line"><code class="plain">AddOfficeNameIndex</code></div>
</div>
    </div>
</li><li class=" "><p   
>Commit your changes to your source control repository.</p>
</li></ol><p   
>When the repository containing your changes is restored on another database, the <strong class=" ">AddOfficeNameIndex.sql</strong> migration is automatically applied (creating the <i class=" ">IX_CompanyOffices_OfficeName</i> index) during the restore process (as part of the migrations executed after the <i class=" ">CIRepository</i> folder is restored). The migration is then added to the <i class=" ">CI_Migration</i> table, marked as applied, and will not be executed again on the target database.</p>
    <h4 id="src-70451861_Synchronizingdatabasechangesnotmanagedbycontinuousintegration-Retrievingthelatestversionofyourprojectandupdatingthedatabase" class="heading "><span>Retrieving the latest version of your project and updating the database</span></h4>
<p   
>To update your local solution and database to the latest version:</p>
<ol class=" "><li class=" "><p   
>Get the latest version of your Kentico solution and the <strong class=" ">CIRepository </strong>folder from your source control system.</p>
</li><li class=" "><p   
>Rebuild the solution in Visual Studio.</p>
</li><li class=" "><p   
>Launch a command-line interface.</p>
</li><li class=" "><p   
>Execute the <strong class=" ">RunRestore.ps1</strong> script using the full path to your Kentico project&#39;s <strong class=" ">~\CMS </strong>folder location as the argument (for example: <i class=" ">.\RunRestore.ps1 C:\inetpub\wwwroot\Kentico11\CMS</i>).</p>
</li></ol><p   
>This restores the <i class=" ">CIRepository</i> folder to the targeted database, executing all unapplied migrations specified in the <i class=" ">Before.txt</i> and <i class=" ">After.txt</i> files.</p>
    <h3 id="src-70451861_Synchronizingdatabasechangesnotmanagedbycontinuousintegration-Rollingbackdatabasechanges" class="heading "><span>Rolling back database changes</span></h3>
<p   
>When rolling back your changes, it is important to realize that migrations you have created and committed to source control may have already been applied to other databases. Therefore, removing your migrations from the <i class=" ">@migrations</i> folder and <i class=" ">Before.txt</i> or <i class=" ">After.txt</i> is <strong class=" ">not enough</strong>. You also need to a write a new migration that returns the structure of the database where your previous migration was already applied to their original state.</p>
    <h4 id="src-70451861_Synchronizingdatabasechangesnotmanagedbycontinuousintegration-Example-Rollingbackchanges" class="heading "><span>Example - Rolling back changes</span></h4>
<p   
>The rollback process is demonstrated here by extending the   <a   href="#src-70451861_Synchronizingdatabasechangesnotmanagedbycontinuousintegration-Example-Creatingmigrationscriptstosynchronizedatabasechanges">example above</a>. To revert the changes made by the <strong class=" ">AddOfficeNameIndex.sql</strong> migration, you need to:</p>
<ol class=" "><li class=" "><p   
>Delete the migration script<strong class=" "> AddOfficeNameIndex.sql </strong>from the <i class=" ">@migrations</i> folder.</p>
</li><li class=" "><p   
>Remove the migration name <strong class=" ">AddOfficeNameIndex</strong> from the list of migrations in the <i class=" ">After.txt </i>file.</p>
</li><li class=" "><p   
>Create a new migration script (for example, <strong class=" ">RemoveOfficeNameIndex.sql</strong>) that removes the index (if it exists):</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                    <div class="title">RemoveOfficeNameIndex.sql</div>
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-title="RemoveOfficeNameIndex.sql" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">IF EXISTS(</code><code class="keyword">SELECT</code><code class="plain"> * </code><code class="keyword">FROM</code><code class="plain"> sys.indexes </code><code class="keyword">WHERE</code><code class="plain"> </code><code class="keyword">name</code><code class="plain"> = </code><code class="string">'IX_CompanyOffices_OfficeName'</code><code class="plain"> </code><code class="color1">AND</code><code class="plain"> object_id = OBJECT_ID(</code><code class="string">'CompanyOffices'</code><code class="plain">))</code></div>
<div class="line"><code class="keyword">BEGIN</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">DROP</code><code class="plain"> </code><code class="keyword">INDEX</code><code class="plain"> IX_CompanyOffices_OfficeName </code><code class="keyword">ON</code><code class="plain"> CompanyOffices</code></div>
<div class="line"><code class="keyword">END</code></div>
</div>
    </div>
</li><li class=" "><p  class="auto-cursor-target" 
>Add the migration script to the<i class=" "> @migrations</i> folder.</p>
</li><li class=" "><p  class="auto-cursor-target" 
>Add the migration name to a new line in the <i class=" ">Before.txt</i> file (the index should be dropped before its table is deleted during the restore process):</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                    <div class="title">Before.txt</div>
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-title="Before.txt" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">...</code></div>
<div class="line"><code class="plain">RemoveOfficeNameIndex</code></div>
</div>
    </div>
</li><li class=" "><p  class="auto-cursor-target" 
>Commit your changes to your source control repository.</p>
</li></ol><p   
>When the repository containing your changes is restored on another database, the <i class=" ">RemoveOfficeNameIndex.sql</i> migration is automatically applied (removing the <i class=" ">IX_CompanyOffices_OfficeName</i> index, if it exists) during the restore process (as part of the migrations executed before the <i class=" ">CIRepository</i> folder is restored). The migration is then added to the <i class=" ">CI_Migration</i> table, marked as applied, and will not be executed again on the target database.</p>
    <h4 id="src-70451861_Synchronizingdatabasechangesnotmanagedbycontinuousintegration-Restoringthedatabasetoaspecificpointintime" class="heading "><span>Restoring the database to a specific point in time</span></h4>
<p   
>If you need to revert your database to a specific backup, we recommend restoring the backup to a clean database to avoid possible structural database conflicts which may arise when restoring the database to an older version.</p>
<p   
>To perform a restore on a clean database:</p>
<ol class=" "><li class=" "><p   
>Create a blank database.</p>
</li><li class=" "><p   
>Get the required version of your Kentico solution and the <strong class=" ">CIRepository </strong>folder from your source control system.</p>
</li><li class=" "><p   
>Update the <strong class=" ">CMSConnectionString </strong>in the project&#39;s web.config file to point to the new database.</p>
</li><li class=" "><p   
>Rebuild the solution in Visual Studio.</p>
</li><li class=" "><p   
>Execute the <strong class=" ">RunRestore.ps1</strong> script using the full path to your Kentico project&#39;s <strong class=" ">~\CMS </strong>folder location as the argument (for example: <i class=" ">.\RunRestore.ps1 C:\inetpub\wwwroot\Kentico11\CMS</i>).</p>
</li></ol><p   
>After the restore finishes, you can continue working with the restored database backup.</p>
        </div>

    </article>


               
            
    <footer id="ht-footer">
    <a href="#" id="ht-jump-top" class="sp-aui-icon-small sp-aui-iconfont-arrows-up"></a>
</footer></div>

<div>
    <div id="ht-mq-detect"></div>
</div>

    <script src="js/lunr.js"></script>
    <script src="js/lunr-extras.js"></script>
    <script src="assets/js/scroll-search.js"></script>

    <script src="assets/js/expand-macro.js"></script>
</body>
</html>
