<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Preventing Azure cache folders from bloating - Kentico 11 Documentation</title>

    
    <link rel="stylesheet" href="assets/css/expand-macro.css">

            <meta name="scroll-content-language-key" content="">
    
    <meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=2.0, user-scalable=yes">

<script type="text/javascript" src="assets/js/jquery.min.js"></script>
<script type="text/javascript" src="assets/js/jquery.scrollTo.min.js"></script>


<script type="text/javascript" src="assets/js/translate.js"></script>

<script type="text/javascript" src="assets/js/theme.main.js"></script>

    <script type="text/javascript" src="assets/js/iframeResizer.min.js"></script>

<link rel="stylesheet" href="assets/css/content-style.css">
    <link rel="stylesheet" href="assets/css/search.css">

<link rel="stylesheet" href="assets/css/theme.main.css">
<link rel="stylesheet" href="assets/css/theme.colors.css">

            <!-- ES5 support for older browsers, needed by lunr -->
        <script src="js/augment.js"></script> 
        <script id="worker" type="javascript/worker">

        startIndex = function() {
            idx = lunr.Index.load(lunrIndex);
            idx.pipeline.remove(lunr.stopWordFilter);
            postMessage({type: "setup-complete"});
        }

        onmessage = function (event) {
            var message = event.data;

            if ((message.type === 'setup') && message.baseUrl) {
                var url = message.baseUrl;
                importScripts(url + 'js/lunr.js');
                importScripts(url + 'js/lunr-extras.js');
                importScripts(url + 'js/lunr-index.js');
                importScripts(url + 'js/lunr-data.js');
                startIndex();
            }

            if (idx && (message.type === 'search-request') && message.query) {
                var searchWord = message.query;
                var results = idx.search(searchWord).map(function (result) {
                    return lunrData.filter(function (d) {
                        return d.id === parseInt(result.ref, 10)
                    })[0]
                });
                postMessage({type: 'search-results', results: results, query: searchWord, queryId: message.queryId});
            }
        }

    </script>
    </head>

<body pageid="68879260">

<div id="ht-loader">
    <noscript>
        <p style="width: 100%; text-align:center; position: absolute; margin-top: 200px;">This content cannot be displayed without JavaScript.<br>Please enable JavaScript and reload the page.</p>
    </noscript>
</div>

<div>
   	<header id="ht-headerbar">
    <div class="ht-headerbar-left">
        <a href="" id="ht-menu-toggle" class="sp-aui-icon-small sp-aui-iconfont-appswitcher"></a>
    </div>
    <div class="ht-headerbar-right">
            <div class="sp-aui-icon-small ht-search-index-loader ht-header-icon"></div>

        <div id="ht-search">
            <div class="ht-search-input" style="display: none;">
              	<a href="#" class="sp-aui-icon-small sp-aui-iconfont-remove ht-search-clear"></a>

                <form action="#" method="GET" id="search">
                    <input class="search-input" type="text" placeholder="Search" tabindex="-1" autocomplete="off" name="q" value="">
                    <input type="hidden" name="max" value="15" />
                    <input type="submit" style="display:none" tabindex="-4"/>
                </form>

                <a href="#" id="ht-search-button" class="ht-header-icon ht-header-icon-svg">
                                        <svg width="40px" height="40px" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                        <g>
                            <path d="M29.572,28.802 L28.801,29.571 C28.515,29.857 28.187,30 27.816,30 C27.445,30 27.116,29.857 26.831,29.571 L21.392,24.134 C20.193,24.762 18.908,25.076 17.538,25.076 C15.396,25.076 13.605,24.348 12.163,22.892 C10.721,21.436 10,19.651 10,17.538 C10,15.397 10.721,13.605 12.163,12.163 C13.605,10.721 15.396,10 17.538,10 C19.651,10 21.434,10.721 22.89,12.163 C24.347,13.605 25.075,15.397 25.075,17.538 C25.075,18.937 24.761,20.222 24.132,21.393 L29.572,26.832 C29.857,27.118 30,27.446 30,27.817 C30,28.188 29.857,28.517 29.572,28.802 L29.572,28.802 Z M13.662,21.414 C14.732,22.485 16.024,23.02 17.538,23.02 C19.051,23.02 20.343,22.485 21.413,21.414 C22.484,20.344 23.019,19.052 23.019,17.538 C23.019,16.025 22.484,14.733 21.413,13.662 C20.343,12.592 19.051,12.056 17.538,12.056 C16.024,12.056 14.732,12.592 13.662,13.662 C12.591,14.733 12.056,16.025 12.056,17.538 C12.056,19.052 12.591,20.344 13.662,21.414 L13.662,21.414 Z"></path>
                        </g>
                    </svg>
              	</a>

                <div class="ht-search-dropdown ht-dropdown">
                    <ul></ul>
                </div>
            </div>
        </div>
    </div>
    </header>   	<aside id="ht-sidebar">
    <div class="ht-sidebar-content">
        <div class="ht-sidebar-content-scroll-container">
            <header class="ht-sidebar-header">
                <h1 class="ht-logo">
                    <span class="ht-logo-label">K11</span>
                    <img class="space-logo" src="global.logo" />
                </h1>
                <a href="Kentico-11-Documentation-Home.htm" class="ht-space-link">
                    <h2>Kentico 11 Documentation</h2>
                </a>
            </header>
                            <iframe id="ht-nav" src="toc.html?pageId=68881698"></iframe>
                <script>
                    $('iframe#ht-nav').iFrameResize(
                            { 'log': true, 'autoResize': true, 'heightCalculationMethod': 'lowestElement', 'checkOrigin': false });
                </script>
                    </div>
    </div>

</aside></div>

<div id="ht-wrap-container">

            
    <div id="ht-sidebar-dragbar">
    <div class="ht-sidebar-drag-handle">
        <span class="drag-handle-1"></span>
        <span class="drag-handle-2"></span>
        <span class="drag-handle-3"></span>
    </div>
</div>
    <article id="ht-content" class="ht-content">
        <header class="ht-content-header">
            <div id="ht-breadcrumb">
    <ul>
        <li><a href="Kentico-11-Documentation-Home.htm">Kentico 11 Documentation</a></li>
                                                                                     <li><a href="Running-Kentico-on-Microsoft-Azure.htm">Running Kentico on Microsoft Azure</a></li>
                                                            </ul>
</div>            <h1 id="src-68881698"> <span>Preventing Azure cache folders from bloating</span></h1>
        </header>

        <div id="main-content" class="wiki-content sp-grid-section" data-index-for-search="true">
<p   
>Kentico projects connected to the Azure Blob Storage (Cloud Services by default, Web Apps optionally and standard applications connected to the blob storage) cache temporary data from the blob storage in the file system. The temporary data is stored in the <strong class=" ">Azure Temp</strong> and <strong class=" ">Azure Cache</strong> folders located in your web application&#39;s local file system.</p>
<p   
>When these folders contain too much data, your web application&#39;s local storage can get bloated and lack free storage for new data. The system can also display errors for not having enough space on the disk.</p>
<p   
>We recommend the following measures to prevent these folders from containing too much data:</p>
<ul class=" "><li class=" "><p   
>    <span style="color: #262524;">
<a   href="k11/Configuring-Azure-CDN.htm">Configuring a CDN for your storage</a><br/>    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #262524;">
<a   href="k11/#src-68881698_PreventingAzurecachefoldersfrombloating-Usingdirectlinkstofiles">Using direct links to files</a>    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #262524;">
<a   href="k11/#src-68881698_PreventingAzurecachefoldersfrombloating-Structuringmedialibraryfilesintofolders">Structuring media library files into folders</a>    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #262524;">
    <span style="color: #262524;">
<a   href="k11/#src-68881698_PreventingAzurecachefoldersfrombloating-ConfiguringtheCleanAzurestoragecachescheduledtask">Configuring the Clean Azure storage cache scheduled task</a>    </span>
    </span>
<a   href="k11/Configuring-Azure-CDN.htm">    <span style="color: #262524;">
    </span>
</a></p>
</li></ul>    <h3 id="src-68881698_PreventingAzurecachefoldersfrombloating-Usingdirectlinkstofiles" class="heading "><span>Using direct links to files </span></h3>
<p   
>    <span style="color: #262524;">
When linking to files located on the blob storage, we recommend using <strong class=" ">direct links</strong> (for example,     </span>
<i class=" ">/site/media/imagelibrary/picture.png</i>) instead of links through the application (beginning with<i class=" "> /CMSPages/GetAzureFile.aspx</i>...). Direct access to files reduces the number of files cached in the AzureTemp and AzureCache folders.</p>
<p   
>    <span style="color: #262524;">
To be able to use direct links to files:    </span>
</p>
<ol class=" "><li class=" "><p   
>    <span style="color: #262524;">
Configure the main container on your blob storage to be public &ndash; add the following setting to your application:    </span>
</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">&lt;</code><code class="keyword">add</code><code class="plain"> </code><code class="color1">key</code><code class="plain">=</code><code class="string">"CMSAzurePublicContainer"</code><code class="plain"> </code><code class="color1">value</code><code class="plain">=</code><code class="string">"true"</code><code class="plain"> /&gt;</code></div>
</div>
    </div>
<p   
>    <span style="color: #262524;">
    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #262524;">
Make sure that the <strong class=" ">Use permanent URLs</strong> option in <strong class=" ">Settings</strong> application <strong class=" ">-&gt; Content -&gt; Media</strong> is not selected.    </span>
</p>
</li></ol><p   
>    <span style="color: #262524;">
The system can now use direct links to files on the blob storage.<br/>    </span>
</p>
    <div  class="confbox admonition admonition-note">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p   
><strong class=" ">Note:</strong> Automatic resizing of images does not work when using direct links to files on a blob storage.</p>
        </div>
    </div>
    <h3 id="src-68881698_PreventingAzurecachefoldersfrombloating-Structuringmedialibraryfilesintofolders" class="heading "><span>Structuring media library files into folders</span></h3>
<p   
>    <span style="color: #262524;">
Structure the files in your media libraries into folders of up to 100 files. See <a   href="k11/Configuring-media-libraries.htm#src-68879365_Configuringmedialibraries-Medialibrarylimitationswhenstoringfilesinanexternalstorage">Media library limitations when storing files in an external storage</a> for details.<br/>    </span>
</p>
    <h3 id="src-68881698_PreventingAzurecachefoldersfrombloating-ConfiguringtheCleanAzurestoragecachescheduledtask" class="heading "><span>Configuring the Clean Azure storage cache scheduled task</span></h3>
<p   
>To prevent the Azure Temp and Azure Cache folders from bloating, Kentico uses the     <span style="color: #262524;">
<strong class=" ">Clean Azure storage cache</strong> <a   href="k11/Scheduling-tasks.htm">scheduled task</a>. The scheduled task browses through the folders and if a threshold is exceeded, the system deletes the configured amount of files starting from the oldest files.    </span>
</p>
<p   
>    <span style="color: #262524;">
You can set:    </span>
</p>
<ul class=" "><li class=" "><p   
>    <span style="color: #262524;">
The frequency of evaluation of the parameters (    <span style="color: #262524;">
threshold    </span>
)<br/>    </span>
</p>
</li><li class=" "><p   
>The threshold when the system starts deleting old files</p>
</li><li class=" "><p   
>How many gigabytes of data stay in the system after the deleting occurs</p>
</li><li class=" "><p   
>Excluded paths that are never deleted</p>
</li></ul>    <h4 id="src-68881698_PreventingAzurecachefoldersfrombloating-Modifyingthescheduledtask" class="heading "><span>Modifying the scheduled task</span></h4>
<p   
>    <span style="color: #262524;">
You can modify the frequency of evaluating the parameters in the <strong class=" ">Scheduled tasks</strong> application.    </span>
</p>
<ol class=" "><li class=" "><p   
>    <span style="color: #262524;">
Open the <strong class=" ">Scheduled tasks</strong> application.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #262524;">
Leave <i class=" ">(global)</i> in the <strong class=" ">Site</strong> drop-down list.    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #262524;">
<strong class=" ">Edit</strong> (<img  class="confluence-embedded-image"  src="images/download/attachments/68879208/edit.png" alt="images/download/attachments/68879208/edit.png"   />
) the <strong class=" ">Clean Azure storage cache</strong> scheduled task.    </span>
    <span style="color: #262524;">
<br/>    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #262524;">
Modify the <strong class=" ">Period</strong> or other <a   href="k11/Reference---scheduled-task-properties.htm">properties of the task</a> according to your needs.    </span>
</p>
<ul class=" "><li class=" "><p   
>    <span style="color: #262524;">
The scheduled task uses the <i class=" ">CMS.AzureStorage.AzureStorageCacheCleaner</i> class.    </span>
</p>
</li></ul></li><li class=" "><p   
>Click <strong class=" ">Save</strong>.</p>
</li></ol><p   
>The scheduled task now runs according to your changes.</p>
    <div  class="confbox panel">
            <div class="title panel-header">On this page</div>
            <div class="panel-content">
<p   
></p>
<ul class="toc-indentation "><li class=" "><p   
><a   href="k11/#src-68881698_PreventingAzurecachefoldersfrombloating-Usingdirectlinkstofiles">Using direct links to files</a></p>
</li><li class=" "><p   
><a   href="k11/#src-68881698_PreventingAzurecachefoldersfrombloating-Structuringmedialibraryfilesintofolders">Structuring media library files into folders</a></p>
</li><li class=" "><p   
><a   href="k11/#src-68881698_PreventingAzurecachefoldersfrombloating-ConfiguringtheCleanAzurestoragecachescheduledtask">Configuring the Clean Azure storage cache scheduled task</a></p>
<ul class="toc-indentation "><li class=" "><p   
><a   href="k11/#src-68881698_PreventingAzurecachefoldersfrombloating-Modifyingthescheduledtask">Modifying the scheduled task</a></p>
</li><li class=" "><p   
><a   href="k11/#src-68881698_PreventingAzurecachefoldersfrombloating-Modifyingrelatedweb.configkeys">Modifying related web.config keys</a></p>
</li></ul></li></ul><p   
></p>
        </div>
    </div>
    <div  class="confbox panel">
            <div class="title panel-header">Related pages</div>
            <div class="panel-content">
<ul class=" "><li class=" "><p   
><a   href="k11/Running-Kentico-in-Azure-Web-Apps.htm">Running Kentico in Azure Web Apps</a></p>
</li><li class=" "><p   
><a   href="k11/Running-Kentico-in-Azure-Cloud-Services.htm">Running Kentico in Azure Cloud Services</a></p>
</li></ul>        </div>
    </div>
    <h4 id="src-68881698_PreventingAzurecachefoldersfrombloating-Modifyingrelatedweb.configkeys" class="heading "><span>Modifying related web.config keys</span></h4>
<p   
>    <span style="color: #262524;">
Set the <a   href="k11/Reference---Web.config-application-keys.htm">web.config file</a> to affect the process of cleaning the Azure Temp and Azure Cache folders.    </span>
</p>
    <h5 id="src-68881698_PreventingAzurecachefoldersfrombloating-CMSAzureStorageCacheCleanerThreshold" class="heading "><span>CMSAzureStorageCacheCleanerThreshold</span></h5>
<p   
>This web.config key specifies a threshold in gigabytes. When the threshold is exceeded, the system starts to delete files from the oldest to the newest until the result target size is achieved (specified by the <strong class=" ">CMSAzureStorageCacheCleanerKeepLimit</strong> web.config key) while excluding the specified paths (set by the <strong class=" ">CMSAzureStorageCacheCleanerExcludedPaths</strong> web.config key).</p>
<p   
>The default value, i.e., if the key is not specified, is 45GB.</p>
<p   
>Use the following syntax to add the web.config key:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">&lt;add key=</code><code class="string">"CMSAzureStorageCacheCleanerThreshold"</code><code class="plain"> value=</code><code class="string">"45"</code><code class="plain">/&gt;</code></div>
</div>
    </div>
    <h5 id="src-68881698_PreventingAzurecachefoldersfrombloating-CMSAzureStorageCacheCleanerKeepLimit" class="heading "><span>CMSAzureStorageCacheCleanerKeepLimit</span></h5>
<p   
>    <span style="color: #262524;">
This web.config key specifies an amount in gigabytes. The amount is the target size of the Azure Cache and Azure Temp folders when the scheduled task deletes the files. For example, if the amount is set to 10GB, the Azure Cache and Azure Temp folders have in total the size of 10GB, after the scheduled task runs and the threshold is exceeded.    </span>
</p>
<p   
>    <span style="color: #262524;">
The default value, i.e., if the key is not specified, is 10GB. The size of the excluded paths (set by the <strong class=" ">CMSAzureStorageCacheCleanerExcludedPaths</strong> web.config key) is included in the amount.    </span>
</p>
<p   
>Use the following syntax to add the web.config key:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">&lt;add key=</code><code class="string">"CMSAzureStorageCacheCleanerKeepLimit"</code><code class="plain"> value=</code><code class="string">"10"</code><code class="plain">/&gt;</code></div>
</div>
    </div>
    <h5 id="src-68881698_PreventingAzurecachefoldersfrombloating-CMSAzureStorageCacheCleanerExcludedPaths" class="heading "><span>CMSAzureStorageCacheCleanerExcludedPaths</span></h5>
<p   
>    <span style="color: #262524;">
This web.config key specifies relative paths separated by semicolons (<i class=" ">;</i>). The system does not delete files inside the paths typed in the web.config key     <span style="color: #262524;">
in both the AzureTemp and AzureCache folders    </span>
.    </span>
</p>
<p   
>    <span style="color: #262524;">
There is not any predefined excluded path by default.    </span>
</p>
<p   
>Use the following syntax to add the web.config key (the system does not delete the <i class=" ">AzureTemp/folder_name1</i>, <i class=" ">AzureTemp/folder_name2</i>, <i class=" ">AzureCache/folder_name1</i> and <i class=" ">AzureCache/folder_name2</i> folders):</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">&lt;add key=</code><code class="string">"CMSAzureStorageCacheCleanerExcludedPaths"</code><code class="plain"> value=</code><code class="string">"folder_name1;folder_name2"</code><code class="plain">/&gt;</code></div>
</div>
    </div>
        </div>

    </article>


               
            
    <footer id="ht-footer">
    <a href="#" id="ht-jump-top" class="sp-aui-icon-small sp-aui-iconfont-arrows-up"></a>
</footer></div>

<div>
    <div id="ht-mq-detect"></div>
</div>

    <script src="js/lunr.js"></script>
    <script src="js/lunr-extras.js"></script>
    <script src="assets/js/scroll-search.js"></script>

    <script src="assets/js/expand-macro.js"></script>
</body>
</html>
