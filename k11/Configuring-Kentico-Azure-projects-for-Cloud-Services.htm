<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Configuring Kentico Azure projects for Cloud Services - Kentico 11 Documentation</title>

    
    <link rel="stylesheet" href="assets/css/expand-macro.css">

            <meta name="scroll-content-language-key" content="">
    
    <meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=2.0, user-scalable=yes">

<script type="text/javascript" src="assets/js/jquery.min.js"></script>
<script type="text/javascript" src="assets/js/jquery.scrollTo.min.js"></script>


<script type="text/javascript" src="assets/js/translate.js"></script>

<script type="text/javascript" src="assets/js/theme.main.js"></script>

    <script type="text/javascript" src="assets/js/iframeResizer.min.js"></script>

<link rel="stylesheet" href="assets/css/content-style.css">
    <link rel="stylesheet" href="assets/css/search.css">

<link rel="stylesheet" href="assets/css/theme.main.css">
<link rel="stylesheet" href="assets/css/theme.colors.css">

            <!-- ES5 support for older browsers, needed by lunr -->
        <script src="js/augment.js"></script> 
        <script id="worker" type="javascript/worker">

        startIndex = function() {
            idx = lunr.Index.load(lunrIndex);
            idx.pipeline.remove(lunr.stopWordFilter);
            postMessage({type: "setup-complete"});
        }

        onmessage = function (event) {
            var message = event.data;

            if ((message.type === 'setup') && message.baseUrl) {
                var url = message.baseUrl;
                importScripts(url + 'js/lunr.js');
                importScripts(url + 'js/lunr-extras.js');
                importScripts(url + 'js/lunr-index.js');
                importScripts(url + 'js/lunr-data.js');
                startIndex();
            }

            if (idx && (message.type === 'search-request') && message.query) {
                var searchWord = message.query;
                var results = idx.search(searchWord).map(function (result) {
                    return lunrData.filter(function (d) {
                        return d.id === parseInt(result.ref, 10)
                    })[0]
                });
                postMessage({type: 'search-results', results: results, query: searchWord, queryId: message.queryId});
            }
        }

    </script>
    </head>

<body pageid="68879260">

<div id="ht-loader">
    <noscript>
        <p style="width: 100%; text-align:center; position: absolute; margin-top: 200px;">This content cannot be displayed without JavaScript.<br>Please enable JavaScript and reload the page.</p>
    </noscript>
</div>

<div>
   	<header id="ht-headerbar">
    <div class="ht-headerbar-left">
        <a href="" id="ht-menu-toggle" class="sp-aui-icon-small sp-aui-iconfont-appswitcher"></a>
    </div>
    <div class="ht-headerbar-right">
            <div class="sp-aui-icon-small ht-search-index-loader ht-header-icon"></div>

        <div id="ht-search">
            <div class="ht-search-input" style="display: none;">
              	<a href="#" class="sp-aui-icon-small sp-aui-iconfont-remove ht-search-clear"></a>

                <form action="#" method="GET" id="search">
                    <input class="search-input" type="text" placeholder="Search" tabindex="-1" autocomplete="off" name="q" value="">
                    <input type="hidden" name="max" value="15" />
                    <input type="submit" style="display:none" tabindex="-4"/>
                </form>

                <a href="#" id="ht-search-button" class="ht-header-icon ht-header-icon-svg">
                                        <svg width="40px" height="40px" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                        <g>
                            <path d="M29.572,28.802 L28.801,29.571 C28.515,29.857 28.187,30 27.816,30 C27.445,30 27.116,29.857 26.831,29.571 L21.392,24.134 C20.193,24.762 18.908,25.076 17.538,25.076 C15.396,25.076 13.605,24.348 12.163,22.892 C10.721,21.436 10,19.651 10,17.538 C10,15.397 10.721,13.605 12.163,12.163 C13.605,10.721 15.396,10 17.538,10 C19.651,10 21.434,10.721 22.89,12.163 C24.347,13.605 25.075,15.397 25.075,17.538 C25.075,18.937 24.761,20.222 24.132,21.393 L29.572,26.832 C29.857,27.118 30,27.446 30,27.817 C30,28.188 29.857,28.517 29.572,28.802 L29.572,28.802 Z M13.662,21.414 C14.732,22.485 16.024,23.02 17.538,23.02 C19.051,23.02 20.343,22.485 21.413,21.414 C22.484,20.344 23.019,19.052 23.019,17.538 C23.019,16.025 22.484,14.733 21.413,13.662 C20.343,12.592 19.051,12.056 17.538,12.056 C16.024,12.056 14.732,12.592 13.662,13.662 C12.591,14.733 12.056,16.025 12.056,17.538 C12.056,19.052 12.591,20.344 13.662,21.414 L13.662,21.414 Z"></path>
                        </g>
                    </svg>
              	</a>

                <div class="ht-search-dropdown ht-dropdown">
                    <ul></ul>
                </div>
            </div>
        </div>
    </div>
    </header>   	<aside id="ht-sidebar">
    <div class="ht-sidebar-content">
        <div class="ht-sidebar-content-scroll-container">
            <header class="ht-sidebar-header">
                <h1 class="ht-logo">
                    <span class="ht-logo-label">K11</span>
                    <img class="space-logo" src="global.logo" />
                </h1>
                <a href="Kentico-11-Documentation-Home.htm" class="ht-space-link">
                    <h2>Kentico 11 Documentation</h2>
                </a>
            </header>
                            <iframe id="ht-nav" src="toc.html?pageId=68881729"></iframe>
                <script>
                    $('iframe#ht-nav').iFrameResize(
                            { 'log': true, 'autoResize': true, 'heightCalculationMethod': 'lowestElement', 'checkOrigin': false });
                </script>
                    </div>
    </div>

</aside></div>

<div id="ht-wrap-container">

            
    <div id="ht-sidebar-dragbar">
    <div class="ht-sidebar-drag-handle">
        <span class="drag-handle-1"></span>
        <span class="drag-handle-2"></span>
        <span class="drag-handle-3"></span>
    </div>
</div>
    <article id="ht-content" class="ht-content">
        <header class="ht-content-header">
            <div id="ht-breadcrumb">
    <ul>
        <li><a href="Kentico-11-Documentation-Home.htm">Kentico 11 Documentation</a></li>
                                                                                                             <li><a href="" onclick="$('.shortcut').each(function(){$(this).removeClass('shortcut')}); $(this).parent().addClass('shortcut'); return false;">...</a> </li>
                                        <li class="shortcut"><a href="Running-Kentico-on-Microsoft-Azure.htm">Running Kentico on Microsoft Azure</a></li>
                                                                                     <li><a href="Running-Kentico-in-Azure-Cloud-Services.htm">Running Kentico in Azure Cloud Services</a></li>
                                                            </ul>
</div>            <h1 id="src-68881729"> <span>Configuring Kentico Azure projects for Cloud Services</span></h1>
        </header>

        <div id="main-content" class="wiki-content sp-grid-section" data-index-for-search="true">
<p   
>After you <a   href="k11/Installing-Kentico-Azure-projects.htm">install a Kentico Azure project</a> and <a   href="k11/Preparing-the-Azure-cloud-environment.htm">prepare the cloud environment</a>, you need to configure your project before the actual deployment to Azure Cloud Services.</p>
<ul class=" "><li class=" "><p   
><a   href="k11/#src-68881729_ConfiguringKenticoAzureprojectsforCloudServices-Basicconfiguration">Basic configuration</a> &ndash; perform these configuration tasks for every Kentico Azure project.</p>
</li><li class=" "><p   
><a   href="k11/#src-68881729_safe-id-Q29uZmlndXJpbmdLZW50aWNvQXp1cmVwcm9qZWN0c2ZvckNsb3VkU2VydmljZXMtQWR2YW5jZWRjb25maWd1cmF0aW9uKG11bHRpcGxld2Vicm9sZXMp">Advanced configuration</a> &ndash; perform these configurations when you upgrade your project to use two or more web role instances.</p>
</li><li class=" "><p   
><a   href="k11/#src-68881729_ConfiguringKenticoAzureprojectsforCloudServices-Additionalconfigurations">Additional configurations</a> &ndash; you can perform these configurations in any phase of your project.</p>
</li></ul>    <div  class="confbox admonition admonition-note">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p   
><strong class=" ">Azure SDK version</strong></p>
<p   
>Before you start configuring your Kentico Azure project, check that you have <strong class=" ">Azure SDK </strong><strong class=" ">2.9.5 or newer</strong> installed for your version of Visual Studio. See <a   href="k11/Requirements-and-limitations-for-running-Kentico-in-Azure-Cloud-Services.htm">Requirements and limitations for running Kentico in Azure Cloud Services</a> for details.</p>
        </div>
    </div>
    <h3 id="src-68881729_ConfiguringKenticoAzureprojectsforCloudServices-AddingapplicationsettingsinanAzureproject" class="heading "><span>Adding application settings in an Azure project </span></h3>
<p   
>Generally, you can add settings for your Azure application either in the <strong class=" ">web.config file</strong> or in the <strong class=" ">ServiceConfiguration.Cloud.cscfg</strong> file.</p>
<p   
>However, when you need to modify setting values in the web.config file, you have to deploy the whole project again. When you need to modify setting values configured in the ServiceConfiguration.Cloud.cscfg file, you can modify them on the <a  class="external-link" href="https://portal.azure.com/">Azure Management Portal</a> in <strong class=" ">Cloud services -&gt;</strong> your cloud service<strong class=" "> -&gt; Configuration </strong>tab. Therefore, we recommend that you configure your application mainly using the ServiceConfiguration.Cloud.cscfg file.</p>
<p   
>To add new settings to the configuration file:</p>
<ol class=" "><li class=" "><p   
>Open your Azure project in Visual Studio.</p>
</li><li class=" "><p   
>Double-click <strong class=" ">CMSApp</strong> role in <strong class=" ">CMSAzure/Roles</strong>.</p>
</li><li class=" "><p   
>Switch to the <strong class=" ">Settings</strong> tab.</p>
</li><li class=" "><p   
>Click <strong class=" ">Add Setting</strong>.</p>
</li></ol><p   
>When you add or remove settings this way, Visual Studio ensures that all necessary files (ServiceConfiguration.Cloud.cscfg, ServiceConfiguration.Local.cscfg and ServiceDefinition.csdef) are modified according to your changes.</p>
    <div  class="confbox admonition admonition-note">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p   
>Whenever you add or remove settings, you have to <strong class=" ">deploy your project</strong> to the cloud. Therefore, you should decide in advance which functionality you need to configure in your Azure project.</p>
        </div>
    </div>
    <h3 id="src-68881729_ConfiguringKenticoAzureprojectsforCloudServices-Basicconfiguration" class="heading "><span>Basic configuration</span></h3>
<p   
>These configuration tasks are necessary to perform for every Microsoft Azure project.</p>
    <h4 id="src-68881729_ConfiguringKenticoAzureprojectsforCloudServices-SettingtheAzurestorageaccesskeys" class="heading "><span>Setting the Azure storage access keys</span></h4>
<ol class=" "><li class=" "><p   
>Open your Azure project in Visual Studio.</p>
</li><li class=" "><p   
>Open the <strong class=" ">ServiceConfiguration.Cloud.cscfg</strong> file.</p>
</li><li class=" "><p   
>Open the <a  class="external-link" href="https://portal.azure.com/">Azure Management Portal</a>.</p>
</li><li class=" "><p   
>Access your storage account.</p>
</li><li class=" "><p   
>Switch to the <strong class=" ">Access keys</strong> tab.<br/></p>
<img  class="confluence-embedded-image confluence-content-image-border"  src="images/download/attachments/68881729/StorageAccountAcessKeys.png" alt="images/download/attachments/68881729/StorageAccountAcessKeys.png" width="600"  />
        <br/><span class="caption">Managing storage account access keys</span>
    </li><li class=" "><p   
>Copy the <strong class=" ">Storage account name</strong> and enter it as a value of <strong class=" ">CMSAzureAccountName </strong>setting in <strong class=" ">CMSApp</strong> role section in the ServiceConfiguration.Cloud.cscfg file.</p>
</li><li class=" "><p   
>Copy one of the provided access keys and enter it as a value of <strong class=" ">CMSAzureSharedKey</strong> setting in <strong class=" ">CMSApp</strong> role section in the ServiceConfiguration.Cloud.cscfg file (Azure     <span style="color: #252525;">
privodes two access keys so that you can maintain connections using one key while regenerating the other    </span>
).</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">&lt;</code><code class="keyword">Role</code><code class="plain"> </code><code class="color1">name</code><code class="plain">=</code><code class="string">"CMSApp"</code><code class="plain">&gt;</code></div>
<div class="line"><code class="plain">	&lt;</code><code class="keyword">ConfigurationSettings</code><code class="plain">&gt;</code></div>
<div class="line"><code class="plain">		&lt;</code><code class="keyword">Setting</code><code class="plain"> </code><code class="color1">name</code><code class="plain">=</code><code class="string">"CMSAzureAccountName"</code><code class="plain"> </code><code class="color1">value</code><code class="plain">=</code><code class="string">"YourStorageName"</code><code class="plain">/&gt;</code></div>
<div class="line"><code class="plain">		&lt;</code><code class="keyword">Setting</code><code class="plain"> </code><code class="color1">name</code><code class="plain">=</code><code class="string">"CMSAzureSharedKey"</code><code class="plain"> </code><code class="color1">value</code><code class="plain">=</code><code class="string">"YourPrimaryAccessKey"</code><code class="plain">/&gt;</code></div>
<div class="line"><code class="plain">	&lt;/</code><code class="keyword">ConfigurationSettings</code><code class="plain">&gt;</code></div>
<div class="line"><code class="plain">&lt;/</code><code class="keyword">Role</code><code class="plain">&gt;</code></div>
</div>
    </div>
<p   
>Replace <strong class=" ">YourStorageName</strong> and <strong class=" ">YourPrimaryAccessKey</strong> with your own values.<br/>    <span style="color: #ffffff;">
.    </span>
</p>
</li><li class=" "><p   
>Save the configuration file.</p>
</li></ol><p   
>You have connected your Azure project with your Azure storage account.</p>
    <div  class="confbox admonition admonition-tip">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p   
><strong class=" ">Setting the keys after the deployment</strong></p>
<p   
>If you do not set the storage access keys before you deploy the Azure project to the cloud, you can do it after the deployment as well in the <a  class="external-link" href="https://portal.azure.com/">Azure Management Portal</a>. Navigate to <strong class=" ">Cloud services -&gt;</strong> select your service <strong class=" ">-&gt; Configuration</strong>, where you can copy the <strong class=" ">Storage account name</strong> and one of the provided keys as values of the <strong class=" ">CMSAzureAccountName</strong> and <strong class=" ">CMSAzureSharedKey</strong> settings for the <strong class=" ">CMSApp</strong> and <strong class=" ">SmartSearchWorker</strong> roles.</p>
        </div>
    </div>
    <div  class="confbox panel">
            <div class="title panel-header">On this page</div>
            <div class="panel-content">
<p   
></p>
<ul class="toc-indentation "><li class=" "><p   
><a   href="k11/#src-68881729_ConfiguringKenticoAzureprojectsforCloudServices-AddingapplicationsettingsinanAzureproject">Adding application settings in an Azure project</a></p>
</li><li class=" "><p   
><a   href="k11/#src-68881729_ConfiguringKenticoAzureprojectsforCloudServices-Basicconfiguration">Basic configuration</a></p>
<ul class="toc-indentation "><li class=" "><p   
><a   href="k11/#src-68881729_ConfiguringKenticoAzureprojectsforCloudServices-SettingtheAzurestorageaccesskeys">Setting the Azure storage access keys</a></p>
</li><li class=" "><p   
><a   href="k11/#src-68881729_ConfiguringKenticoAzureprojectsforCloudServices-Configuringsmartsearch">Configuring smart search</a></p>
<ul class="toc-indentation "><li class=" "><p   
><a   href="k11/#src-68881729_ConfiguringKenticoAzureprojectsforCloudServices-ConfiguringtheSmartSearchWorkerrole">Configuring the SmartSearchWorker role</a></p>
</li><li class=" "><p   
><a   href="k11/#src-68881729_ConfiguringKenticoAzureprojectsforCloudServices-ConfiguringtheprocessingofsmartsearchtasksintheCMSAppwebrole">Configuring the processing of smart search tasks in the CMSApp web role</a></p>
</li><li class=" "><p   
><a   href="k11/#src-68881729_ConfiguringKenticoAzureprojectsforCloudServices-Disablingsmartsearchfunctionality">Disabling smart search functionality</a></p>
</li></ul></li></ul></li><li class=" "><p   
><a   href="k11/#src-68881729_safe-id-Q29uZmlndXJpbmdLZW50aWNvQXp1cmVwcm9qZWN0c2ZvckNsb3VkU2VydmljZXMtQWR2YW5jZWRjb25maWd1cmF0aW9uKG11bHRpcGxld2Vicm9sZXMp">Advanced configuration (multiple web roles)</a></p>
<ul class="toc-indentation "><li class=" "><p   
><a   href="k11/#src-68881729_ConfiguringKenticoAzureprojectsforCloudServices-Configuringthenumberofinstances">Configuring the number of instances</a></p>
<ul class="toc-indentation "><li class=" "><p   
><a   href="k11/#src-68881729_ConfiguringKenticoAzureprojectsforCloudServices-Instancelicensing">Instance licensing</a></p>
</li></ul></li><li class=" "><p   
><a   href="k11/#src-68881729_ConfiguringKenticoAzureprojectsforCloudServices-Configuringsessionstatestorage">Configuring session state storage</a></p>
</li></ul></li><li class=" "><p   
><a   href="k11/#src-68881729_ConfiguringKenticoAzureprojectsforCloudServices-Additionalconfigurations">Additional configurations</a></p>
<ul class="toc-indentation "><li class=" "><p   
><a   href="k11/#src-68881729_ConfiguringKenticoAzureprojectsforCloudServices-ConfiguringsizesoftheCMSAppwebrole">Configuring sizes of the CMSApp web role</a></p>
</li><li class=" "><p   
><a   href="k11/#src-68881729_ConfiguringKenticoAzureprojectsforCloudServices-ConfiguringexternalWindowsservices">Configuring external Windows services</a></p>
</li><li class=" "><p   
><a   href="k11/#src-68881729_ConfiguringKenticoAzureprojectsforCloudServices-ConfiguringmonitoringforCloudServices">Configuring monitoring for Cloud Services</a></p>
</li></ul></li></ul><p   
></p>
        </div>
    </div>
    <div  class="confbox panel">
            <div class="title panel-header">Installing and deploying Kentico to Azure Cloud Services</div>
            <div class="panel-content">
<ol class=" "><li class=" "><p   
><a   href="k11/Preparing-the-Azure-cloud-environment.htm">Preparing the Azure cloud environment</a></p>
</li><li class=" "><p   
><a   href="k11/Installing-Kentico-Azure-projects.htm">Installing Kentico Azure projects</a></p>
</li><li class=" "><p   
>Configuring Kentico Azure projects for Cloud Services</p>
</li><li class=" "><p   
><a   href="k11/Deploying-Azure-projects-to-Cloud-Services.htm">Deploying Azure projects to Cloud Services</a></p>
</li><li class=" "><p   
><a   href="k11/Installing-the-database-for-Azure-projects.htm">Installing the database for Azure projects</a></p>
</li></ol>        </div>
    </div>
    <h4 id="src-68881729_ConfiguringKenticoAzureprojectsforCloudServices-Configuringsmartsearch" class="heading "><span>Configuring smart search</span></h4>
<p   
>Before you deploy your Azure project to the cloud, you need to decide whether you want to use <a   href="k11/Using-locally-stored-search-indexes.htm">locally stored search indexes</a>. You have the following options:</p>
<ul class=" "><li class=" "><p   
><a   href="k11/#src-68881729_ConfiguringKenticoAzureprojectsforCloudServices-ConfiguringtheSmartSearchWorkerrole">Configure the SmartSearchWorker role</a></p>
</li><li class=" "><p   
><a   href="k11/#src-68881729_ConfiguringKenticoAzureprojectsforCloudServices-ConfiguringtheprocessingofsmartsearchtasksintheCMSAppwebrole">Remove the SmartSearchWorker role and configure processing of smart search tasks in the CMSApp role</a></p>
</li><li class=" "><p   
><a   href="k11/#src-68881729_ConfiguringKenticoAzureprojectsforCloudServices-Disablingsmartsearchfunctionality">Remove the SmartSearchWorker role and disable smart search functionality</a></p>
</li></ul>    <div  class="confbox admonition admonition-info">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p   
><strong class=" ">Note</strong>: You can use <a   href="k11/Using-Azure-Search.htm">Azure Search indexes</a> without the SmartSearchWorker role.</p>
        </div>
    </div>
    <h5 id="src-68881729_ConfiguringKenticoAzureprojectsforCloudServices-ConfiguringtheSmartSearchWorkerrole" class="heading "><span>Configuring the SmartSearchWorker role</span></h5>
<p   
>If you want to use the SmartSearchWorker role and utilize local smart search indexes, configure the <strong class=" ">Storage account name</strong> and <strong class=" ">Primary access key</strong> for this role.</p>
<ol class=" "><li class=" "><p   
>Open your Azure project in Visual Studio.</p>
</li><li class=" "><p   
>Open the <strong class=" ">ServiceConfiguration.Cloud.cscfg</strong> file.</p>
</li><li class=" "><p   
>Copy the <strong class=" ">CMSAzureAccountName </strong>and <strong class=" ">CMSAzureSharedKey</strong> keys (which you set when <a   href="k11/#src-68881729_ConfiguringKenticoAzureprojectsforCloudServices-SettingtheAzurestorageaccesskeys">configuring the storage access keys</a>) with their values from the CMSApp role section to the <strong class=" ">SmartSearchWorker</strong> role section:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">&lt;</code><code class="keyword">Role</code><code class="plain"> </code><code class="color1">name</code><code class="plain">=</code><code class="string">"SmartSearchWorker"</code><code class="plain">&gt;</code></div>
<div class="line"><code class="plain">	&lt;</code><code class="keyword">ConfigurationSettings</code><code class="plain">&gt;</code></div>
<div class="line"><code class="plain">		&lt;</code><code class="keyword">Setting</code><code class="plain"> </code><code class="color1">name</code><code class="plain">=</code><code class="string">"CMSAzureAccountName"</code><code class="plain"> </code><code class="color1">value</code><code class="plain">=</code><code class="string">"YourStorageName"</code><code class="plain">/&gt;</code></div>
<div class="line"><code class="plain">		&lt;</code><code class="keyword">Setting</code><code class="plain"> </code><code class="color1">name</code><code class="plain">=</code><code class="string">"CMSAzureSharedKey"</code><code class="plain"> </code><code class="color1">value</code><code class="plain">=</code><code class="string">"YourPrimaryAccessKey"</code><code class="plain">/&gt;</code></div>
<div class="line"><code class="plain">	&lt;/</code><code class="keyword">ConfigurationSettings</code><code class="plain">&gt;</code></div>
<div class="line"><code class="plain">&lt;/</code><code class="keyword">Role</code><code class="plain">&gt;</code></div>
</div>
    </div>
<p   
>Replace <strong class=" ">YourStorageName</strong> and <strong class=" ">YourPrimaryAccessKey</strong> with your own values.<br/>    <span style="color: #ffffff;">
.    </span>
</p>
</li><li class=" "><p   
><strong class=" ">Save</strong> the configuration file.</p>
</li></ol><p   
>You have configured the SmartSearchWorker role to work on Microsoft Azure. If you do not need to perform any other configuration tasks, continue to <a   href="k11/Deploying-Azure-projects-to-Cloud-Services.htm">Deploying Azure projects to Cloud Services</a>.</p>
    <h5 id="src-68881729_ConfiguringKenticoAzureprojectsforCloudServices-ConfiguringtheprocessingofsmartsearchtasksintheCMSAppwebrole" class="heading "><span>Configuring the processing of smart search tasks in the CMSApp web role</span></h5>
<p   
>If you would not utilize the whole worker role, but you do not want to lose the smart search functionality entirely, you can configure local search tasks to be processed by the main CMSApp web role. This solution can only be used by small projects, as the search tasks affect the performance of the web role.</p>
<ol class=" "><li class=" "><p   
>Open your Azure project in Visual Studio.</p>
</li><li class=" "><p   
>Remove the <strong class=" ">SmartSearchWorker</strong> role from CMSAzure/Roles.</p>
</li><li class=" "><p   
>Open the <strong class=" ">web.config</strong> file from the CMSApp project.</p>
</li><li class=" "><p   
>Add the <strong class=" ">CMSProcessSearchTasksByScheduler </strong>key to the &lt;appSettings&gt; section:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">&lt;</code><code class="keyword">add</code><code class="plain"> </code><code class="color1">key</code><code class="plain">=</code><code class="string">"CMSProcessSearchTasksByScheduler"</code><code class="plain"> </code><code class="color1">value</code><code class="plain">=</code><code class="string">"true"</code><code class="plain"> /&gt;</code></div>
</div>
    </div>
</li><li class=" "><p   
><strong class=" ">Save</strong> the web.config file.</p>
</li></ol><p   
>Local smart search tasks are now processed by the CMSApp web role. The SmartSearchWorker role will not be deployed to the hosting environment, so the costs of running your application on Microsoft Azure will be lower. If you do not need to perform any other configuration tasks, continue to <a   href="k11/Deploying-Azure-projects-to-Cloud-Services.htm">Deploying Azure projects to Cloud Services</a>.</p>
    <h5 id="src-68881729_ConfiguringKenticoAzureprojectsforCloudServices-Disablingsmartsearchfunctionality" class="heading "><span>Disabling smart search functionality</span></h5>
<p   
>If you are certain that you will not need local search indexes for your project:</p>
<ol class=" "><li class=" "><p   
>Open your <strong class=" ">Azure project</strong> in Visual Studio.</p>
</li><li class=" "><p   
>Remove the <strong class=" ">SmartSearchWorker</strong> role from CMSAzure/Roles.</p>
</li></ol><p   
>Removing the SmartSearchWorker reduces the number of roles that need to be hosted, so the costs of running your application on Microsoft Azure will be lower. If you do not need to perform any other configuration tasks, continue to <a   href="k11/Deploying-Azure-projects-to-Cloud-Services.htm">Deploying Azure projects to Cloud Services</a>.</p>
    <h3 id="src-68881729_safe-id-Q29uZmlndXJpbmdLZW50aWNvQXp1cmVwcm9qZWN0c2ZvckNsb3VkU2VydmljZXMtQWR2YW5jZWRjb25maWd1cmF0aW9uKG11bHRpcGxld2Vicm9sZXMp" class="heading "><span>Advanced configuration (multiple web roles)</span></h3>
<p   
>When you use more than one instance of the CMSApp web role, the system considers these instances as web farm servers. Therefore, you need to configure your project according to the instructions in this section.</p>
    <h4 id="src-68881729_ConfiguringKenticoAzureprojectsforCloudServices-Configuringthenumberofinstances" class="heading "><span>Configuring the number of instances</span></h4>
<p   
>You can set up the number of instances used for the <strong class=" ">CMSApp</strong> role, which represents the Kentico application. This determines the number of virtual machines dedicated to the website. The number of instances influences the performance and load handling capacity of the application.</p>
<p   
>To set the number of instances used for the CMSApp role, change the value of the <strong class=" ">count</strong> attribute of the role&#39;s <i class=" ">&lt;Instances&gt;</i> element:</p>
<ol class=" "><li class=" "><p   
>Open your Azure project in Visual Studio.</p>
</li><li class=" "><p   
>Open the <strong class=" ">ServiceConfiguration.Cloud.cscfg</strong> file.</p>
</li><li class=" "><p   
>Change the <strong class=" ">&lt;Instances count=&quot;1&quot; /&gt;</strong> setting to the required number of instances:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">&lt;</code><code class="keyword">Role</code><code class="plain"> </code><code class="color1">name</code><code class="plain">=</code><code class="string">"CMSApp"</code><code class="plain">&gt;</code></div>
<div class="line"><code class="plain">  &lt;</code><code class="keyword">Instances</code><code class="plain"> </code><code class="color1">count</code><code class="plain">=</code><code class="string">"2"</code><code class="plain"> /&gt;</code></div>
<div class="line"><code class="plain">  &lt;</code><code class="keyword">ConfigurationSettings</code><code class="plain">&gt;</code></div>
<div class="line"><code class="plain">    ...</code></div>
<div class="line"><code class="plain">  &lt;/</code><code class="keyword">ConfigurationSettings</code><code class="plain">&gt;</code></div>
<div class="line"><code class="plain">&lt;/</code><code class="keyword">Role</code><code class="plain">&gt;</code></div>
</div>
    </div>
</li><li class=" "><p   
>Save the configuration file.</p>
</li></ol><p   
>Each instance is represented by a separate web farm server within the Kentico system. The creation and management of the servers is handled automatically, and you do not have to perform any further configuration.</p>
    <div  class="confbox admonition admonition-tip">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p   
>You can also change the number of used instances on the <a  class="external-link" href="https://portal.azure.com/">Azure Management Portal</a> in <strong class=" ">Cloud services -&gt; Scale</strong> tab.</p>
        </div>
    </div>
    <div  class="confbox admonition admonition-warning">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p   
><strong class=" ">SmartSearchWorker</strong> <strong class=" ">role</strong></p>
<p   
>Do NOT increase the number of instances for the <strong class=" ">SmartSearchWorker</strong> role. Due to the way smart search indexes are processed, the required tasks must be performed by a single instance.</p>
        </div>
    </div>
    <h5 id="src-68881729_ConfiguringKenticoAzureprojectsforCloudServices-Instancelicensing" class="heading "><span>Instance licensing</span></h5>
<p   
>The Kentico license used for your domain must allow at least as many web farm servers as the amount of instances set for the role. See <a  class="external-link" href="http://www.kentico.com/purchase/price-list/product-license-pricelist">http://www.kentico.com</a> for pricing information.</p>
    <h4 id="src-68881729_ConfiguringKenticoAzureprojectsforCloudServices-Configuringsessionstatestorage" class="heading "><span>Configuring session state storage</span></h4>
<p   
>If you want your Azure application to use two or more web role instances, choose where to store session state information. See <a   href="k11/Storing-cache-and-session-state-data-in-Azure-environment.htm">Storing cache and session state data in Azure environment</a> for details.</p>
    <h3 id="src-68881729_ConfiguringKenticoAzureprojectsforCloudServices-Additionalconfigurations" class="heading "><span>Additional configurations</span></h3>
<p   
>You can perform the configurations in this section in any phase of project development.</p>
    <h4 id="src-68881729_ConfiguringKenticoAzureprojectsforCloudServices-ConfiguringsizesoftheCMSAppwebrole" class="heading "><span>Configuring sizes of the CMSApp web role</span></h4>
<p   
>The size of a web role determines the number of CPU cores, the memory capacity, and the local file system size that is allocated to a running instance. You can change the size of the web role anytime, however, note that <strong class=" ">full redeployment</strong> is required after the change.</p>
<ol class=" "><li class=" "><p   
>Open your Azure project in Visual Studio.</p>
</li><li class=" "><p   
>Open the <strong class=" ">ServiceDefinition.csdef</strong> file.</p>
</li><li class=" "><p   
>Set the <strong class=" ">vmsize</strong> attribute of the <strong class=" ">WebRole</strong> element to the size that you desire.</p>
<ul class=" "><li class=" "><p   
>For more information about the available size options, see <a  class="external-link" href="https://docs.microsoft.com/en-us/azure/cloud-services/cloud-services-sizes-specs">Sizes for Cloud Services</a>.</p>
</li></ul>    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">&lt;</code><code class="keyword">WebRole</code><code class="plain"> </code><code class="color1">name</code><code class="plain">=</code><code class="string">"CMSApp"</code><code class="plain"> </code><code class="color1">vmsize</code><code class="plain">=</code><code class="string">"Large"</code><code class="plain">&gt;</code></div>
</div>
    </div>
</li></ol>    <h4 id="src-68881729_ConfiguringKenticoAzureprojectsforCloudServices-ConfiguringexternalWindowsservices" class="heading "><span>Configuring external Windows services</span></h4>
<p   
>By default, external Windows services (Scheduler and Health monitor) that come with Kentico do not run in the Azure environment. However, you can make a few adjustments to the Visual Studio project to make the services work. After performing the steps described in this section, the Scheduler service will run as part of the <strong class=" ">SmartSearchWorker </strong>role and the Health monitoring service will run as part of the <strong class=" ">CMSApp</strong> role.</p>
    <div  class="confbox admonition admonition-warning">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p   
><strong class=" ">Prerequisites for the Health monitoring service</strong></p>
<p   
>For the Health monitoring service to work in your Azure project:</p>
<ul class=" "><li class=" "><p   
>The Azure Cloud Service and SQL Server must share the same Location (<a  class="external-link" href="https://azure.microsoft.com/en-us/regions/">Azure Region</a>)</p>
</li><li class=" "><p   
>The SQL server must have the <strong class=" ">Allow access to Azure Services</strong> setting enabled. You can enable this option in the <a  class="external-link" href="https://portal.azure.com/">Azure Management Portal</a> &ndash; navigate to <strong class=" ">SQL servers</strong>,<strong class=" "> </strong>select your server, and open the <strong class=" ">Firewall / Virtual Networks</strong> tab.</p>
</li></ul><p   
>You cannot change the Location for existing Cloud Services and SQL Servers. If your services do not have the same Location, you need to delete the services and recreate them in the same Location.</p>
        </div>
    </div>
<p   
>To enable external services in your Azure project:</p>
<ol class=" "><li class=" "><p   
>Open your Kentico Azure solution in Visual Studio.</p>
</li><li class=" "><p   
>Edit the CMSAzure/<strong class=" ">ServiceDefinition.csdef</strong> file and uncomment the following code:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                    <div class="title">Scheduler</div>
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-title="Scheduler" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">&lt;</code><code class="keyword">Startup</code><code class="plain">&gt;</code></div>
<div class="line"><code class="plain">	&lt;</code><code class="keyword">Task</code><code class="plain"> </code><code class="color1">commandLine</code><code class="plain">=</code><code class="string">"InstallSchedulerService.cmd"</code><code class="plain"> </code><code class="color1">executionContext</code><code class="plain">=</code><code class="string">"elevated"</code><code class="plain"> </code><code class="color1">taskType</code><code class="plain">=</code><code class="string">"simple"</code><code class="plain"> /&gt;</code></div>
<div class="line"><code class="plain">&lt;/</code><code class="keyword">Startup</code><code class="plain">&gt;</code></div>
</div>
    </div>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                    <div class="title">Health monitoring</div>
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-title="Health monitoring" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">&lt;</code><code class="keyword">Startup</code><code class="plain">&gt;</code></div>
<div class="line"><code class="plain">      &lt;</code><code class="keyword">Task</code><code class="plain"> </code><code class="color1">commandLine</code><code class="plain">=</code><code class="string">"InstallHealthMonitoringService.cmd"</code><code class="plain"> </code><code class="color1">executionContext</code><code class="plain">=</code><code class="string">"elevated"</code><code class="plain"> </code><code class="color1">taskType</code><code class="plain">=</code><code class="string">"simple"</code><code class="plain"> /&gt;</code></div>
<div class="line"><code class="plain">&lt;/</code><code class="keyword">Startup</code><code class="plain">&gt;</code></div>
</div>
    </div>
</li><li class=" "><p   
>Edit the <strong class=" ">web.config</strong> file in the CMSApp project and copy the value of the <strong class=" ">CMSApplicationName</strong> key.</p>
</li><li class=" "><p   
>Open the SmartSearchWorker/<strong class=" ">InstallSchedulerService.cmd</strong> and CMSApp/<strong class=" ">InstallHealthMonitoringService.cmd</strong> files, and replace <i class=" ">&lt;ApplicationName&gt;</i> with the value of the <strong class=" ">CMSApplicationName</strong> key.</p>
<ul class=" "><li class=" "><p   
>For example, if the value of the CMSApplicationName key is:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">&lt;</code><code class="keyword">add</code><code class="plain"> </code><code class="color1">key</code><code class="plain">=</code><code class="string">"CMSApplicationName"</code><code class="plain"> </code><code class="color1">value</code><code class="plain">=</code><code class="string">"My Web Site/Kentico"</code><code class="plain"> /&gt;</code></div>
</div>
    </div>
</li><li class=" "><p   
>then the appropriate line would be:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">SET _applicationIdentifier=My Web Site/Kentico</code></div>
</div>
    </div>
</li><li class=" "><p   
>You can also use the value of the CMSApplicationGuid key, but note that the services will use this value in their names.<br/><br/></p>
</li></ul></li><li class=" "><p   
>Choose a password for a new administrator account, which will be created on your Microsoft Azure machine by the InstallSchedulerService.cmd (InstallHealthMonitoringService.cmd) script. Replace <i class=" ">&lt;YourPassword&gt;</i> with the chosen password:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">SET _adminPassword=QyCZ5HDj</code></div>
</div>
    </div>
</li><li class=" "><p   
>Link the main CMSApp <strong class=" ">web.config</strong> file into the <strong class=" ">SmartSearchWorker</strong> project:</p>
<ol class=" "><li class=" "><p   
>Right-click the <strong class=" ">SmartSearchWorker</strong> project and select <strong class=" ">Add -&gt; Existing Item</strong>.</p>
</li><li class=" "><p   
>Select the <strong class=" ">CMS\web.config</strong> file within the Kentico project. You may need to set the file filter to <i class=" ">All Files (*.*)</i>.</p>
</li><li class=" "><p   
>Expand the <strong class=" ">Add</strong> menu and click <strong class=" ">Add As Link</strong>.</p>
</li></ol></li><li class=" "><p   
>Link the <strong class=" ">services.xml</strong> file into the <strong class=" ">SmartSearchWorker</strong> project:</p>
<ol class=" "><li class=" "><p   
>Create the following folder structure under in the <strong class=" ">SmartSearchWorker</strong> project: <i class=" ">/App_Data/CMSModules/WinServices</i></p>
</li><li class=" "><p   
>Right-click the <i class=" ">SmartSearchWorker/App_Data/CMSModules/WinServices</i> folder and select <strong class=" ">Add -&gt; Existing Item</strong>.</p>
</li><li class=" "><p   
>Select the <strong class=" ">CMS\App_Data\CMSModules\WinServices\services.xml </strong>file within the Kentico project. You may need to set the file filter to <i class=" ">All Files (*.*)</i>.</p>
</li><li class=" "><p   
>Expand the <strong class=" ">Add</strong> menu and click <strong class=" ">Add As Link</strong>.</p>
</li></ol></li><li class=" "><p   
>Open the Visual Studio <strong class=" ">Properties Window</strong> (by selecting <strong class=" ">View -&gt; Properties Window</strong> in the main menu or by pressing <strong class=" ">F4</strong>).</p>
</li><li class=" "><p   
>Set the <strong class=" ">Copy to Output Directory</strong> property to <i class=" ">Copy always</i> for the following files:<br/></p>
<ul class=" "><li class=" "><p   
>CMSApp/App_Data/CMSModules/HealthMonitoring/<strong class=" ">Counters.xpc</strong></p>
</li><li class=" "><p   
>CMSApp/<strong class=" ">InstallHealthMonitoringService.cmd</strong></p>
</li><li class=" "><p   
>SmartSearchWorker//App_Data/CMSModules/WinServices/<strong class=" ">services.xml</strong> (linked file)</p>
</li><li class=" "><p   
>SmartSearchWorker/<strong class=" ">InstallSchedulerService.cmd</strong></p>
</li><li class=" "><p   
>SmartSearchWorker/<strong class=" ">Web.config</strong> (linked file)<strong class=" "><br/></strong></p>
</li></ul></li></ol><p   
>Once the application is deployed and starts for the first time, the InstallSchedulerService.cmd and InstallHealthMonitoringService.cmd scripts register the services into the system and start them. You will then be able to manage them via remote desktop.</p>
    <div  class="confbox admonition admonition-info">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p   
><strong class=" ">Deploying a project without a database</strong></p>
<p   
>If you deploy your Azure project without a database (you perhaps intend to install the database later using the web installer), the Windows services will not be started and will not run even after you install the database.</p>
<p   
>To start the Windows services after you additionally install the database, restart the instances of the cloud service:</p>
<ol class=" "><li class=" "><p   
>Open the <a  class="external-link" href="https://portal.azure.com/">Azure Management Portal</a>.</p>
</li><li class=" "><p   
>Select your Cloud Service.</p>
</li><li class=" "><p   
>Switch to the <strong class=" ">Roles and Instances </strong>tab.</p>
</li><li class=" "><p   
>Select a role instance and click <strong class=" ">Reboot </strong>in the top panel.</p>
</li><li class=" "><p   
>Reboot all other instances including the worker role.</p>
</li></ol><p   
>The restart will cause the Windows services to start properly and the performance counters to be registered.</p>
        </div>
    </div>
    <div  class="confbox admonition admonition-note">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p   
><strong class=" ">Known issue</strong></p>
<p   
>If you encounter the following error while publishing your Azure project from Visual Studio:</p>
<ul class=" "><li class=" "><p   
><i class=" ">Could not copy the file &quot;InstallHealthMonitoringService.cmd&quot; because it was not found.</i></p>
</li></ul><p   
>try publishing your project once again. This error sometimes occurs when you build your Azure solution in the <i class=" ">release</i> configuration and subsequently publish the project.</p>
        </div>
    </div>
    <h4 id="src-68881729_ConfiguringKenticoAzureprojectsforCloudServices-ConfiguringmonitoringforCloudServices" class="heading "><span>Configuring monitoring for Cloud Services</span></h4>
<p   
>You can monitor the performance of your cloud services in the <a  class="external-link" href="https://portal.azure.com/">Azure Management Portal</a>, when you select your cloud service and switch to the <strong class=" ">Monitor</strong> page. The Azure platform offers two monitoring modes, Minimal and Verbose.</p>
<ul class=" "><li class=" "><p   
><strong class=" ">Minimal</strong> &ndash; the default monitoring mode for new cloud services. Allows you to monitor the following metrics: CPU Percentage, Data In, Data Out, Disk Read Throughput, and Disk Write Throughput.</p>
</li><li class=" "><p   
><strong class=" ">Verbose</strong> &ndash; provides more monitoring options, but requires access to the Azure blob storage. You need to provide storage access keys and configure the diagnostics connection string for your roles.</p>
</li></ul><p   
>You can find more information about the monitoring options in <a  class="external-link" href="https://docs.microsoft.com/en-us/azure/cloud-services/cloud-services-how-to-monitor">How to Monitor Cloud Services</a>.</p>
<p   
>To configure your Azure project to enable <strong class=" ">verbose monitoring</strong>:</p>
<ol class=" "><li class=" "><p   
>Open your Azure project in Visual Studio.</p>
</li><li class=" "><p   
>Right-click the <strong class=" ">CMSApp</strong> role in the solution explorer and select <strong class=" ">Add Diagnostics Configuration</strong>, which adds a diagnostics configuration file to the solution. See <a  class="external-link" href="https://docs.microsoft.com/en-us/azure/vs-azure-tools-diagnostics-for-cloud-services-and-virtual-machines">Configuring Diagnostics for Azure Cloud Services</a> for more instructions.</p>
</li><li class=" "><p   
>Double click the <strong class=" ">CMSApp</strong> role.</p>
</li><li class=" "><p   
>On the <strong class=" ">Configuration</strong> tab, make sure that the <strong class=" ">Enable Diagnostics</strong> option is selected.</p>
</li><li class=" "><p   
>Click <strong class=" ">Configure...</strong></p>
</li><li class=" "><p   
>On the General tab of the Diagnostics configuration dialog box, click <strong class=" ">Configure</strong>.</p>
</li><li class=" "><p   
>Select your <strong class=" ">Subscription</strong> and <strong class=" ">Storage account</strong>, where the diagnostics data will be stored.</p>
</li><li class=" "><p   
>Close both configuration dialog boxes.</p>
</li><li class=" "><p   
>Repeat this procedure for the <strong class=" ">SmartSearchWorker</strong> role.</p>
</li></ol><p   
>After you deploy your project, you can switch to the Verbose monitoring mode in the Azure Management Portal when you select your cloud service and switch to the <strong class=" ">Configure</strong> tab. You can also change the diagnostics connection string on the <strong class=" ">Configure</strong> tab in the <strong class=" ">Diagnostics Connection Strings</strong> section.</p>
        </div>

    </article>


               
            
    <footer id="ht-footer">
    <a href="#" id="ht-jump-top" class="sp-aui-icon-small sp-aui-iconfont-arrows-up"></a>
</footer></div>

<div>
    <div id="ht-mq-detect"></div>
</div>

    <script src="js/lunr.js"></script>
    <script src="js/lunr-extras.js"></script>
    <script src="assets/js/scroll-search.js"></script>

    <script src="assets/js/expand-macro.js"></script>
</body>
</html>
