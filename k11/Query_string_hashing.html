<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Query string hashing - Kentico 11 Documentation</title>

    
    <link rel="stylesheet" href="assets/css/expand-macro.css">

            <meta name="scroll-content-language-key" content="">
    
    <meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=2.0, user-scalable=yes">

<script type="text/javascript" src="assets/js/jquery.min.js"></script>
<script type="text/javascript" src="assets/js/jquery.scrollTo.min.js"></script>


<script type="text/javascript" src="assets/js/translate.js"></script>

<script type="text/javascript" src="assets/js/theme.main.js"></script>

    <script type="text/javascript" src="assets/js/iframeResizer.min.js"></script>

<link rel="stylesheet" href="assets/css/content-style.css">
    <link rel="stylesheet" href="assets/css/search.css">

<link rel="stylesheet" href="assets/css/theme.main.css">
<link rel="stylesheet" href="assets/css/theme.colors.css">

            <!-- ES5 support for older browsers, needed by lunr -->
        <script src="js/augment.js"></script>
        <script id="worker" type="javascript/worker">

        startIndex = function() {
            idx = lunr.Index.load(lunrIndex);
            idx.pipeline.remove(lunr.stopWordFilter);
            postMessage({type: "setup-complete"});
        }

        onmessage = function (event) {
            var message = event.data;

            if ((message.type === 'setup') && message.baseUrl) {
                var url = message.baseUrl;
                importScripts(url + 'js/lunr.js');
                importScripts(url + 'js/lunr-extras.js');
                importScripts(url + 'js/lunr-index.js');
                importScripts(url + 'js/lunr-data.js');
                startIndex();
            }

            if (idx && (message.type === 'search-request') && message.query) {
                var searchWord = message.query;
                var results = idx.search(searchWord).map(function (result) {
                    return lunrData.filter(function (d) {
                        return d.id === parseInt(result.ref, 10)
                    })[0]
                });
                postMessage({type: 'search-results', results: results, query: searchWord, queryId: message.queryId});
            }
        }

    </script>
    </head>

<body pageid="68879260">

<div id="ht-loader">
    <noscript>
        <p style="width: 100%; text-align:center; position: absolute; margin-top: 200px;">This content cannot be displayed without JavaScript.<br>Please enable JavaScript and reload the page.</p>
    </noscript>
</div>

<div>
   	<header id="ht-headerbar">
    <div class="ht-headerbar-left">
        <a href="" id="ht-menu-toggle" class="sp-aui-icon-small sp-aui-iconfont-appswitcher"></a>
    </div>
    <div class="ht-headerbar-right">
            <div class="sp-aui-icon-small ht-search-index-loader ht-header-icon"></div>

        <div id="ht-search">
            <div class="ht-search-input" style="display: none;">
              	<a href="#" class="sp-aui-icon-small sp-aui-iconfont-remove ht-search-clear"></a>

                <form action="#" method="GET" id="search">
                    <input class="search-input" type="text" placeholder="Search" tabindex="-1" autocomplete="off" name="q" value="">
                    <input type="hidden" name="max" value="15" />
                    <input type="submit" style="display:none" tabindex="-4"/>
                </form>

                <a href="#" id="ht-search-button" class="ht-header-icon ht-header-icon-svg">
                                        <svg width="40px" height="40px" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                        <g>
                            <path d="M29.572,28.802 L28.801,29.571 C28.515,29.857 28.187,30 27.816,30 C27.445,30 27.116,29.857 26.831,29.571 L21.392,24.134 C20.193,24.762 18.908,25.076 17.538,25.076 C15.396,25.076 13.605,24.348 12.163,22.892 C10.721,21.436 10,19.651 10,17.538 C10,15.397 10.721,13.605 12.163,12.163 C13.605,10.721 15.396,10 17.538,10 C19.651,10 21.434,10.721 22.89,12.163 C24.347,13.605 25.075,15.397 25.075,17.538 C25.075,18.937 24.761,20.222 24.132,21.393 L29.572,26.832 C29.857,27.118 30,27.446 30,27.817 C30,28.188 29.857,28.517 29.572,28.802 L29.572,28.802 Z M13.662,21.414 C14.732,22.485 16.024,23.02 17.538,23.02 C19.051,23.02 20.343,22.485 21.413,21.414 C22.484,20.344 23.019,19.052 23.019,17.538 C23.019,16.025 22.484,14.733 21.413,13.662 C20.343,12.592 19.051,12.056 17.538,12.056 C16.024,12.056 14.732,12.592 13.662,13.662 C12.591,14.733 12.056,16.025 12.056,17.538 C12.056,19.052 12.591,20.344 13.662,21.414 L13.662,21.414 Z"></path>
                        </g>
                    </svg>
              	</a>

                <div class="ht-search-dropdown ht-dropdown">
                    <ul></ul>
                </div>
            </div>
        </div>
    </div>
    </header>   	<aside id="ht-sidebar">
    <div class="ht-sidebar-content">
        <div class="ht-sidebar-content-scroll-container">
            <header class="ht-sidebar-header">
                <h1 class="ht-logo">
                    <span class="ht-logo-label">K11</span>
                    <img class="space-logo" src="global.logo" />
                </h1>
                <a href="Kentico_11_Documentation_Home.html" class="ht-space-link">
                    <h2>Kentico 11 Documentation</h2>
                </a>
            </header>
                            <iframe id="ht-nav" src="toc.html?pageId=68881120"></iframe>
                <script>
                    $('iframe#ht-nav').iFrameResize(
                            { 'log': true, 'autoResize': true, 'heightCalculationMethod': 'lowestElement', 'checkOrigin': false });
                </script>
                    </div>
    </div>

</aside></div>

<div id="ht-wrap-container">

            
    <div id="ht-sidebar-dragbar">
    <div class="ht-sidebar-drag-handle">
        <span class="drag-handle-1"></span>
        <span class="drag-handle-2"></span>
        <span class="drag-handle-3"></span>
    </div>
</div>
    <article id="ht-content" class="ht-content">
        <header class="ht-content-header">
            <div id="ht-breadcrumb">
    <ul>
        <li><a href="Kentico_11_Documentation_Home.html">Kentico 11 Documentation</a></li>
                                                                                                             <li><a href="" onclick="$('.shortcut').each(function(){$(this).removeClass('shortcut')}); $(this).parent().addClass('shortcut'); return false;">...</a> </li>
                                        <li class="shortcut"><a href="Securing_websites.html">Securing websites</a></li>
                                                                                     <li><a href="Developing_secure_websites.html">Developing secure websites</a></li>
                                                            </ul>
</div>            <h1 id="src-68881120"> <span>Query string hashing</span></h1>
        </header>

        <div id="main-content" class="wiki-content sp-grid-section" data-index-for-search="true">
        $page.content
<p   
>Query strings in URLs are useful and important in many ways, for example, when passing various values between pages or retrieving data from the database. In some cases though, an unauthorized user could obtain sensitive data or harm the system by entering a URL with <strong class=" ">tampered query string parameters</strong>.</p>
<p   
>To prevent tampering with query string parameters, the system adds the result of a <strong class=" ">hash function</strong> at the end of each URL. Such URLs can look like this:</p>
    <div  class="confbox admonition admonition-info has-no-icon">
                        <div class="admonition-body">
<p   
>http://localhost/Kentico/cms/getfile/2d003444-9a27-43c9-be97-4f5832474015/Partners_logos_silver.aspx?latestfordocid=75&amp;<strong class=" ">hash=eee41e027bd45142fd1f44d173d61950f34d6e98f4e35018fda70542322adc77&amp;chset=013bca78-6bf2-42ac-8959-b8bbbeb0a8e8</strong></p>
        </div>
    </div>
<p   
>The part in bold is the hash parameter added to the URL. If an attacker modifies the parameters and tries to submit such a URL, the system rejects it, because the query string parameters and hash do not match.</p>
<p   
>The hash function is calculated from the query string parameters using <a  class="external-link" href="http://en.wikipedia.org/wiki/SHA-2">SHA-2</a>. The hashing is used in various parts of the system:</p>
<ul class=" "><li class=" "><p   
>Dialog boxes</p>
</li><li class=" "><p   
><a   href="Working_with_macro_signatures.html">Macro signatures</a></p>
</li><li class=" "><p   
>In links for downloading files (e.g.,     <span style="color: #333333;">
getamazonfile.aspx, getazurefile.aspx or sometimes even with     </span>
    <span style="color: #333333;">
getfile.aspx    </span>
) &ndash; to ensure that users download only the file specified in the original URL and nothing else.</p>
</li></ul>    <div  class="confbox panel">
            <div class="title panel-header">On this page</div>
            <div class="panel-content">
<p   
></p>
<ul class="toc-indentation "><li class=" "><p   
><a   href="#src-68881120_Querystringhashing-Salt">Salt</a></p>
</li><li class=" "><p   
><a   href="#src-68881120_Querystringhashing-Userspecifichash">User specific hash</a></p>
</li><li class=" "><p   
><a   href="#src-68881120_Querystringhashing-Customhashvalidation">Custom hash validation</a></p>
</li></ul><p   
></p>
        </div>
    </div>
    <div  class="confbox panel">
            <div class="title panel-header">Related pages</div>
            <div class="panel-content">
<ul class=" "><li class=" "><p   
><a   href="Working_with_macro_signatures.html">Working with macro signatures</a></p>
</li></ul>        </div>
    </div>
    <h3 id="src-68881120_Querystringhashing-Salt" class="heading "><span>Salt</span></h3>
<p   
>Protection of query string parameters using only the hash function would not be enough because attackers are able to reverse the hash function using <a  class="external-link" href="http://en.wikipedia.org/wiki/Rainbow_table">rainbow tables</a>. For this reason, the system adds a <strong class=" ">salt</strong> to the URL before hashing it.</p>
    <div  class="confbox admonition admonition-info">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p   
><strong class=" ">Hash calculation:</strong></p>
<p   
>URL parameters + salt -&gt; all this is hashed using <a  class="external-link" href="http://en.wikipedia.org/wiki/SHA-2">SHA-2</a> and added to the original URL.</p>
        </div>
    </div>
<p   
>The salt is a secret string of characters, which users do not have access to. In Kentico, the default salt added to the URL is a <strong class=" ">randomly generated GUID</strong> specified by the <i class=" ">    <span style="color: #333333;">
CMSHashStringSalt    </span>
 </i>key in the web.config file:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">&lt;</code><code class="keyword">add</code><code class="plain"> </code><code class="color1">key</code><code class="plain">=</code><code class="string">"CMSHashStringSalt"</code><code class="plain"> </code><code class="color1">value</code><code class="plain">=</code><code class="string">"e68b9ad6-a461-4707-8e3e-ece73f03dd02"</code><code class="plain"> /&gt;</code></div>
</div>
    </div>
<p   
>You may change this value if you need to. If you delete this key completely, the system uses the connection string stored in the web.config file as the salt.</p>
    <div  class="confbox admonition admonition-warning">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p   
>If you have already stored some persistent information (links for downloading files, image links, macros) in the system and you change the salt calculation, then these links and <strong class=" ">information may become broken</strong>. You will have to re-save the content to create hashes with the new salt.</p>
        </div>
    </div>
    <h3 id="src-68881120_Querystringhashing-Userspecifichash" class="heading "><span>User specific hash</span></h3>
<p   
>Sometimes it is useful to add user-specific information to the hash. Either the user session ID or IP address (if there is no session ID) are used for this purpose. If attackers manage to eavesdrop a URL and try to exploit it to gain sensitive data, they would not succeed, as their session ID would not match the hash.</p>
<p   
>The user specific hash is used mainly for non-persistent information, such as displaying dialog boxes.</p>
    <div  class="confbox admonition admonition-note">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p   
>Note that if you use user specific hashing and save some content with it, users other than the one who saved the content will not be able to use it.</p>
        </div>
    </div>
    <h3 id="src-68881120_Querystringhashing-Customhashvalidation" class="heading "><span>Custom hash validation</span></h3>
<p   
>We recommend using hashing features when developing custom dialog boxes. The following methods are available in the Kentico API:</p>
<p   
>    <span style="color: #333333;">
Hash calculation:<br/>    </span>
</p>
<ul class=" "><li class=" "><p   
><strong class=" ">QueryHelper.BuildQueryWithHash</strong> - builds the entire query string with any number of parameters, automatically calculates and adds a hash parameter (with all parameters as the input).</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                    <div class="title">Example - BuildQueryWithHash</div>
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-title="Example - BuildQueryWithHash" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="keyword">using</code><code class="plain"> CMS.Helpers;</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">...</code></div>
<div class="line"> </div>
<div class="line"><code class="comments">// Sample URL parameter values</code></div>
<div class="line"><code class="keyword">string</code><code class="plain"> urlParamValue1 = </code><code class="string">"value1"</code><code class="plain">;</code></div>
<div class="line"><code class="keyword">string</code><code class="plain"> urlParamValue2 = </code><code class="string">"value2"</code><code class="plain">;</code></div>
<div class="line"> </div>
<div class="line"><code class="comments">// Sample base URL</code></div>
<div class="line"><code class="keyword">string</code><code class="plain"> url = </code><code class="string">"base"</code><code class="plain">;</code></div>
<div class="line"> </div>
<div class="line"><code class="comments">// Creates a query string containing the sample parameters and the hash</code></div>
<div class="line"><code class="keyword">string</code><code class="plain"> queryString = QueryHelper.BuildQueryWithHash(</code><code class="string">"parameter1"</code><code class="plain">, urlParamValue1, </code><code class="string">"parameter2"</code><code class="plain">, urlParamValue2);</code></div>
<div class="line"> </div>
<div class="line"><code class="comments">// Adds the query string parameters to the URL, including the hash</code></div>
<div class="line"><code class="plain">url += queryString;</code></div>
</div>
    </div>
</li><li class=" "><p   
>    <span style="color: #333333;">
    <span style="color: #333333;">
<strong class=" ">ValidationHelper.GetHashString</strong> - creates a SHA2 hash of a specified value. Can be used to create hashes for any values, not just query strings. The optional <i class=" ">HashSettings</i> parameter allows you to specify whether the hash is user-specific, and also add a custom salt.<br/>    </span>
    </span>
</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                    <div class="title">Example - GetHashString</div>
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-title="Example - GetHashString" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="keyword">using</code><code class="plain"> CMS.Helpers;</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">...</code></div>
<div class="line"> </div>
<div class="line"><code class="comments">// Sample string value</code></div>
<div class="line"><code class="keyword">string</code><code class="plain"> customValue = </code><code class="string">"value"</code><code class="plain">;</code></div>
<div class="line"> </div>
<div class="line"><code class="comments">// Creates a hash for the custom value</code></div>
<div class="line"><code class="keyword">string</code><code class="plain"> hash = ValidationHelper.GetHashString(urlParameterValue);</code></div>
</div>
    </div>
<p   
>    <span style="color: #333333;">
<br/>    </span>
</p>
</li></ul><p   
>    <span style="color: #333333;">
Hash validation:<br/>    </span>
</p>
<ul class=" "><li class=" "><p   
><strong class=" ">    <span style="color: #333333;">
QueryHelper.ValidateHash    </span>
</strong> - works directly with the query string and can exclude individual parameters from hash validation.    <span style="color: #333333;">
    </span>
</p>
</li><li class=" "><p   
>    <span style="color: #333333;">
<strong class=" ">ValidationHelper.ValidateHash</strong> - general hash validation method, can be used for macro signatures.<br/>    </span>
</p>
</li></ul><p   
>You can validate hashes on pages individually:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="keyword">using</code><code class="plain"> CMS.Helpers;</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">...</code></div>
<div class="line"> </div>
<div class="line"><code class="comments">// Validates a hash value</code></div>
<div class="line"><code class="keyword">if</code><code class="plain"> (QueryHelper.ValidateHash(</code><code class="string">"hash"</code><code class="plain">))</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">	</code><code class="comments">// The validation was successful, perform any required actions</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p   
>Or you can validate hashes automatically by including the <i class=" ">    <span style="color: #333333;">
[HashValidation(Name=&quot;hash2&quot;)]    </span>
</i> attribute on a page:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="keyword">using</code><code class="plain"> CMS.UIControls;</code></div>
<div class="line"><code class="keyword">using</code><code class="plain"> CMS.Helpers;</code></div>
<div class="line"><code class="keyword">using</code><code class="plain"> CMS.Base;</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">[HashValidation(HashValidationSalts.REDIRECT_PAGE)]</code></div>
<div class="line"><code class="keyword">public</code><code class="plain"> </code><code class="keyword">partial</code><code class="plain"> </code><code class="keyword">class</code><code class="plain"> CMSMessages_Redirect : MessagePage</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">	</code><code class="comments">/// &lt;summary&gt;</code></div>
<div class="line"><code class="plain">	</code><code class="comments">/// OnInit event.</code></div>
<div class="line"><code class="plain">	</code><code class="comments">/// &lt;/summary&gt;</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">protected</code><code class="plain"> </code><code class="keyword">override</code><code class="plain"> </code><code class="keyword">void</code><code class="plain"> OnPreInit(EventArgs e)</code></div>
<div class="line"><code class="plain">	{</code></div>
<div class="line"><code class="plain">		</code><code class="keyword">string</code><code class="plain"> url = QueryHelper.GetText(</code><code class="string">"url"</code><code class="plain">, String.Empty);</code></div>
<div class="line"><code class="plain">		CheckHashValidationAttribute = !(url.StartsWithAny(StringComparison.InvariantCulture, </code><code class="string">"~"</code><code class="plain">, </code><code class="string">"/"</code><code class="plain">));</code></div>
<div class="line"><code class="plain">		</code><code class="keyword">base</code><code class="plain">.OnPreInit(e);</code></div>
<div class="line"><code class="plain">	}</code></div>
</div>
    </div>
        </div>

    </article>


               
            
    <footer id="ht-footer">
    <a href="#" id="ht-jump-top" class="sp-aui-icon-small sp-aui-iconfont-arrows-up"></a>
</footer></div>

<div>
    <div id="ht-mq-detect"></div>
</div>

    <script src="js/lunr.js"></script>
    <script src="js/lunr-extras.js"></script>
    <script src="assets/js/scroll-search.js"></script>

    <script src="assets/js/expand-macro.js"></script>
</body>
</html>
