<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Adding custom macro fields - Kentico 11 Documentation</title>

    
    <link rel="stylesheet" href="assets/css/expand-macro.css">

            <meta name="scroll-content-language-key" content="">
    
    <meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=2.0, user-scalable=yes">

<script type="text/javascript" src="assets/js/jquery.min.js"></script>
<script type="text/javascript" src="assets/js/jquery.scrollTo.min.js"></script>


<script type="text/javascript" src="assets/js/translate.js"></script>

<script type="text/javascript" src="assets/js/theme.main.js"></script>

    <script type="text/javascript" src="assets/js/iframeResizer.min.js"></script>

<link rel="stylesheet" href="assets/css/content-style.css">
    <link rel="stylesheet" href="assets/css/search.css">

<link rel="stylesheet" href="assets/css/theme.main.css">
<link rel="stylesheet" href="assets/css/theme.colors.css">

            <!-- ES5 support for older browsers, needed by lunr -->
        <script src="js/augment.js"></script>
        <script id="worker" type="javascript/worker">

        startIndex = function() {
            idx = lunr.Index.load(lunrIndex);
            idx.pipeline.remove(lunr.stopWordFilter);
            postMessage({type: "setup-complete"});
        }

        onmessage = function (event) {
            var message = event.data;

            if ((message.type === 'setup') && message.baseUrl) {
                var url = message.baseUrl;
                importScripts(url + 'js/lunr.js');
                importScripts(url + 'js/lunr-extras.js');
                importScripts(url + 'js/lunr-index.js');
                importScripts(url + 'js/lunr-data.js');
                startIndex();
            }

            if (idx && (message.type === 'search-request') && message.query) {
                var searchWord = message.query;
                var results = idx.search(searchWord).map(function (result) {
                    return lunrData.filter(function (d) {
                        return d.id === parseInt(result.ref, 10)
                    })[0]
                });
                postMessage({type: 'search-results', results: results, query: searchWord, queryId: message.queryId});
            }
        }

    </script>
    </head>

<body pageid="68879260">

<div id="ht-loader">
    <noscript>
        <p style="width: 100%; text-align:center; position: absolute; margin-top: 200px;">This content cannot be displayed without JavaScript.<br>Please enable JavaScript and reload the page.</p>
    </noscript>
</div>

<div>
   	<header id="ht-headerbar">
    <div class="ht-headerbar-left">
        <a href="" id="ht-menu-toggle" class="sp-aui-icon-small sp-aui-iconfont-appswitcher"></a>
    </div>
    <div class="ht-headerbar-right">
            <div class="sp-aui-icon-small ht-search-index-loader ht-header-icon"></div>

        <div id="ht-search">
            <div class="ht-search-input" style="display: none;">
              	<a href="#" class="sp-aui-icon-small sp-aui-iconfont-remove ht-search-clear"></a>

                <form action="#" method="GET" id="search">
                    <input class="search-input" type="text" placeholder="Search" tabindex="-1" autocomplete="off" name="q" value="">
                    <input type="hidden" name="max" value="15" />
                    <input type="submit" style="display:none" tabindex="-4"/>
                </form>

                <a href="#" id="ht-search-button" class="ht-header-icon ht-header-icon-svg">
                                        <svg width="40px" height="40px" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                        <g>
                            <path d="M29.572,28.802 L28.801,29.571 C28.515,29.857 28.187,30 27.816,30 C27.445,30 27.116,29.857 26.831,29.571 L21.392,24.134 C20.193,24.762 18.908,25.076 17.538,25.076 C15.396,25.076 13.605,24.348 12.163,22.892 C10.721,21.436 10,19.651 10,17.538 C10,15.397 10.721,13.605 12.163,12.163 C13.605,10.721 15.396,10 17.538,10 C19.651,10 21.434,10.721 22.89,12.163 C24.347,13.605 25.075,15.397 25.075,17.538 C25.075,18.937 24.761,20.222 24.132,21.393 L29.572,26.832 C29.857,27.118 30,27.446 30,27.817 C30,28.188 29.857,28.517 29.572,28.802 L29.572,28.802 Z M13.662,21.414 C14.732,22.485 16.024,23.02 17.538,23.02 C19.051,23.02 20.343,22.485 21.413,21.414 C22.484,20.344 23.019,19.052 23.019,17.538 C23.019,16.025 22.484,14.733 21.413,13.662 C20.343,12.592 19.051,12.056 17.538,12.056 C16.024,12.056 14.732,12.592 13.662,13.662 C12.591,14.733 12.056,16.025 12.056,17.538 C12.056,19.052 12.591,20.344 13.662,21.414 L13.662,21.414 Z"></path>
                        </g>
                    </svg>
              	</a>

                <div class="ht-search-dropdown ht-dropdown">
                    <ul></ul>
                </div>
            </div>
        </div>
    </div>
    </header>   	<aside id="ht-sidebar">
    <div class="ht-sidebar-content">
        <div class="ht-sidebar-content-scroll-container">
            <header class="ht-sidebar-header">
                <h1 class="ht-logo">
                    <span class="ht-logo-label">K11</span>
                    <img class="space-logo" src="global.logo" />
                </h1>
                <a href="Kentico_11_Documentation_Home.html" class="ht-space-link">
                    <h2>Kentico 11 Documentation</h2>
                </a>
            </header>
                            <iframe id="ht-nav" src="toc.html?pageId=68882636"></iframe>
                <script>
                    $('iframe#ht-nav').iFrameResize(
                            { 'log': true, 'autoResize': true, 'heightCalculationMethod': 'lowestElement', 'checkOrigin': false });
                </script>
                    </div>
    </div>

</aside></div>

<div id="ht-wrap-container">

            
    <div id="ht-sidebar-dragbar">
    <div class="ht-sidebar-drag-handle">
        <span class="drag-handle-1"></span>
        <span class="drag-handle-2"></span>
        <span class="drag-handle-3"></span>
    </div>
</div>
    <article id="ht-content" class="ht-content">
        <header class="ht-content-header">
            <div id="ht-breadcrumb">
    <ul>
        <li><a href="Kentico_11_Documentation_Home.html">Kentico 11 Documentation</a></li>
                                                                                                             <li><a href="" onclick="$('.shortcut').each(function(){$(this).removeClass('shortcut')}); $(this).parent().addClass('shortcut'); return false;">...</a> </li>
                                        <li class="shortcut"><a href="Macro_expressions.html">Macro expressions</a></li>
                                                                                     <li><a href="Extending_the_macro_engine.html">Extending the macro engine</a></li>
                                                            </ul>
</div>            <h1 id="src-68882636"> <span>Adding custom macro fields</span></h1>
        </header>

        <div id="main-content" class="wiki-content sp-grid-section" data-index-for-search="true">
        $page.content
<p   
>Fields (properties) allow users to load values in macro expressions. Field values can be of any supported type, from simple scalar types (strings, numbers) to objects and collections. The macro engine supports fields both as members of objects or namespaces, and as independent values.</p>
<p   
>The system provides two different ways to add your own macro fields:</p>
<ul class=" "><li class=" "><p   
><a   href="#src-68882636_Addingcustommacrofields-Registeringfieldsintomacroresolvers">Register fields into macro resolvers</a></p>
</li><li class=" "><p   
><a   href="#src-68882636_Addingcustommacrofields-Addingcustommacrofieldstoexistingobjecttypes">Extend existing objects or macro namespaces</a></p>
</li></ul>    <h3 id="src-68882636_Addingcustommacrofields-Registeringfieldsintomacroresolvers" class="heading "><span>Registering fields into macro resolvers</span></h3>
<p   
>Macro resolvers are system components that ensure the processing of macros. The resolvers are organized in a hierarchy that allows child resolvers to inherit all macro options from the parent. The <strong class=" "><i class=" ">Global resolver</i></strong> is the parent of all other resolvers in the system. By adding fields into the global resolver, you create new macros that are available in all parts of the system.</p>
<p   
>To add custom macro fields, you need to register data sources into resolvers:</p>
<ul class=" "><li class=" "><p   
><a   href="#src-68882636_Addingcustommacrofields-Namedsources">Named sources</a></p>
</li><li class=" "><p   
><a   href="#src-68882636_Addingcustommacrofields-Namedcallbacksources">Named callback sources</a></p>
</li><li class=" "><p   
><a   href="#src-68882636_Addingcustommacrofields-Anonymoussources">Anonymous sources</a></p>
</li></ul>    <div  class="confbox panel">
            <div class="title panel-header">On this page</div>
            <div class="panel-content">
<p   
></p>
<ul class="toc-indentation "><li class=" "><p   
><a   href="#src-68882636_Addingcustommacrofields-Registeringfieldsintomacroresolvers">Registering fields into macro resolvers</a></p>
<ul class="toc-indentation "><li class=" "><p   
><a   href="#src-68882636_Addingcustommacrofields-Namedsources">Named sources</a></p>
</li><li class=" "><p   
><a   href="#src-68882636_Addingcustommacrofields-Namedcallbacksources">Named callback sources</a></p>
</li><li class=" "><p   
><a   href="#src-68882636_Addingcustommacrofields-Anonymoussources">Anonymous sources</a></p>
</li><li class=" "><p   
><a   href="#src-68882636_Addingcustommacrofields-Example-Addingcustommacrostotheglobalresolver">Example - Adding custom macros to the global resolver</a></p>
</li></ul></li><li class=" "><p   
><a   href="#src-68882636_Addingcustommacrofields-Addingcustommacrofieldstoexistingobjecttypes">Adding custom macro fields to existing object types</a></p>
</li></ul><p   
></p>
        </div>
    </div>
    <div  class="confbox panel">
            <div class="title panel-header">Related pages</div>
            <div class="panel-content">
<ul class=" "><li class=" "><p   
><a   href="Registering_custom_macro_methods.html">Registering custom macro methods</a></p>
</li><li class=" "><p   
><a   href="Creating_macro_namespaces.html">Creating macro namespaces</a></p>
</li></ul>        </div>
    </div>
    <h4 id="src-68882636_Addingcustommacrofields-Namedsources" class="heading "><span>Named sources</span></h4>
<p   
>Use named macro sources to directly register objects or scalar values into resolvers. Named sources appear in the macro autocomplete help and macro tree.</p>
<p   
>Call the <strong class=" ">SetNamedSourceData</strong> method for a resolver object, with the following parameters:</p>
<ul class=" "><li class=" "><p   
>A string that sets the name of the macro field (used in macro syntax).</p>
</li><li class=" "><p   
>The object that the system returns when resolving the field in macro expressions.</p>
</li><li class=" "><p   
>(Optional) By default, the registered fields appear in the high priority section of the autocomplete help and macro tree. To add namespaces with normal priority, add <strong class=" ">false</strong> as the third parameter.</p>
</li></ul>    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                    <div class="title">Example</div>
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-title="Example" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="keyword">using</code><code class="plain"> CMS.MacroEngine;</code></div>
<div class="line"><code class="keyword">using</code><code class="plain"> CMS.Membership;</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">...</code></div>
<div class="line"> </div>
<div class="line"><code class="comments">// Registers macro fields into the global resolver</code></div>
<div class="line"><code class="plain">MacroContext.GlobalResolver.SetNamedSourceData(</code><code class="string">"MacroField"</code><code class="plain">, </code><code class="string">"RESOLVED Value 1"</code><code class="plain">);</code></div>
<div class="line"><code class="plain">MacroContext.GlobalResolver.SetNamedSourceData(</code><code class="string">"MyUser"</code><code class="plain">, UserInfoProvider.GetUserInfo(</code><code class="string">"administrator"</code><code class="plain">));</code></div>
</div>
    </div>
<p   
>Users can work with the new macros in any part of the system that uses the given macro resolver. If the field&#39;s value is an object containing additional fields, you always need to access the fields as members of the object itself. For example:</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">The name of my user in upper </code><code class="keyword">case</code><code class="plain"> is: {% MyUser.UserName.ToUpper() %}</code></div>
<div class="line"><code class="plain">First eight characters of the MacroField value: {% MacroField.Substring(</code><code class="value">0</code><code class="plain">, </code><code class="value">8</code><code class="plain">) %}</code></div>
</div>
    </div>
    <h4 id="src-68882636_Addingcustommacrofields-Namedcallbacksources" class="heading "><span>Named callback sources</span></h4>
<p   
>You can define macro fields that use a <a  class="external-link" href="http://msdn.microsoft.com/en-us/library/d186xcf0%28v=vs.110%29.aspx">callback method</a> to get the value. This approach allows you to calculate the field&#39;s value in a separate method.</p>
<p   
>Call the <strong class=" ">SetNamedSourceDataCallback</strong> method for a resolver object with the following parameters:</p>
<ul class=" "><li class=" "><p   
>A string that sets the name of the macro field (used in macro syntax).</p>
</li><li class=" "><p   
>The name of the callback method.</p>
</li><li class=" "><p   
>(Optional) By default, the registered fields appear in the high priority section of the autocomplete help and macro tree. To add namespaces with normal priority, add <strong class=" ">false</strong> as the third parameter.</p>
</li></ul>    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                    <div class="title">Example</div>
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-title="Example" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="keyword">using</code><code class="plain"> CMS.MacroEngine;</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">...</code></div>
<div class="line"> </div>
<div class="line"><code class="comments">// Registers a single macro field, with the value processed using a callback method</code></div>
<div class="line"><code class="plain">MacroContext.GlobalResolver.SetNamedSourceDataCallback(</code><code class="string">"CallbackField"</code><code class="plain">, MacroFieldEvaluator);</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">...</code></div>
<div class="line"> </div>
<div class="line"><code class="comments">// Callback method that provides the value of the 'CallbackField' macro field</code></div>
<div class="line"><code class="keyword">private</code><code class="plain"> </code><code class="keyword">object</code><code class="plain"> MacroFieldEvaluator(EvaluationContext context)</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">	</code><code class="comments">// Returns the result of the macro.</code></div>
<div class="line"><code class="plain">	</code><code class="comments">// The example is only a demonstration of the basic principles. The method can be as complex as required.</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">return</code><code class="plain"> </code><code class="string">"Macro return value"</code><code class="plain">;</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
<p   
>Users can work with the new macros in any part of the system that uses the given macro resolver. For example: <i class=" ">{% CallbackField %}</i></p>
    <div  class="confbox admonition admonition-note">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p   
><strong class=" ">Note</strong>: The system executes the callback for every occurrence of the custom macro. If the evaluator method contains any computationally intensive logic, we recommend implementing a <a   href="Caching_in_custom_code.html">caching mechanism</a> for the result to optimize performance.</p>
        </div>
    </div>
    <h4 id="src-68882636_Addingcustommacrofields-Anonymoussources" class="heading "><span>Anonymous sources</span></h4>
<p   
>When you register an object as an anonymous macro source, users can access the object&#39;s data fields, but not the object itself.</p>
<p   
>Call the <strong class=" ">AddAnonymousSourceData </strong>method for a resolver object, with the appropriate data object as the parameter (for example a <a  class="external-link" href="http://msdn.microsoft.com/en-us/library/system.data.datarow%28v=vs.100%29.aspx">DataRow</a>).</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="keyword">using</code><code class="plain"> CMS.MacroEngine;</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">...</code></div>
<div class="line"> </div>
<div class="line"><code class="comments">// Prepares sample data in a DataRow</code></div>
<div class="line"><code class="plain">DataTable table = </code><code class="keyword">new</code><code class="plain"> DataTable();</code></div>
<div class="line"><code class="plain">table.Columns.Add(</code><code class="string">"Field1"</code><code class="plain">, </code><code class="keyword">typeof</code><code class="plain">(</code><code class="keyword">string</code><code class="plain">));</code></div>
<div class="line"><code class="plain">table.Columns.Add(</code><code class="string">"Field2"</code><code class="plain">, </code><code class="keyword">typeof</code><code class="plain">(</code><code class="keyword">string</code><code class="plain">));</code></div>
<div class="line"><code class="plain">table.Columns.Add(</code><code class="string">"Field3"</code><code class="plain">, </code><code class="keyword">typeof</code><code class="plain">(</code><code class="keyword">int</code><code class="plain">));</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">table.Rows.Add(</code><code class="string">"Value1"</code><code class="plain">, </code><code class="string">"Value2"</code><code class="plain">, 42);</code></div>
<div class="line"> </div>
<div class="line"><code class="comments">// Registers the data into the global resolver as an anonymous source</code></div>
<div class="line"><code class="plain">MacroContext.GlobalResolver.AddAnonymousSourceData(table.Rows[0]);</code></div>
</div>
    </div>
<p   
>In macro expressions, users can access the data fields (columns) inside the anonymous source, without referring to the actual registered object.</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="plain">{% Field1 %}</code></div>
<div class="line"><code class="plain">{% Field2 %}</code></div>
<div class="line"><code class="plain">{% Field3 %}</code></div>
</div>
    </div>
<p  class="auto-cursor-target" 
>Data fields registered through an anonymous macro source are resolved normally by the system, but do NOT appear in the macro autocomplete help.</p>
    <div  class="confbox admonition admonition-info">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p   
><strong class=" ">Note</strong>: Macro resolver objects also have <strong class=" ">SetAnonymousSourceData</strong> method, which works the same way as <i class=" ">AddAnonymousSourceData,</i> but also directly replaces any other anonymous sources registered into the given resolver. Do NOT call the <i class=" ">SetAnonymousSourceData</i> method for the <i class=" ">GlobalResolver.</i></p>
        </div>
    </div>
    <h4 id="src-68882636_Addingcustommacrofields-Example-Addingcustommacrostotheglobalresolver" class="heading "><span>Example - Adding custom macros to the global resolver</span></h4>
<p   
>The following example demonstrates how to add a custom field to the global macro resolver. The global resolver is the parent of all other resolvers. Macro fields that you add into the global resolver become available in all parts of the system. The sample macro uses a callback method to calculate the age of the current user.</p>
<ol class=" "><li class=" "><p   
>Open your web project in Visual Studio.</p>
</li><li class=" "><p   
>Create a <a   href="Initializing_modules_to_run_custom_code.html">custom module class</a>.</p>
<ul class=" "><li class=" "><p   
>Either add the class into a custom project within the Kentico solution (recommended) or directly into the Kentico web project (into the <strong class=" ">CMSApp</strong> project for <i class=" ">web application</i> installations, into the <strong class=" ">App_Code</strong> folder for <i class=" ">web site</i> installations).</p>
</li></ul>    <div  class="confbox admonition admonition-info">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p   
>For basic execution of initialization code, you only need to register a &quot;code-only&quot; module through the API. You do NOT need to create a new module within the <strong class=" ">Modules</strong> application in the Kentico administration interface.</p>
        </div>
    </div>
</li><li class=" "><p   
>Override the module&#39;s <strong class=" ">OnInit</strong> method and call the <strong class=" ">SetNamedSourceDataCallback</strong> method for the <strong class=" ">GlobalResolver</strong>.</p>
</li><li class=" "><p   
>Define the callback method.</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="keyword">using</code><code class="plain"> System;</code></div>
<div class="line"> </div>
<div class="line"><code class="keyword">using</code><code class="plain"> CMS;</code></div>
<div class="line"><code class="keyword">using</code><code class="plain"> CMS.Base;</code></div>
<div class="line"><code class="keyword">using</code><code class="plain"> CMS.DataEngine;</code></div>
<div class="line"><code class="keyword">using</code><code class="plain"> CMS.MacroEngine;</code></div>
<div class="line"><code class="keyword">using</code><code class="plain"> CMS.Membership;</code></div>
<div class="line"> </div>
<div class="line"><code class="comments">// Registers the custom module into the system</code></div>
<div class="line"><code class="plain">[assembly: RegisterModule(</code><code class="keyword">typeof</code><code class="plain">(CustomMacroModule))]</code></div>
<div class="line"> </div>
<div class="line"><code class="keyword">public</code><code class="plain"> </code><code class="keyword">class</code><code class="plain"> CustomMacroModule : Module</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">	</code><code class="comments">// Module class constructor, the system registers the module under the name "CustomMacros"</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">public</code><code class="plain"> CustomMacroModule()</code></div>
<div class="line"><code class="plain">		: </code><code class="keyword">base</code><code class="plain">(</code><code class="string">"CustomMacros"</code><code class="plain">)</code></div>
<div class="line"><code class="plain">	{</code></div>
<div class="line"><code class="plain">	}</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">	</code><code class="comments">// Contains initialization code that is executed when the application starts</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">protected</code><code class="plain"> </code><code class="keyword">override</code><code class="plain"> </code><code class="keyword">void</code><code class="plain"> OnInit()</code></div>
<div class="line"><code class="plain">	{</code></div>
<div class="line"><code class="plain">		</code><code class="keyword">base</code><code class="plain">.OnInit();</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">		</code><code class="comments">// Adds the 'MyAge' field to the global macro resolver</code></div>
<div class="line"><code class="plain">		MacroContext.GlobalResolver.SetNamedSourceDataCallback(</code><code class="string">"MyAge"</code><code class="plain">, MyAgeEvaluator);</code></div>
<div class="line"><code class="plain">	}</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">	</code><code class="comments">// Callback method that defines the result of the 'MyAge' macro field</code></div>
<div class="line"><code class="plain">	</code><code class="keyword">private</code><code class="plain"> </code><code class="keyword">object</code><code class="plain"> MyAgeEvaluator(EvaluationContext context)</code></div>
<div class="line"><code class="plain">	{</code></div>
<div class="line"><code class="plain">		</code><code class="comments">// Gets the birth date of the current user</code></div>
<div class="line"><code class="plain">		DateTime dateOfBirth = MembershipContext.AuthenticatedUser.UserSettings.UserDateOfBirth;</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">		</code><code class="keyword">if</code><code class="plain"> (dateOfBirth == DateTime.MinValue)</code></div>
<div class="line"><code class="plain">		{</code></div>
<div class="line"><code class="plain">			</code><code class="keyword">return</code><code class="plain"> </code><code class="string">"Date of birth is unknown."</code><code class="plain">;</code></div>
<div class="line"><code class="plain">		}</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">		DateTime now = DateTime.Now;</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">		</code><code class="comments">// Calculates the basic difference in years</code></div>
<div class="line"><code class="plain">		</code><code class="keyword">int</code><code class="plain"> age = now.Year - dateOfBirth.Year;</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">		</code><code class="comments">// Subtracts one year if the current user's birthday has not occurred yet this year</code></div>
<div class="line"><code class="plain">		</code><code class="keyword">if</code><code class="plain"> (dateOfBirth.AddYears(age) &gt; now)</code></div>
<div class="line"><code class="plain">		{</code></div>
<div class="line"><code class="plain">			age--;</code></div>
<div class="line"><code class="plain">		}</code></div>
<div class="line"> </div>
<div class="line"><code class="plain">		</code><code class="keyword">return</code><code class="plain"> age;</code></div>
<div class="line"><code class="plain">	}</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
</li><li class=" "><p   
>Save the class. On <i class=" ">web application</i> installations, build the solution.</p>
</li></ol><p   
>You can now try entering the <i class=" "><strong class=" ">{% MyAge %}</strong></i> expression in any part of the system where macros are supported. The macro autocomplete help automatically offers the custom field in the high priority section.</p>
<p   
><img  class="confluence-embedded-image confluence-content-image-border"  src="images/download/attachments/68882636/Custom_Macro_Field_Result.png" alt="images/download/attachments/68882636/Custom_Macro_Field_Result.png" width="293" height="218" />
        <br/><span class="caption">'MyAge' field appearing in the autocomplete help when writing macros</span>
    </p>
    <h3 id="src-68882636_Addingcustommacrofields-Addingcustommacrofieldstoexistingobjecttypes" class="heading "><span>Adding custom macro fields to existing object types</span></h3>
<p   
>The macro engine allows you to add <strong class=" "><i class=" ">static</i></strong> fields to existing object types or <a   href="Creating_macro_namespaces.html">macro namespaces</a>.</p>
<p   
>Start by defining your fields inside a container class:</p>
<ol class=" "><li class=" "><p   
>Open your project in Visual Studio.</p>
</li><li class=" "><p   
>Create a new class. In <i class=" ">web site</i> projects, you can either add the class into the <strong class=" ">App_Code</strong> folder or as part of a custom assembly.</p>
</li><li class=" "><p   
>Make the class inherit from <strong class=" ">MacroFieldContainer</strong>.</p>
</li><li class=" "><p   
>Override the <strong class=" ">RegisterFields</strong> method.</p>
</li><li class=" "><p   
>Call <strong class=" ">RegisterField</strong> to define your custom fields.</p>
    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="keyword">using</code><code class="plain"> CMS.MacroEngine;</code></div>
<div class="line"><code class="keyword">using</code><code class="plain"> CMS.Membership;</code></div>
<div class="line"> </div>
<div class="line"><code class="keyword">public</code><code class="plain"> </code><code class="keyword">class</code><code class="plain"> CustomMacroFields : MacroFieldContainer</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">    </code><code class="keyword">protected</code><code class="plain"> </code><code class="keyword">override</code><code class="plain"> </code><code class="keyword">void</code><code class="plain"> RegisterFields()</code></div>
<div class="line"><code class="plain">    {</code></div>
<div class="line"><code class="plain">        </code><code class="keyword">base</code><code class="plain">.RegisterFields();</code></div>
<div class="line"><code class="plain"> </code></div>
<div class="line"><code class="plain">		</code><code class="comments">// Defines a custom macro field in the container</code></div>
<div class="line"><code class="plain">		RegisterField(</code><code class="keyword">new</code><code class="plain"> MacroField(</code><code class="string">"MyUser"</code><code class="plain">, () =&gt; UserInfoProvider.GetUserInfo(</code><code class="string">"administrator"</code><code class="plain">)));</code></div>
<div class="line"><code class="plain">	}</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
    </div>
    <div  class="confbox admonition admonition-info">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p   
>The <i class=" ">RegisterFields</i> method accepts a <strong class=" ">MacroField</strong> parameter. Specify the following information for each macro field:</p>
<ul class=" "><li class=" "><p   
>The field&#39;s name (used in macro syntax).</p>
</li><li class=" "><p   
>The value of the field. Define the value using a <a  class="external-link" href="http://msdn.microsoft.com/en-us/library/bb397687.aspx">lambda expression</a>.</p>
</li></ul>        </div>
    </div>
</li></ol><p   
>Register your macro field container class by extending an object type or macro namespace.</p>
<p   
>Add a <strong class=" ">RegisterExtension</strong> assembly attribute above the class declaration for each type that you wish to extend (requires a reference to the <strong class=" ">CMS</strong> namespace).</p>
<p   
>Specify the type parameters for the <strong class=" ">RegisterExtension</strong> attribute in the following format:</p>
<p   
><strong class=" ">[assembly: RegisterExtension(typeof(<i class=" ">&lt;macro field container class&gt;</i>), typeof(<i class=" ">&lt;extended type&gt;</i>))]</strong></p>
<p   
>You can extend the following types:</p>
<ul class=" "><li class=" "><p   
>General system types (string, int, ...)</p>
</li><li class=" "><p   
>Kentico API object types (UserInfo, TreeNode, ...)</p>
</li><li class=" "><p   
><a   href="Creating_macro_namespaces.html">Macro namespaces</a> (SystemNamespace, StringNamespace, MathNamespace, ...)</p>
</li><li class=" "><p   
>Custom types</p>
</li></ul>    <div  class="confbox programlisting" style="counter-reset: scroll-code-numbering 1">
                    <div class="title">Example</div>
                <div xmlns="http://www.w3.org/1999/xhtml" class="defaultnew syntaxhighlighter scroll-html-formatted-code" data-title="Example" data-linenumbers="false" data-firstline="1">
<div class="line"><code class="keyword">using</code><code class="plain"> CMS;</code></div>
<div class="line"> </div>
<div class="line"><code class="keyword">using</code><code class="plain"> CMS.MacroEngine;</code></div>
<div class="line"><code class="keyword">using</code><code class="plain"> CMS.Membership;</code></div>
<div class="line"> </div>
<div class="line"><code class="comments">// Registers fields from the 'CustomMacroFields' container into the "System" macro namespace</code></div>
<div class="line"><code class="plain">[assembly: RegisterExtension(</code><code class="keyword">typeof</code><code class="plain">(CustomMacroFields), </code><code class="keyword">typeof</code><code class="plain">(SystemNamespace))]</code></div>
<div class="line"> </div>
<div class="line"><code class="keyword">public</code><code class="plain"> </code><code class="keyword">class</code><code class="plain"> CustomMacroFields : MacroFieldContainer</code></div>
<div class="line"><code class="plain">{</code></div>
<div class="line"><code class="plain">...</code></div>
</div>
    </div>
<p   
>The attribute registers your custom field container class. You can access the field&#39;s value in macro expressions as a member of the extended object type or namespace.</p>
    <div  class="confbox admonition admonition-note">
                            <span class="admonition-icon confluence-information-macro-icon"></span>
                <div class="admonition-body">
<p   
><strong class=" ">Important</strong>: If your macro field container class is defined within a custom assembly, the assembly project must contain the <strong class=" ">[assembly: AssemblyDiscoverable]</strong> attribute (the recommended location is in the <i class=" ">Properties/AssemblyInfo.cs</i> file). To use the attribute, your assembly&#39;s project must contain a reference to the <i class=" ">CMS.Core.dll</i> library.</p>
        </div>
    </div>
        </div>

    </article>


               
            
    <footer id="ht-footer">
    <a href="#" id="ht-jump-top" class="sp-aui-icon-small sp-aui-iconfont-arrows-up"></a>
</footer></div>

<div>
    <div id="ht-mq-detect"></div>
</div>

    <script src="js/lunr.js"></script>
    <script src="js/lunr-extras.js"></script>
    <script src="assets/js/scroll-search.js"></script>

    <script src="assets/js/expand-macro.js"></script>
</body>
</html>
